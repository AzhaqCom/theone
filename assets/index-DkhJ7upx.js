(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))i(u);new MutationObserver(u=>{for(const m of u)if(m.type==="childList")for(const f of m.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&i(f)}).observe(document,{childList:!0,subtree:!0});function s(u){const m={};return u.integrity&&(m.integrity=u.integrity),u.referrerPolicy&&(m.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?m.credentials="include":u.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function i(u){if(u.ep)return;u.ep=!0;const m=s(u);fetch(u.href,m)}})();function xo(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var ao={exports:{}},ll={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pp;function fg(){if(pp)return ll;pp=1;var r=Symbol.for("react.transitional.element"),l=Symbol.for("react.fragment");function s(i,u,m){var f=null;if(m!==void 0&&(f=""+m),u.key!==void 0&&(f=""+u.key),"key"in u){m={};for(var p in u)p!=="key"&&(m[p]=u[p])}else m=u;return u=m.ref,{$$typeof:r,type:i,key:f,ref:u!==void 0?u:null,props:m}}return ll.Fragment=l,ll.jsx=s,ll.jsxs=s,ll}var fp;function hg(){return fp||(fp=1,ao.exports=fg()),ao.exports}var c=hg(),no={exports:{}},fe={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hp;function gg(){if(hp)return fe;hp=1;var r=Symbol.for("react.transitional.element"),l=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),u=Symbol.for("react.profiler"),m=Symbol.for("react.consumer"),f=Symbol.for("react.context"),p=Symbol.for("react.forward_ref"),g=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),b=Symbol.iterator;function S(j){return j===null||typeof j!="object"?null:(j=b&&j[b]||j["@@iterator"],typeof j=="function"?j:null)}var A={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},T=Object.assign,N={};function q(j,k,Q){this.props=j,this.context=k,this.refs=N,this.updater=Q||A}q.prototype.isReactComponent={},q.prototype.setState=function(j,k){if(typeof j!="object"&&typeof j!="function"&&j!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,j,k,"setState")},q.prototype.forceUpdate=function(j){this.updater.enqueueForceUpdate(this,j,"forceUpdate")};function _(){}_.prototype=q.prototype;function D(j,k,Q){this.props=j,this.context=k,this.refs=N,this.updater=Q||A}var G=D.prototype=new _;G.constructor=D,T(G,q.prototype),G.isPureReactComponent=!0;var re=Array.isArray,F={H:null,A:null,T:null,S:null,V:null},ee=Object.prototype.hasOwnProperty;function I(j,k,Q,Z,te,pe){return Q=pe.ref,{$$typeof:r,type:j,key:k,ref:Q!==void 0?Q:null,props:pe}}function ne(j,k){return I(j.type,k,void 0,void 0,void 0,j.props)}function K(j){return typeof j=="object"&&j!==null&&j.$$typeof===r}function he(j){var k={"=":"=0",":":"=2"};return"$"+j.replace(/[=:]/g,function(Q){return k[Q]})}var oe=/\/+/g;function Ce(j,k){return typeof j=="object"&&j!==null&&j.key!=null?he(""+j.key):k.toString(36)}function Ye(){}function $(j){switch(j.status){case"fulfilled":return j.value;case"rejected":throw j.reason;default:switch(typeof j.status=="string"?j.then(Ye,Ye):(j.status="pending",j.then(function(k){j.status==="pending"&&(j.status="fulfilled",j.value=k)},function(k){j.status==="pending"&&(j.status="rejected",j.reason=k)})),j.status){case"fulfilled":return j.value;case"rejected":throw j.reason}}throw j}function U(j,k,Q,Z,te){var pe=typeof j;(pe==="undefined"||pe==="boolean")&&(j=null);var ie=!1;if(j===null)ie=!0;else switch(pe){case"bigint":case"string":case"number":ie=!0;break;case"object":switch(j.$$typeof){case r:case l:ie=!0;break;case y:return ie=j._init,U(ie(j._payload),k,Q,Z,te)}}if(ie)return te=te(j),ie=Z===""?"."+Ce(j,0):Z,re(te)?(Q="",ie!=null&&(Q=ie.replace(oe,"$&/")+"/"),U(te,k,Q,"",function(Ft){return Ft})):te!=null&&(K(te)&&(te=ne(te,Q+(te.key==null||j&&j.key===te.key?"":(""+te.key).replace(oe,"$&/")+"/")+ie)),k.push(te)),1;ie=0;var Je=Z===""?".":Z+":";if(re(j))for(var Ae=0;Ae<j.length;Ae++)Z=j[Ae],pe=Je+Ce(Z,Ae),ie+=U(Z,k,Q,pe,te);else if(Ae=S(j),typeof Ae=="function")for(j=Ae.call(j),Ae=0;!(Z=j.next()).done;)Z=Z.value,pe=Je+Ce(Z,Ae++),ie+=U(Z,k,Q,pe,te);else if(pe==="object"){if(typeof j.then=="function")return U($(j),k,Q,Z,te);throw k=String(j),Error("Objects are not valid as a React child (found: "+(k==="[object Object]"?"object with keys {"+Object.keys(j).join(", ")+"}":k)+"). If you meant to render a collection of children, use an array instead.")}return ie}function E(j,k,Q){if(j==null)return j;var Z=[],te=0;return U(j,Z,"","",function(pe){return k.call(Q,pe,te++)}),Z}function B(j){if(j._status===-1){var k=j._result;k=k(),k.then(function(Q){(j._status===0||j._status===-1)&&(j._status=1,j._result=Q)},function(Q){(j._status===0||j._status===-1)&&(j._status=2,j._result=Q)}),j._status===-1&&(j._status=0,j._result=k)}if(j._status===1)return j._result.default;throw j._result}var Y=typeof reportError=="function"?reportError:function(j){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var k=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof j=="object"&&j!==null&&typeof j.message=="string"?String(j.message):String(j),error:j});if(!window.dispatchEvent(k))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",j);return}console.error(j)};function J(){}return fe.Children={map:E,forEach:function(j,k,Q){E(j,function(){k.apply(this,arguments)},Q)},count:function(j){var k=0;return E(j,function(){k++}),k},toArray:function(j){return E(j,function(k){return k})||[]},only:function(j){if(!K(j))throw Error("React.Children.only expected to receive a single React element child.");return j}},fe.Component=q,fe.Fragment=s,fe.Profiler=u,fe.PureComponent=D,fe.StrictMode=i,fe.Suspense=g,fe.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=F,fe.__COMPILER_RUNTIME={__proto__:null,c:function(j){return F.H.useMemoCache(j)}},fe.cache=function(j){return function(){return j.apply(null,arguments)}},fe.cloneElement=function(j,k,Q){if(j==null)throw Error("The argument must be a React element, but you passed "+j+".");var Z=T({},j.props),te=j.key,pe=void 0;if(k!=null)for(ie in k.ref!==void 0&&(pe=void 0),k.key!==void 0&&(te=""+k.key),k)!ee.call(k,ie)||ie==="key"||ie==="__self"||ie==="__source"||ie==="ref"&&k.ref===void 0||(Z[ie]=k[ie]);var ie=arguments.length-2;if(ie===1)Z.children=Q;else if(1<ie){for(var Je=Array(ie),Ae=0;Ae<ie;Ae++)Je[Ae]=arguments[Ae+2];Z.children=Je}return I(j.type,te,void 0,void 0,pe,Z)},fe.createContext=function(j){return j={$$typeof:f,_currentValue:j,_currentValue2:j,_threadCount:0,Provider:null,Consumer:null},j.Provider=j,j.Consumer={$$typeof:m,_context:j},j},fe.createElement=function(j,k,Q){var Z,te={},pe=null;if(k!=null)for(Z in k.key!==void 0&&(pe=""+k.key),k)ee.call(k,Z)&&Z!=="key"&&Z!=="__self"&&Z!=="__source"&&(te[Z]=k[Z]);var ie=arguments.length-2;if(ie===1)te.children=Q;else if(1<ie){for(var Je=Array(ie),Ae=0;Ae<ie;Ae++)Je[Ae]=arguments[Ae+2];te.children=Je}if(j&&j.defaultProps)for(Z in ie=j.defaultProps,ie)te[Z]===void 0&&(te[Z]=ie[Z]);return I(j,pe,void 0,void 0,null,te)},fe.createRef=function(){return{current:null}},fe.forwardRef=function(j){return{$$typeof:p,render:j}},fe.isValidElement=K,fe.lazy=function(j){return{$$typeof:y,_payload:{_status:-1,_result:j},_init:B}},fe.memo=function(j,k){return{$$typeof:h,type:j,compare:k===void 0?null:k}},fe.startTransition=function(j){var k=F.T,Q={};F.T=Q;try{var Z=j(),te=F.S;te!==null&&te(Q,Z),typeof Z=="object"&&Z!==null&&typeof Z.then=="function"&&Z.then(J,Y)}catch(pe){Y(pe)}finally{F.T=k}},fe.unstable_useCacheRefresh=function(){return F.H.useCacheRefresh()},fe.use=function(j){return F.H.use(j)},fe.useActionState=function(j,k,Q){return F.H.useActionState(j,k,Q)},fe.useCallback=function(j,k){return F.H.useCallback(j,k)},fe.useContext=function(j){return F.H.useContext(j)},fe.useDebugValue=function(){},fe.useDeferredValue=function(j,k){return F.H.useDeferredValue(j,k)},fe.useEffect=function(j,k,Q){var Z=F.H;if(typeof Q=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return Z.useEffect(j,k)},fe.useId=function(){return F.H.useId()},fe.useImperativeHandle=function(j,k,Q){return F.H.useImperativeHandle(j,k,Q)},fe.useInsertionEffect=function(j,k){return F.H.useInsertionEffect(j,k)},fe.useLayoutEffect=function(j,k){return F.H.useLayoutEffect(j,k)},fe.useMemo=function(j,k){return F.H.useMemo(j,k)},fe.useOptimistic=function(j,k){return F.H.useOptimistic(j,k)},fe.useReducer=function(j,k,Q){return F.H.useReducer(j,k,Q)},fe.useRef=function(j){return F.H.useRef(j)},fe.useState=function(j){return F.H.useState(j)},fe.useSyncExternalStore=function(j,k,Q){return F.H.useSyncExternalStore(j,k,Q)},fe.useTransition=function(){return F.H.useTransition()},fe.version="19.1.1",fe}var gp;function bo(){return gp||(gp=1,no.exports=gg()),no.exports}var se=bo();const Pe=xo(se);var so={exports:{}},il={},lo={exports:{}},io={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vp;function vg(){return vp||(vp=1,function(r){function l(E,B){var Y=E.length;E.push(B);e:for(;0<Y;){var J=Y-1>>>1,j=E[J];if(0<u(j,B))E[J]=B,E[Y]=j,Y=J;else break e}}function s(E){return E.length===0?null:E[0]}function i(E){if(E.length===0)return null;var B=E[0],Y=E.pop();if(Y!==B){E[0]=Y;e:for(var J=0,j=E.length,k=j>>>1;J<k;){var Q=2*(J+1)-1,Z=E[Q],te=Q+1,pe=E[te];if(0>u(Z,Y))te<j&&0>u(pe,Z)?(E[J]=pe,E[te]=Y,J=te):(E[J]=Z,E[Q]=Y,J=Q);else if(te<j&&0>u(pe,Y))E[J]=pe,E[te]=Y,J=te;else break e}}return B}function u(E,B){var Y=E.sortIndex-B.sortIndex;return Y!==0?Y:E.id-B.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var m=performance;r.unstable_now=function(){return m.now()}}else{var f=Date,p=f.now();r.unstable_now=function(){return f.now()-p}}var g=[],h=[],y=1,b=null,S=3,A=!1,T=!1,N=!1,q=!1,_=typeof setTimeout=="function"?setTimeout:null,D=typeof clearTimeout=="function"?clearTimeout:null,G=typeof setImmediate<"u"?setImmediate:null;function re(E){for(var B=s(h);B!==null;){if(B.callback===null)i(h);else if(B.startTime<=E)i(h),B.sortIndex=B.expirationTime,l(g,B);else break;B=s(h)}}function F(E){if(N=!1,re(E),!T)if(s(g)!==null)T=!0,ee||(ee=!0,Ce());else{var B=s(h);B!==null&&U(F,B.startTime-E)}}var ee=!1,I=-1,ne=5,K=-1;function he(){return q?!0:!(r.unstable_now()-K<ne)}function oe(){if(q=!1,ee){var E=r.unstable_now();K=E;var B=!0;try{e:{T=!1,N&&(N=!1,D(I),I=-1),A=!0;var Y=S;try{t:{for(re(E),b=s(g);b!==null&&!(b.expirationTime>E&&he());){var J=b.callback;if(typeof J=="function"){b.callback=null,S=b.priorityLevel;var j=J(b.expirationTime<=E);if(E=r.unstable_now(),typeof j=="function"){b.callback=j,re(E),B=!0;break t}b===s(g)&&i(g),re(E)}else i(g);b=s(g)}if(b!==null)B=!0;else{var k=s(h);k!==null&&U(F,k.startTime-E),B=!1}}break e}finally{b=null,S=Y,A=!1}B=void 0}}finally{B?Ce():ee=!1}}}var Ce;if(typeof G=="function")Ce=function(){G(oe)};else if(typeof MessageChannel<"u"){var Ye=new MessageChannel,$=Ye.port2;Ye.port1.onmessage=oe,Ce=function(){$.postMessage(null)}}else Ce=function(){_(oe,0)};function U(E,B){I=_(function(){E(r.unstable_now())},B)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(E){E.callback=null},r.unstable_forceFrameRate=function(E){0>E||125<E?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ne=0<E?Math.floor(1e3/E):5},r.unstable_getCurrentPriorityLevel=function(){return S},r.unstable_next=function(E){switch(S){case 1:case 2:case 3:var B=3;break;default:B=S}var Y=S;S=B;try{return E()}finally{S=Y}},r.unstable_requestPaint=function(){q=!0},r.unstable_runWithPriority=function(E,B){switch(E){case 1:case 2:case 3:case 4:case 5:break;default:E=3}var Y=S;S=E;try{return B()}finally{S=Y}},r.unstable_scheduleCallback=function(E,B,Y){var J=r.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?J+Y:J):Y=J,E){case 1:var j=-1;break;case 2:j=250;break;case 5:j=1073741823;break;case 4:j=1e4;break;default:j=5e3}return j=Y+j,E={id:y++,callback:B,priorityLevel:E,startTime:Y,expirationTime:j,sortIndex:-1},Y>J?(E.sortIndex=Y,l(h,E),s(g)===null&&E===s(h)&&(N?(D(I),I=-1):N=!0,U(F,Y-J))):(E.sortIndex=j,l(g,E),T||A||(T=!0,ee||(ee=!0,Ce()))),E},r.unstable_shouldYield=he,r.unstable_wrapCallback=function(E){var B=S;return function(){var Y=S;S=B;try{return E.apply(this,arguments)}finally{S=Y}}}}(io)),io}var yp;function yg(){return yp||(yp=1,lo.exports=vg()),lo.exports}var ro={exports:{}},ft={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xp;function xg(){if(xp)return ft;xp=1;var r=bo();function l(g){var h="https://react.dev/errors/"+g;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var y=2;y<arguments.length;y++)h+="&args[]="+encodeURIComponent(arguments[y])}return"Minified React error #"+g+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(){}var i={d:{f:s,r:function(){throw Error(l(522))},D:s,C:s,L:s,m:s,X:s,S:s,M:s},p:0,findDOMNode:null},u=Symbol.for("react.portal");function m(g,h,y){var b=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:u,key:b==null?null:""+b,children:g,containerInfo:h,implementation:y}}var f=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function p(g,h){if(g==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return ft.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,ft.createPortal=function(g,h){var y=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(l(299));return m(g,h,null,y)},ft.flushSync=function(g){var h=f.T,y=i.p;try{if(f.T=null,i.p=2,g)return g()}finally{f.T=h,i.p=y,i.d.f()}},ft.preconnect=function(g,h){typeof g=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,i.d.C(g,h))},ft.prefetchDNS=function(g){typeof g=="string"&&i.d.D(g)},ft.preinit=function(g,h){if(typeof g=="string"&&h&&typeof h.as=="string"){var y=h.as,b=p(y,h.crossOrigin),S=typeof h.integrity=="string"?h.integrity:void 0,A=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;y==="style"?i.d.S(g,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:b,integrity:S,fetchPriority:A}):y==="script"&&i.d.X(g,{crossOrigin:b,integrity:S,fetchPriority:A,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},ft.preinitModule=function(g,h){if(typeof g=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var y=p(h.as,h.crossOrigin);i.d.M(g,{crossOrigin:y,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&i.d.M(g)},ft.preload=function(g,h){if(typeof g=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var y=h.as,b=p(y,h.crossOrigin);i.d.L(g,y,{crossOrigin:b,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},ft.preloadModule=function(g,h){if(typeof g=="string")if(h){var y=p(h.as,h.crossOrigin);i.d.m(g,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:y,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else i.d.m(g)},ft.requestFormReset=function(g){i.d.r(g)},ft.unstable_batchedUpdates=function(g,h){return g(h)},ft.useFormState=function(g,h,y){return f.H.useFormState(g,h,y)},ft.useFormStatus=function(){return f.H.useHostTransitionStatus()},ft.version="19.1.1",ft}var bp;function Lp(){if(bp)return ro.exports;bp=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(l){console.error(l)}}return r(),ro.exports=xg(),ro.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _p;function bg(){if(_p)return il;_p=1;var r=yg(),l=bo(),s=Lp();function i(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var a=2;a<arguments.length;a++)t+="&args[]="+encodeURIComponent(arguments[a])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function u(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function m(e){var t=e,a=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,(t.flags&4098)!==0&&(a=t.return),e=t.return;while(e)}return t.tag===3?a:null}function f(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function p(e){if(m(e)!==e)throw Error(i(188))}function g(e){var t=e.alternate;if(!t){if(t=m(e),t===null)throw Error(i(188));return t!==e?null:e}for(var a=e,n=t;;){var o=a.return;if(o===null)break;var d=o.alternate;if(d===null){if(n=o.return,n!==null){a=n;continue}break}if(o.child===d.child){for(d=o.child;d;){if(d===a)return p(o),e;if(d===n)return p(o),t;d=d.sibling}throw Error(i(188))}if(a.return!==n.return)a=o,n=d;else{for(var v=!1,x=o.child;x;){if(x===a){v=!0,a=o,n=d;break}if(x===n){v=!0,n=o,a=d;break}x=x.sibling}if(!v){for(x=d.child;x;){if(x===a){v=!0,a=d,n=o;break}if(x===n){v=!0,n=d,a=o;break}x=x.sibling}if(!v)throw Error(i(189))}}if(a.alternate!==n)throw Error(i(190))}if(a.tag!==3)throw Error(i(188));return a.stateNode.current===a?e:t}function h(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e;for(e=e.child;e!==null;){if(t=h(e),t!==null)return t;e=e.sibling}return null}var y=Object.assign,b=Symbol.for("react.element"),S=Symbol.for("react.transitional.element"),A=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),N=Symbol.for("react.strict_mode"),q=Symbol.for("react.profiler"),_=Symbol.for("react.provider"),D=Symbol.for("react.consumer"),G=Symbol.for("react.context"),re=Symbol.for("react.forward_ref"),F=Symbol.for("react.suspense"),ee=Symbol.for("react.suspense_list"),I=Symbol.for("react.memo"),ne=Symbol.for("react.lazy"),K=Symbol.for("react.activity"),he=Symbol.for("react.memo_cache_sentinel"),oe=Symbol.iterator;function Ce(e){return e===null||typeof e!="object"?null:(e=oe&&e[oe]||e["@@iterator"],typeof e=="function"?e:null)}var Ye=Symbol.for("react.client.reference");function $(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===Ye?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case T:return"Fragment";case q:return"Profiler";case N:return"StrictMode";case F:return"Suspense";case ee:return"SuspenseList";case K:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case A:return"Portal";case G:return(e.displayName||"Context")+".Provider";case D:return(e._context.displayName||"Context")+".Consumer";case re:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case I:return t=e.displayName||null,t!==null?t:$(e.type)||"Memo";case ne:t=e._payload,e=e._init;try{return $(e(t))}catch{}}return null}var U=Array.isArray,E=l.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,B=s.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Y={pending:!1,data:null,method:null,action:null},J=[],j=-1;function k(e){return{current:e}}function Q(e){0>j||(e.current=J[j],J[j]=null,j--)}function Z(e,t){j++,J[j]=e.current,e.current=t}var te=k(null),pe=k(null),ie=k(null),Je=k(null);function Ae(e,t){switch(Z(ie,t),Z(pe,e),Z(te,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?Um(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)t=Um(t),e=Gm(t,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}Q(te),Z(te,e)}function Ft(){Q(te),Q(pe),Q(ie)}function Za(e){e.memoizedState!==null&&Z(Je,e);var t=te.current,a=Gm(t,e.type);t!==a&&(Z(pe,e),Z(te,a))}function gn(e){pe.current===e&&(Q(te),Q(pe)),Je.current===e&&(Q(Je),el._currentValue=Y)}var rs=Object.prototype.hasOwnProperty,cs=r.unstable_scheduleCallback,vn=r.unstable_cancelCallback,yn=r.unstable_shouldYield,Ui=r.unstable_requestPaint,wt=r.unstable_now,Gi=r.unstable_getCurrentPriorityLevel,ml=r.unstable_ImmediatePriority,pl=r.unstable_UserBlockingPriority,xn=r.unstable_NormalPriority,Xi=r.unstable_LowPriority,W=r.unstable_IdlePriority,He=r.log,Le=r.unstable_setDisableYieldValue,Ie=null,Se=null;function Fe(e){if(typeof He=="function"&&Le(e),Se&&typeof Se.setStrictMode=="function")try{Se.setStrictMode(Ie,e)}catch{}}var We=Math.clz32?Math.clz32:Wp,jo=Math.log,$i=Math.LN2;function Wp(e){return e>>>=0,e===0?32:31-(jo(e)/$i|0)|0}var fl=256,hl=4194304;function Ka(e){var t=e&42;if(t!==0)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function gl(e,t,a){var n=e.pendingLanes;if(n===0)return 0;var o=0,d=e.suspendedLanes,v=e.pingedLanes;e=e.warmLanes;var x=n&134217727;return x!==0?(n=x&~d,n!==0?o=Ka(n):(v&=x,v!==0?o=Ka(v):a||(a=x&~e,a!==0&&(o=Ka(a))))):(x=n&~d,x!==0?o=Ka(x):v!==0?o=Ka(v):a||(a=n&~e,a!==0&&(o=Ka(a)))),o===0?0:t!==0&&t!==o&&(t&d)===0&&(d=o&-o,a=t&-t,d>=a||d===32&&(a&4194048)!==0)?t:o}function os(e,t){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)===0}function ef(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function To(){var e=fl;return fl<<=1,(fl&4194048)===0&&(fl=256),e}function Eo(){var e=hl;return hl<<=1,(hl&62914560)===0&&(hl=4194304),e}function Vi(e){for(var t=[],a=0;31>a;a++)t.push(e);return t}function us(e,t){e.pendingLanes|=t,t!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function tf(e,t,a,n,o,d){var v=e.pendingLanes;e.pendingLanes=a,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=a,e.entangledLanes&=a,e.errorRecoveryDisabledLanes&=a,e.shellSuspendCounter=0;var x=e.entanglements,C=e.expirationTimes,O=e.hiddenUpdates;for(a=v&~a;0<a;){var P=31-We(a),V=1<<P;x[P]=0,C[P]=-1;var H=O[P];if(H!==null)for(O[P]=null,P=0;P<H.length;P++){var w=H[P];w!==null&&(w.lane&=-536870913)}a&=~V}n!==0&&Co(e,n,0),d!==0&&o===0&&e.tag!==0&&(e.suspendedLanes|=d&~(v&~t))}function Co(e,t,a){e.pendingLanes|=t,e.suspendedLanes&=~t;var n=31-We(t);e.entangledLanes|=t,e.entanglements[n]=e.entanglements[n]|1073741824|a&4194090}function Ao(e,t){var a=e.entangledLanes|=t;for(e=e.entanglements;a;){var n=31-We(a),o=1<<n;o&t|e[n]&t&&(e[n]|=t),a&=~o}}function Yi(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function Qi(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function No(){var e=B.p;return e!==0?e:(e=window.event,e===void 0?32:rp(e.type))}function af(e,t){var a=B.p;try{return B.p=e,t()}finally{B.p=a}}var Ea=Math.random().toString(36).slice(2),mt="__reactFiber$"+Ea,xt="__reactProps$"+Ea,bn="__reactContainer$"+Ea,Zi="__reactEvents$"+Ea,nf="__reactListeners$"+Ea,sf="__reactHandles$"+Ea,qo="__reactResources$"+Ea,ds="__reactMarker$"+Ea;function Ki(e){delete e[mt],delete e[xt],delete e[Zi],delete e[nf],delete e[sf]}function _n(e){var t=e[mt];if(t)return t;for(var a=e.parentNode;a;){if(t=a[bn]||a[mt]){if(a=t.alternate,t.child!==null||a!==null&&a.child!==null)for(e=Ym(e);e!==null;){if(a=e[mt])return a;e=Ym(e)}return t}e=a,a=e.parentNode}return null}function Sn(e){if(e=e[mt]||e[bn]){var t=e.tag;if(t===5||t===6||t===13||t===26||t===27||t===3)return e}return null}function ms(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e.stateNode;throw Error(i(33))}function jn(e){var t=e[qo];return t||(t=e[qo]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function nt(e){e[ds]=!0}var Mo=new Set,Do={};function Ja(e,t){Tn(e,t),Tn(e+"Capture",t)}function Tn(e,t){for(Do[e]=t,e=0;e<t.length;e++)Mo.add(t[e])}var lf=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Ro={},zo={};function rf(e){return rs.call(zo,e)?!0:rs.call(Ro,e)?!1:lf.test(e)?zo[e]=!0:(Ro[e]=!0,!1)}function vl(e,t,a){if(rf(t))if(a===null)e.removeAttribute(t);else{switch(typeof a){case"undefined":case"function":case"symbol":e.removeAttribute(t);return;case"boolean":var n=t.toLowerCase().slice(0,5);if(n!=="data-"&&n!=="aria-"){e.removeAttribute(t);return}}e.setAttribute(t,""+a)}}function yl(e,t,a){if(a===null)e.removeAttribute(t);else{switch(typeof a){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(t);return}e.setAttribute(t,""+a)}}function ra(e,t,a,n){if(n===null)e.removeAttribute(a);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(a);return}e.setAttributeNS(t,a,""+n)}}var Ji,Oo;function En(e){if(Ji===void 0)try{throw Error()}catch(a){var t=a.stack.trim().match(/\n( *(at )?)/);Ji=t&&t[1]||"",Oo=-1<a.stack.indexOf(`
    at`)?" (<anonymous>)":-1<a.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ji+e+Oo}var Ii=!1;function Fi(e,t){if(!e||Ii)return"";Ii=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var n={DetermineComponentFrameRoot:function(){try{if(t){var V=function(){throw Error()};if(Object.defineProperty(V.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(V,[])}catch(w){var H=w}Reflect.construct(e,[],V)}else{try{V.call()}catch(w){H=w}e.call(V.prototype)}}else{try{throw Error()}catch(w){H=w}(V=e())&&typeof V.catch=="function"&&V.catch(function(){})}}catch(w){if(w&&H&&typeof w.stack=="string")return[w.stack,H.stack]}return[null,null]}};n.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var o=Object.getOwnPropertyDescriptor(n.DetermineComponentFrameRoot,"name");o&&o.configurable&&Object.defineProperty(n.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var d=n.DetermineComponentFrameRoot(),v=d[0],x=d[1];if(v&&x){var C=v.split(`
`),O=x.split(`
`);for(o=n=0;n<C.length&&!C[n].includes("DetermineComponentFrameRoot");)n++;for(;o<O.length&&!O[o].includes("DetermineComponentFrameRoot");)o++;if(n===C.length||o===O.length)for(n=C.length-1,o=O.length-1;1<=n&&0<=o&&C[n]!==O[o];)o--;for(;1<=n&&0<=o;n--,o--)if(C[n]!==O[o]){if(n!==1||o!==1)do if(n--,o--,0>o||C[n]!==O[o]){var P=`
`+C[n].replace(" at new "," at ");return e.displayName&&P.includes("<anonymous>")&&(P=P.replace("<anonymous>",e.displayName)),P}while(1<=n&&0<=o);break}}}finally{Ii=!1,Error.prepareStackTrace=a}return(a=e?e.displayName||e.name:"")?En(a):""}function cf(e){switch(e.tag){case 26:case 27:case 5:return En(e.type);case 16:return En("Lazy");case 13:return En("Suspense");case 19:return En("SuspenseList");case 0:case 15:return Fi(e.type,!1);case 11:return Fi(e.type.render,!1);case 1:return Fi(e.type,!0);case 31:return En("Activity");default:return""}}function Ho(e){try{var t="";do t+=cf(e),e=e.return;while(e);return t}catch(a){return`
Error generating stack: `+a.message+`
`+a.stack}}function Lt(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function wo(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function of(e){var t=wo(e)?"checked":"value",a=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&typeof a<"u"&&typeof a.get=="function"&&typeof a.set=="function"){var o=a.get,d=a.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return o.call(this)},set:function(v){n=""+v,d.call(this,v)}}),Object.defineProperty(e,t,{enumerable:a.enumerable}),{getValue:function(){return n},setValue:function(v){n=""+v},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function xl(e){e._valueTracker||(e._valueTracker=of(e))}function Lo(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var a=t.getValue(),n="";return e&&(n=wo(e)?e.checked?"true":"false":e.value),e=n,e!==a?(t.setValue(e),!0):!1}function bl(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var uf=/[\n"\\]/g;function kt(e){return e.replace(uf,function(t){return"\\"+t.charCodeAt(0).toString(16)+" "})}function Wi(e,t,a,n,o,d,v,x){e.name="",v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"?e.type=v:e.removeAttribute("type"),t!=null?v==="number"?(t===0&&e.value===""||e.value!=t)&&(e.value=""+Lt(t)):e.value!==""+Lt(t)&&(e.value=""+Lt(t)):v!=="submit"&&v!=="reset"||e.removeAttribute("value"),t!=null?er(e,v,Lt(t)):a!=null?er(e,v,Lt(a)):n!=null&&e.removeAttribute("value"),o==null&&d!=null&&(e.defaultChecked=!!d),o!=null&&(e.checked=o&&typeof o!="function"&&typeof o!="symbol"),x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"?e.name=""+Lt(x):e.removeAttribute("name")}function ko(e,t,a,n,o,d,v,x){if(d!=null&&typeof d!="function"&&typeof d!="symbol"&&typeof d!="boolean"&&(e.type=d),t!=null||a!=null){if(!(d!=="submit"&&d!=="reset"||t!=null))return;a=a!=null?""+Lt(a):"",t=t!=null?""+Lt(t):a,x||t===e.value||(e.value=t),e.defaultValue=t}n=n??o,n=typeof n!="function"&&typeof n!="symbol"&&!!n,e.checked=x?e.checked:!!n,e.defaultChecked=!!n,v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"&&(e.name=v)}function er(e,t,a){t==="number"&&bl(e.ownerDocument)===e||e.defaultValue===""+a||(e.defaultValue=""+a)}function Cn(e,t,a,n){if(e=e.options,t){t={};for(var o=0;o<a.length;o++)t["$"+a[o]]=!0;for(a=0;a<e.length;a++)o=t.hasOwnProperty("$"+e[a].value),e[a].selected!==o&&(e[a].selected=o),o&&n&&(e[a].defaultSelected=!0)}else{for(a=""+Lt(a),t=null,o=0;o<e.length;o++){if(e[o].value===a){e[o].selected=!0,n&&(e[o].defaultSelected=!0);return}t!==null||e[o].disabled||(t=e[o])}t!==null&&(t.selected=!0)}}function Bo(e,t,a){if(t!=null&&(t=""+Lt(t),t!==e.value&&(e.value=t),a==null)){e.defaultValue!==t&&(e.defaultValue=t);return}e.defaultValue=a!=null?""+Lt(a):""}function Po(e,t,a,n){if(t==null){if(n!=null){if(a!=null)throw Error(i(92));if(U(n)){if(1<n.length)throw Error(i(93));n=n[0]}a=n}a==null&&(a=""),t=a}a=Lt(t),e.defaultValue=a,n=e.textContent,n===a&&n!==""&&n!==null&&(e.value=n)}function An(e,t){if(t){var a=e.firstChild;if(a&&a===e.lastChild&&a.nodeType===3){a.nodeValue=t;return}}e.textContent=t}var df=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Uo(e,t,a){var n=t.indexOf("--")===0;a==null||typeof a=="boolean"||a===""?n?e.setProperty(t,""):t==="float"?e.cssFloat="":e[t]="":n?e.setProperty(t,a):typeof a!="number"||a===0||df.has(t)?t==="float"?e.cssFloat=a:e[t]=(""+a).trim():e[t]=a+"px"}function Go(e,t,a){if(t!=null&&typeof t!="object")throw Error(i(62));if(e=e.style,a!=null){for(var n in a)!a.hasOwnProperty(n)||t!=null&&t.hasOwnProperty(n)||(n.indexOf("--")===0?e.setProperty(n,""):n==="float"?e.cssFloat="":e[n]="");for(var o in t)n=t[o],t.hasOwnProperty(o)&&a[o]!==n&&Uo(e,o,n)}else for(var d in t)t.hasOwnProperty(d)&&Uo(e,d,t[d])}function tr(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var mf=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),pf=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function _l(e){return pf.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var ar=null;function nr(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Nn=null,qn=null;function Xo(e){var t=Sn(e);if(t&&(e=t.stateNode)){var a=e[xt]||null;e:switch(e=t.stateNode,t.type){case"input":if(Wi(e,a.value,a.defaultValue,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name),t=a.name,a.type==="radio"&&t!=null){for(a=e;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll('input[name="'+kt(""+t)+'"][type="radio"]'),t=0;t<a.length;t++){var n=a[t];if(n!==e&&n.form===e.form){var o=n[xt]||null;if(!o)throw Error(i(90));Wi(n,o.value,o.defaultValue,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name)}}for(t=0;t<a.length;t++)n=a[t],n.form===e.form&&Lo(n)}break e;case"textarea":Bo(e,a.value,a.defaultValue);break e;case"select":t=a.value,t!=null&&Cn(e,!!a.multiple,t,!1)}}}var sr=!1;function $o(e,t,a){if(sr)return e(t,a);sr=!0;try{var n=e(t);return n}finally{if(sr=!1,(Nn!==null||qn!==null)&&(ii(),Nn&&(t=Nn,e=qn,qn=Nn=null,Xo(t),e)))for(t=0;t<e.length;t++)Xo(e[t])}}function ps(e,t){var a=e.stateNode;if(a===null)return null;var n=a[xt]||null;if(n===null)return null;a=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(a&&typeof a!="function")throw Error(i(231,t,typeof a));return a}var ca=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),lr=!1;if(ca)try{var fs={};Object.defineProperty(fs,"passive",{get:function(){lr=!0}}),window.addEventListener("test",fs,fs),window.removeEventListener("test",fs,fs)}catch{lr=!1}var Ca=null,ir=null,Sl=null;function Vo(){if(Sl)return Sl;var e,t=ir,a=t.length,n,o="value"in Ca?Ca.value:Ca.textContent,d=o.length;for(e=0;e<a&&t[e]===o[e];e++);var v=a-e;for(n=1;n<=v&&t[a-n]===o[d-n];n++);return Sl=o.slice(e,1<n?1-n:void 0)}function jl(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Tl(){return!0}function Yo(){return!1}function bt(e){function t(a,n,o,d,v){this._reactName=a,this._targetInst=o,this.type=n,this.nativeEvent=d,this.target=v,this.currentTarget=null;for(var x in e)e.hasOwnProperty(x)&&(a=e[x],this[x]=a?a(d):d[x]);return this.isDefaultPrevented=(d.defaultPrevented!=null?d.defaultPrevented:d.returnValue===!1)?Tl:Yo,this.isPropagationStopped=Yo,this}return y(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=Tl)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=Tl)},persist:function(){},isPersistent:Tl}),t}var Ia={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},El=bt(Ia),hs=y({},Ia,{view:0,detail:0}),ff=bt(hs),rr,cr,gs,Cl=y({},hs,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ur,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==gs&&(gs&&e.type==="mousemove"?(rr=e.screenX-gs.screenX,cr=e.screenY-gs.screenY):cr=rr=0,gs=e),rr)},movementY:function(e){return"movementY"in e?e.movementY:cr}}),Qo=bt(Cl),hf=y({},Cl,{dataTransfer:0}),gf=bt(hf),vf=y({},hs,{relatedTarget:0}),or=bt(vf),yf=y({},Ia,{animationName:0,elapsedTime:0,pseudoElement:0}),xf=bt(yf),bf=y({},Ia,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),_f=bt(bf),Sf=y({},Ia,{data:0}),Zo=bt(Sf),jf={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Tf={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Ef={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Cf(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=Ef[e])?!!t[e]:!1}function ur(){return Cf}var Af=y({},hs,{key:function(e){if(e.key){var t=jf[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=jl(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Tf[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ur,charCode:function(e){return e.type==="keypress"?jl(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?jl(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Nf=bt(Af),qf=y({},Cl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ko=bt(qf),Mf=y({},hs,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ur}),Df=bt(Mf),Rf=y({},Ia,{propertyName:0,elapsedTime:0,pseudoElement:0}),zf=bt(Rf),Of=y({},Cl,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Hf=bt(Of),wf=y({},Ia,{newState:0,oldState:0}),Lf=bt(wf),kf=[9,13,27,32],dr=ca&&"CompositionEvent"in window,vs=null;ca&&"documentMode"in document&&(vs=document.documentMode);var Bf=ca&&"TextEvent"in window&&!vs,Jo=ca&&(!dr||vs&&8<vs&&11>=vs),Io=" ",Fo=!1;function Wo(e,t){switch(e){case"keyup":return kf.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function eu(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Mn=!1;function Pf(e,t){switch(e){case"compositionend":return eu(t);case"keypress":return t.which!==32?null:(Fo=!0,Io);case"textInput":return e=t.data,e===Io&&Fo?null:e;default:return null}}function Uf(e,t){if(Mn)return e==="compositionend"||!dr&&Wo(e,t)?(e=Vo(),Sl=ir=Ca=null,Mn=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Jo&&t.locale!=="ko"?null:t.data;default:return null}}var Gf={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function tu(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Gf[e.type]:t==="textarea"}function au(e,t,a,n){Nn?qn?qn.push(n):qn=[n]:Nn=n,t=mi(t,"onChange"),0<t.length&&(a=new El("onChange","change",null,a,n),e.push({event:a,listeners:t}))}var ys=null,xs=null;function Xf(e){wm(e,0)}function Al(e){var t=ms(e);if(Lo(t))return e}function nu(e,t){if(e==="change")return t}var su=!1;if(ca){var mr;if(ca){var pr="oninput"in document;if(!pr){var lu=document.createElement("div");lu.setAttribute("oninput","return;"),pr=typeof lu.oninput=="function"}mr=pr}else mr=!1;su=mr&&(!document.documentMode||9<document.documentMode)}function iu(){ys&&(ys.detachEvent("onpropertychange",ru),xs=ys=null)}function ru(e){if(e.propertyName==="value"&&Al(xs)){var t=[];au(t,xs,e,nr(e)),$o(Xf,t)}}function $f(e,t,a){e==="focusin"?(iu(),ys=t,xs=a,ys.attachEvent("onpropertychange",ru)):e==="focusout"&&iu()}function Vf(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Al(xs)}function Yf(e,t){if(e==="click")return Al(t)}function Qf(e,t){if(e==="input"||e==="change")return Al(t)}function Zf(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var qt=typeof Object.is=="function"?Object.is:Zf;function bs(e,t){if(qt(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var a=Object.keys(e),n=Object.keys(t);if(a.length!==n.length)return!1;for(n=0;n<a.length;n++){var o=a[n];if(!rs.call(t,o)||!qt(e[o],t[o]))return!1}return!0}function cu(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ou(e,t){var a=cu(e);e=0;for(var n;a;){if(a.nodeType===3){if(n=e+a.textContent.length,e<=t&&n>=t)return{node:a,offset:t-e};e=n}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=cu(a)}}function uu(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?uu(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function du(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var t=bl(e.document);t instanceof e.HTMLIFrameElement;){try{var a=typeof t.contentWindow.location.href=="string"}catch{a=!1}if(a)e=t.contentWindow;else break;t=bl(e.document)}return t}function fr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}var Kf=ca&&"documentMode"in document&&11>=document.documentMode,Dn=null,hr=null,_s=null,gr=!1;function mu(e,t,a){var n=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;gr||Dn==null||Dn!==bl(n)||(n=Dn,"selectionStart"in n&&fr(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),_s&&bs(_s,n)||(_s=n,n=mi(hr,"onSelect"),0<n.length&&(t=new El("onSelect","select",null,t,a),e.push({event:t,listeners:n}),t.target=Dn)))}function Fa(e,t){var a={};return a[e.toLowerCase()]=t.toLowerCase(),a["Webkit"+e]="webkit"+t,a["Moz"+e]="moz"+t,a}var Rn={animationend:Fa("Animation","AnimationEnd"),animationiteration:Fa("Animation","AnimationIteration"),animationstart:Fa("Animation","AnimationStart"),transitionrun:Fa("Transition","TransitionRun"),transitionstart:Fa("Transition","TransitionStart"),transitioncancel:Fa("Transition","TransitionCancel"),transitionend:Fa("Transition","TransitionEnd")},vr={},pu={};ca&&(pu=document.createElement("div").style,"AnimationEvent"in window||(delete Rn.animationend.animation,delete Rn.animationiteration.animation,delete Rn.animationstart.animation),"TransitionEvent"in window||delete Rn.transitionend.transition);function Wa(e){if(vr[e])return vr[e];if(!Rn[e])return e;var t=Rn[e],a;for(a in t)if(t.hasOwnProperty(a)&&a in pu)return vr[e]=t[a];return e}var fu=Wa("animationend"),hu=Wa("animationiteration"),gu=Wa("animationstart"),Jf=Wa("transitionrun"),If=Wa("transitionstart"),Ff=Wa("transitioncancel"),vu=Wa("transitionend"),yu=new Map,yr="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");yr.push("scrollEnd");function Zt(e,t){yu.set(e,t),Ja(t,[e])}var xu=new WeakMap;function Bt(e,t){if(typeof e=="object"&&e!==null){var a=xu.get(e);return a!==void 0?a:(t={value:e,source:t,stack:Ho(t)},xu.set(e,t),t)}return{value:e,source:t,stack:Ho(t)}}var Pt=[],zn=0,xr=0;function Nl(){for(var e=zn,t=xr=zn=0;t<e;){var a=Pt[t];Pt[t++]=null;var n=Pt[t];Pt[t++]=null;var o=Pt[t];Pt[t++]=null;var d=Pt[t];if(Pt[t++]=null,n!==null&&o!==null){var v=n.pending;v===null?o.next=o:(o.next=v.next,v.next=o),n.pending=o}d!==0&&bu(a,o,d)}}function ql(e,t,a,n){Pt[zn++]=e,Pt[zn++]=t,Pt[zn++]=a,Pt[zn++]=n,xr|=n,e.lanes|=n,e=e.alternate,e!==null&&(e.lanes|=n)}function br(e,t,a,n){return ql(e,t,a,n),Ml(e)}function On(e,t){return ql(e,null,null,t),Ml(e)}function bu(e,t,a){e.lanes|=a;var n=e.alternate;n!==null&&(n.lanes|=a);for(var o=!1,d=e.return;d!==null;)d.childLanes|=a,n=d.alternate,n!==null&&(n.childLanes|=a),d.tag===22&&(e=d.stateNode,e===null||e._visibility&1||(o=!0)),e=d,d=d.return;return e.tag===3?(d=e.stateNode,o&&t!==null&&(o=31-We(a),e=d.hiddenUpdates,n=e[o],n===null?e[o]=[t]:n.push(t),t.lane=a|536870912),d):null}function Ml(e){if(50<Ys)throw Ys=0,Cc=null,Error(i(185));for(var t=e.return;t!==null;)e=t,t=e.return;return e.tag===3?e.stateNode:null}var Hn={};function Wf(e,t,a,n){this.tag=e,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Mt(e,t,a,n){return new Wf(e,t,a,n)}function _r(e){return e=e.prototype,!(!e||!e.isReactComponent)}function oa(e,t){var a=e.alternate;return a===null?(a=Mt(e.tag,t,e.key,e.mode),a.elementType=e.elementType,a.type=e.type,a.stateNode=e.stateNode,a.alternate=e,e.alternate=a):(a.pendingProps=t,a.type=e.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=e.flags&65011712,a.childLanes=e.childLanes,a.lanes=e.lanes,a.child=e.child,a.memoizedProps=e.memoizedProps,a.memoizedState=e.memoizedState,a.updateQueue=e.updateQueue,t=e.dependencies,a.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},a.sibling=e.sibling,a.index=e.index,a.ref=e.ref,a.refCleanup=e.refCleanup,a}function _u(e,t){e.flags&=65011714;var a=e.alternate;return a===null?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=a.childLanes,e.lanes=a.lanes,e.child=a.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=a.memoizedProps,e.memoizedState=a.memoizedState,e.updateQueue=a.updateQueue,e.type=a.type,t=a.dependencies,e.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function Dl(e,t,a,n,o,d){var v=0;if(n=e,typeof e=="function")_r(e)&&(v=1);else if(typeof e=="string")v=tg(e,a,te.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case K:return e=Mt(31,a,t,o),e.elementType=K,e.lanes=d,e;case T:return en(a.children,o,d,t);case N:v=8,o|=24;break;case q:return e=Mt(12,a,t,o|2),e.elementType=q,e.lanes=d,e;case F:return e=Mt(13,a,t,o),e.elementType=F,e.lanes=d,e;case ee:return e=Mt(19,a,t,o),e.elementType=ee,e.lanes=d,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case _:case G:v=10;break e;case D:v=9;break e;case re:v=11;break e;case I:v=14;break e;case ne:v=16,n=null;break e}v=29,a=Error(i(130,e===null?"null":typeof e,"")),n=null}return t=Mt(v,a,t,o),t.elementType=e,t.type=n,t.lanes=d,t}function en(e,t,a,n){return e=Mt(7,e,n,t),e.lanes=a,e}function Sr(e,t,a){return e=Mt(6,e,null,t),e.lanes=a,e}function jr(e,t,a){return t=Mt(4,e.children!==null?e.children:[],e.key,t),t.lanes=a,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var wn=[],Ln=0,Rl=null,zl=0,Ut=[],Gt=0,tn=null,ua=1,da="";function an(e,t){wn[Ln++]=zl,wn[Ln++]=Rl,Rl=e,zl=t}function Su(e,t,a){Ut[Gt++]=ua,Ut[Gt++]=da,Ut[Gt++]=tn,tn=e;var n=ua;e=da;var o=32-We(n)-1;n&=~(1<<o),a+=1;var d=32-We(t)+o;if(30<d){var v=o-o%5;d=(n&(1<<v)-1).toString(32),n>>=v,o-=v,ua=1<<32-We(t)+o|a<<o|n,da=d+e}else ua=1<<d|a<<o|n,da=e}function Tr(e){e.return!==null&&(an(e,1),Su(e,1,0))}function Er(e){for(;e===Rl;)Rl=wn[--Ln],wn[Ln]=null,zl=wn[--Ln],wn[Ln]=null;for(;e===tn;)tn=Ut[--Gt],Ut[Gt]=null,da=Ut[--Gt],Ut[Gt]=null,ua=Ut[--Gt],Ut[Gt]=null}var ht=null,Ge=null,Ee=!1,nn=null,Wt=!1,Cr=Error(i(519));function sn(e){var t=Error(i(418,""));throw Ts(Bt(t,e)),Cr}function ju(e){var t=e.stateNode,a=e.type,n=e.memoizedProps;switch(t[mt]=e,t[xt]=n,a){case"dialog":xe("cancel",t),xe("close",t);break;case"iframe":case"object":case"embed":xe("load",t);break;case"video":case"audio":for(a=0;a<Zs.length;a++)xe(Zs[a],t);break;case"source":xe("error",t);break;case"img":case"image":case"link":xe("error",t),xe("load",t);break;case"details":xe("toggle",t);break;case"input":xe("invalid",t),ko(t,n.value,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name,!0),xl(t);break;case"select":xe("invalid",t);break;case"textarea":xe("invalid",t),Po(t,n.value,n.defaultValue,n.children),xl(t)}a=n.children,typeof a!="string"&&typeof a!="number"&&typeof a!="bigint"||t.textContent===""+a||n.suppressHydrationWarning===!0||Pm(t.textContent,a)?(n.popover!=null&&(xe("beforetoggle",t),xe("toggle",t)),n.onScroll!=null&&xe("scroll",t),n.onScrollEnd!=null&&xe("scrollend",t),n.onClick!=null&&(t.onclick=pi),t=!0):t=!1,t||sn(e)}function Tu(e){for(ht=e.return;ht;)switch(ht.tag){case 5:case 13:Wt=!1;return;case 27:case 3:Wt=!0;return;default:ht=ht.return}}function Ss(e){if(e!==ht)return!1;if(!Ee)return Tu(e),Ee=!0,!1;var t=e.tag,a;if((a=t!==3&&t!==27)&&((a=t===5)&&(a=e.type,a=!(a!=="form"&&a!=="button")||Gc(e.type,e.memoizedProps)),a=!a),a&&Ge&&sn(e),Tu(e),t===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(i(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8)if(a=e.data,a==="/$"){if(t===0){Ge=Jt(e.nextSibling);break e}t--}else a!=="$"&&a!=="$!"&&a!=="$?"||t++;e=e.nextSibling}Ge=null}}else t===27?(t=Ge,Ga(e.type)?(e=Yc,Yc=null,Ge=e):Ge=t):Ge=ht?Jt(e.stateNode.nextSibling):null;return!0}function js(){Ge=ht=null,Ee=!1}function Eu(){var e=nn;return e!==null&&(jt===null?jt=e:jt.push.apply(jt,e),nn=null),e}function Ts(e){nn===null?nn=[e]:nn.push(e)}var Ar=k(null),ln=null,ma=null;function Aa(e,t,a){Z(Ar,t._currentValue),t._currentValue=a}function pa(e){e._currentValue=Ar.current,Q(Ar)}function Nr(e,t,a){for(;e!==null;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,n!==null&&(n.childLanes|=t)):n!==null&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===a)break;e=e.return}}function qr(e,t,a,n){var o=e.child;for(o!==null&&(o.return=e);o!==null;){var d=o.dependencies;if(d!==null){var v=o.child;d=d.firstContext;e:for(;d!==null;){var x=d;d=o;for(var C=0;C<t.length;C++)if(x.context===t[C]){d.lanes|=a,x=d.alternate,x!==null&&(x.lanes|=a),Nr(d.return,a,e),n||(v=null);break e}d=x.next}}else if(o.tag===18){if(v=o.return,v===null)throw Error(i(341));v.lanes|=a,d=v.alternate,d!==null&&(d.lanes|=a),Nr(v,a,e),v=null}else v=o.child;if(v!==null)v.return=o;else for(v=o;v!==null;){if(v===e){v=null;break}if(o=v.sibling,o!==null){o.return=v.return,v=o;break}v=v.return}o=v}}function Es(e,t,a,n){e=null;for(var o=t,d=!1;o!==null;){if(!d){if((o.flags&524288)!==0)d=!0;else if((o.flags&262144)!==0)break}if(o.tag===10){var v=o.alternate;if(v===null)throw Error(i(387));if(v=v.memoizedProps,v!==null){var x=o.type;qt(o.pendingProps.value,v.value)||(e!==null?e.push(x):e=[x])}}else if(o===Je.current){if(v=o.alternate,v===null)throw Error(i(387));v.memoizedState.memoizedState!==o.memoizedState.memoizedState&&(e!==null?e.push(el):e=[el])}o=o.return}e!==null&&qr(t,e,a,n),t.flags|=262144}function Ol(e){for(e=e.firstContext;e!==null;){if(!qt(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function rn(e){ln=e,ma=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function pt(e){return Cu(ln,e)}function Hl(e,t){return ln===null&&rn(e),Cu(e,t)}function Cu(e,t){var a=t._currentValue;if(t={context:t,memoizedValue:a,next:null},ma===null){if(e===null)throw Error(i(308));ma=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else ma=ma.next=t;return a}var eh=typeof AbortController<"u"?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(a,n){e.push(n)}};this.abort=function(){t.aborted=!0,e.forEach(function(a){return a()})}},th=r.unstable_scheduleCallback,ah=r.unstable_NormalPriority,et={$$typeof:G,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Mr(){return{controller:new eh,data:new Map,refCount:0}}function Cs(e){e.refCount--,e.refCount===0&&th(ah,function(){e.controller.abort()})}var As=null,Dr=0,kn=0,Bn=null;function nh(e,t){if(As===null){var a=As=[];Dr=0,kn=zc(),Bn={status:"pending",value:void 0,then:function(n){a.push(n)}}}return Dr++,t.then(Au,Au),t}function Au(){if(--Dr===0&&As!==null){Bn!==null&&(Bn.status="fulfilled");var e=As;As=null,kn=0,Bn=null;for(var t=0;t<e.length;t++)(0,e[t])()}}function sh(e,t){var a=[],n={status:"pending",value:null,reason:null,then:function(o){a.push(o)}};return e.then(function(){n.status="fulfilled",n.value=t;for(var o=0;o<a.length;o++)(0,a[o])(t)},function(o){for(n.status="rejected",n.reason=o,o=0;o<a.length;o++)(0,a[o])(void 0)}),n}var Nu=E.S;E.S=function(e,t){typeof t=="object"&&t!==null&&typeof t.then=="function"&&nh(e,t),Nu!==null&&Nu(e,t)};var cn=k(null);function Rr(){var e=cn.current;return e!==null?e:we.pooledCache}function wl(e,t){t===null?Z(cn,cn.current):Z(cn,t.pool)}function qu(){var e=Rr();return e===null?null:{parent:et._currentValue,pool:e}}var Ns=Error(i(460)),Mu=Error(i(474)),Ll=Error(i(542)),zr={then:function(){}};function Du(e){return e=e.status,e==="fulfilled"||e==="rejected"}function kl(){}function Ru(e,t,a){switch(a=e[a],a===void 0?e.push(t):a!==t&&(t.then(kl,kl),t=a),t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,Ou(e),e;default:if(typeof t.status=="string")t.then(kl,kl);else{if(e=we,e!==null&&100<e.shellSuspendCounter)throw Error(i(482));e=t,e.status="pending",e.then(function(n){if(t.status==="pending"){var o=t;o.status="fulfilled",o.value=n}},function(n){if(t.status==="pending"){var o=t;o.status="rejected",o.reason=n}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,Ou(e),e}throw qs=t,Ns}}var qs=null;function zu(){if(qs===null)throw Error(i(459));var e=qs;return qs=null,e}function Ou(e){if(e===Ns||e===Ll)throw Error(i(483))}var Na=!1;function Or(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Hr(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function qa(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function Ma(e,t,a){var n=e.updateQueue;if(n===null)return null;if(n=n.shared,(Ne&2)!==0){var o=n.pending;return o===null?t.next=t:(t.next=o.next,o.next=t),n.pending=t,t=Ml(e),bu(e,null,a),t}return ql(e,n,t,a),Ml(e)}function Ms(e,t,a){if(t=t.updateQueue,t!==null&&(t=t.shared,(a&4194048)!==0)){var n=t.lanes;n&=e.pendingLanes,a|=n,t.lanes=a,Ao(e,a)}}function wr(e,t){var a=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,a===n)){var o=null,d=null;if(a=a.firstBaseUpdate,a!==null){do{var v={lane:a.lane,tag:a.tag,payload:a.payload,callback:null,next:null};d===null?o=d=v:d=d.next=v,a=a.next}while(a!==null);d===null?o=d=t:d=d.next=t}else o=d=t;a={baseState:n.baseState,firstBaseUpdate:o,lastBaseUpdate:d,shared:n.shared,callbacks:n.callbacks},e.updateQueue=a;return}e=a.lastBaseUpdate,e===null?a.firstBaseUpdate=t:e.next=t,a.lastBaseUpdate=t}var Lr=!1;function Ds(){if(Lr){var e=Bn;if(e!==null)throw e}}function Rs(e,t,a,n){Lr=!1;var o=e.updateQueue;Na=!1;var d=o.firstBaseUpdate,v=o.lastBaseUpdate,x=o.shared.pending;if(x!==null){o.shared.pending=null;var C=x,O=C.next;C.next=null,v===null?d=O:v.next=O,v=C;var P=e.alternate;P!==null&&(P=P.updateQueue,x=P.lastBaseUpdate,x!==v&&(x===null?P.firstBaseUpdate=O:x.next=O,P.lastBaseUpdate=C))}if(d!==null){var V=o.baseState;v=0,P=O=C=null,x=d;do{var H=x.lane&-536870913,w=H!==x.lane;if(w?(_e&H)===H:(n&H)===H){H!==0&&H===kn&&(Lr=!0),P!==null&&(P=P.next={lane:0,tag:x.tag,payload:x.payload,callback:null,next:null});e:{var me=e,ue=x;H=t;var Re=a;switch(ue.tag){case 1:if(me=ue.payload,typeof me=="function"){V=me.call(Re,V,H);break e}V=me;break e;case 3:me.flags=me.flags&-65537|128;case 0:if(me=ue.payload,H=typeof me=="function"?me.call(Re,V,H):me,H==null)break e;V=y({},V,H);break e;case 2:Na=!0}}H=x.callback,H!==null&&(e.flags|=64,w&&(e.flags|=8192),w=o.callbacks,w===null?o.callbacks=[H]:w.push(H))}else w={lane:H,tag:x.tag,payload:x.payload,callback:x.callback,next:null},P===null?(O=P=w,C=V):P=P.next=w,v|=H;if(x=x.next,x===null){if(x=o.shared.pending,x===null)break;w=x,x=w.next,w.next=null,o.lastBaseUpdate=w,o.shared.pending=null}}while(!0);P===null&&(C=V),o.baseState=C,o.firstBaseUpdate=O,o.lastBaseUpdate=P,d===null&&(o.shared.lanes=0),ka|=v,e.lanes=v,e.memoizedState=V}}function Hu(e,t){if(typeof e!="function")throw Error(i(191,e));e.call(t)}function wu(e,t){var a=e.callbacks;if(a!==null)for(e.callbacks=null,e=0;e<a.length;e++)Hu(a[e],t)}var Pn=k(null),Bl=k(0);function Lu(e,t){e=ba,Z(Bl,e),Z(Pn,t),ba=e|t.baseLanes}function kr(){Z(Bl,ba),Z(Pn,Pn.current)}function Br(){ba=Bl.current,Q(Pn),Q(Bl)}var Da=0,ge=null,Me=null,Qe=null,Pl=!1,Un=!1,on=!1,Ul=0,zs=0,Gn=null,lh=0;function $e(){throw Error(i(321))}function Pr(e,t){if(t===null)return!1;for(var a=0;a<t.length&&a<e.length;a++)if(!qt(e[a],t[a]))return!1;return!0}function Ur(e,t,a,n,o,d){return Da=d,ge=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,E.H=e===null||e.memoizedState===null?bd:_d,on=!1,d=a(n,o),on=!1,Un&&(d=Bu(t,a,n,o)),ku(e),d}function ku(e){E.H=Ql;var t=Me!==null&&Me.next!==null;if(Da=0,Qe=Me=ge=null,Pl=!1,zs=0,Gn=null,t)throw Error(i(300));e===null||st||(e=e.dependencies,e!==null&&Ol(e)&&(st=!0))}function Bu(e,t,a,n){ge=e;var o=0;do{if(Un&&(Gn=null),zs=0,Un=!1,25<=o)throw Error(i(301));if(o+=1,Qe=Me=null,e.updateQueue!=null){var d=e.updateQueue;d.lastEffect=null,d.events=null,d.stores=null,d.memoCache!=null&&(d.memoCache.index=0)}E.H=mh,d=t(a,n)}while(Un);return d}function ih(){var e=E.H,t=e.useState()[0];return t=typeof t.then=="function"?Os(t):t,e=e.useState()[0],(Me!==null?Me.memoizedState:null)!==e&&(ge.flags|=1024),t}function Gr(){var e=Ul!==0;return Ul=0,e}function Xr(e,t,a){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a}function $r(e){if(Pl){for(e=e.memoizedState;e!==null;){var t=e.queue;t!==null&&(t.pending=null),e=e.next}Pl=!1}Da=0,Qe=Me=ge=null,Un=!1,zs=Ul=0,Gn=null}function _t(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Qe===null?ge.memoizedState=Qe=e:Qe=Qe.next=e,Qe}function Ze(){if(Me===null){var e=ge.alternate;e=e!==null?e.memoizedState:null}else e=Me.next;var t=Qe===null?ge.memoizedState:Qe.next;if(t!==null)Qe=t,Me=e;else{if(e===null)throw ge.alternate===null?Error(i(467)):Error(i(310));Me=e,e={memoizedState:Me.memoizedState,baseState:Me.baseState,baseQueue:Me.baseQueue,queue:Me.queue,next:null},Qe===null?ge.memoizedState=Qe=e:Qe=Qe.next=e}return Qe}function Vr(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Os(e){var t=zs;return zs+=1,Gn===null&&(Gn=[]),e=Ru(Gn,e,t),t=ge,(Qe===null?t.memoizedState:Qe.next)===null&&(t=t.alternate,E.H=t===null||t.memoizedState===null?bd:_d),e}function Gl(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return Os(e);if(e.$$typeof===G)return pt(e)}throw Error(i(438,String(e)))}function Yr(e){var t=null,a=ge.updateQueue;if(a!==null&&(t=a.memoCache),t==null){var n=ge.alternate;n!==null&&(n=n.updateQueue,n!==null&&(n=n.memoCache,n!=null&&(t={data:n.data.map(function(o){return o.slice()}),index:0})))}if(t==null&&(t={data:[],index:0}),a===null&&(a=Vr(),ge.updateQueue=a),a.memoCache=t,a=t.data[t.index],a===void 0)for(a=t.data[t.index]=Array(e),n=0;n<e;n++)a[n]=he;return t.index++,a}function fa(e,t){return typeof t=="function"?t(e):t}function Xl(e){var t=Ze();return Qr(t,Me,e)}function Qr(e,t,a){var n=e.queue;if(n===null)throw Error(i(311));n.lastRenderedReducer=a;var o=e.baseQueue,d=n.pending;if(d!==null){if(o!==null){var v=o.next;o.next=d.next,d.next=v}t.baseQueue=o=d,n.pending=null}if(d=e.baseState,o===null)e.memoizedState=d;else{t=o.next;var x=v=null,C=null,O=t,P=!1;do{var V=O.lane&-536870913;if(V!==O.lane?(_e&V)===V:(Da&V)===V){var H=O.revertLane;if(H===0)C!==null&&(C=C.next={lane:0,revertLane:0,action:O.action,hasEagerState:O.hasEagerState,eagerState:O.eagerState,next:null}),V===kn&&(P=!0);else if((Da&H)===H){O=O.next,H===kn&&(P=!0);continue}else V={lane:0,revertLane:O.revertLane,action:O.action,hasEagerState:O.hasEagerState,eagerState:O.eagerState,next:null},C===null?(x=C=V,v=d):C=C.next=V,ge.lanes|=H,ka|=H;V=O.action,on&&a(d,V),d=O.hasEagerState?O.eagerState:a(d,V)}else H={lane:V,revertLane:O.revertLane,action:O.action,hasEagerState:O.hasEagerState,eagerState:O.eagerState,next:null},C===null?(x=C=H,v=d):C=C.next=H,ge.lanes|=V,ka|=V;O=O.next}while(O!==null&&O!==t);if(C===null?v=d:C.next=x,!qt(d,e.memoizedState)&&(st=!0,P&&(a=Bn,a!==null)))throw a;e.memoizedState=d,e.baseState=v,e.baseQueue=C,n.lastRenderedState=d}return o===null&&(n.lanes=0),[e.memoizedState,n.dispatch]}function Zr(e){var t=Ze(),a=t.queue;if(a===null)throw Error(i(311));a.lastRenderedReducer=e;var n=a.dispatch,o=a.pending,d=t.memoizedState;if(o!==null){a.pending=null;var v=o=o.next;do d=e(d,v.action),v=v.next;while(v!==o);qt(d,t.memoizedState)||(st=!0),t.memoizedState=d,t.baseQueue===null&&(t.baseState=d),a.lastRenderedState=d}return[d,n]}function Pu(e,t,a){var n=ge,o=Ze(),d=Ee;if(d){if(a===void 0)throw Error(i(407));a=a()}else a=t();var v=!qt((Me||o).memoizedState,a);v&&(o.memoizedState=a,st=!0),o=o.queue;var x=Xu.bind(null,n,o,e);if(Hs(2048,8,x,[e]),o.getSnapshot!==t||v||Qe!==null&&Qe.memoizedState.tag&1){if(n.flags|=2048,Xn(9,$l(),Gu.bind(null,n,o,a,t),null),we===null)throw Error(i(349));d||(Da&124)!==0||Uu(n,t,a)}return a}function Uu(e,t,a){e.flags|=16384,e={getSnapshot:t,value:a},t=ge.updateQueue,t===null?(t=Vr(),ge.updateQueue=t,t.stores=[e]):(a=t.stores,a===null?t.stores=[e]:a.push(e))}function Gu(e,t,a,n){t.value=a,t.getSnapshot=n,$u(t)&&Vu(e)}function Xu(e,t,a){return a(function(){$u(t)&&Vu(e)})}function $u(e){var t=e.getSnapshot;e=e.value;try{var a=t();return!qt(e,a)}catch{return!0}}function Vu(e){var t=On(e,2);t!==null&&Ht(t,e,2)}function Kr(e){var t=_t();if(typeof e=="function"){var a=e;if(e=a(),on){Fe(!0);try{a()}finally{Fe(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:fa,lastRenderedState:e},t}function Yu(e,t,a,n){return e.baseState=a,Qr(e,Me,typeof n=="function"?n:fa)}function rh(e,t,a,n,o){if(Yl(e))throw Error(i(485));if(e=t.action,e!==null){var d={payload:o,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(v){d.listeners.push(v)}};E.T!==null?a(!0):d.isTransition=!1,n(d),a=t.pending,a===null?(d.next=t.pending=d,Qu(t,d)):(d.next=a.next,t.pending=a.next=d)}}function Qu(e,t){var a=t.action,n=t.payload,o=e.state;if(t.isTransition){var d=E.T,v={};E.T=v;try{var x=a(o,n),C=E.S;C!==null&&C(v,x),Zu(e,t,x)}catch(O){Jr(e,t,O)}finally{E.T=d}}else try{d=a(o,n),Zu(e,t,d)}catch(O){Jr(e,t,O)}}function Zu(e,t,a){a!==null&&typeof a=="object"&&typeof a.then=="function"?a.then(function(n){Ku(e,t,n)},function(n){return Jr(e,t,n)}):Ku(e,t,a)}function Ku(e,t,a){t.status="fulfilled",t.value=a,Ju(t),e.state=a,t=e.pending,t!==null&&(a=t.next,a===t?e.pending=null:(a=a.next,t.next=a,Qu(e,a)))}function Jr(e,t,a){var n=e.pending;if(e.pending=null,n!==null){n=n.next;do t.status="rejected",t.reason=a,Ju(t),t=t.next;while(t!==n)}e.action=null}function Ju(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function Iu(e,t){return t}function Fu(e,t){if(Ee){var a=we.formState;if(a!==null){e:{var n=ge;if(Ee){if(Ge){t:{for(var o=Ge,d=Wt;o.nodeType!==8;){if(!d){o=null;break t}if(o=Jt(o.nextSibling),o===null){o=null;break t}}d=o.data,o=d==="F!"||d==="F"?o:null}if(o){Ge=Jt(o.nextSibling),n=o.data==="F!";break e}}sn(n)}n=!1}n&&(t=a[0])}}return a=_t(),a.memoizedState=a.baseState=t,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Iu,lastRenderedState:t},a.queue=n,a=vd.bind(null,ge,n),n.dispatch=a,n=Kr(!1),d=tc.bind(null,ge,!1,n.queue),n=_t(),o={state:t,dispatch:null,action:e,pending:null},n.queue=o,a=rh.bind(null,ge,o,d,a),o.dispatch=a,n.memoizedState=e,[t,a,!1]}function Wu(e){var t=Ze();return ed(t,Me,e)}function ed(e,t,a){if(t=Qr(e,t,Iu)[0],e=Xl(fa)[0],typeof t=="object"&&t!==null&&typeof t.then=="function")try{var n=Os(t)}catch(v){throw v===Ns?Ll:v}else n=t;t=Ze();var o=t.queue,d=o.dispatch;return a!==t.memoizedState&&(ge.flags|=2048,Xn(9,$l(),ch.bind(null,o,a),null)),[n,d,e]}function ch(e,t){e.action=t}function td(e){var t=Ze(),a=Me;if(a!==null)return ed(t,a,e);Ze(),t=t.memoizedState,a=Ze();var n=a.queue.dispatch;return a.memoizedState=e,[t,n,!1]}function Xn(e,t,a,n){return e={tag:e,create:a,deps:n,inst:t,next:null},t=ge.updateQueue,t===null&&(t=Vr(),ge.updateQueue=t),a=t.lastEffect,a===null?t.lastEffect=e.next=e:(n=a.next,a.next=e,e.next=n,t.lastEffect=e),e}function $l(){return{destroy:void 0,resource:void 0}}function ad(){return Ze().memoizedState}function Vl(e,t,a,n){var o=_t();n=n===void 0?null:n,ge.flags|=e,o.memoizedState=Xn(1|t,$l(),a,n)}function Hs(e,t,a,n){var o=Ze();n=n===void 0?null:n;var d=o.memoizedState.inst;Me!==null&&n!==null&&Pr(n,Me.memoizedState.deps)?o.memoizedState=Xn(t,d,a,n):(ge.flags|=e,o.memoizedState=Xn(1|t,d,a,n))}function nd(e,t){Vl(8390656,8,e,t)}function sd(e,t){Hs(2048,8,e,t)}function ld(e,t){return Hs(4,2,e,t)}function id(e,t){return Hs(4,4,e,t)}function rd(e,t){if(typeof t=="function"){e=e();var a=t(e);return function(){typeof a=="function"?a():t(null)}}if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function cd(e,t,a){a=a!=null?a.concat([e]):null,Hs(4,4,rd.bind(null,t,e),a)}function Ir(){}function od(e,t){var a=Ze();t=t===void 0?null:t;var n=a.memoizedState;return t!==null&&Pr(t,n[1])?n[0]:(a.memoizedState=[e,t],e)}function ud(e,t){var a=Ze();t=t===void 0?null:t;var n=a.memoizedState;if(t!==null&&Pr(t,n[1]))return n[0];if(n=e(),on){Fe(!0);try{e()}finally{Fe(!1)}}return a.memoizedState=[n,t],n}function Fr(e,t,a){return a===void 0||(Da&1073741824)!==0?e.memoizedState=t:(e.memoizedState=a,e=pm(),ge.lanes|=e,ka|=e,a)}function dd(e,t,a,n){return qt(a,t)?a:Pn.current!==null?(e=Fr(e,a,n),qt(e,t)||(st=!0),e):(Da&42)===0?(st=!0,e.memoizedState=a):(e=pm(),ge.lanes|=e,ka|=e,t)}function md(e,t,a,n,o){var d=B.p;B.p=d!==0&&8>d?d:8;var v=E.T,x={};E.T=x,tc(e,!1,t,a);try{var C=o(),O=E.S;if(O!==null&&O(x,C),C!==null&&typeof C=="object"&&typeof C.then=="function"){var P=sh(C,n);ws(e,t,P,Ot(e))}else ws(e,t,n,Ot(e))}catch(V){ws(e,t,{then:function(){},status:"rejected",reason:V},Ot())}finally{B.p=d,E.T=v}}function oh(){}function Wr(e,t,a,n){if(e.tag!==5)throw Error(i(476));var o=pd(e).queue;md(e,o,t,Y,a===null?oh:function(){return fd(e),a(n)})}function pd(e){var t=e.memoizedState;if(t!==null)return t;t={memoizedState:Y,baseState:Y,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:fa,lastRenderedState:Y},next:null};var a={};return t.next={memoizedState:a,baseState:a,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:fa,lastRenderedState:a},next:null},e.memoizedState=t,e=e.alternate,e!==null&&(e.memoizedState=t),t}function fd(e){var t=pd(e).next.queue;ws(e,t,{},Ot())}function ec(){return pt(el)}function hd(){return Ze().memoizedState}function gd(){return Ze().memoizedState}function uh(e){for(var t=e.return;t!==null;){switch(t.tag){case 24:case 3:var a=Ot();e=qa(a);var n=Ma(t,e,a);n!==null&&(Ht(n,t,a),Ms(n,t,a)),t={cache:Mr()},e.payload=t;return}t=t.return}}function dh(e,t,a){var n=Ot();a={lane:n,revertLane:0,action:a,hasEagerState:!1,eagerState:null,next:null},Yl(e)?yd(t,a):(a=br(e,t,a,n),a!==null&&(Ht(a,e,n),xd(a,t,n)))}function vd(e,t,a){var n=Ot();ws(e,t,a,n)}function ws(e,t,a,n){var o={lane:n,revertLane:0,action:a,hasEagerState:!1,eagerState:null,next:null};if(Yl(e))yd(t,o);else{var d=e.alternate;if(e.lanes===0&&(d===null||d.lanes===0)&&(d=t.lastRenderedReducer,d!==null))try{var v=t.lastRenderedState,x=d(v,a);if(o.hasEagerState=!0,o.eagerState=x,qt(x,v))return ql(e,t,o,0),we===null&&Nl(),!1}catch{}finally{}if(a=br(e,t,o,n),a!==null)return Ht(a,e,n),xd(a,t,n),!0}return!1}function tc(e,t,a,n){if(n={lane:2,revertLane:zc(),action:n,hasEagerState:!1,eagerState:null,next:null},Yl(e)){if(t)throw Error(i(479))}else t=br(e,a,n,2),t!==null&&Ht(t,e,2)}function Yl(e){var t=e.alternate;return e===ge||t!==null&&t===ge}function yd(e,t){Un=Pl=!0;var a=e.pending;a===null?t.next=t:(t.next=a.next,a.next=t),e.pending=t}function xd(e,t,a){if((a&4194048)!==0){var n=t.lanes;n&=e.pendingLanes,a|=n,t.lanes=a,Ao(e,a)}}var Ql={readContext:pt,use:Gl,useCallback:$e,useContext:$e,useEffect:$e,useImperativeHandle:$e,useLayoutEffect:$e,useInsertionEffect:$e,useMemo:$e,useReducer:$e,useRef:$e,useState:$e,useDebugValue:$e,useDeferredValue:$e,useTransition:$e,useSyncExternalStore:$e,useId:$e,useHostTransitionStatus:$e,useFormState:$e,useActionState:$e,useOptimistic:$e,useMemoCache:$e,useCacheRefresh:$e},bd={readContext:pt,use:Gl,useCallback:function(e,t){return _t().memoizedState=[e,t===void 0?null:t],e},useContext:pt,useEffect:nd,useImperativeHandle:function(e,t,a){a=a!=null?a.concat([e]):null,Vl(4194308,4,rd.bind(null,t,e),a)},useLayoutEffect:function(e,t){return Vl(4194308,4,e,t)},useInsertionEffect:function(e,t){Vl(4,2,e,t)},useMemo:function(e,t){var a=_t();t=t===void 0?null:t;var n=e();if(on){Fe(!0);try{e()}finally{Fe(!1)}}return a.memoizedState=[n,t],n},useReducer:function(e,t,a){var n=_t();if(a!==void 0){var o=a(t);if(on){Fe(!0);try{a(t)}finally{Fe(!1)}}}else o=t;return n.memoizedState=n.baseState=o,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:o},n.queue=e,e=e.dispatch=dh.bind(null,ge,e),[n.memoizedState,e]},useRef:function(e){var t=_t();return e={current:e},t.memoizedState=e},useState:function(e){e=Kr(e);var t=e.queue,a=vd.bind(null,ge,t);return t.dispatch=a,[e.memoizedState,a]},useDebugValue:Ir,useDeferredValue:function(e,t){var a=_t();return Fr(a,e,t)},useTransition:function(){var e=Kr(!1);return e=md.bind(null,ge,e.queue,!0,!1),_t().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,a){var n=ge,o=_t();if(Ee){if(a===void 0)throw Error(i(407));a=a()}else{if(a=t(),we===null)throw Error(i(349));(_e&124)!==0||Uu(n,t,a)}o.memoizedState=a;var d={value:a,getSnapshot:t};return o.queue=d,nd(Xu.bind(null,n,d,e),[e]),n.flags|=2048,Xn(9,$l(),Gu.bind(null,n,d,a,t),null),a},useId:function(){var e=_t(),t=we.identifierPrefix;if(Ee){var a=da,n=ua;a=(n&~(1<<32-We(n)-1)).toString(32)+a,t=""+t+"R"+a,a=Ul++,0<a&&(t+="H"+a.toString(32)),t+=""}else a=lh++,t=""+t+"r"+a.toString(32)+"";return e.memoizedState=t},useHostTransitionStatus:ec,useFormState:Fu,useActionState:Fu,useOptimistic:function(e){var t=_t();t.memoizedState=t.baseState=e;var a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=a,t=tc.bind(null,ge,!0,a),a.dispatch=t,[e,t]},useMemoCache:Yr,useCacheRefresh:function(){return _t().memoizedState=uh.bind(null,ge)}},_d={readContext:pt,use:Gl,useCallback:od,useContext:pt,useEffect:sd,useImperativeHandle:cd,useInsertionEffect:ld,useLayoutEffect:id,useMemo:ud,useReducer:Xl,useRef:ad,useState:function(){return Xl(fa)},useDebugValue:Ir,useDeferredValue:function(e,t){var a=Ze();return dd(a,Me.memoizedState,e,t)},useTransition:function(){var e=Xl(fa)[0],t=Ze().memoizedState;return[typeof e=="boolean"?e:Os(e),t]},useSyncExternalStore:Pu,useId:hd,useHostTransitionStatus:ec,useFormState:Wu,useActionState:Wu,useOptimistic:function(e,t){var a=Ze();return Yu(a,Me,e,t)},useMemoCache:Yr,useCacheRefresh:gd},mh={readContext:pt,use:Gl,useCallback:od,useContext:pt,useEffect:sd,useImperativeHandle:cd,useInsertionEffect:ld,useLayoutEffect:id,useMemo:ud,useReducer:Zr,useRef:ad,useState:function(){return Zr(fa)},useDebugValue:Ir,useDeferredValue:function(e,t){var a=Ze();return Me===null?Fr(a,e,t):dd(a,Me.memoizedState,e,t)},useTransition:function(){var e=Zr(fa)[0],t=Ze().memoizedState;return[typeof e=="boolean"?e:Os(e),t]},useSyncExternalStore:Pu,useId:hd,useHostTransitionStatus:ec,useFormState:td,useActionState:td,useOptimistic:function(e,t){var a=Ze();return Me!==null?Yu(a,Me,e,t):(a.baseState=e,[e,a.queue.dispatch])},useMemoCache:Yr,useCacheRefresh:gd},$n=null,Ls=0;function Zl(e){var t=Ls;return Ls+=1,$n===null&&($n=[]),Ru($n,e,t)}function ks(e,t){t=t.props.ref,e.ref=t!==void 0?t:null}function Kl(e,t){throw t.$$typeof===b?Error(i(525)):(e=Object.prototype.toString.call(t),Error(i(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)))}function Sd(e){var t=e._init;return t(e._payload)}function jd(e){function t(R,M){if(e){var z=R.deletions;z===null?(R.deletions=[M],R.flags|=16):z.push(M)}}function a(R,M){if(!e)return null;for(;M!==null;)t(R,M),M=M.sibling;return null}function n(R){for(var M=new Map;R!==null;)R.key!==null?M.set(R.key,R):M.set(R.index,R),R=R.sibling;return M}function o(R,M){return R=oa(R,M),R.index=0,R.sibling=null,R}function d(R,M,z){return R.index=z,e?(z=R.alternate,z!==null?(z=z.index,z<M?(R.flags|=67108866,M):z):(R.flags|=67108866,M)):(R.flags|=1048576,M)}function v(R){return e&&R.alternate===null&&(R.flags|=67108866),R}function x(R,M,z,X){return M===null||M.tag!==6?(M=Sr(z,R.mode,X),M.return=R,M):(M=o(M,z),M.return=R,M)}function C(R,M,z,X){var ae=z.type;return ae===T?P(R,M,z.props.children,X,z.key):M!==null&&(M.elementType===ae||typeof ae=="object"&&ae!==null&&ae.$$typeof===ne&&Sd(ae)===M.type)?(M=o(M,z.props),ks(M,z),M.return=R,M):(M=Dl(z.type,z.key,z.props,null,R.mode,X),ks(M,z),M.return=R,M)}function O(R,M,z,X){return M===null||M.tag!==4||M.stateNode.containerInfo!==z.containerInfo||M.stateNode.implementation!==z.implementation?(M=jr(z,R.mode,X),M.return=R,M):(M=o(M,z.children||[]),M.return=R,M)}function P(R,M,z,X,ae){return M===null||M.tag!==7?(M=en(z,R.mode,X,ae),M.return=R,M):(M=o(M,z),M.return=R,M)}function V(R,M,z){if(typeof M=="string"&&M!==""||typeof M=="number"||typeof M=="bigint")return M=Sr(""+M,R.mode,z),M.return=R,M;if(typeof M=="object"&&M!==null){switch(M.$$typeof){case S:return z=Dl(M.type,M.key,M.props,null,R.mode,z),ks(z,M),z.return=R,z;case A:return M=jr(M,R.mode,z),M.return=R,M;case ne:var X=M._init;return M=X(M._payload),V(R,M,z)}if(U(M)||Ce(M))return M=en(M,R.mode,z,null),M.return=R,M;if(typeof M.then=="function")return V(R,Zl(M),z);if(M.$$typeof===G)return V(R,Hl(R,M),z);Kl(R,M)}return null}function H(R,M,z,X){var ae=M!==null?M.key:null;if(typeof z=="string"&&z!==""||typeof z=="number"||typeof z=="bigint")return ae!==null?null:x(R,M,""+z,X);if(typeof z=="object"&&z!==null){switch(z.$$typeof){case S:return z.key===ae?C(R,M,z,X):null;case A:return z.key===ae?O(R,M,z,X):null;case ne:return ae=z._init,z=ae(z._payload),H(R,M,z,X)}if(U(z)||Ce(z))return ae!==null?null:P(R,M,z,X,null);if(typeof z.then=="function")return H(R,M,Zl(z),X);if(z.$$typeof===G)return H(R,M,Hl(R,z),X);Kl(R,z)}return null}function w(R,M,z,X,ae){if(typeof X=="string"&&X!==""||typeof X=="number"||typeof X=="bigint")return R=R.get(z)||null,x(M,R,""+X,ae);if(typeof X=="object"&&X!==null){switch(X.$$typeof){case S:return R=R.get(X.key===null?z:X.key)||null,C(M,R,X,ae);case A:return R=R.get(X.key===null?z:X.key)||null,O(M,R,X,ae);case ne:var ve=X._init;return X=ve(X._payload),w(R,M,z,X,ae)}if(U(X)||Ce(X))return R=R.get(z)||null,P(M,R,X,ae,null);if(typeof X.then=="function")return w(R,M,z,Zl(X),ae);if(X.$$typeof===G)return w(R,M,z,Hl(M,X),ae);Kl(M,X)}return null}function me(R,M,z,X){for(var ae=null,ve=null,le=M,de=M=0,it=null;le!==null&&de<z.length;de++){le.index>de?(it=le,le=null):it=le.sibling;var je=H(R,le,z[de],X);if(je===null){le===null&&(le=it);break}e&&le&&je.alternate===null&&t(R,le),M=d(je,M,de),ve===null?ae=je:ve.sibling=je,ve=je,le=it}if(de===z.length)return a(R,le),Ee&&an(R,de),ae;if(le===null){for(;de<z.length;de++)le=V(R,z[de],X),le!==null&&(M=d(le,M,de),ve===null?ae=le:ve.sibling=le,ve=le);return Ee&&an(R,de),ae}for(le=n(le);de<z.length;de++)it=w(le,R,de,z[de],X),it!==null&&(e&&it.alternate!==null&&le.delete(it.key===null?de:it.key),M=d(it,M,de),ve===null?ae=it:ve.sibling=it,ve=it);return e&&le.forEach(function(Qa){return t(R,Qa)}),Ee&&an(R,de),ae}function ue(R,M,z,X){if(z==null)throw Error(i(151));for(var ae=null,ve=null,le=M,de=M=0,it=null,je=z.next();le!==null&&!je.done;de++,je=z.next()){le.index>de?(it=le,le=null):it=le.sibling;var Qa=H(R,le,je.value,X);if(Qa===null){le===null&&(le=it);break}e&&le&&Qa.alternate===null&&t(R,le),M=d(Qa,M,de),ve===null?ae=Qa:ve.sibling=Qa,ve=Qa,le=it}if(je.done)return a(R,le),Ee&&an(R,de),ae;if(le===null){for(;!je.done;de++,je=z.next())je=V(R,je.value,X),je!==null&&(M=d(je,M,de),ve===null?ae=je:ve.sibling=je,ve=je);return Ee&&an(R,de),ae}for(le=n(le);!je.done;de++,je=z.next())je=w(le,R,de,je.value,X),je!==null&&(e&&je.alternate!==null&&le.delete(je.key===null?de:je.key),M=d(je,M,de),ve===null?ae=je:ve.sibling=je,ve=je);return e&&le.forEach(function(pg){return t(R,pg)}),Ee&&an(R,de),ae}function Re(R,M,z,X){if(typeof z=="object"&&z!==null&&z.type===T&&z.key===null&&(z=z.props.children),typeof z=="object"&&z!==null){switch(z.$$typeof){case S:e:{for(var ae=z.key;M!==null;){if(M.key===ae){if(ae=z.type,ae===T){if(M.tag===7){a(R,M.sibling),X=o(M,z.props.children),X.return=R,R=X;break e}}else if(M.elementType===ae||typeof ae=="object"&&ae!==null&&ae.$$typeof===ne&&Sd(ae)===M.type){a(R,M.sibling),X=o(M,z.props),ks(X,z),X.return=R,R=X;break e}a(R,M);break}else t(R,M);M=M.sibling}z.type===T?(X=en(z.props.children,R.mode,X,z.key),X.return=R,R=X):(X=Dl(z.type,z.key,z.props,null,R.mode,X),ks(X,z),X.return=R,R=X)}return v(R);case A:e:{for(ae=z.key;M!==null;){if(M.key===ae)if(M.tag===4&&M.stateNode.containerInfo===z.containerInfo&&M.stateNode.implementation===z.implementation){a(R,M.sibling),X=o(M,z.children||[]),X.return=R,R=X;break e}else{a(R,M);break}else t(R,M);M=M.sibling}X=jr(z,R.mode,X),X.return=R,R=X}return v(R);case ne:return ae=z._init,z=ae(z._payload),Re(R,M,z,X)}if(U(z))return me(R,M,z,X);if(Ce(z)){if(ae=Ce(z),typeof ae!="function")throw Error(i(150));return z=ae.call(z),ue(R,M,z,X)}if(typeof z.then=="function")return Re(R,M,Zl(z),X);if(z.$$typeof===G)return Re(R,M,Hl(R,z),X);Kl(R,z)}return typeof z=="string"&&z!==""||typeof z=="number"||typeof z=="bigint"?(z=""+z,M!==null&&M.tag===6?(a(R,M.sibling),X=o(M,z),X.return=R,R=X):(a(R,M),X=Sr(z,R.mode,X),X.return=R,R=X),v(R)):a(R,M)}return function(R,M,z,X){try{Ls=0;var ae=Re(R,M,z,X);return $n=null,ae}catch(le){if(le===Ns||le===Ll)throw le;var ve=Mt(29,le,null,R.mode);return ve.lanes=X,ve.return=R,ve}finally{}}}var Vn=jd(!0),Td=jd(!1),Xt=k(null),ea=null;function Ra(e){var t=e.alternate;Z(tt,tt.current&1),Z(Xt,e),ea===null&&(t===null||Pn.current!==null||t.memoizedState!==null)&&(ea=e)}function Ed(e){if(e.tag===22){if(Z(tt,tt.current),Z(Xt,e),ea===null){var t=e.alternate;t!==null&&t.memoizedState!==null&&(ea=e)}}else za()}function za(){Z(tt,tt.current),Z(Xt,Xt.current)}function ha(e){Q(Xt),ea===e&&(ea=null),Q(tt)}var tt=k(0);function Jl(e){for(var t=e;t!==null;){if(t.tag===13){var a=t.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||a.data==="$?"||Vc(a)))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if((t.flags&128)!==0)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function ac(e,t,a,n){t=e.memoizedState,a=a(n,t),a=a==null?t:y({},t,a),e.memoizedState=a,e.lanes===0&&(e.updateQueue.baseState=a)}var nc={enqueueSetState:function(e,t,a){e=e._reactInternals;var n=Ot(),o=qa(n);o.payload=t,a!=null&&(o.callback=a),t=Ma(e,o,n),t!==null&&(Ht(t,e,n),Ms(t,e,n))},enqueueReplaceState:function(e,t,a){e=e._reactInternals;var n=Ot(),o=qa(n);o.tag=1,o.payload=t,a!=null&&(o.callback=a),t=Ma(e,o,n),t!==null&&(Ht(t,e,n),Ms(t,e,n))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var a=Ot(),n=qa(a);n.tag=2,t!=null&&(n.callback=t),t=Ma(e,n,a),t!==null&&(Ht(t,e,a),Ms(t,e,a))}};function Cd(e,t,a,n,o,d,v){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,d,v):t.prototype&&t.prototype.isPureReactComponent?!bs(a,n)||!bs(o,d):!0}function Ad(e,t,a,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(a,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(a,n),t.state!==e&&nc.enqueueReplaceState(t,t.state,null)}function un(e,t){var a=t;if("ref"in t){a={};for(var n in t)n!=="ref"&&(a[n]=t[n])}if(e=e.defaultProps){a===t&&(a=y({},a));for(var o in e)a[o]===void 0&&(a[o]=e[o])}return a}var Il=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)};function Nd(e){Il(e)}function qd(e){console.error(e)}function Md(e){Il(e)}function Fl(e,t){try{var a=e.onUncaughtError;a(t.value,{componentStack:t.stack})}catch(n){setTimeout(function(){throw n})}}function Dd(e,t,a){try{var n=e.onCaughtError;n(a.value,{componentStack:a.stack,errorBoundary:t.tag===1?t.stateNode:null})}catch(o){setTimeout(function(){throw o})}}function sc(e,t,a){return a=qa(a),a.tag=3,a.payload={element:null},a.callback=function(){Fl(e,t)},a}function Rd(e){return e=qa(e),e.tag=3,e}function zd(e,t,a,n){var o=a.type.getDerivedStateFromError;if(typeof o=="function"){var d=n.value;e.payload=function(){return o(d)},e.callback=function(){Dd(t,a,n)}}var v=a.stateNode;v!==null&&typeof v.componentDidCatch=="function"&&(e.callback=function(){Dd(t,a,n),typeof o!="function"&&(Ba===null?Ba=new Set([this]):Ba.add(this));var x=n.stack;this.componentDidCatch(n.value,{componentStack:x!==null?x:""})})}function ph(e,t,a,n,o){if(a.flags|=32768,n!==null&&typeof n=="object"&&typeof n.then=="function"){if(t=a.alternate,t!==null&&Es(t,a,o,!0),a=Xt.current,a!==null){switch(a.tag){case 13:return ea===null?Nc():a.alternate===null&&Xe===0&&(Xe=3),a.flags&=-257,a.flags|=65536,a.lanes=o,n===zr?a.flags|=16384:(t=a.updateQueue,t===null?a.updateQueue=new Set([n]):t.add(n),Mc(e,n,o)),!1;case 22:return a.flags|=65536,n===zr?a.flags|=16384:(t=a.updateQueue,t===null?(t={transitions:null,markerInstances:null,retryQueue:new Set([n])},a.updateQueue=t):(a=t.retryQueue,a===null?t.retryQueue=new Set([n]):a.add(n)),Mc(e,n,o)),!1}throw Error(i(435,a.tag))}return Mc(e,n,o),Nc(),!1}if(Ee)return t=Xt.current,t!==null?((t.flags&65536)===0&&(t.flags|=256),t.flags|=65536,t.lanes=o,n!==Cr&&(e=Error(i(422),{cause:n}),Ts(Bt(e,a)))):(n!==Cr&&(t=Error(i(423),{cause:n}),Ts(Bt(t,a))),e=e.current.alternate,e.flags|=65536,o&=-o,e.lanes|=o,n=Bt(n,a),o=sc(e.stateNode,n,o),wr(e,o),Xe!==4&&(Xe=2)),!1;var d=Error(i(520),{cause:n});if(d=Bt(d,a),Vs===null?Vs=[d]:Vs.push(d),Xe!==4&&(Xe=2),t===null)return!0;n=Bt(n,a),a=t;do{switch(a.tag){case 3:return a.flags|=65536,e=o&-o,a.lanes|=e,e=sc(a.stateNode,n,e),wr(a,e),!1;case 1:if(t=a.type,d=a.stateNode,(a.flags&128)===0&&(typeof t.getDerivedStateFromError=="function"||d!==null&&typeof d.componentDidCatch=="function"&&(Ba===null||!Ba.has(d))))return a.flags|=65536,o&=-o,a.lanes|=o,o=Rd(o),zd(o,e,a,n),wr(a,o),!1}a=a.return}while(a!==null);return!1}var Od=Error(i(461)),st=!1;function ot(e,t,a,n){t.child=e===null?Td(t,null,a,n):Vn(t,e.child,a,n)}function Hd(e,t,a,n,o){a=a.render;var d=t.ref;if("ref"in n){var v={};for(var x in n)x!=="ref"&&(v[x]=n[x])}else v=n;return rn(t),n=Ur(e,t,a,v,d,o),x=Gr(),e!==null&&!st?(Xr(e,t,o),ga(e,t,o)):(Ee&&x&&Tr(t),t.flags|=1,ot(e,t,n,o),t.child)}function wd(e,t,a,n,o){if(e===null){var d=a.type;return typeof d=="function"&&!_r(d)&&d.defaultProps===void 0&&a.compare===null?(t.tag=15,t.type=d,Ld(e,t,d,n,o)):(e=Dl(a.type,null,n,t,t.mode,o),e.ref=t.ref,e.return=t,t.child=e)}if(d=e.child,!mc(e,o)){var v=d.memoizedProps;if(a=a.compare,a=a!==null?a:bs,a(v,n)&&e.ref===t.ref)return ga(e,t,o)}return t.flags|=1,e=oa(d,n),e.ref=t.ref,e.return=t,t.child=e}function Ld(e,t,a,n,o){if(e!==null){var d=e.memoizedProps;if(bs(d,n)&&e.ref===t.ref)if(st=!1,t.pendingProps=n=d,mc(e,o))(e.flags&131072)!==0&&(st=!0);else return t.lanes=e.lanes,ga(e,t,o)}return lc(e,t,a,n,o)}function kd(e,t,a){var n=t.pendingProps,o=n.children,d=e!==null?e.memoizedState:null;if(n.mode==="hidden"){if((t.flags&128)!==0){if(n=d!==null?d.baseLanes|a:a,e!==null){for(o=t.child=e.child,d=0;o!==null;)d=d|o.lanes|o.childLanes,o=o.sibling;t.childLanes=d&~n}else t.childLanes=0,t.child=null;return Bd(e,t,n,a)}if((a&536870912)!==0)t.memoizedState={baseLanes:0,cachePool:null},e!==null&&wl(t,d!==null?d.cachePool:null),d!==null?Lu(t,d):kr(),Ed(t);else return t.lanes=t.childLanes=536870912,Bd(e,t,d!==null?d.baseLanes|a:a,a)}else d!==null?(wl(t,d.cachePool),Lu(t,d),za(),t.memoizedState=null):(e!==null&&wl(t,null),kr(),za());return ot(e,t,o,a),t.child}function Bd(e,t,a,n){var o=Rr();return o=o===null?null:{parent:et._currentValue,pool:o},t.memoizedState={baseLanes:a,cachePool:o},e!==null&&wl(t,null),kr(),Ed(t),e!==null&&Es(e,t,n,!0),null}function Wl(e,t){var a=t.ref;if(a===null)e!==null&&e.ref!==null&&(t.flags|=4194816);else{if(typeof a!="function"&&typeof a!="object")throw Error(i(284));(e===null||e.ref!==a)&&(t.flags|=4194816)}}function lc(e,t,a,n,o){return rn(t),a=Ur(e,t,a,n,void 0,o),n=Gr(),e!==null&&!st?(Xr(e,t,o),ga(e,t,o)):(Ee&&n&&Tr(t),t.flags|=1,ot(e,t,a,o),t.child)}function Pd(e,t,a,n,o,d){return rn(t),t.updateQueue=null,a=Bu(t,n,a,o),ku(e),n=Gr(),e!==null&&!st?(Xr(e,t,d),ga(e,t,d)):(Ee&&n&&Tr(t),t.flags|=1,ot(e,t,a,d),t.child)}function Ud(e,t,a,n,o){if(rn(t),t.stateNode===null){var d=Hn,v=a.contextType;typeof v=="object"&&v!==null&&(d=pt(v)),d=new a(n,d),t.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,d.updater=nc,t.stateNode=d,d._reactInternals=t,d=t.stateNode,d.props=n,d.state=t.memoizedState,d.refs={},Or(t),v=a.contextType,d.context=typeof v=="object"&&v!==null?pt(v):Hn,d.state=t.memoizedState,v=a.getDerivedStateFromProps,typeof v=="function"&&(ac(t,a,v,n),d.state=t.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof d.getSnapshotBeforeUpdate=="function"||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(v=d.state,typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount(),v!==d.state&&nc.enqueueReplaceState(d,d.state,null),Rs(t,n,d,o),Ds(),d.state=t.memoizedState),typeof d.componentDidMount=="function"&&(t.flags|=4194308),n=!0}else if(e===null){d=t.stateNode;var x=t.memoizedProps,C=un(a,x);d.props=C;var O=d.context,P=a.contextType;v=Hn,typeof P=="object"&&P!==null&&(v=pt(P));var V=a.getDerivedStateFromProps;P=typeof V=="function"||typeof d.getSnapshotBeforeUpdate=="function",x=t.pendingProps!==x,P||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(x||O!==v)&&Ad(t,d,n,v),Na=!1;var H=t.memoizedState;d.state=H,Rs(t,n,d,o),Ds(),O=t.memoizedState,x||H!==O||Na?(typeof V=="function"&&(ac(t,a,V,n),O=t.memoizedState),(C=Na||Cd(t,a,C,n,H,O,v))?(P||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount()),typeof d.componentDidMount=="function"&&(t.flags|=4194308)):(typeof d.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=O),d.props=n,d.state=O,d.context=v,n=C):(typeof d.componentDidMount=="function"&&(t.flags|=4194308),n=!1)}else{d=t.stateNode,Hr(e,t),v=t.memoizedProps,P=un(a,v),d.props=P,V=t.pendingProps,H=d.context,O=a.contextType,C=Hn,typeof O=="object"&&O!==null&&(C=pt(O)),x=a.getDerivedStateFromProps,(O=typeof x=="function"||typeof d.getSnapshotBeforeUpdate=="function")||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(v!==V||H!==C)&&Ad(t,d,n,C),Na=!1,H=t.memoizedState,d.state=H,Rs(t,n,d,o),Ds();var w=t.memoizedState;v!==V||H!==w||Na||e!==null&&e.dependencies!==null&&Ol(e.dependencies)?(typeof x=="function"&&(ac(t,a,x,n),w=t.memoizedState),(P=Na||Cd(t,a,P,n,H,w,C)||e!==null&&e.dependencies!==null&&Ol(e.dependencies))?(O||typeof d.UNSAFE_componentWillUpdate!="function"&&typeof d.componentWillUpdate!="function"||(typeof d.componentWillUpdate=="function"&&d.componentWillUpdate(n,w,C),typeof d.UNSAFE_componentWillUpdate=="function"&&d.UNSAFE_componentWillUpdate(n,w,C)),typeof d.componentDidUpdate=="function"&&(t.flags|=4),typeof d.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof d.componentDidUpdate!="function"||v===e.memoizedProps&&H===e.memoizedState||(t.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||v===e.memoizedProps&&H===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=w),d.props=n,d.state=w,d.context=C,n=P):(typeof d.componentDidUpdate!="function"||v===e.memoizedProps&&H===e.memoizedState||(t.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||v===e.memoizedProps&&H===e.memoizedState||(t.flags|=1024),n=!1)}return d=n,Wl(e,t),n=(t.flags&128)!==0,d||n?(d=t.stateNode,a=n&&typeof a.getDerivedStateFromError!="function"?null:d.render(),t.flags|=1,e!==null&&n?(t.child=Vn(t,e.child,null,o),t.child=Vn(t,null,a,o)):ot(e,t,a,o),t.memoizedState=d.state,e=t.child):e=ga(e,t,o),e}function Gd(e,t,a,n){return js(),t.flags|=256,ot(e,t,a,n),t.child}var ic={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function rc(e){return{baseLanes:e,cachePool:qu()}}function cc(e,t,a){return e=e!==null?e.childLanes&~a:0,t&&(e|=$t),e}function Xd(e,t,a){var n=t.pendingProps,o=!1,d=(t.flags&128)!==0,v;if((v=d)||(v=e!==null&&e.memoizedState===null?!1:(tt.current&2)!==0),v&&(o=!0,t.flags&=-129),v=(t.flags&32)!==0,t.flags&=-33,e===null){if(Ee){if(o?Ra(t):za(),Ee){var x=Ge,C;if(C=x){e:{for(C=x,x=Wt;C.nodeType!==8;){if(!x){x=null;break e}if(C=Jt(C.nextSibling),C===null){x=null;break e}}x=C}x!==null?(t.memoizedState={dehydrated:x,treeContext:tn!==null?{id:ua,overflow:da}:null,retryLane:536870912,hydrationErrors:null},C=Mt(18,null,null,0),C.stateNode=x,C.return=t,t.child=C,ht=t,Ge=null,C=!0):C=!1}C||sn(t)}if(x=t.memoizedState,x!==null&&(x=x.dehydrated,x!==null))return Vc(x)?t.lanes=32:t.lanes=536870912,null;ha(t)}return x=n.children,n=n.fallback,o?(za(),o=t.mode,x=ei({mode:"hidden",children:x},o),n=en(n,o,a,null),x.return=t,n.return=t,x.sibling=n,t.child=x,o=t.child,o.memoizedState=rc(a),o.childLanes=cc(e,v,a),t.memoizedState=ic,n):(Ra(t),oc(t,x))}if(C=e.memoizedState,C!==null&&(x=C.dehydrated,x!==null)){if(d)t.flags&256?(Ra(t),t.flags&=-257,t=uc(e,t,a)):t.memoizedState!==null?(za(),t.child=e.child,t.flags|=128,t=null):(za(),o=n.fallback,x=t.mode,n=ei({mode:"visible",children:n.children},x),o=en(o,x,a,null),o.flags|=2,n.return=t,o.return=t,n.sibling=o,t.child=n,Vn(t,e.child,null,a),n=t.child,n.memoizedState=rc(a),n.childLanes=cc(e,v,a),t.memoizedState=ic,t=o);else if(Ra(t),Vc(x)){if(v=x.nextSibling&&x.nextSibling.dataset,v)var O=v.dgst;v=O,n=Error(i(419)),n.stack="",n.digest=v,Ts({value:n,source:null,stack:null}),t=uc(e,t,a)}else if(st||Es(e,t,a,!1),v=(a&e.childLanes)!==0,st||v){if(v=we,v!==null&&(n=a&-a,n=(n&42)!==0?1:Yi(n),n=(n&(v.suspendedLanes|a))!==0?0:n,n!==0&&n!==C.retryLane))throw C.retryLane=n,On(e,n),Ht(v,e,n),Od;x.data==="$?"||Nc(),t=uc(e,t,a)}else x.data==="$?"?(t.flags|=192,t.child=e.child,t=null):(e=C.treeContext,Ge=Jt(x.nextSibling),ht=t,Ee=!0,nn=null,Wt=!1,e!==null&&(Ut[Gt++]=ua,Ut[Gt++]=da,Ut[Gt++]=tn,ua=e.id,da=e.overflow,tn=t),t=oc(t,n.children),t.flags|=4096);return t}return o?(za(),o=n.fallback,x=t.mode,C=e.child,O=C.sibling,n=oa(C,{mode:"hidden",children:n.children}),n.subtreeFlags=C.subtreeFlags&65011712,O!==null?o=oa(O,o):(o=en(o,x,a,null),o.flags|=2),o.return=t,n.return=t,n.sibling=o,t.child=n,n=o,o=t.child,x=e.child.memoizedState,x===null?x=rc(a):(C=x.cachePool,C!==null?(O=et._currentValue,C=C.parent!==O?{parent:O,pool:O}:C):C=qu(),x={baseLanes:x.baseLanes|a,cachePool:C}),o.memoizedState=x,o.childLanes=cc(e,v,a),t.memoizedState=ic,n):(Ra(t),a=e.child,e=a.sibling,a=oa(a,{mode:"visible",children:n.children}),a.return=t,a.sibling=null,e!==null&&(v=t.deletions,v===null?(t.deletions=[e],t.flags|=16):v.push(e)),t.child=a,t.memoizedState=null,a)}function oc(e,t){return t=ei({mode:"visible",children:t},e.mode),t.return=e,e.child=t}function ei(e,t){return e=Mt(22,e,null,t),e.lanes=0,e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},e}function uc(e,t,a){return Vn(t,e.child,null,a),e=oc(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function $d(e,t,a){e.lanes|=t;var n=e.alternate;n!==null&&(n.lanes|=t),Nr(e.return,t,a)}function dc(e,t,a,n,o){var d=e.memoizedState;d===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:a,tailMode:o}:(d.isBackwards=t,d.rendering=null,d.renderingStartTime=0,d.last=n,d.tail=a,d.tailMode=o)}function Vd(e,t,a){var n=t.pendingProps,o=n.revealOrder,d=n.tail;if(ot(e,t,n.children,a),n=tt.current,(n&2)!==0)n=n&1|2,t.flags|=128;else{if(e!==null&&(e.flags&128)!==0)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&$d(e,a,t);else if(e.tag===19)$d(e,a,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}switch(Z(tt,n),o){case"forwards":for(a=t.child,o=null;a!==null;)e=a.alternate,e!==null&&Jl(e)===null&&(o=a),a=a.sibling;a=o,a===null?(o=t.child,t.child=null):(o=a.sibling,a.sibling=null),dc(t,!1,o,a,d);break;case"backwards":for(a=null,o=t.child,t.child=null;o!==null;){if(e=o.alternate,e!==null&&Jl(e)===null){t.child=o;break}e=o.sibling,o.sibling=a,a=o,o=e}dc(t,!0,a,null,d);break;case"together":dc(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function ga(e,t,a){if(e!==null&&(t.dependencies=e.dependencies),ka|=t.lanes,(a&t.childLanes)===0)if(e!==null){if(Es(e,t,a,!1),(a&t.childLanes)===0)return null}else return null;if(e!==null&&t.child!==e.child)throw Error(i(153));if(t.child!==null){for(e=t.child,a=oa(e,e.pendingProps),t.child=a,a.return=t;e.sibling!==null;)e=e.sibling,a=a.sibling=oa(e,e.pendingProps),a.return=t;a.sibling=null}return t.child}function mc(e,t){return(e.lanes&t)!==0?!0:(e=e.dependencies,!!(e!==null&&Ol(e)))}function fh(e,t,a){switch(t.tag){case 3:Ae(t,t.stateNode.containerInfo),Aa(t,et,e.memoizedState.cache),js();break;case 27:case 5:Za(t);break;case 4:Ae(t,t.stateNode.containerInfo);break;case 10:Aa(t,t.type,t.memoizedProps.value);break;case 13:var n=t.memoizedState;if(n!==null)return n.dehydrated!==null?(Ra(t),t.flags|=128,null):(a&t.child.childLanes)!==0?Xd(e,t,a):(Ra(t),e=ga(e,t,a),e!==null?e.sibling:null);Ra(t);break;case 19:var o=(e.flags&128)!==0;if(n=(a&t.childLanes)!==0,n||(Es(e,t,a,!1),n=(a&t.childLanes)!==0),o){if(n)return Vd(e,t,a);t.flags|=128}if(o=t.memoizedState,o!==null&&(o.rendering=null,o.tail=null,o.lastEffect=null),Z(tt,tt.current),n)break;return null;case 22:case 23:return t.lanes=0,kd(e,t,a);case 24:Aa(t,et,e.memoizedState.cache)}return ga(e,t,a)}function Yd(e,t,a){if(e!==null)if(e.memoizedProps!==t.pendingProps)st=!0;else{if(!mc(e,a)&&(t.flags&128)===0)return st=!1,fh(e,t,a);st=(e.flags&131072)!==0}else st=!1,Ee&&(t.flags&1048576)!==0&&Su(t,zl,t.index);switch(t.lanes=0,t.tag){case 16:e:{e=t.pendingProps;var n=t.elementType,o=n._init;if(n=o(n._payload),t.type=n,typeof n=="function")_r(n)?(e=un(n,e),t.tag=1,t=Ud(null,t,n,e,a)):(t.tag=0,t=lc(null,t,n,e,a));else{if(n!=null){if(o=n.$$typeof,o===re){t.tag=11,t=Hd(null,t,n,e,a);break e}else if(o===I){t.tag=14,t=wd(null,t,n,e,a);break e}}throw t=$(n)||n,Error(i(306,t,""))}}return t;case 0:return lc(e,t,t.type,t.pendingProps,a);case 1:return n=t.type,o=un(n,t.pendingProps),Ud(e,t,n,o,a);case 3:e:{if(Ae(t,t.stateNode.containerInfo),e===null)throw Error(i(387));n=t.pendingProps;var d=t.memoizedState;o=d.element,Hr(e,t),Rs(t,n,null,a);var v=t.memoizedState;if(n=v.cache,Aa(t,et,n),n!==d.cache&&qr(t,[et],a,!0),Ds(),n=v.element,d.isDehydrated)if(d={element:n,isDehydrated:!1,cache:v.cache},t.updateQueue.baseState=d,t.memoizedState=d,t.flags&256){t=Gd(e,t,n,a);break e}else if(n!==o){o=Bt(Error(i(424)),t),Ts(o),t=Gd(e,t,n,a);break e}else{switch(e=t.stateNode.containerInfo,e.nodeType){case 9:e=e.body;break;default:e=e.nodeName==="HTML"?e.ownerDocument.body:e}for(Ge=Jt(e.firstChild),ht=t,Ee=!0,nn=null,Wt=!0,a=Td(t,null,n,a),t.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling}else{if(js(),n===o){t=ga(e,t,a);break e}ot(e,t,n,a)}t=t.child}return t;case 26:return Wl(e,t),e===null?(a=Jm(t.type,null,t.pendingProps,null))?t.memoizedState=a:Ee||(a=t.type,e=t.pendingProps,n=fi(ie.current).createElement(a),n[mt]=t,n[xt]=e,dt(n,a,e),nt(n),t.stateNode=n):t.memoizedState=Jm(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return Za(t),e===null&&Ee&&(n=t.stateNode=Qm(t.type,t.pendingProps,ie.current),ht=t,Wt=!0,o=Ge,Ga(t.type)?(Yc=o,Ge=Jt(n.firstChild)):Ge=o),ot(e,t,t.pendingProps.children,a),Wl(e,t),e===null&&(t.flags|=4194304),t.child;case 5:return e===null&&Ee&&((o=n=Ge)&&(n=Gh(n,t.type,t.pendingProps,Wt),n!==null?(t.stateNode=n,ht=t,Ge=Jt(n.firstChild),Wt=!1,o=!0):o=!1),o||sn(t)),Za(t),o=t.type,d=t.pendingProps,v=e!==null?e.memoizedProps:null,n=d.children,Gc(o,d)?n=null:v!==null&&Gc(o,v)&&(t.flags|=32),t.memoizedState!==null&&(o=Ur(e,t,ih,null,null,a),el._currentValue=o),Wl(e,t),ot(e,t,n,a),t.child;case 6:return e===null&&Ee&&((e=a=Ge)&&(a=Xh(a,t.pendingProps,Wt),a!==null?(t.stateNode=a,ht=t,Ge=null,e=!0):e=!1),e||sn(t)),null;case 13:return Xd(e,t,a);case 4:return Ae(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=Vn(t,null,n,a):ot(e,t,n,a),t.child;case 11:return Hd(e,t,t.type,t.pendingProps,a);case 7:return ot(e,t,t.pendingProps,a),t.child;case 8:return ot(e,t,t.pendingProps.children,a),t.child;case 12:return ot(e,t,t.pendingProps.children,a),t.child;case 10:return n=t.pendingProps,Aa(t,t.type,n.value),ot(e,t,n.children,a),t.child;case 9:return o=t.type._context,n=t.pendingProps.children,rn(t),o=pt(o),n=n(o),t.flags|=1,ot(e,t,n,a),t.child;case 14:return wd(e,t,t.type,t.pendingProps,a);case 15:return Ld(e,t,t.type,t.pendingProps,a);case 19:return Vd(e,t,a);case 31:return n=t.pendingProps,a=t.mode,n={mode:n.mode,children:n.children},e===null?(a=ei(n,a),a.ref=t.ref,t.child=a,a.return=t,t=a):(a=oa(e.child,n),a.ref=t.ref,t.child=a,a.return=t,t=a),t;case 22:return kd(e,t,a);case 24:return rn(t),n=pt(et),e===null?(o=Rr(),o===null&&(o=we,d=Mr(),o.pooledCache=d,d.refCount++,d!==null&&(o.pooledCacheLanes|=a),o=d),t.memoizedState={parent:n,cache:o},Or(t),Aa(t,et,o)):((e.lanes&a)!==0&&(Hr(e,t),Rs(t,null,null,a),Ds()),o=e.memoizedState,d=t.memoizedState,o.parent!==n?(o={parent:n,cache:n},t.memoizedState=o,t.lanes===0&&(t.memoizedState=t.updateQueue.baseState=o),Aa(t,et,n)):(n=d.cache,Aa(t,et,n),n!==o.cache&&qr(t,[et],a,!0))),ot(e,t,t.pendingProps.children,a),t.child;case 29:throw t.pendingProps}throw Error(i(156,t.tag))}function va(e){e.flags|=4}function Qd(e,t){if(t.type!=="stylesheet"||(t.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!tp(t)){if(t=Xt.current,t!==null&&((_e&4194048)===_e?ea!==null:(_e&62914560)!==_e&&(_e&536870912)===0||t!==ea))throw qs=zr,Mu;e.flags|=8192}}function ti(e,t){t!==null&&(e.flags|=4),e.flags&16384&&(t=e.tag!==22?Eo():536870912,e.lanes|=t,Kn|=t)}function Bs(e,t){if(!Ee)switch(e.tailMode){case"hidden":t=e.tail;for(var a=null;t!==null;)t.alternate!==null&&(a=t),t=t.sibling;a===null?e.tail=null:a.sibling=null;break;case"collapsed":a=e.tail;for(var n=null;a!==null;)a.alternate!==null&&(n=a),a=a.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function Ue(e){var t=e.alternate!==null&&e.alternate.child===e.child,a=0,n=0;if(t)for(var o=e.child;o!==null;)a|=o.lanes|o.childLanes,n|=o.subtreeFlags&65011712,n|=o.flags&65011712,o.return=e,o=o.sibling;else for(o=e.child;o!==null;)a|=o.lanes|o.childLanes,n|=o.subtreeFlags,n|=o.flags,o.return=e,o=o.sibling;return e.subtreeFlags|=n,e.childLanes=a,t}function hh(e,t,a){var n=t.pendingProps;switch(Er(t),t.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ue(t),null;case 1:return Ue(t),null;case 3:return a=t.stateNode,n=null,e!==null&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),pa(et),Ft(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(e===null||e.child===null)&&(Ss(t)?va(t):e===null||e.memoizedState.isDehydrated&&(t.flags&256)===0||(t.flags|=1024,Eu())),Ue(t),null;case 26:return a=t.memoizedState,e===null?(va(t),a!==null?(Ue(t),Qd(t,a)):(Ue(t),t.flags&=-16777217)):a?a!==e.memoizedState?(va(t),Ue(t),Qd(t,a)):(Ue(t),t.flags&=-16777217):(e.memoizedProps!==n&&va(t),Ue(t),t.flags&=-16777217),null;case 27:gn(t),a=ie.current;var o=t.type;if(e!==null&&t.stateNode!=null)e.memoizedProps!==n&&va(t);else{if(!n){if(t.stateNode===null)throw Error(i(166));return Ue(t),null}e=te.current,Ss(t)?ju(t):(e=Qm(o,n,a),t.stateNode=e,va(t))}return Ue(t),null;case 5:if(gn(t),a=t.type,e!==null&&t.stateNode!=null)e.memoizedProps!==n&&va(t);else{if(!n){if(t.stateNode===null)throw Error(i(166));return Ue(t),null}if(e=te.current,Ss(t))ju(t);else{switch(o=fi(ie.current),e){case 1:e=o.createElementNS("http://www.w3.org/2000/svg",a);break;case 2:e=o.createElementNS("http://www.w3.org/1998/Math/MathML",a);break;default:switch(a){case"svg":e=o.createElementNS("http://www.w3.org/2000/svg",a);break;case"math":e=o.createElementNS("http://www.w3.org/1998/Math/MathML",a);break;case"script":e=o.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild);break;case"select":e=typeof n.is=="string"?o.createElement("select",{is:n.is}):o.createElement("select"),n.multiple?e.multiple=!0:n.size&&(e.size=n.size);break;default:e=typeof n.is=="string"?o.createElement(a,{is:n.is}):o.createElement(a)}}e[mt]=t,e[xt]=n;e:for(o=t.child;o!==null;){if(o.tag===5||o.tag===6)e.appendChild(o.stateNode);else if(o.tag!==4&&o.tag!==27&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===t)break e;for(;o.sibling===null;){if(o.return===null||o.return===t)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}t.stateNode=e;e:switch(dt(e,a,n),a){case"button":case"input":case"select":case"textarea":e=!!n.autoFocus;break e;case"img":e=!0;break e;default:e=!1}e&&va(t)}}return Ue(t),t.flags&=-16777217,null;case 6:if(e&&t.stateNode!=null)e.memoizedProps!==n&&va(t);else{if(typeof n!="string"&&t.stateNode===null)throw Error(i(166));if(e=ie.current,Ss(t)){if(e=t.stateNode,a=t.memoizedProps,n=null,o=ht,o!==null)switch(o.tag){case 27:case 5:n=o.memoizedProps}e[mt]=t,e=!!(e.nodeValue===a||n!==null&&n.suppressHydrationWarning===!0||Pm(e.nodeValue,a)),e||sn(t)}else e=fi(e).createTextNode(n),e[mt]=t,t.stateNode=e}return Ue(t),null;case 13:if(n=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(o=Ss(t),n!==null&&n.dehydrated!==null){if(e===null){if(!o)throw Error(i(318));if(o=t.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(i(317));o[mt]=t}else js(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;Ue(t),o=!1}else o=Eu(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=o),o=!0;if(!o)return t.flags&256?(ha(t),t):(ha(t),null)}if(ha(t),(t.flags&128)!==0)return t.lanes=a,t;if(a=n!==null,e=e!==null&&e.memoizedState!==null,a){n=t.child,o=null,n.alternate!==null&&n.alternate.memoizedState!==null&&n.alternate.memoizedState.cachePool!==null&&(o=n.alternate.memoizedState.cachePool.pool);var d=null;n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(d=n.memoizedState.cachePool.pool),d!==o&&(n.flags|=2048)}return a!==e&&a&&(t.child.flags|=8192),ti(t,t.updateQueue),Ue(t),null;case 4:return Ft(),e===null&&Lc(t.stateNode.containerInfo),Ue(t),null;case 10:return pa(t.type),Ue(t),null;case 19:if(Q(tt),o=t.memoizedState,o===null)return Ue(t),null;if(n=(t.flags&128)!==0,d=o.rendering,d===null)if(n)Bs(o,!1);else{if(Xe!==0||e!==null&&(e.flags&128)!==0)for(e=t.child;e!==null;){if(d=Jl(e),d!==null){for(t.flags|=128,Bs(o,!1),e=d.updateQueue,t.updateQueue=e,ti(t,e),t.subtreeFlags=0,e=a,a=t.child;a!==null;)_u(a,e),a=a.sibling;return Z(tt,tt.current&1|2),t.child}e=e.sibling}o.tail!==null&&wt()>si&&(t.flags|=128,n=!0,Bs(o,!1),t.lanes=4194304)}else{if(!n)if(e=Jl(d),e!==null){if(t.flags|=128,n=!0,e=e.updateQueue,t.updateQueue=e,ti(t,e),Bs(o,!0),o.tail===null&&o.tailMode==="hidden"&&!d.alternate&&!Ee)return Ue(t),null}else 2*wt()-o.renderingStartTime>si&&a!==536870912&&(t.flags|=128,n=!0,Bs(o,!1),t.lanes=4194304);o.isBackwards?(d.sibling=t.child,t.child=d):(e=o.last,e!==null?e.sibling=d:t.child=d,o.last=d)}return o.tail!==null?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=wt(),t.sibling=null,e=tt.current,Z(tt,n?e&1|2:e&1),t):(Ue(t),null);case 22:case 23:return ha(t),Br(),n=t.memoizedState!==null,e!==null?e.memoizedState!==null!==n&&(t.flags|=8192):n&&(t.flags|=8192),n?(a&536870912)!==0&&(t.flags&128)===0&&(Ue(t),t.subtreeFlags&6&&(t.flags|=8192)):Ue(t),a=t.updateQueue,a!==null&&ti(t,a.retryQueue),a=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(a=e.memoizedState.cachePool.pool),n=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(n=t.memoizedState.cachePool.pool),n!==a&&(t.flags|=2048),e!==null&&Q(cn),null;case 24:return a=null,e!==null&&(a=e.memoizedState.cache),t.memoizedState.cache!==a&&(t.flags|=2048),pa(et),Ue(t),null;case 25:return null;case 30:return null}throw Error(i(156,t.tag))}function gh(e,t){switch(Er(t),t.tag){case 1:return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return pa(et),Ft(),e=t.flags,(e&65536)!==0&&(e&128)===0?(t.flags=e&-65537|128,t):null;case 26:case 27:case 5:return gn(t),null;case 13:if(ha(t),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(i(340));js()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Q(tt),null;case 4:return Ft(),null;case 10:return pa(t.type),null;case 22:case 23:return ha(t),Br(),e!==null&&Q(cn),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 24:return pa(et),null;case 25:return null;default:return null}}function Zd(e,t){switch(Er(t),t.tag){case 3:pa(et),Ft();break;case 26:case 27:case 5:gn(t);break;case 4:Ft();break;case 13:ha(t);break;case 19:Q(tt);break;case 10:pa(t.type);break;case 22:case 23:ha(t),Br(),e!==null&&Q(cn);break;case 24:pa(et)}}function Ps(e,t){try{var a=t.updateQueue,n=a!==null?a.lastEffect:null;if(n!==null){var o=n.next;a=o;do{if((a.tag&e)===e){n=void 0;var d=a.create,v=a.inst;n=d(),v.destroy=n}a=a.next}while(a!==o)}}catch(x){ze(t,t.return,x)}}function Oa(e,t,a){try{var n=t.updateQueue,o=n!==null?n.lastEffect:null;if(o!==null){var d=o.next;n=d;do{if((n.tag&e)===e){var v=n.inst,x=v.destroy;if(x!==void 0){v.destroy=void 0,o=t;var C=a,O=x;try{O()}catch(P){ze(o,C,P)}}}n=n.next}while(n!==d)}}catch(P){ze(t,t.return,P)}}function Kd(e){var t=e.updateQueue;if(t!==null){var a=e.stateNode;try{wu(t,a)}catch(n){ze(e,e.return,n)}}}function Jd(e,t,a){a.props=un(e.type,e.memoizedProps),a.state=e.memoizedState;try{a.componentWillUnmount()}catch(n){ze(e,t,n)}}function Us(e,t){try{var a=e.ref;if(a!==null){switch(e.tag){case 26:case 27:case 5:var n=e.stateNode;break;case 30:n=e.stateNode;break;default:n=e.stateNode}typeof a=="function"?e.refCleanup=a(n):a.current=n}}catch(o){ze(e,t,o)}}function ta(e,t){var a=e.ref,n=e.refCleanup;if(a!==null)if(typeof n=="function")try{n()}catch(o){ze(e,t,o)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof a=="function")try{a(null)}catch(o){ze(e,t,o)}else a.current=null}function Id(e){var t=e.type,a=e.memoizedProps,n=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":a.autoFocus&&n.focus();break e;case"img":a.src?n.src=a.src:a.srcSet&&(n.srcset=a.srcSet)}}catch(o){ze(e,e.return,o)}}function pc(e,t,a){try{var n=e.stateNode;Lh(n,e.type,a,t),n[xt]=t}catch(o){ze(e,e.return,o)}}function Fd(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&Ga(e.type)||e.tag===4}function fc(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Fd(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&Ga(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function hc(e,t,a){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a).insertBefore(e,t):(t=a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,t.appendChild(e),a=a._reactRootContainer,a!=null||t.onclick!==null||(t.onclick=pi));else if(n!==4&&(n===27&&Ga(e.type)&&(a=e.stateNode,t=null),e=e.child,e!==null))for(hc(e,t,a),e=e.sibling;e!==null;)hc(e,t,a),e=e.sibling}function ai(e,t,a){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?a.insertBefore(e,t):a.appendChild(e);else if(n!==4&&(n===27&&Ga(e.type)&&(a=e.stateNode),e=e.child,e!==null))for(ai(e,t,a),e=e.sibling;e!==null;)ai(e,t,a),e=e.sibling}function Wd(e){var t=e.stateNode,a=e.memoizedProps;try{for(var n=e.type,o=t.attributes;o.length;)t.removeAttributeNode(o[0]);dt(t,n,a),t[mt]=e,t[xt]=a}catch(d){ze(e,e.return,d)}}var ya=!1,Ve=!1,gc=!1,em=typeof WeakSet=="function"?WeakSet:Set,lt=null;function vh(e,t){if(e=e.containerInfo,Pc=bi,e=du(e),fr(e)){if("selectionStart"in e)var a={start:e.selectionStart,end:e.selectionEnd};else e:{a=(a=e.ownerDocument)&&a.defaultView||window;var n=a.getSelection&&a.getSelection();if(n&&n.rangeCount!==0){a=n.anchorNode;var o=n.anchorOffset,d=n.focusNode;n=n.focusOffset;try{a.nodeType,d.nodeType}catch{a=null;break e}var v=0,x=-1,C=-1,O=0,P=0,V=e,H=null;t:for(;;){for(var w;V!==a||o!==0&&V.nodeType!==3||(x=v+o),V!==d||n!==0&&V.nodeType!==3||(C=v+n),V.nodeType===3&&(v+=V.nodeValue.length),(w=V.firstChild)!==null;)H=V,V=w;for(;;){if(V===e)break t;if(H===a&&++O===o&&(x=v),H===d&&++P===n&&(C=v),(w=V.nextSibling)!==null)break;V=H,H=V.parentNode}V=w}a=x===-1||C===-1?null:{start:x,end:C}}else a=null}a=a||{start:0,end:0}}else a=null;for(Uc={focusedElem:e,selectionRange:a},bi=!1,lt=t;lt!==null;)if(t=lt,e=t.child,(t.subtreeFlags&1024)!==0&&e!==null)e.return=t,lt=e;else for(;lt!==null;){switch(t=lt,d=t.alternate,e=t.flags,t.tag){case 0:break;case 11:case 15:break;case 1:if((e&1024)!==0&&d!==null){e=void 0,a=t,o=d.memoizedProps,d=d.memoizedState,n=a.stateNode;try{var me=un(a.type,o,a.elementType===a.type);e=n.getSnapshotBeforeUpdate(me,d),n.__reactInternalSnapshotBeforeUpdate=e}catch(ue){ze(a,a.return,ue)}}break;case 3:if((e&1024)!==0){if(e=t.stateNode.containerInfo,a=e.nodeType,a===9)$c(e);else if(a===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":$c(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(i(163))}if(e=t.sibling,e!==null){e.return=t.return,lt=e;break}lt=t.return}}function tm(e,t,a){var n=a.flags;switch(a.tag){case 0:case 11:case 15:Ha(e,a),n&4&&Ps(5,a);break;case 1:if(Ha(e,a),n&4)if(e=a.stateNode,t===null)try{e.componentDidMount()}catch(v){ze(a,a.return,v)}else{var o=un(a.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(o,t,e.__reactInternalSnapshotBeforeUpdate)}catch(v){ze(a,a.return,v)}}n&64&&Kd(a),n&512&&Us(a,a.return);break;case 3:if(Ha(e,a),n&64&&(e=a.updateQueue,e!==null)){if(t=null,a.child!==null)switch(a.child.tag){case 27:case 5:t=a.child.stateNode;break;case 1:t=a.child.stateNode}try{wu(e,t)}catch(v){ze(a,a.return,v)}}break;case 27:t===null&&n&4&&Wd(a);case 26:case 5:Ha(e,a),t===null&&n&4&&Id(a),n&512&&Us(a,a.return);break;case 12:Ha(e,a);break;case 13:Ha(e,a),n&4&&sm(e,a),n&64&&(e=a.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(a=Ch.bind(null,a),$h(e,a))));break;case 22:if(n=a.memoizedState!==null||ya,!n){t=t!==null&&t.memoizedState!==null||Ve,o=ya;var d=Ve;ya=n,(Ve=t)&&!d?wa(e,a,(a.subtreeFlags&8772)!==0):Ha(e,a),ya=o,Ve=d}break;case 30:break;default:Ha(e,a)}}function am(e){var t=e.alternate;t!==null&&(e.alternate=null,am(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&Ki(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var ke=null,St=!1;function xa(e,t,a){for(a=a.child;a!==null;)nm(e,t,a),a=a.sibling}function nm(e,t,a){if(Se&&typeof Se.onCommitFiberUnmount=="function")try{Se.onCommitFiberUnmount(Ie,a)}catch{}switch(a.tag){case 26:Ve||ta(a,t),xa(e,t,a),a.memoizedState?a.memoizedState.count--:a.stateNode&&(a=a.stateNode,a.parentNode.removeChild(a));break;case 27:Ve||ta(a,t);var n=ke,o=St;Ga(a.type)&&(ke=a.stateNode,St=!1),xa(e,t,a),Js(a.stateNode),ke=n,St=o;break;case 5:Ve||ta(a,t);case 6:if(n=ke,o=St,ke=null,xa(e,t,a),ke=n,St=o,ke!==null)if(St)try{(ke.nodeType===9?ke.body:ke.nodeName==="HTML"?ke.ownerDocument.body:ke).removeChild(a.stateNode)}catch(d){ze(a,t,d)}else try{ke.removeChild(a.stateNode)}catch(d){ze(a,t,d)}break;case 18:ke!==null&&(St?(e=ke,Vm(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,a.stateNode),sl(e)):Vm(ke,a.stateNode));break;case 4:n=ke,o=St,ke=a.stateNode.containerInfo,St=!0,xa(e,t,a),ke=n,St=o;break;case 0:case 11:case 14:case 15:Ve||Oa(2,a,t),Ve||Oa(4,a,t),xa(e,t,a);break;case 1:Ve||(ta(a,t),n=a.stateNode,typeof n.componentWillUnmount=="function"&&Jd(a,t,n)),xa(e,t,a);break;case 21:xa(e,t,a);break;case 22:Ve=(n=Ve)||a.memoizedState!==null,xa(e,t,a),Ve=n;break;default:xa(e,t,a)}}function sm(e,t){if(t.memoizedState===null&&(e=t.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{sl(e)}catch(a){ze(t,t.return,a)}}function yh(e){switch(e.tag){case 13:case 19:var t=e.stateNode;return t===null&&(t=e.stateNode=new em),t;case 22:return e=e.stateNode,t=e._retryCache,t===null&&(t=e._retryCache=new em),t;default:throw Error(i(435,e.tag))}}function vc(e,t){var a=yh(e);t.forEach(function(n){var o=Ah.bind(null,e,n);a.has(n)||(a.add(n),n.then(o,o))})}function Dt(e,t){var a=t.deletions;if(a!==null)for(var n=0;n<a.length;n++){var o=a[n],d=e,v=t,x=v;e:for(;x!==null;){switch(x.tag){case 27:if(Ga(x.type)){ke=x.stateNode,St=!1;break e}break;case 5:ke=x.stateNode,St=!1;break e;case 3:case 4:ke=x.stateNode.containerInfo,St=!0;break e}x=x.return}if(ke===null)throw Error(i(160));nm(d,v,o),ke=null,St=!1,d=o.alternate,d!==null&&(d.return=null),o.return=null}if(t.subtreeFlags&13878)for(t=t.child;t!==null;)lm(t,e),t=t.sibling}var Kt=null;function lm(e,t){var a=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Dt(t,e),Rt(e),n&4&&(Oa(3,e,e.return),Ps(3,e),Oa(5,e,e.return));break;case 1:Dt(t,e),Rt(e),n&512&&(Ve||a===null||ta(a,a.return)),n&64&&ya&&(e=e.updateQueue,e!==null&&(n=e.callbacks,n!==null&&(a=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=a===null?n:a.concat(n))));break;case 26:var o=Kt;if(Dt(t,e),Rt(e),n&512&&(Ve||a===null||ta(a,a.return)),n&4){var d=a!==null?a.memoizedState:null;if(n=e.memoizedState,a===null)if(n===null)if(e.stateNode===null){e:{n=e.type,a=e.memoizedProps,o=o.ownerDocument||o;t:switch(n){case"title":d=o.getElementsByTagName("title")[0],(!d||d[ds]||d[mt]||d.namespaceURI==="http://www.w3.org/2000/svg"||d.hasAttribute("itemprop"))&&(d=o.createElement(n),o.head.insertBefore(d,o.querySelector("head > title"))),dt(d,n,a),d[mt]=e,nt(d),n=d;break e;case"link":var v=Wm("link","href",o).get(n+(a.href||""));if(v){for(var x=0;x<v.length;x++)if(d=v[x],d.getAttribute("href")===(a.href==null||a.href===""?null:a.href)&&d.getAttribute("rel")===(a.rel==null?null:a.rel)&&d.getAttribute("title")===(a.title==null?null:a.title)&&d.getAttribute("crossorigin")===(a.crossOrigin==null?null:a.crossOrigin)){v.splice(x,1);break t}}d=o.createElement(n),dt(d,n,a),o.head.appendChild(d);break;case"meta":if(v=Wm("meta","content",o).get(n+(a.content||""))){for(x=0;x<v.length;x++)if(d=v[x],d.getAttribute("content")===(a.content==null?null:""+a.content)&&d.getAttribute("name")===(a.name==null?null:a.name)&&d.getAttribute("property")===(a.property==null?null:a.property)&&d.getAttribute("http-equiv")===(a.httpEquiv==null?null:a.httpEquiv)&&d.getAttribute("charset")===(a.charSet==null?null:a.charSet)){v.splice(x,1);break t}}d=o.createElement(n),dt(d,n,a),o.head.appendChild(d);break;default:throw Error(i(468,n))}d[mt]=e,nt(d),n=d}e.stateNode=n}else ep(o,e.type,e.stateNode);else e.stateNode=Fm(o,n,e.memoizedProps);else d!==n?(d===null?a.stateNode!==null&&(a=a.stateNode,a.parentNode.removeChild(a)):d.count--,n===null?ep(o,e.type,e.stateNode):Fm(o,n,e.memoizedProps)):n===null&&e.stateNode!==null&&pc(e,e.memoizedProps,a.memoizedProps)}break;case 27:Dt(t,e),Rt(e),n&512&&(Ve||a===null||ta(a,a.return)),a!==null&&n&4&&pc(e,e.memoizedProps,a.memoizedProps);break;case 5:if(Dt(t,e),Rt(e),n&512&&(Ve||a===null||ta(a,a.return)),e.flags&32){o=e.stateNode;try{An(o,"")}catch(w){ze(e,e.return,w)}}n&4&&e.stateNode!=null&&(o=e.memoizedProps,pc(e,o,a!==null?a.memoizedProps:o)),n&1024&&(gc=!0);break;case 6:if(Dt(t,e),Rt(e),n&4){if(e.stateNode===null)throw Error(i(162));n=e.memoizedProps,a=e.stateNode;try{a.nodeValue=n}catch(w){ze(e,e.return,w)}}break;case 3:if(vi=null,o=Kt,Kt=hi(t.containerInfo),Dt(t,e),Kt=o,Rt(e),n&4&&a!==null&&a.memoizedState.isDehydrated)try{sl(t.containerInfo)}catch(w){ze(e,e.return,w)}gc&&(gc=!1,im(e));break;case 4:n=Kt,Kt=hi(e.stateNode.containerInfo),Dt(t,e),Rt(e),Kt=n;break;case 12:Dt(t,e),Rt(e);break;case 13:Dt(t,e),Rt(e),e.child.flags&8192&&e.memoizedState!==null!=(a!==null&&a.memoizedState!==null)&&(jc=wt()),n&4&&(n=e.updateQueue,n!==null&&(e.updateQueue=null,vc(e,n)));break;case 22:o=e.memoizedState!==null;var C=a!==null&&a.memoizedState!==null,O=ya,P=Ve;if(ya=O||o,Ve=P||C,Dt(t,e),Ve=P,ya=O,Rt(e),n&8192)e:for(t=e.stateNode,t._visibility=o?t._visibility&-2:t._visibility|1,o&&(a===null||C||ya||Ve||dn(e)),a=null,t=e;;){if(t.tag===5||t.tag===26){if(a===null){C=a=t;try{if(d=C.stateNode,o)v=d.style,typeof v.setProperty=="function"?v.setProperty("display","none","important"):v.display="none";else{x=C.stateNode;var V=C.memoizedProps.style,H=V!=null&&V.hasOwnProperty("display")?V.display:null;x.style.display=H==null||typeof H=="boolean"?"":(""+H).trim()}}catch(w){ze(C,C.return,w)}}}else if(t.tag===6){if(a===null){C=t;try{C.stateNode.nodeValue=o?"":C.memoizedProps}catch(w){ze(C,C.return,w)}}}else if((t.tag!==22&&t.tag!==23||t.memoizedState===null||t===e)&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;a===t&&(a=null),t=t.return}a===t&&(a=null),t.sibling.return=t.return,t=t.sibling}n&4&&(n=e.updateQueue,n!==null&&(a=n.retryQueue,a!==null&&(n.retryQueue=null,vc(e,a))));break;case 19:Dt(t,e),Rt(e),n&4&&(n=e.updateQueue,n!==null&&(e.updateQueue=null,vc(e,n)));break;case 30:break;case 21:break;default:Dt(t,e),Rt(e)}}function Rt(e){var t=e.flags;if(t&2){try{for(var a,n=e.return;n!==null;){if(Fd(n)){a=n;break}n=n.return}if(a==null)throw Error(i(160));switch(a.tag){case 27:var o=a.stateNode,d=fc(e);ai(e,d,o);break;case 5:var v=a.stateNode;a.flags&32&&(An(v,""),a.flags&=-33);var x=fc(e);ai(e,x,v);break;case 3:case 4:var C=a.stateNode.containerInfo,O=fc(e);hc(e,O,C);break;default:throw Error(i(161))}}catch(P){ze(e,e.return,P)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function im(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var t=e;im(t),t.tag===5&&t.flags&1024&&t.stateNode.reset(),e=e.sibling}}function Ha(e,t){if(t.subtreeFlags&8772)for(t=t.child;t!==null;)tm(e,t.alternate,t),t=t.sibling}function dn(e){for(e=e.child;e!==null;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:Oa(4,t,t.return),dn(t);break;case 1:ta(t,t.return);var a=t.stateNode;typeof a.componentWillUnmount=="function"&&Jd(t,t.return,a),dn(t);break;case 27:Js(t.stateNode);case 26:case 5:ta(t,t.return),dn(t);break;case 22:t.memoizedState===null&&dn(t);break;case 30:dn(t);break;default:dn(t)}e=e.sibling}}function wa(e,t,a){for(a=a&&(t.subtreeFlags&8772)!==0,t=t.child;t!==null;){var n=t.alternate,o=e,d=t,v=d.flags;switch(d.tag){case 0:case 11:case 15:wa(o,d,a),Ps(4,d);break;case 1:if(wa(o,d,a),n=d,o=n.stateNode,typeof o.componentDidMount=="function")try{o.componentDidMount()}catch(O){ze(n,n.return,O)}if(n=d,o=n.updateQueue,o!==null){var x=n.stateNode;try{var C=o.shared.hiddenCallbacks;if(C!==null)for(o.shared.hiddenCallbacks=null,o=0;o<C.length;o++)Hu(C[o],x)}catch(O){ze(n,n.return,O)}}a&&v&64&&Kd(d),Us(d,d.return);break;case 27:Wd(d);case 26:case 5:wa(o,d,a),a&&n===null&&v&4&&Id(d),Us(d,d.return);break;case 12:wa(o,d,a);break;case 13:wa(o,d,a),a&&v&4&&sm(o,d);break;case 22:d.memoizedState===null&&wa(o,d,a),Us(d,d.return);break;case 30:break;default:wa(o,d,a)}t=t.sibling}}function yc(e,t){var a=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(a=e.memoizedState.cachePool.pool),e=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(e=t.memoizedState.cachePool.pool),e!==a&&(e!=null&&e.refCount++,a!=null&&Cs(a))}function xc(e,t){e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&Cs(e))}function aa(e,t,a,n){if(t.subtreeFlags&10256)for(t=t.child;t!==null;)rm(e,t,a,n),t=t.sibling}function rm(e,t,a,n){var o=t.flags;switch(t.tag){case 0:case 11:case 15:aa(e,t,a,n),o&2048&&Ps(9,t);break;case 1:aa(e,t,a,n);break;case 3:aa(e,t,a,n),o&2048&&(e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&Cs(e)));break;case 12:if(o&2048){aa(e,t,a,n),e=t.stateNode;try{var d=t.memoizedProps,v=d.id,x=d.onPostCommit;typeof x=="function"&&x(v,t.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(C){ze(t,t.return,C)}}else aa(e,t,a,n);break;case 13:aa(e,t,a,n);break;case 23:break;case 22:d=t.stateNode,v=t.alternate,t.memoizedState!==null?d._visibility&2?aa(e,t,a,n):Gs(e,t):d._visibility&2?aa(e,t,a,n):(d._visibility|=2,Yn(e,t,a,n,(t.subtreeFlags&10256)!==0)),o&2048&&yc(v,t);break;case 24:aa(e,t,a,n),o&2048&&xc(t.alternate,t);break;default:aa(e,t,a,n)}}function Yn(e,t,a,n,o){for(o=o&&(t.subtreeFlags&10256)!==0,t=t.child;t!==null;){var d=e,v=t,x=a,C=n,O=v.flags;switch(v.tag){case 0:case 11:case 15:Yn(d,v,x,C,o),Ps(8,v);break;case 23:break;case 22:var P=v.stateNode;v.memoizedState!==null?P._visibility&2?Yn(d,v,x,C,o):Gs(d,v):(P._visibility|=2,Yn(d,v,x,C,o)),o&&O&2048&&yc(v.alternate,v);break;case 24:Yn(d,v,x,C,o),o&&O&2048&&xc(v.alternate,v);break;default:Yn(d,v,x,C,o)}t=t.sibling}}function Gs(e,t){if(t.subtreeFlags&10256)for(t=t.child;t!==null;){var a=e,n=t,o=n.flags;switch(n.tag){case 22:Gs(a,n),o&2048&&yc(n.alternate,n);break;case 24:Gs(a,n),o&2048&&xc(n.alternate,n);break;default:Gs(a,n)}t=t.sibling}}var Xs=8192;function Qn(e){if(e.subtreeFlags&Xs)for(e=e.child;e!==null;)cm(e),e=e.sibling}function cm(e){switch(e.tag){case 26:Qn(e),e.flags&Xs&&e.memoizedState!==null&&ng(Kt,e.memoizedState,e.memoizedProps);break;case 5:Qn(e);break;case 3:case 4:var t=Kt;Kt=hi(e.stateNode.containerInfo),Qn(e),Kt=t;break;case 22:e.memoizedState===null&&(t=e.alternate,t!==null&&t.memoizedState!==null?(t=Xs,Xs=16777216,Qn(e),Xs=t):Qn(e));break;default:Qn(e)}}function om(e){var t=e.alternate;if(t!==null&&(e=t.child,e!==null)){t.child=null;do t=e.sibling,e.sibling=null,e=t;while(e!==null)}}function $s(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var a=0;a<t.length;a++){var n=t[a];lt=n,dm(n,e)}om(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)um(e),e=e.sibling}function um(e){switch(e.tag){case 0:case 11:case 15:$s(e),e.flags&2048&&Oa(9,e,e.return);break;case 3:$s(e);break;case 12:$s(e);break;case 22:var t=e.stateNode;e.memoizedState!==null&&t._visibility&2&&(e.return===null||e.return.tag!==13)?(t._visibility&=-3,ni(e)):$s(e);break;default:$s(e)}}function ni(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var a=0;a<t.length;a++){var n=t[a];lt=n,dm(n,e)}om(e)}for(e=e.child;e!==null;){switch(t=e,t.tag){case 0:case 11:case 15:Oa(8,t,t.return),ni(t);break;case 22:a=t.stateNode,a._visibility&2&&(a._visibility&=-3,ni(t));break;default:ni(t)}e=e.sibling}}function dm(e,t){for(;lt!==null;){var a=lt;switch(a.tag){case 0:case 11:case 15:Oa(8,a,t);break;case 23:case 22:if(a.memoizedState!==null&&a.memoizedState.cachePool!==null){var n=a.memoizedState.cachePool.pool;n!=null&&n.refCount++}break;case 24:Cs(a.memoizedState.cache)}if(n=a.child,n!==null)n.return=a,lt=n;else e:for(a=e;lt!==null;){n=lt;var o=n.sibling,d=n.return;if(am(n),n===a){lt=null;break e}if(o!==null){o.return=d,lt=o;break e}lt=d}}}var xh={getCacheForType:function(e){var t=pt(et),a=t.data.get(e);return a===void 0&&(a=e(),t.data.set(e,a)),a}},bh=typeof WeakMap=="function"?WeakMap:Map,Ne=0,we=null,ye=null,_e=0,qe=0,zt=null,La=!1,Zn=!1,bc=!1,ba=0,Xe=0,ka=0,mn=0,_c=0,$t=0,Kn=0,Vs=null,jt=null,Sc=!1,jc=0,si=1/0,li=null,Ba=null,ut=0,Pa=null,Jn=null,In=0,Tc=0,Ec=null,mm=null,Ys=0,Cc=null;function Ot(){if((Ne&2)!==0&&_e!==0)return _e&-_e;if(E.T!==null){var e=kn;return e!==0?e:zc()}return No()}function pm(){$t===0&&($t=(_e&536870912)===0||Ee?To():536870912);var e=Xt.current;return e!==null&&(e.flags|=32),$t}function Ht(e,t,a){(e===we&&(qe===2||qe===9)||e.cancelPendingCommit!==null)&&(Fn(e,0),Ua(e,_e,$t,!1)),us(e,a),((Ne&2)===0||e!==we)&&(e===we&&((Ne&2)===0&&(mn|=a),Xe===4&&Ua(e,_e,$t,!1)),na(e))}function fm(e,t,a){if((Ne&6)!==0)throw Error(i(327));var n=!a&&(t&124)===0&&(t&e.expiredLanes)===0||os(e,t),o=n?jh(e,t):qc(e,t,!0),d=n;do{if(o===0){Zn&&!n&&Ua(e,t,0,!1);break}else{if(a=e.current.alternate,d&&!_h(a)){o=qc(e,t,!1),d=!1;continue}if(o===2){if(d=t,e.errorRecoveryDisabledLanes&d)var v=0;else v=e.pendingLanes&-536870913,v=v!==0?v:v&536870912?536870912:0;if(v!==0){t=v;e:{var x=e;o=Vs;var C=x.current.memoizedState.isDehydrated;if(C&&(Fn(x,v).flags|=256),v=qc(x,v,!1),v!==2){if(bc&&!C){x.errorRecoveryDisabledLanes|=d,mn|=d,o=4;break e}d=jt,jt=o,d!==null&&(jt===null?jt=d:jt.push.apply(jt,d))}o=v}if(d=!1,o!==2)continue}}if(o===1){Fn(e,0),Ua(e,t,0,!0);break}e:{switch(n=e,d=o,d){case 0:case 1:throw Error(i(345));case 4:if((t&4194048)!==t)break;case 6:Ua(n,t,$t,!La);break e;case 2:jt=null;break;case 3:case 5:break;default:throw Error(i(329))}if((t&62914560)===t&&(o=jc+300-wt(),10<o)){if(Ua(n,t,$t,!La),gl(n,0,!0)!==0)break e;n.timeoutHandle=Xm(hm.bind(null,n,a,jt,li,Sc,t,$t,mn,Kn,La,d,2,-0,0),o);break e}hm(n,a,jt,li,Sc,t,$t,mn,Kn,La,d,0,-0,0)}}break}while(!0);na(e)}function hm(e,t,a,n,o,d,v,x,C,O,P,V,H,w){if(e.timeoutHandle=-1,V=t.subtreeFlags,(V&8192||(V&16785408)===16785408)&&(Ws={stylesheets:null,count:0,unsuspend:ag},cm(t),V=sg(),V!==null)){e.cancelPendingCommit=V(Sm.bind(null,e,t,d,a,n,o,v,x,C,P,1,H,w)),Ua(e,d,v,!O);return}Sm(e,t,d,a,n,o,v,x,C)}function _h(e){for(var t=e;;){var a=t.tag;if((a===0||a===11||a===15)&&t.flags&16384&&(a=t.updateQueue,a!==null&&(a=a.stores,a!==null)))for(var n=0;n<a.length;n++){var o=a[n],d=o.getSnapshot;o=o.value;try{if(!qt(d(),o))return!1}catch{return!1}}if(a=t.child,t.subtreeFlags&16384&&a!==null)a.return=t,t=a;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Ua(e,t,a,n){t&=~_c,t&=~mn,e.suspendedLanes|=t,e.pingedLanes&=~t,n&&(e.warmLanes|=t),n=e.expirationTimes;for(var o=t;0<o;){var d=31-We(o),v=1<<d;n[d]=-1,o&=~v}a!==0&&Co(e,a,t)}function ii(){return(Ne&6)===0?(Qs(0),!1):!0}function Ac(){if(ye!==null){if(qe===0)var e=ye.return;else e=ye,ma=ln=null,$r(e),$n=null,Ls=0,e=ye;for(;e!==null;)Zd(e.alternate,e),e=e.return;ye=null}}function Fn(e,t){var a=e.timeoutHandle;a!==-1&&(e.timeoutHandle=-1,Bh(a)),a=e.cancelPendingCommit,a!==null&&(e.cancelPendingCommit=null,a()),Ac(),we=e,ye=a=oa(e.current,null),_e=t,qe=0,zt=null,La=!1,Zn=os(e,t),bc=!1,Kn=$t=_c=mn=ka=Xe=0,jt=Vs=null,Sc=!1,(t&8)!==0&&(t|=t&32);var n=e.entangledLanes;if(n!==0)for(e=e.entanglements,n&=t;0<n;){var o=31-We(n),d=1<<o;t|=e[o],n&=~d}return ba=t,Nl(),a}function gm(e,t){ge=null,E.H=Ql,t===Ns||t===Ll?(t=zu(),qe=3):t===Mu?(t=zu(),qe=4):qe=t===Od?8:t!==null&&typeof t=="object"&&typeof t.then=="function"?6:1,zt=t,ye===null&&(Xe=1,Fl(e,Bt(t,e.current)))}function vm(){var e=E.H;return E.H=Ql,e===null?Ql:e}function ym(){var e=E.A;return E.A=xh,e}function Nc(){Xe=4,La||(_e&4194048)!==_e&&Xt.current!==null||(Zn=!0),(ka&134217727)===0&&(mn&134217727)===0||we===null||Ua(we,_e,$t,!1)}function qc(e,t,a){var n=Ne;Ne|=2;var o=vm(),d=ym();(we!==e||_e!==t)&&(li=null,Fn(e,t)),t=!1;var v=Xe;e:do try{if(qe!==0&&ye!==null){var x=ye,C=zt;switch(qe){case 8:Ac(),v=6;break e;case 3:case 2:case 9:case 6:Xt.current===null&&(t=!0);var O=qe;if(qe=0,zt=null,Wn(e,x,C,O),a&&Zn){v=0;break e}break;default:O=qe,qe=0,zt=null,Wn(e,x,C,O)}}Sh(),v=Xe;break}catch(P){gm(e,P)}while(!0);return t&&e.shellSuspendCounter++,ma=ln=null,Ne=n,E.H=o,E.A=d,ye===null&&(we=null,_e=0,Nl()),v}function Sh(){for(;ye!==null;)xm(ye)}function jh(e,t){var a=Ne;Ne|=2;var n=vm(),o=ym();we!==e||_e!==t?(li=null,si=wt()+500,Fn(e,t)):Zn=os(e,t);e:do try{if(qe!==0&&ye!==null){t=ye;var d=zt;t:switch(qe){case 1:qe=0,zt=null,Wn(e,t,d,1);break;case 2:case 9:if(Du(d)){qe=0,zt=null,bm(t);break}t=function(){qe!==2&&qe!==9||we!==e||(qe=7),na(e)},d.then(t,t);break e;case 3:qe=7;break e;case 4:qe=5;break e;case 7:Du(d)?(qe=0,zt=null,bm(t)):(qe=0,zt=null,Wn(e,t,d,7));break;case 5:var v=null;switch(ye.tag){case 26:v=ye.memoizedState;case 5:case 27:var x=ye;if(!v||tp(v)){qe=0,zt=null;var C=x.sibling;if(C!==null)ye=C;else{var O=x.return;O!==null?(ye=O,ri(O)):ye=null}break t}}qe=0,zt=null,Wn(e,t,d,5);break;case 6:qe=0,zt=null,Wn(e,t,d,6);break;case 8:Ac(),Xe=6;break e;default:throw Error(i(462))}}Th();break}catch(P){gm(e,P)}while(!0);return ma=ln=null,E.H=n,E.A=o,Ne=a,ye!==null?0:(we=null,_e=0,Nl(),Xe)}function Th(){for(;ye!==null&&!yn();)xm(ye)}function xm(e){var t=Yd(e.alternate,e,ba);e.memoizedProps=e.pendingProps,t===null?ri(e):ye=t}function bm(e){var t=e,a=t.alternate;switch(t.tag){case 15:case 0:t=Pd(a,t,t.pendingProps,t.type,void 0,_e);break;case 11:t=Pd(a,t,t.pendingProps,t.type.render,t.ref,_e);break;case 5:$r(t);default:Zd(a,t),t=ye=_u(t,ba),t=Yd(a,t,ba)}e.memoizedProps=e.pendingProps,t===null?ri(e):ye=t}function Wn(e,t,a,n){ma=ln=null,$r(t),$n=null,Ls=0;var o=t.return;try{if(ph(e,o,t,a,_e)){Xe=1,Fl(e,Bt(a,e.current)),ye=null;return}}catch(d){if(o!==null)throw ye=o,d;Xe=1,Fl(e,Bt(a,e.current)),ye=null;return}t.flags&32768?(Ee||n===1?e=!0:Zn||(_e&536870912)!==0?e=!1:(La=e=!0,(n===2||n===9||n===3||n===6)&&(n=Xt.current,n!==null&&n.tag===13&&(n.flags|=16384))),_m(t,e)):ri(t)}function ri(e){var t=e;do{if((t.flags&32768)!==0){_m(t,La);return}e=t.return;var a=hh(t.alternate,t,ba);if(a!==null){ye=a;return}if(t=t.sibling,t!==null){ye=t;return}ye=t=e}while(t!==null);Xe===0&&(Xe=5)}function _m(e,t){do{var a=gh(e.alternate,e);if(a!==null){a.flags&=32767,ye=a;return}if(a=e.return,a!==null&&(a.flags|=32768,a.subtreeFlags=0,a.deletions=null),!t&&(e=e.sibling,e!==null)){ye=e;return}ye=e=a}while(e!==null);Xe=6,ye=null}function Sm(e,t,a,n,o,d,v,x,C){e.cancelPendingCommit=null;do ci();while(ut!==0);if((Ne&6)!==0)throw Error(i(327));if(t!==null){if(t===e.current)throw Error(i(177));if(d=t.lanes|t.childLanes,d|=xr,tf(e,a,d,v,x,C),e===we&&(ye=we=null,_e=0),Jn=t,Pa=e,In=a,Tc=d,Ec=o,mm=n,(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,Nh(xn,function(){return Am(),null})):(e.callbackNode=null,e.callbackPriority=0),n=(t.flags&13878)!==0,(t.subtreeFlags&13878)!==0||n){n=E.T,E.T=null,o=B.p,B.p=2,v=Ne,Ne|=4;try{vh(e,t,a)}finally{Ne=v,B.p=o,E.T=n}}ut=1,jm(),Tm(),Em()}}function jm(){if(ut===1){ut=0;var e=Pa,t=Jn,a=(t.flags&13878)!==0;if((t.subtreeFlags&13878)!==0||a){a=E.T,E.T=null;var n=B.p;B.p=2;var o=Ne;Ne|=4;try{lm(t,e);var d=Uc,v=du(e.containerInfo),x=d.focusedElem,C=d.selectionRange;if(v!==x&&x&&x.ownerDocument&&uu(x.ownerDocument.documentElement,x)){if(C!==null&&fr(x)){var O=C.start,P=C.end;if(P===void 0&&(P=O),"selectionStart"in x)x.selectionStart=O,x.selectionEnd=Math.min(P,x.value.length);else{var V=x.ownerDocument||document,H=V&&V.defaultView||window;if(H.getSelection){var w=H.getSelection(),me=x.textContent.length,ue=Math.min(C.start,me),Re=C.end===void 0?ue:Math.min(C.end,me);!w.extend&&ue>Re&&(v=Re,Re=ue,ue=v);var R=ou(x,ue),M=ou(x,Re);if(R&&M&&(w.rangeCount!==1||w.anchorNode!==R.node||w.anchorOffset!==R.offset||w.focusNode!==M.node||w.focusOffset!==M.offset)){var z=V.createRange();z.setStart(R.node,R.offset),w.removeAllRanges(),ue>Re?(w.addRange(z),w.extend(M.node,M.offset)):(z.setEnd(M.node,M.offset),w.addRange(z))}}}}for(V=[],w=x;w=w.parentNode;)w.nodeType===1&&V.push({element:w,left:w.scrollLeft,top:w.scrollTop});for(typeof x.focus=="function"&&x.focus(),x=0;x<V.length;x++){var X=V[x];X.element.scrollLeft=X.left,X.element.scrollTop=X.top}}bi=!!Pc,Uc=Pc=null}finally{Ne=o,B.p=n,E.T=a}}e.current=t,ut=2}}function Tm(){if(ut===2){ut=0;var e=Pa,t=Jn,a=(t.flags&8772)!==0;if((t.subtreeFlags&8772)!==0||a){a=E.T,E.T=null;var n=B.p;B.p=2;var o=Ne;Ne|=4;try{tm(e,t.alternate,t)}finally{Ne=o,B.p=n,E.T=a}}ut=3}}function Em(){if(ut===4||ut===3){ut=0,Ui();var e=Pa,t=Jn,a=In,n=mm;(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?ut=5:(ut=0,Jn=Pa=null,Cm(e,e.pendingLanes));var o=e.pendingLanes;if(o===0&&(Ba=null),Qi(a),t=t.stateNode,Se&&typeof Se.onCommitFiberRoot=="function")try{Se.onCommitFiberRoot(Ie,t,void 0,(t.current.flags&128)===128)}catch{}if(n!==null){t=E.T,o=B.p,B.p=2,E.T=null;try{for(var d=e.onRecoverableError,v=0;v<n.length;v++){var x=n[v];d(x.value,{componentStack:x.stack})}}finally{E.T=t,B.p=o}}(In&3)!==0&&ci(),na(e),o=e.pendingLanes,(a&4194090)!==0&&(o&42)!==0?e===Cc?Ys++:(Ys=0,Cc=e):Ys=0,Qs(0)}}function Cm(e,t){(e.pooledCacheLanes&=t)===0&&(t=e.pooledCache,t!=null&&(e.pooledCache=null,Cs(t)))}function ci(e){return jm(),Tm(),Em(),Am()}function Am(){if(ut!==5)return!1;var e=Pa,t=Tc;Tc=0;var a=Qi(In),n=E.T,o=B.p;try{B.p=32>a?32:a,E.T=null,a=Ec,Ec=null;var d=Pa,v=In;if(ut=0,Jn=Pa=null,In=0,(Ne&6)!==0)throw Error(i(331));var x=Ne;if(Ne|=4,um(d.current),rm(d,d.current,v,a),Ne=x,Qs(0,!1),Se&&typeof Se.onPostCommitFiberRoot=="function")try{Se.onPostCommitFiberRoot(Ie,d)}catch{}return!0}finally{B.p=o,E.T=n,Cm(e,t)}}function Nm(e,t,a){t=Bt(a,t),t=sc(e.stateNode,t,2),e=Ma(e,t,2),e!==null&&(us(e,2),na(e))}function ze(e,t,a){if(e.tag===3)Nm(e,e,a);else for(;t!==null;){if(t.tag===3){Nm(t,e,a);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Ba===null||!Ba.has(n))){e=Bt(a,e),a=Rd(2),n=Ma(t,a,2),n!==null&&(zd(a,n,t,e),us(n,2),na(n));break}}t=t.return}}function Mc(e,t,a){var n=e.pingCache;if(n===null){n=e.pingCache=new bh;var o=new Set;n.set(t,o)}else o=n.get(t),o===void 0&&(o=new Set,n.set(t,o));o.has(a)||(bc=!0,o.add(a),e=Eh.bind(null,e,t,a),t.then(e,e))}function Eh(e,t,a){var n=e.pingCache;n!==null&&n.delete(t),e.pingedLanes|=e.suspendedLanes&a,e.warmLanes&=~a,we===e&&(_e&a)===a&&(Xe===4||Xe===3&&(_e&62914560)===_e&&300>wt()-jc?(Ne&2)===0&&Fn(e,0):_c|=a,Kn===_e&&(Kn=0)),na(e)}function qm(e,t){t===0&&(t=Eo()),e=On(e,t),e!==null&&(us(e,t),na(e))}function Ch(e){var t=e.memoizedState,a=0;t!==null&&(a=t.retryLane),qm(e,a)}function Ah(e,t){var a=0;switch(e.tag){case 13:var n=e.stateNode,o=e.memoizedState;o!==null&&(a=o.retryLane);break;case 19:n=e.stateNode;break;case 22:n=e.stateNode._retryCache;break;default:throw Error(i(314))}n!==null&&n.delete(t),qm(e,a)}function Nh(e,t){return cs(e,t)}var oi=null,es=null,Dc=!1,ui=!1,Rc=!1,pn=0;function na(e){e!==es&&e.next===null&&(es===null?oi=es=e:es=es.next=e),ui=!0,Dc||(Dc=!0,Mh())}function Qs(e,t){if(!Rc&&ui){Rc=!0;do for(var a=!1,n=oi;n!==null;){if(e!==0){var o=n.pendingLanes;if(o===0)var d=0;else{var v=n.suspendedLanes,x=n.pingedLanes;d=(1<<31-We(42|e)+1)-1,d&=o&~(v&~x),d=d&201326741?d&201326741|1:d?d|2:0}d!==0&&(a=!0,zm(n,d))}else d=_e,d=gl(n,n===we?d:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),(d&3)===0||os(n,d)||(a=!0,zm(n,d));n=n.next}while(a);Rc=!1}}function qh(){Mm()}function Mm(){ui=Dc=!1;var e=0;pn!==0&&(kh()&&(e=pn),pn=0);for(var t=wt(),a=null,n=oi;n!==null;){var o=n.next,d=Dm(n,t);d===0?(n.next=null,a===null?oi=o:a.next=o,o===null&&(es=a)):(a=n,(e!==0||(d&3)!==0)&&(ui=!0)),n=o}Qs(e)}function Dm(e,t){for(var a=e.suspendedLanes,n=e.pingedLanes,o=e.expirationTimes,d=e.pendingLanes&-62914561;0<d;){var v=31-We(d),x=1<<v,C=o[v];C===-1?((x&a)===0||(x&n)!==0)&&(o[v]=ef(x,t)):C<=t&&(e.expiredLanes|=x),d&=~x}if(t=we,a=_e,a=gl(e,e===t?a:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),n=e.callbackNode,a===0||e===t&&(qe===2||qe===9)||e.cancelPendingCommit!==null)return n!==null&&n!==null&&vn(n),e.callbackNode=null,e.callbackPriority=0;if((a&3)===0||os(e,a)){if(t=a&-a,t===e.callbackPriority)return t;switch(n!==null&&vn(n),Qi(a)){case 2:case 8:a=pl;break;case 32:a=xn;break;case 268435456:a=W;break;default:a=xn}return n=Rm.bind(null,e),a=cs(a,n),e.callbackPriority=t,e.callbackNode=a,t}return n!==null&&n!==null&&vn(n),e.callbackPriority=2,e.callbackNode=null,2}function Rm(e,t){if(ut!==0&&ut!==5)return e.callbackNode=null,e.callbackPriority=0,null;var a=e.callbackNode;if(ci()&&e.callbackNode!==a)return null;var n=_e;return n=gl(e,e===we?n:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),n===0?null:(fm(e,n,t),Dm(e,wt()),e.callbackNode!=null&&e.callbackNode===a?Rm.bind(null,e):null)}function zm(e,t){if(ci())return null;fm(e,t,!0)}function Mh(){Ph(function(){(Ne&6)!==0?cs(ml,qh):Mm()})}function zc(){return pn===0&&(pn=To()),pn}function Om(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:_l(""+e)}function Hm(e,t){var a=t.ownerDocument.createElement("input");return a.name=t.name,a.value=t.value,e.id&&a.setAttribute("form",e.id),t.parentNode.insertBefore(a,t),e=new FormData(e),a.parentNode.removeChild(a),e}function Dh(e,t,a,n,o){if(t==="submit"&&a&&a.stateNode===o){var d=Om((o[xt]||null).action),v=n.submitter;v&&(t=(t=v[xt]||null)?Om(t.formAction):v.getAttribute("formAction"),t!==null&&(d=t,v=null));var x=new El("action","action",null,n,o);e.push({event:x,listeners:[{instance:null,listener:function(){if(n.defaultPrevented){if(pn!==0){var C=v?Hm(o,v):new FormData(o);Wr(a,{pending:!0,data:C,method:o.method,action:d},null,C)}}else typeof d=="function"&&(x.preventDefault(),C=v?Hm(o,v):new FormData(o),Wr(a,{pending:!0,data:C,method:o.method,action:d},d,C))},currentTarget:o}]})}}for(var Oc=0;Oc<yr.length;Oc++){var Hc=yr[Oc],Rh=Hc.toLowerCase(),zh=Hc[0].toUpperCase()+Hc.slice(1);Zt(Rh,"on"+zh)}Zt(fu,"onAnimationEnd"),Zt(hu,"onAnimationIteration"),Zt(gu,"onAnimationStart"),Zt("dblclick","onDoubleClick"),Zt("focusin","onFocus"),Zt("focusout","onBlur"),Zt(Jf,"onTransitionRun"),Zt(If,"onTransitionStart"),Zt(Ff,"onTransitionCancel"),Zt(vu,"onTransitionEnd"),Tn("onMouseEnter",["mouseout","mouseover"]),Tn("onMouseLeave",["mouseout","mouseover"]),Tn("onPointerEnter",["pointerout","pointerover"]),Tn("onPointerLeave",["pointerout","pointerover"]),Ja("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ja("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ja("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ja("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ja("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ja("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Zs="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Oh=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Zs));function wm(e,t){t=(t&4)!==0;for(var a=0;a<e.length;a++){var n=e[a],o=n.event;n=n.listeners;e:{var d=void 0;if(t)for(var v=n.length-1;0<=v;v--){var x=n[v],C=x.instance,O=x.currentTarget;if(x=x.listener,C!==d&&o.isPropagationStopped())break e;d=x,o.currentTarget=O;try{d(o)}catch(P){Il(P)}o.currentTarget=null,d=C}else for(v=0;v<n.length;v++){if(x=n[v],C=x.instance,O=x.currentTarget,x=x.listener,C!==d&&o.isPropagationStopped())break e;d=x,o.currentTarget=O;try{d(o)}catch(P){Il(P)}o.currentTarget=null,d=C}}}}function xe(e,t){var a=t[Zi];a===void 0&&(a=t[Zi]=new Set);var n=e+"__bubble";a.has(n)||(Lm(t,e,2,!1),a.add(n))}function wc(e,t,a){var n=0;t&&(n|=4),Lm(a,e,n,t)}var di="_reactListening"+Math.random().toString(36).slice(2);function Lc(e){if(!e[di]){e[di]=!0,Mo.forEach(function(a){a!=="selectionchange"&&(Oh.has(a)||wc(a,!1,e),wc(a,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[di]||(t[di]=!0,wc("selectionchange",!1,t))}}function Lm(e,t,a,n){switch(rp(t)){case 2:var o=rg;break;case 8:o=cg;break;default:o=Ic}a=o.bind(null,t,a,e),o=void 0,!lr||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(o=!0),n?o!==void 0?e.addEventListener(t,a,{capture:!0,passive:o}):e.addEventListener(t,a,!0):o!==void 0?e.addEventListener(t,a,{passive:o}):e.addEventListener(t,a,!1)}function kc(e,t,a,n,o){var d=n;if((t&1)===0&&(t&2)===0&&n!==null)e:for(;;){if(n===null)return;var v=n.tag;if(v===3||v===4){var x=n.stateNode.containerInfo;if(x===o)break;if(v===4)for(v=n.return;v!==null;){var C=v.tag;if((C===3||C===4)&&v.stateNode.containerInfo===o)return;v=v.return}for(;x!==null;){if(v=_n(x),v===null)return;if(C=v.tag,C===5||C===6||C===26||C===27){n=d=v;continue e}x=x.parentNode}}n=n.return}$o(function(){var O=d,P=nr(a),V=[];e:{var H=yu.get(e);if(H!==void 0){var w=El,me=e;switch(e){case"keypress":if(jl(a)===0)break e;case"keydown":case"keyup":w=Nf;break;case"focusin":me="focus",w=or;break;case"focusout":me="blur",w=or;break;case"beforeblur":case"afterblur":w=or;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":w=Qo;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":w=gf;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":w=Df;break;case fu:case hu:case gu:w=xf;break;case vu:w=zf;break;case"scroll":case"scrollend":w=ff;break;case"wheel":w=Hf;break;case"copy":case"cut":case"paste":w=_f;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":w=Ko;break;case"toggle":case"beforetoggle":w=Lf}var ue=(t&4)!==0,Re=!ue&&(e==="scroll"||e==="scrollend"),R=ue?H!==null?H+"Capture":null:H;ue=[];for(var M=O,z;M!==null;){var X=M;if(z=X.stateNode,X=X.tag,X!==5&&X!==26&&X!==27||z===null||R===null||(X=ps(M,R),X!=null&&ue.push(Ks(M,X,z))),Re)break;M=M.return}0<ue.length&&(H=new w(H,me,null,a,P),V.push({event:H,listeners:ue}))}}if((t&7)===0){e:{if(H=e==="mouseover"||e==="pointerover",w=e==="mouseout"||e==="pointerout",H&&a!==ar&&(me=a.relatedTarget||a.fromElement)&&(_n(me)||me[bn]))break e;if((w||H)&&(H=P.window===P?P:(H=P.ownerDocument)?H.defaultView||H.parentWindow:window,w?(me=a.relatedTarget||a.toElement,w=O,me=me?_n(me):null,me!==null&&(Re=m(me),ue=me.tag,me!==Re||ue!==5&&ue!==27&&ue!==6)&&(me=null)):(w=null,me=O),w!==me)){if(ue=Qo,X="onMouseLeave",R="onMouseEnter",M="mouse",(e==="pointerout"||e==="pointerover")&&(ue=Ko,X="onPointerLeave",R="onPointerEnter",M="pointer"),Re=w==null?H:ms(w),z=me==null?H:ms(me),H=new ue(X,M+"leave",w,a,P),H.target=Re,H.relatedTarget=z,X=null,_n(P)===O&&(ue=new ue(R,M+"enter",me,a,P),ue.target=z,ue.relatedTarget=Re,X=ue),Re=X,w&&me)t:{for(ue=w,R=me,M=0,z=ue;z;z=ts(z))M++;for(z=0,X=R;X;X=ts(X))z++;for(;0<M-z;)ue=ts(ue),M--;for(;0<z-M;)R=ts(R),z--;for(;M--;){if(ue===R||R!==null&&ue===R.alternate)break t;ue=ts(ue),R=ts(R)}ue=null}else ue=null;w!==null&&km(V,H,w,ue,!1),me!==null&&Re!==null&&km(V,Re,me,ue,!0)}}e:{if(H=O?ms(O):window,w=H.nodeName&&H.nodeName.toLowerCase(),w==="select"||w==="input"&&H.type==="file")var ae=nu;else if(tu(H))if(su)ae=Qf;else{ae=Vf;var ve=$f}else w=H.nodeName,!w||w.toLowerCase()!=="input"||H.type!=="checkbox"&&H.type!=="radio"?O&&tr(O.elementType)&&(ae=nu):ae=Yf;if(ae&&(ae=ae(e,O))){au(V,ae,a,P);break e}ve&&ve(e,H,O),e==="focusout"&&O&&H.type==="number"&&O.memoizedProps.value!=null&&er(H,"number",H.value)}switch(ve=O?ms(O):window,e){case"focusin":(tu(ve)||ve.contentEditable==="true")&&(Dn=ve,hr=O,_s=null);break;case"focusout":_s=hr=Dn=null;break;case"mousedown":gr=!0;break;case"contextmenu":case"mouseup":case"dragend":gr=!1,mu(V,a,P);break;case"selectionchange":if(Kf)break;case"keydown":case"keyup":mu(V,a,P)}var le;if(dr)e:{switch(e){case"compositionstart":var de="onCompositionStart";break e;case"compositionend":de="onCompositionEnd";break e;case"compositionupdate":de="onCompositionUpdate";break e}de=void 0}else Mn?Wo(e,a)&&(de="onCompositionEnd"):e==="keydown"&&a.keyCode===229&&(de="onCompositionStart");de&&(Jo&&a.locale!=="ko"&&(Mn||de!=="onCompositionStart"?de==="onCompositionEnd"&&Mn&&(le=Vo()):(Ca=P,ir="value"in Ca?Ca.value:Ca.textContent,Mn=!0)),ve=mi(O,de),0<ve.length&&(de=new Zo(de,e,null,a,P),V.push({event:de,listeners:ve}),le?de.data=le:(le=eu(a),le!==null&&(de.data=le)))),(le=Bf?Pf(e,a):Uf(e,a))&&(de=mi(O,"onBeforeInput"),0<de.length&&(ve=new Zo("onBeforeInput","beforeinput",null,a,P),V.push({event:ve,listeners:de}),ve.data=le)),Dh(V,e,O,a,P)}wm(V,t)})}function Ks(e,t,a){return{instance:e,listener:t,currentTarget:a}}function mi(e,t){for(var a=t+"Capture",n=[];e!==null;){var o=e,d=o.stateNode;if(o=o.tag,o!==5&&o!==26&&o!==27||d===null||(o=ps(e,a),o!=null&&n.unshift(Ks(e,o,d)),o=ps(e,t),o!=null&&n.push(Ks(e,o,d))),e.tag===3)return n;e=e.return}return[]}function ts(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function km(e,t,a,n,o){for(var d=t._reactName,v=[];a!==null&&a!==n;){var x=a,C=x.alternate,O=x.stateNode;if(x=x.tag,C!==null&&C===n)break;x!==5&&x!==26&&x!==27||O===null||(C=O,o?(O=ps(a,d),O!=null&&v.unshift(Ks(a,O,C))):o||(O=ps(a,d),O!=null&&v.push(Ks(a,O,C)))),a=a.return}v.length!==0&&e.push({event:t,listeners:v})}var Hh=/\r\n?/g,wh=/\u0000|\uFFFD/g;function Bm(e){return(typeof e=="string"?e:""+e).replace(Hh,`
`).replace(wh,"")}function Pm(e,t){return t=Bm(t),Bm(e)===t}function pi(){}function De(e,t,a,n,o,d){switch(a){case"children":typeof n=="string"?t==="body"||t==="textarea"&&n===""||An(e,n):(typeof n=="number"||typeof n=="bigint")&&t!=="body"&&An(e,""+n);break;case"className":yl(e,"class",n);break;case"tabIndex":yl(e,"tabindex",n);break;case"dir":case"role":case"viewBox":case"width":case"height":yl(e,a,n);break;case"style":Go(e,n,d);break;case"data":if(t!=="object"){yl(e,"data",n);break}case"src":case"href":if(n===""&&(t!=="a"||a!=="href")){e.removeAttribute(a);break}if(n==null||typeof n=="function"||typeof n=="symbol"||typeof n=="boolean"){e.removeAttribute(a);break}n=_l(""+n),e.setAttribute(a,n);break;case"action":case"formAction":if(typeof n=="function"){e.setAttribute(a,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof d=="function"&&(a==="formAction"?(t!=="input"&&De(e,t,"name",o.name,o,null),De(e,t,"formEncType",o.formEncType,o,null),De(e,t,"formMethod",o.formMethod,o,null),De(e,t,"formTarget",o.formTarget,o,null)):(De(e,t,"encType",o.encType,o,null),De(e,t,"method",o.method,o,null),De(e,t,"target",o.target,o,null)));if(n==null||typeof n=="symbol"||typeof n=="boolean"){e.removeAttribute(a);break}n=_l(""+n),e.setAttribute(a,n);break;case"onClick":n!=null&&(e.onclick=pi);break;case"onScroll":n!=null&&xe("scroll",e);break;case"onScrollEnd":n!=null&&xe("scrollend",e);break;case"dangerouslySetInnerHTML":if(n!=null){if(typeof n!="object"||!("__html"in n))throw Error(i(61));if(a=n.__html,a!=null){if(o.children!=null)throw Error(i(60));e.innerHTML=a}}break;case"multiple":e.multiple=n&&typeof n!="function"&&typeof n!="symbol";break;case"muted":e.muted=n&&typeof n!="function"&&typeof n!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(n==null||typeof n=="function"||typeof n=="boolean"||typeof n=="symbol"){e.removeAttribute("xlink:href");break}a=_l(""+n),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",a);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":n!=null&&typeof n!="function"&&typeof n!="symbol"?e.setAttribute(a,""+n):e.removeAttribute(a);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":n&&typeof n!="function"&&typeof n!="symbol"?e.setAttribute(a,""):e.removeAttribute(a);break;case"capture":case"download":n===!0?e.setAttribute(a,""):n!==!1&&n!=null&&typeof n!="function"&&typeof n!="symbol"?e.setAttribute(a,n):e.removeAttribute(a);break;case"cols":case"rows":case"size":case"span":n!=null&&typeof n!="function"&&typeof n!="symbol"&&!isNaN(n)&&1<=n?e.setAttribute(a,n):e.removeAttribute(a);break;case"rowSpan":case"start":n==null||typeof n=="function"||typeof n=="symbol"||isNaN(n)?e.removeAttribute(a):e.setAttribute(a,n);break;case"popover":xe("beforetoggle",e),xe("toggle",e),vl(e,"popover",n);break;case"xlinkActuate":ra(e,"http://www.w3.org/1999/xlink","xlink:actuate",n);break;case"xlinkArcrole":ra(e,"http://www.w3.org/1999/xlink","xlink:arcrole",n);break;case"xlinkRole":ra(e,"http://www.w3.org/1999/xlink","xlink:role",n);break;case"xlinkShow":ra(e,"http://www.w3.org/1999/xlink","xlink:show",n);break;case"xlinkTitle":ra(e,"http://www.w3.org/1999/xlink","xlink:title",n);break;case"xlinkType":ra(e,"http://www.w3.org/1999/xlink","xlink:type",n);break;case"xmlBase":ra(e,"http://www.w3.org/XML/1998/namespace","xml:base",n);break;case"xmlLang":ra(e,"http://www.w3.org/XML/1998/namespace","xml:lang",n);break;case"xmlSpace":ra(e,"http://www.w3.org/XML/1998/namespace","xml:space",n);break;case"is":vl(e,"is",n);break;case"innerText":case"textContent":break;default:(!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N")&&(a=mf.get(a)||a,vl(e,a,n))}}function Bc(e,t,a,n,o,d){switch(a){case"style":Go(e,n,d);break;case"dangerouslySetInnerHTML":if(n!=null){if(typeof n!="object"||!("__html"in n))throw Error(i(61));if(a=n.__html,a!=null){if(o.children!=null)throw Error(i(60));e.innerHTML=a}}break;case"children":typeof n=="string"?An(e,n):(typeof n=="number"||typeof n=="bigint")&&An(e,""+n);break;case"onScroll":n!=null&&xe("scroll",e);break;case"onScrollEnd":n!=null&&xe("scrollend",e);break;case"onClick":n!=null&&(e.onclick=pi);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Do.hasOwnProperty(a))e:{if(a[0]==="o"&&a[1]==="n"&&(o=a.endsWith("Capture"),t=a.slice(2,o?a.length-7:void 0),d=e[xt]||null,d=d!=null?d[a]:null,typeof d=="function"&&e.removeEventListener(t,d,o),typeof n=="function")){typeof d!="function"&&d!==null&&(a in e?e[a]=null:e.hasAttribute(a)&&e.removeAttribute(a)),e.addEventListener(t,n,o);break e}a in e?e[a]=n:n===!0?e.setAttribute(a,""):vl(e,a,n)}}}function dt(e,t,a){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":xe("error",e),xe("load",e);var n=!1,o=!1,d;for(d in a)if(a.hasOwnProperty(d)){var v=a[d];if(v!=null)switch(d){case"src":n=!0;break;case"srcSet":o=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,t));default:De(e,t,d,v,a,null)}}o&&De(e,t,"srcSet",a.srcSet,a,null),n&&De(e,t,"src",a.src,a,null);return;case"input":xe("invalid",e);var x=d=v=o=null,C=null,O=null;for(n in a)if(a.hasOwnProperty(n)){var P=a[n];if(P!=null)switch(n){case"name":o=P;break;case"type":v=P;break;case"checked":C=P;break;case"defaultChecked":O=P;break;case"value":d=P;break;case"defaultValue":x=P;break;case"children":case"dangerouslySetInnerHTML":if(P!=null)throw Error(i(137,t));break;default:De(e,t,n,P,a,null)}}ko(e,d,x,C,O,v,o,!1),xl(e);return;case"select":xe("invalid",e),n=v=d=null;for(o in a)if(a.hasOwnProperty(o)&&(x=a[o],x!=null))switch(o){case"value":d=x;break;case"defaultValue":v=x;break;case"multiple":n=x;default:De(e,t,o,x,a,null)}t=d,a=v,e.multiple=!!n,t!=null?Cn(e,!!n,t,!1):a!=null&&Cn(e,!!n,a,!0);return;case"textarea":xe("invalid",e),d=o=n=null;for(v in a)if(a.hasOwnProperty(v)&&(x=a[v],x!=null))switch(v){case"value":n=x;break;case"defaultValue":o=x;break;case"children":d=x;break;case"dangerouslySetInnerHTML":if(x!=null)throw Error(i(91));break;default:De(e,t,v,x,a,null)}Po(e,n,o,d),xl(e);return;case"option":for(C in a)if(a.hasOwnProperty(C)&&(n=a[C],n!=null))switch(C){case"selected":e.selected=n&&typeof n!="function"&&typeof n!="symbol";break;default:De(e,t,C,n,a,null)}return;case"dialog":xe("beforetoggle",e),xe("toggle",e),xe("cancel",e),xe("close",e);break;case"iframe":case"object":xe("load",e);break;case"video":case"audio":for(n=0;n<Zs.length;n++)xe(Zs[n],e);break;case"image":xe("error",e),xe("load",e);break;case"details":xe("toggle",e);break;case"embed":case"source":case"link":xe("error",e),xe("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(O in a)if(a.hasOwnProperty(O)&&(n=a[O],n!=null))switch(O){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,t));default:De(e,t,O,n,a,null)}return;default:if(tr(t)){for(P in a)a.hasOwnProperty(P)&&(n=a[P],n!==void 0&&Bc(e,t,P,n,a,void 0));return}}for(x in a)a.hasOwnProperty(x)&&(n=a[x],n!=null&&De(e,t,x,n,a,null))}function Lh(e,t,a,n){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var o=null,d=null,v=null,x=null,C=null,O=null,P=null;for(w in a){var V=a[w];if(a.hasOwnProperty(w)&&V!=null)switch(w){case"checked":break;case"value":break;case"defaultValue":C=V;default:n.hasOwnProperty(w)||De(e,t,w,null,n,V)}}for(var H in n){var w=n[H];if(V=a[H],n.hasOwnProperty(H)&&(w!=null||V!=null))switch(H){case"type":d=w;break;case"name":o=w;break;case"checked":O=w;break;case"defaultChecked":P=w;break;case"value":v=w;break;case"defaultValue":x=w;break;case"children":case"dangerouslySetInnerHTML":if(w!=null)throw Error(i(137,t));break;default:w!==V&&De(e,t,H,w,n,V)}}Wi(e,v,x,C,O,P,d,o);return;case"select":w=v=x=H=null;for(d in a)if(C=a[d],a.hasOwnProperty(d)&&C!=null)switch(d){case"value":break;case"multiple":w=C;default:n.hasOwnProperty(d)||De(e,t,d,null,n,C)}for(o in n)if(d=n[o],C=a[o],n.hasOwnProperty(o)&&(d!=null||C!=null))switch(o){case"value":H=d;break;case"defaultValue":x=d;break;case"multiple":v=d;default:d!==C&&De(e,t,o,d,n,C)}t=x,a=v,n=w,H!=null?Cn(e,!!a,H,!1):!!n!=!!a&&(t!=null?Cn(e,!!a,t,!0):Cn(e,!!a,a?[]:"",!1));return;case"textarea":w=H=null;for(x in a)if(o=a[x],a.hasOwnProperty(x)&&o!=null&&!n.hasOwnProperty(x))switch(x){case"value":break;case"children":break;default:De(e,t,x,null,n,o)}for(v in n)if(o=n[v],d=a[v],n.hasOwnProperty(v)&&(o!=null||d!=null))switch(v){case"value":H=o;break;case"defaultValue":w=o;break;case"children":break;case"dangerouslySetInnerHTML":if(o!=null)throw Error(i(91));break;default:o!==d&&De(e,t,v,o,n,d)}Bo(e,H,w);return;case"option":for(var me in a)if(H=a[me],a.hasOwnProperty(me)&&H!=null&&!n.hasOwnProperty(me))switch(me){case"selected":e.selected=!1;break;default:De(e,t,me,null,n,H)}for(C in n)if(H=n[C],w=a[C],n.hasOwnProperty(C)&&H!==w&&(H!=null||w!=null))switch(C){case"selected":e.selected=H&&typeof H!="function"&&typeof H!="symbol";break;default:De(e,t,C,H,n,w)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ue in a)H=a[ue],a.hasOwnProperty(ue)&&H!=null&&!n.hasOwnProperty(ue)&&De(e,t,ue,null,n,H);for(O in n)if(H=n[O],w=a[O],n.hasOwnProperty(O)&&H!==w&&(H!=null||w!=null))switch(O){case"children":case"dangerouslySetInnerHTML":if(H!=null)throw Error(i(137,t));break;default:De(e,t,O,H,n,w)}return;default:if(tr(t)){for(var Re in a)H=a[Re],a.hasOwnProperty(Re)&&H!==void 0&&!n.hasOwnProperty(Re)&&Bc(e,t,Re,void 0,n,H);for(P in n)H=n[P],w=a[P],!n.hasOwnProperty(P)||H===w||H===void 0&&w===void 0||Bc(e,t,P,H,n,w);return}}for(var R in a)H=a[R],a.hasOwnProperty(R)&&H!=null&&!n.hasOwnProperty(R)&&De(e,t,R,null,n,H);for(V in n)H=n[V],w=a[V],!n.hasOwnProperty(V)||H===w||H==null&&w==null||De(e,t,V,H,n,w)}var Pc=null,Uc=null;function fi(e){return e.nodeType===9?e:e.ownerDocument}function Um(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Gm(e,t){if(e===0)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&t==="foreignObject"?0:e}function Gc(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.children=="bigint"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Xc=null;function kh(){var e=window.event;return e&&e.type==="popstate"?e===Xc?!1:(Xc=e,!0):(Xc=null,!1)}var Xm=typeof setTimeout=="function"?setTimeout:void 0,Bh=typeof clearTimeout=="function"?clearTimeout:void 0,$m=typeof Promise=="function"?Promise:void 0,Ph=typeof queueMicrotask=="function"?queueMicrotask:typeof $m<"u"?function(e){return $m.resolve(null).then(e).catch(Uh)}:Xm;function Uh(e){setTimeout(function(){throw e})}function Ga(e){return e==="head"}function Vm(e,t){var a=t,n=0,o=0;do{var d=a.nextSibling;if(e.removeChild(a),d&&d.nodeType===8)if(a=d.data,a==="/$"){if(0<n&&8>n){a=n;var v=e.ownerDocument;if(a&1&&Js(v.documentElement),a&2&&Js(v.body),a&4)for(a=v.head,Js(a),v=a.firstChild;v;){var x=v.nextSibling,C=v.nodeName;v[ds]||C==="SCRIPT"||C==="STYLE"||C==="LINK"&&v.rel.toLowerCase()==="stylesheet"||a.removeChild(v),v=x}}if(o===0){e.removeChild(d),sl(t);return}o--}else a==="$"||a==="$?"||a==="$!"?o++:n=a.charCodeAt(0)-48;else n=0;a=d}while(a);sl(t)}function $c(e){var t=e.firstChild;for(t&&t.nodeType===10&&(t=t.nextSibling);t;){var a=t;switch(t=t.nextSibling,a.nodeName){case"HTML":case"HEAD":case"BODY":$c(a),Ki(a);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(a.rel.toLowerCase()==="stylesheet")continue}e.removeChild(a)}}function Gh(e,t,a,n){for(;e.nodeType===1;){var o=a;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!n&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(n){if(!e[ds])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(d=e.getAttribute("rel"),d==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(d!==o.rel||e.getAttribute("href")!==(o.href==null||o.href===""?null:o.href)||e.getAttribute("crossorigin")!==(o.crossOrigin==null?null:o.crossOrigin)||e.getAttribute("title")!==(o.title==null?null:o.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(d=e.getAttribute("src"),(d!==(o.src==null?null:o.src)||e.getAttribute("type")!==(o.type==null?null:o.type)||e.getAttribute("crossorigin")!==(o.crossOrigin==null?null:o.crossOrigin))&&d&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(t==="input"&&e.type==="hidden"){var d=o.name==null?null:""+o.name;if(o.type==="hidden"&&e.getAttribute("name")===d)return e}else return e;if(e=Jt(e.nextSibling),e===null)break}return null}function Xh(e,t,a){if(t==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!a||(e=Jt(e.nextSibling),e===null))return null;return e}function Vc(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState==="complete"}function $h(e,t){var a=e.ownerDocument;if(e.data!=="$?"||a.readyState==="complete")t();else{var n=function(){t(),a.removeEventListener("DOMContentLoaded",n)};a.addEventListener("DOMContentLoaded",n),e._reactRetry=n}}function Jt(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?"||t==="F!"||t==="F")break;if(t==="/$")return null}}return e}var Yc=null;function Ym(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var a=e.data;if(a==="$"||a==="$!"||a==="$?"){if(t===0)return e;t--}else a==="/$"&&t++}e=e.previousSibling}return null}function Qm(e,t,a){switch(t=fi(a),e){case"html":if(e=t.documentElement,!e)throw Error(i(452));return e;case"head":if(e=t.head,!e)throw Error(i(453));return e;case"body":if(e=t.body,!e)throw Error(i(454));return e;default:throw Error(i(451))}}function Js(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);Ki(e)}var Vt=new Map,Zm=new Set;function hi(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var _a=B.d;B.d={f:Vh,r:Yh,D:Qh,C:Zh,L:Kh,m:Jh,X:Fh,S:Ih,M:Wh};function Vh(){var e=_a.f(),t=ii();return e||t}function Yh(e){var t=Sn(e);t!==null&&t.tag===5&&t.type==="form"?fd(t):_a.r(e)}var as=typeof document>"u"?null:document;function Km(e,t,a){var n=as;if(n&&typeof t=="string"&&t){var o=kt(t);o='link[rel="'+e+'"][href="'+o+'"]',typeof a=="string"&&(o+='[crossorigin="'+a+'"]'),Zm.has(o)||(Zm.add(o),e={rel:e,crossOrigin:a,href:t},n.querySelector(o)===null&&(t=n.createElement("link"),dt(t,"link",e),nt(t),n.head.appendChild(t)))}}function Qh(e){_a.D(e),Km("dns-prefetch",e,null)}function Zh(e,t){_a.C(e,t),Km("preconnect",e,t)}function Kh(e,t,a){_a.L(e,t,a);var n=as;if(n&&e&&t){var o='link[rel="preload"][as="'+kt(t)+'"]';t==="image"&&a&&a.imageSrcSet?(o+='[imagesrcset="'+kt(a.imageSrcSet)+'"]',typeof a.imageSizes=="string"&&(o+='[imagesizes="'+kt(a.imageSizes)+'"]')):o+='[href="'+kt(e)+'"]';var d=o;switch(t){case"style":d=ns(e);break;case"script":d=ss(e)}Vt.has(d)||(e=y({rel:"preload",href:t==="image"&&a&&a.imageSrcSet?void 0:e,as:t},a),Vt.set(d,e),n.querySelector(o)!==null||t==="style"&&n.querySelector(Is(d))||t==="script"&&n.querySelector(Fs(d))||(t=n.createElement("link"),dt(t,"link",e),nt(t),n.head.appendChild(t)))}}function Jh(e,t){_a.m(e,t);var a=as;if(a&&e){var n=t&&typeof t.as=="string"?t.as:"script",o='link[rel="modulepreload"][as="'+kt(n)+'"][href="'+kt(e)+'"]',d=o;switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":d=ss(e)}if(!Vt.has(d)&&(e=y({rel:"modulepreload",href:e},t),Vt.set(d,e),a.querySelector(o)===null)){switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(a.querySelector(Fs(d)))return}n=a.createElement("link"),dt(n,"link",e),nt(n),a.head.appendChild(n)}}}function Ih(e,t,a){_a.S(e,t,a);var n=as;if(n&&e){var o=jn(n).hoistableStyles,d=ns(e);t=t||"default";var v=o.get(d);if(!v){var x={loading:0,preload:null};if(v=n.querySelector(Is(d)))x.loading=5;else{e=y({rel:"stylesheet",href:e,"data-precedence":t},a),(a=Vt.get(d))&&Qc(e,a);var C=v=n.createElement("link");nt(C),dt(C,"link",e),C._p=new Promise(function(O,P){C.onload=O,C.onerror=P}),C.addEventListener("load",function(){x.loading|=1}),C.addEventListener("error",function(){x.loading|=2}),x.loading|=4,gi(v,t,n)}v={type:"stylesheet",instance:v,count:1,state:x},o.set(d,v)}}}function Fh(e,t){_a.X(e,t);var a=as;if(a&&e){var n=jn(a).hoistableScripts,o=ss(e),d=n.get(o);d||(d=a.querySelector(Fs(o)),d||(e=y({src:e,async:!0},t),(t=Vt.get(o))&&Zc(e,t),d=a.createElement("script"),nt(d),dt(d,"link",e),a.head.appendChild(d)),d={type:"script",instance:d,count:1,state:null},n.set(o,d))}}function Wh(e,t){_a.M(e,t);var a=as;if(a&&e){var n=jn(a).hoistableScripts,o=ss(e),d=n.get(o);d||(d=a.querySelector(Fs(o)),d||(e=y({src:e,async:!0,type:"module"},t),(t=Vt.get(o))&&Zc(e,t),d=a.createElement("script"),nt(d),dt(d,"link",e),a.head.appendChild(d)),d={type:"script",instance:d,count:1,state:null},n.set(o,d))}}function Jm(e,t,a,n){var o=(o=ie.current)?hi(o):null;if(!o)throw Error(i(446));switch(e){case"meta":case"title":return null;case"style":return typeof a.precedence=="string"&&typeof a.href=="string"?(t=ns(a.href),a=jn(o).hoistableStyles,n=a.get(t),n||(n={type:"style",instance:null,count:0,state:null},a.set(t,n)),n):{type:"void",instance:null,count:0,state:null};case"link":if(a.rel==="stylesheet"&&typeof a.href=="string"&&typeof a.precedence=="string"){e=ns(a.href);var d=jn(o).hoistableStyles,v=d.get(e);if(v||(o=o.ownerDocument||o,v={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},d.set(e,v),(d=o.querySelector(Is(e)))&&!d._p&&(v.instance=d,v.state.loading=5),Vt.has(e)||(a={rel:"preload",as:"style",href:a.href,crossOrigin:a.crossOrigin,integrity:a.integrity,media:a.media,hrefLang:a.hrefLang,referrerPolicy:a.referrerPolicy},Vt.set(e,a),d||eg(o,e,a,v.state))),t&&n===null)throw Error(i(528,""));return v}if(t&&n!==null)throw Error(i(529,""));return null;case"script":return t=a.async,a=a.src,typeof a=="string"&&t&&typeof t!="function"&&typeof t!="symbol"?(t=ss(a),a=jn(o).hoistableScripts,n=a.get(t),n||(n={type:"script",instance:null,count:0,state:null},a.set(t,n)),n):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,e))}}function ns(e){return'href="'+kt(e)+'"'}function Is(e){return'link[rel="stylesheet"]['+e+"]"}function Im(e){return y({},e,{"data-precedence":e.precedence,precedence:null})}function eg(e,t,a,n){e.querySelector('link[rel="preload"][as="style"]['+t+"]")?n.loading=1:(t=e.createElement("link"),n.preload=t,t.addEventListener("load",function(){return n.loading|=1}),t.addEventListener("error",function(){return n.loading|=2}),dt(t,"link",a),nt(t),e.head.appendChild(t))}function ss(e){return'[src="'+kt(e)+'"]'}function Fs(e){return"script[async]"+e}function Fm(e,t,a){if(t.count++,t.instance===null)switch(t.type){case"style":var n=e.querySelector('style[data-href~="'+kt(a.href)+'"]');if(n)return t.instance=n,nt(n),n;var o=y({},a,{"data-href":a.href,"data-precedence":a.precedence,href:null,precedence:null});return n=(e.ownerDocument||e).createElement("style"),nt(n),dt(n,"style",o),gi(n,a.precedence,e),t.instance=n;case"stylesheet":o=ns(a.href);var d=e.querySelector(Is(o));if(d)return t.state.loading|=4,t.instance=d,nt(d),d;n=Im(a),(o=Vt.get(o))&&Qc(n,o),d=(e.ownerDocument||e).createElement("link"),nt(d);var v=d;return v._p=new Promise(function(x,C){v.onload=x,v.onerror=C}),dt(d,"link",n),t.state.loading|=4,gi(d,a.precedence,e),t.instance=d;case"script":return d=ss(a.src),(o=e.querySelector(Fs(d)))?(t.instance=o,nt(o),o):(n=a,(o=Vt.get(d))&&(n=y({},a),Zc(n,o)),e=e.ownerDocument||e,o=e.createElement("script"),nt(o),dt(o,"link",n),e.head.appendChild(o),t.instance=o);case"void":return null;default:throw Error(i(443,t.type))}else t.type==="stylesheet"&&(t.state.loading&4)===0&&(n=t.instance,t.state.loading|=4,gi(n,a.precedence,e));return t.instance}function gi(e,t,a){for(var n=a.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),o=n.length?n[n.length-1]:null,d=o,v=0;v<n.length;v++){var x=n[v];if(x.dataset.precedence===t)d=x;else if(d!==o)break}d?d.parentNode.insertBefore(e,d.nextSibling):(t=a.nodeType===9?a.head:a,t.insertBefore(e,t.firstChild))}function Qc(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.title==null&&(e.title=t.title)}function Zc(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.integrity==null&&(e.integrity=t.integrity)}var vi=null;function Wm(e,t,a){if(vi===null){var n=new Map,o=vi=new Map;o.set(a,n)}else o=vi,n=o.get(a),n||(n=new Map,o.set(a,n));if(n.has(e))return n;for(n.set(e,null),a=a.getElementsByTagName(e),o=0;o<a.length;o++){var d=a[o];if(!(d[ds]||d[mt]||e==="link"&&d.getAttribute("rel")==="stylesheet")&&d.namespaceURI!=="http://www.w3.org/2000/svg"){var v=d.getAttribute(t)||"";v=e+v;var x=n.get(v);x?x.push(d):n.set(v,[d])}}return n}function ep(e,t,a){e=e.ownerDocument||e,e.head.insertBefore(a,t==="title"?e.querySelector("head > title"):null)}function tg(e,t,a){if(a===1||t.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof t.precedence!="string"||typeof t.href!="string"||t.href==="")break;return!0;case"link":if(typeof t.rel!="string"||typeof t.href!="string"||t.href===""||t.onLoad||t.onError)break;switch(t.rel){case"stylesheet":return e=t.disabled,typeof t.precedence=="string"&&e==null;default:return!0}case"script":if(t.async&&typeof t.async!="function"&&typeof t.async!="symbol"&&!t.onLoad&&!t.onError&&t.src&&typeof t.src=="string")return!0}return!1}function tp(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}var Ws=null;function ag(){}function ng(e,t,a){if(Ws===null)throw Error(i(475));var n=Ws;if(t.type==="stylesheet"&&(typeof a.media!="string"||matchMedia(a.media).matches!==!1)&&(t.state.loading&4)===0){if(t.instance===null){var o=ns(a.href),d=e.querySelector(Is(o));if(d){e=d._p,e!==null&&typeof e=="object"&&typeof e.then=="function"&&(n.count++,n=yi.bind(n),e.then(n,n)),t.state.loading|=4,t.instance=d,nt(d);return}d=e.ownerDocument||e,a=Im(a),(o=Vt.get(o))&&Qc(a,o),d=d.createElement("link"),nt(d);var v=d;v._p=new Promise(function(x,C){v.onload=x,v.onerror=C}),dt(d,"link",a),t.instance=d}n.stylesheets===null&&(n.stylesheets=new Map),n.stylesheets.set(t,e),(e=t.state.preload)&&(t.state.loading&3)===0&&(n.count++,t=yi.bind(n),e.addEventListener("load",t),e.addEventListener("error",t))}}function sg(){if(Ws===null)throw Error(i(475));var e=Ws;return e.stylesheets&&e.count===0&&Kc(e,e.stylesheets),0<e.count?function(t){var a=setTimeout(function(){if(e.stylesheets&&Kc(e,e.stylesheets),e.unsuspend){var n=e.unsuspend;e.unsuspend=null,n()}},6e4);return e.unsuspend=t,function(){e.unsuspend=null,clearTimeout(a)}}:null}function yi(){if(this.count--,this.count===0){if(this.stylesheets)Kc(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var xi=null;function Kc(e,t){e.stylesheets=null,e.unsuspend!==null&&(e.count++,xi=new Map,t.forEach(lg,e),xi=null,yi.call(e))}function lg(e,t){if(!(t.state.loading&4)){var a=xi.get(e);if(a)var n=a.get(null);else{a=new Map,xi.set(e,a);for(var o=e.querySelectorAll("link[data-precedence],style[data-precedence]"),d=0;d<o.length;d++){var v=o[d];(v.nodeName==="LINK"||v.getAttribute("media")!=="not all")&&(a.set(v.dataset.precedence,v),n=v)}n&&a.set(null,n)}o=t.instance,v=o.getAttribute("data-precedence"),d=a.get(v)||n,d===n&&a.set(null,o),a.set(v,o),this.count++,n=yi.bind(this),o.addEventListener("load",n),o.addEventListener("error",n),d?d.parentNode.insertBefore(o,d.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(o,e.firstChild)),t.state.loading|=4}}var el={$$typeof:G,Provider:null,Consumer:null,_currentValue:Y,_currentValue2:Y,_threadCount:0};function ig(e,t,a,n,o,d,v,x){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Vi(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Vi(0),this.hiddenUpdates=Vi(null),this.identifierPrefix=n,this.onUncaughtError=o,this.onCaughtError=d,this.onRecoverableError=v,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=x,this.incompleteTransitions=new Map}function ap(e,t,a,n,o,d,v,x,C,O,P,V){return e=new ig(e,t,a,v,x,C,O,V),t=1,d===!0&&(t|=24),d=Mt(3,null,null,t),e.current=d,d.stateNode=e,t=Mr(),t.refCount++,e.pooledCache=t,t.refCount++,d.memoizedState={element:n,isDehydrated:a,cache:t},Or(d),e}function np(e){return e?(e=Hn,e):Hn}function sp(e,t,a,n,o,d){o=np(o),n.context===null?n.context=o:n.pendingContext=o,n=qa(t),n.payload={element:a},d=d===void 0?null:d,d!==null&&(n.callback=d),a=Ma(e,n,t),a!==null&&(Ht(a,e,t),Ms(a,e,t))}function lp(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var a=e.retryLane;e.retryLane=a!==0&&a<t?a:t}}function Jc(e,t){lp(e,t),(e=e.alternate)&&lp(e,t)}function ip(e){if(e.tag===13){var t=On(e,67108864);t!==null&&Ht(t,e,67108864),Jc(e,67108864)}}var bi=!0;function rg(e,t,a,n){var o=E.T;E.T=null;var d=B.p;try{B.p=2,Ic(e,t,a,n)}finally{B.p=d,E.T=o}}function cg(e,t,a,n){var o=E.T;E.T=null;var d=B.p;try{B.p=8,Ic(e,t,a,n)}finally{B.p=d,E.T=o}}function Ic(e,t,a,n){if(bi){var o=Fc(n);if(o===null)kc(e,t,n,_i,a),cp(e,n);else if(ug(o,e,t,a,n))n.stopPropagation();else if(cp(e,n),t&4&&-1<og.indexOf(e)){for(;o!==null;){var d=Sn(o);if(d!==null)switch(d.tag){case 3:if(d=d.stateNode,d.current.memoizedState.isDehydrated){var v=Ka(d.pendingLanes);if(v!==0){var x=d;for(x.pendingLanes|=2,x.entangledLanes|=2;v;){var C=1<<31-We(v);x.entanglements[1]|=C,v&=~C}na(d),(Ne&6)===0&&(si=wt()+500,Qs(0))}}break;case 13:x=On(d,2),x!==null&&Ht(x,d,2),ii(),Jc(d,2)}if(d=Fc(n),d===null&&kc(e,t,n,_i,a),d===o)break;o=d}o!==null&&n.stopPropagation()}else kc(e,t,n,null,a)}}function Fc(e){return e=nr(e),Wc(e)}var _i=null;function Wc(e){if(_i=null,e=_n(e),e!==null){var t=m(e);if(t===null)e=null;else{var a=t.tag;if(a===13){if(e=f(t),e!==null)return e;e=null}else if(a===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return _i=e,null}function rp(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Gi()){case ml:return 2;case pl:return 8;case xn:case Xi:return 32;case W:return 268435456;default:return 32}default:return 32}}var eo=!1,Xa=null,$a=null,Va=null,tl=new Map,al=new Map,Ya=[],og="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function cp(e,t){switch(e){case"focusin":case"focusout":Xa=null;break;case"dragenter":case"dragleave":$a=null;break;case"mouseover":case"mouseout":Va=null;break;case"pointerover":case"pointerout":tl.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":al.delete(t.pointerId)}}function nl(e,t,a,n,o,d){return e===null||e.nativeEvent!==d?(e={blockedOn:t,domEventName:a,eventSystemFlags:n,nativeEvent:d,targetContainers:[o]},t!==null&&(t=Sn(t),t!==null&&ip(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,o!==null&&t.indexOf(o)===-1&&t.push(o),e)}function ug(e,t,a,n,o){switch(t){case"focusin":return Xa=nl(Xa,e,t,a,n,o),!0;case"dragenter":return $a=nl($a,e,t,a,n,o),!0;case"mouseover":return Va=nl(Va,e,t,a,n,o),!0;case"pointerover":var d=o.pointerId;return tl.set(d,nl(tl.get(d)||null,e,t,a,n,o)),!0;case"gotpointercapture":return d=o.pointerId,al.set(d,nl(al.get(d)||null,e,t,a,n,o)),!0}return!1}function op(e){var t=_n(e.target);if(t!==null){var a=m(t);if(a!==null){if(t=a.tag,t===13){if(t=f(a),t!==null){e.blockedOn=t,af(e.priority,function(){if(a.tag===13){var n=Ot();n=Yi(n);var o=On(a,n);o!==null&&Ht(o,a,n),Jc(a,n)}});return}}else if(t===3&&a.stateNode.current.memoizedState.isDehydrated){e.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Si(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var a=Fc(e.nativeEvent);if(a===null){a=e.nativeEvent;var n=new a.constructor(a.type,a);ar=n,a.target.dispatchEvent(n),ar=null}else return t=Sn(a),t!==null&&ip(t),e.blockedOn=a,!1;t.shift()}return!0}function up(e,t,a){Si(e)&&a.delete(t)}function dg(){eo=!1,Xa!==null&&Si(Xa)&&(Xa=null),$a!==null&&Si($a)&&($a=null),Va!==null&&Si(Va)&&(Va=null),tl.forEach(up),al.forEach(up)}function ji(e,t){e.blockedOn===t&&(e.blockedOn=null,eo||(eo=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,dg)))}var Ti=null;function dp(e){Ti!==e&&(Ti=e,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){Ti===e&&(Ti=null);for(var t=0;t<e.length;t+=3){var a=e[t],n=e[t+1],o=e[t+2];if(typeof n!="function"){if(Wc(n||a)===null)continue;break}var d=Sn(a);d!==null&&(e.splice(t,3),t-=3,Wr(d,{pending:!0,data:o,method:a.method,action:n},n,o))}}))}function sl(e){function t(C){return ji(C,e)}Xa!==null&&ji(Xa,e),$a!==null&&ji($a,e),Va!==null&&ji(Va,e),tl.forEach(t),al.forEach(t);for(var a=0;a<Ya.length;a++){var n=Ya[a];n.blockedOn===e&&(n.blockedOn=null)}for(;0<Ya.length&&(a=Ya[0],a.blockedOn===null);)op(a),a.blockedOn===null&&Ya.shift();if(a=(e.ownerDocument||e).$$reactFormReplay,a!=null)for(n=0;n<a.length;n+=3){var o=a[n],d=a[n+1],v=o[xt]||null;if(typeof d=="function")v||dp(a);else if(v){var x=null;if(d&&d.hasAttribute("formAction")){if(o=d,v=d[xt]||null)x=v.formAction;else if(Wc(o)!==null)continue}else x=v.action;typeof x=="function"?a[n+1]=x:(a.splice(n,3),n-=3),dp(a)}}}function to(e){this._internalRoot=e}Ei.prototype.render=to.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(i(409));var a=t.current,n=Ot();sp(a,n,e,t,null,null)},Ei.prototype.unmount=to.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;sp(e.current,2,null,e,null,null),ii(),t[bn]=null}};function Ei(e){this._internalRoot=e}Ei.prototype.unstable_scheduleHydration=function(e){if(e){var t=No();e={blockedOn:null,target:e,priority:t};for(var a=0;a<Ya.length&&t!==0&&t<Ya[a].priority;a++);Ya.splice(a,0,e),a===0&&op(e)}};var mp=l.version;if(mp!=="19.1.1")throw Error(i(527,mp,"19.1.1"));B.findDOMNode=function(e){var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(i(188)):(e=Object.keys(e).join(","),Error(i(268,e)));return e=g(t),e=e!==null?h(e):null,e=e===null?null:e.stateNode,e};var mg={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:E,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ci=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ci.isDisabled&&Ci.supportsFiber)try{Ie=Ci.inject(mg),Se=Ci}catch{}}return il.createRoot=function(e,t){if(!u(e))throw Error(i(299));var a=!1,n="",o=Nd,d=qd,v=Md,x=null;return t!=null&&(t.unstable_strictMode===!0&&(a=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onUncaughtError!==void 0&&(o=t.onUncaughtError),t.onCaughtError!==void 0&&(d=t.onCaughtError),t.onRecoverableError!==void 0&&(v=t.onRecoverableError),t.unstable_transitionCallbacks!==void 0&&(x=t.unstable_transitionCallbacks)),t=ap(e,1,!1,null,null,a,n,o,d,v,x,null),e[bn]=t.current,Lc(e),new to(t)},il.hydrateRoot=function(e,t,a){if(!u(e))throw Error(i(299));var n=!1,o="",d=Nd,v=qd,x=Md,C=null,O=null;return a!=null&&(a.unstable_strictMode===!0&&(n=!0),a.identifierPrefix!==void 0&&(o=a.identifierPrefix),a.onUncaughtError!==void 0&&(d=a.onUncaughtError),a.onCaughtError!==void 0&&(v=a.onCaughtError),a.onRecoverableError!==void 0&&(x=a.onRecoverableError),a.unstable_transitionCallbacks!==void 0&&(C=a.unstable_transitionCallbacks),a.formState!==void 0&&(O=a.formState)),t=ap(e,1,!0,t,a??null,n,o,d,v,x,C,O),t.context=np(null),a=t.current,n=Ot(),n=Yi(n),o=qa(n),o.callback=null,Ma(a,o,n),a=n,t.current.lanes=a,us(t,a),na(t),e[bn]=t.current,Lc(e),new Ei(t)},il.version="19.1.1",il}var Sp;function _g(){if(Sp)return so.exports;Sp=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(l){console.error(l)}}return r(),so.exports=bg(),so.exports}var Sg=_g();const jg=xo(Sg),Tg=se.createContext(null),co={didCatch:!1,error:null};class jp extends se.Component{constructor(l){super(l),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=co}static getDerivedStateFromError(l){return{didCatch:!0,error:l}}resetErrorBoundary(){const{error:l}=this.state;if(l!==null){for(var s,i,u=arguments.length,m=new Array(u),f=0;f<u;f++)m[f]=arguments[f];(s=(i=this.props).onReset)===null||s===void 0||s.call(i,{args:m,reason:"imperative-api"}),this.setState(co)}}componentDidCatch(l,s){var i,u;(i=(u=this.props).onError)===null||i===void 0||i.call(u,l,s)}componentDidUpdate(l,s){const{didCatch:i}=this.state,{resetKeys:u}=this.props;if(i&&s.error!==null&&Eg(l.resetKeys,u)){var m,f;(m=(f=this.props).onReset)===null||m===void 0||m.call(f,{next:u,prev:l.resetKeys,reason:"keys"}),this.setState(co)}}render(){const{children:l,fallbackRender:s,FallbackComponent:i,fallback:u}=this.props,{didCatch:m,error:f}=this.state;let p=l;if(m){const g={error:f,resetErrorBoundary:this.resetErrorBoundary};if(typeof s=="function")p=s(g);else if(i)p=se.createElement(i,g);else if(u!==void 0)p=u;else throw f}return se.createElement(Tg.Provider,{value:{didCatch:m,error:f,resetErrorBoundary:this.resetErrorBoundary}},p)}}function Eg(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return r.length!==l.length||r.some((s,i)=>!Object.is(s,l[i]))}const Cg={scene1:{text:`Tu es Elarion, un jeune magicien haut-elfe de la cit d'Ilveras. Tes cheveux argents tombent en mches fines autour de ton visage ple et lgant, et tes yeux d'un bleu profond refltent la curiosit insatiable qui t'anime. Tu portes une robe de mage bleu nuit, brode de runes argentes, et un sac rempli de tes parchemins.

Ilveras est une cit ancienne, btie sur des falaises dominant la mer. Les tours de cristal de l'Acadmie des Arcanes s'lvent au centre, tandis que les ruelles paves et les jardins suspendus tmoignent de la grandeur passe de ce royaume elfique.

Rcemment, tu as entendu des murmures concernant une ancienne prophtie lie  un "symbole perdu" qui pourrait dtenir la cl d'un pouvoir immense. Ces murmures t'ont men  la grande bibliothque de l'Acadmie, le cur de ton apprentissage. En explorant les ranges d'tagres, une trange lueur mane d'un vieux manuscrit sur un pupitre isol. L'air vibre d'une magie ancienne, et tu sens une forte connexion avec cet objet.`,choices:[{text:"Approcher et lire le manuscrit",next:"scene2a"},{text:"Explorer les tagres  la recherche d'un savoir oubli",next:"scene2b"},{text:"Ignorer le manuscrit et sortir dans les jardins de l'acadmie",next:"scene2c"}]},scene2a:{text:"Tu t'approches du manuscrit. Au moment o tu le touches, une page s'efface sous tes yeux et un symbole brlant se grave sur ta paume. La douleur est si intense que tu perds connaissance quelques instants.  ton rveil, le manuscrit est ferm, mais ton esprit est trangement veill. Tu comprends instinctivement que ce symbole est la cl de la prophtie. La piste la plus prometteuse pour dcouvrir sa signification se trouve  Meresnya, la grande cit marchande, connue pour ses rudits et ses archives millnaires.",choices:[{text:"Prparer ton voyage vers Meresnya",next:"scene3"}]},scene2b:{text:"En fouillant les tagres, tu trouves un ancien parchemin qui semble te murmurer des secrets. Il est d'une grande valeur pour un rudit comme toi. Soudain, le manuscrit que tu as vu plus tt attire ton attention  nouveau, il se met  lviter doucement au-dessus du pupitre. Le symbole de la prophtie apparat sur la couverture. Le parchemin que tu as en main te rvle alors que la seule personne qui peut t'aider est un mystrieux matre de la ville de Meresnya.",choices:[{text:"Prendre le parchemin et commencer le voyage",next:{type:"item",item:["potionOfSuperiorHealing","arccheat"],nextScene:"scene3"}}]},scene2c:{text:`Tu ignores le manuscrit et sors dans les jardins suspendus de l'acadmie. L'air est frais et les fleurs exhalent un parfum mystrieux. Cependant, une trange sensation de chaleur sur ta main gauche te fait dcouvrir un symbole magique grav dans ta paume. Tu ralises que c'est un signe, li  la prophtie que tu tudiais. Un vent soudain murmure le nom de "Meresnya", et tu comprends que c'est l que tu dois te rendre pour percer son secret.`,choices:[{text:"Prparer ton voyage vers Meresnya",next:"scene3"}]},scene3:{text:"Alors que tu quittes l'enceinte sacre de l'acadmie pour la route menant  la grande cit de Meresnya, le sentier se rtrcit brusquement. Deux gobelins  la peau vert-de-gris et aux sourires dments surgissent d'un buisson, leurs armes de fortune brandies. Ils grognent et s'avancent vers toi, prts  en dcoudre.",choices:[{text:"Dgainer ton arme et te dfendre !",action:{type:"combat",enemies:[{type:"gobelin",count:2}],enemyPositions:[{x:6,y:0},{x:7,y:0}],next:"scene4"}}]},scene4:{text:"Aprs avoir repouss les gobelins, tu continues ta route, ton cur battant encore la chamade. Tu arrives bientt dans une clairire baigne de soleil. Au centre, une fontaine cristalline chante doucement, ses eaux pures glissant sur la pierre use. C'est un endroit paisible, parfait pour faire une courte pause et reprendre ton souffle.",choices:[{text:"Faire un court repos pour soigner tes blessures",action:{type:"shortRest",nextScene:"scene5"}},{text:"Continuer l'exploration sans t'arrter",next:"scene5"}]},scene5:{text:"Tu pntres dans la Fort de Murmures, un bois ancien et mystrieux o les arbres centenaires tordent leurs branches comme des doigts crochus. Des murmures magiques semblent flotter dans l'air, et tu as l'impression que des cratures invisibles t'observent. Le sentier se divise en deux. L'un, sombre et escarp, s'enfonce entre les arbres, tandis que l'autre est bord de fleurs luminescentes, crant une lueur apaisante.",choices:[{text:"Prendre le chemin sombre",next:"scene6"},{text:"Prendre le chemin lumineux",next:"scene6"}]},scene6:{text:"Peu importe le chemin choisi, tu arrives devant un ancien pont de pierre, enjambant un torrent tumultueux. Un symbole trangement familier est grav dans la pierre. Il reprsente un blason oubli, celui d'un des fondateurs de l'Acadmie des Arcanes, dont l'histoire a t perdue au fil du temps. Le symbole sur ta paume semble ragir, mettant une faible chaleur.",choices:[{text:"Essayer de se souvenir de l'histoire du blason",action:{type:"skillCheck",skill:"histoire",dc:15,onSuccess:"scene6a",onPartialSuccess:"scene6b",onFailure:"scene6c"}},{text:"Ignorer le blason et traverser le pont",next:"scene7"}]},scene6a:{text:"Grce  tes vastes connaissances acadmiques, tu te souviens parfaitement que ce blason appartient  l'un des fondateurs originels de l'Acadmie, un mage excentrique qui a scell un passage secret derrire le pont. En observant attentivement la pierre, tu dcouvres un mcanisme cach. Le symbole sur ta main s'illumine au moment o tu l'actives, et un passage s'ouvre, rvlant un coffre.",choices:[{text:"Ouvrir le coffre",next:{type:"item",item:"potionOfSuperiorHealing",nextScene:"scene7"}}]},scene6b:{text:"Tu te souviens que ce blason est li aux fondateurs de l'Acadmie, mais tu ne parviens pas  te souvenir des dtails prcis. En touchant la pierre, tu sens une lgre vibration qui rsonne avec le symbole sur ta main, mais tu ne parviens pas  activer le mcanisme. Tu n'as d'autre choix que de continuer ton chemin.",choices:[{text:"Continuer l'exploration",next:"scene7"}]},scene6c:{text:"Le blason ne te dit absolument rien. En touchant la pierre, une dcharge lectrique te parcourt, te laissant un peu tourdi. Le symbole sur ta main reste silencieux. Il vaut mieux ne pas insister et continuer ton chemin.",choices:[{text:"Continuer l'exploration",next:"scene7"}]},scene7:{text:"Aprs avoir travers le pont, tu longes le torrent. Tu remarques un petit trsor dissimul dans une crevasse : une fiole de potion de soins et un ancien parchemin. Le parchemin brille d'une faible lueur magique, tu sens qu'il pourrait amliorer tes capacits.",choices:[{text:"rhingann",next:{type:"ally",ally:"Rhingann",nextScene:"scene8"}},{text:"Les ranger dans mon sac !",next:{type:"item",item:["potionOfHealing","scrollOfIntelligence"],nextScene:"scene8"}}]},scene8:{text:"Un jeune guerrier au regard dtermin apparat sur ton chemin. Il se nomme Tyrion. Il porte une armure de cuir souple use par les voyages et te propose de l'accompagner vers les ruines de Valdoria, une ancienne cit maudite, pour y chercher une relique perdue de son ordre. Tu sens qu'il a besoin d'aide, et son chemin pourrait galement t'en apprendre plus sur le mystrieux symbole grav sur ta main.",choices:[{text:"Accepter la proposition et faire quipe avec Tyrion",next:{type:"ally",ally:"Tyrion",nextScene:"scene9"}},{text:"Refuser l'offre et continuer seul",next:"scene9"}]},scene9:{text:"Aprs des heures de marche, tu arrives devant les ruines anciennes de Valdoria, un lieu charg d'histoire et de lgendes. Les vestiges de ce qui fut autrefois une cit majestueuse s'tendent  perte de vue, des murs effondrs et des arches brises se dressant comme les squelettes d'un gant endormi. L'air, trangement immobile, est imprgn de l'odeur de la pierre humide, de la terre et d'un effluve mtallique qui te glace le sang : le parfum de la mort. Une aura magique palpable mane de l'ensemble du site, comme si les chos des sorts passs continuaient de vibrer dans le silence. Deux chemins s'offrent  toi : l'un s'enfonce dans les entrailles des ruines, l'autre contourne prudemment la zone.",choices:[{text:"T'aventurer plus profondment dans les ruines",next:"scene10"},{text:"Continuer ton chemin et contourner les ruines",next:"scene12"}]},scene10:{text:"Ignorant les avertissements de ton instinct, tu t'engages dans l'alle principale des ruines. Les btiments, rduits  l'tat de carcasses de pierre, te rappellent des histoires oublies de batailles et de puissantes magies. Soudain, un craquement macabre brise le silence. Deux silhouettes squelettiques, animes par une force obscure, mergent des dcombres d'une ancienne taverne. Leurs os jaunis par le temps, leurs orbites vides fixes sur toi, elles brandissent des pes rouilles. Ces gardiens d'outre-tombe semblent prts  dfendre ce lieu jusqu' ce que leurs derniers os tombent en poussire.",choices:[{text:"Prparer ton arme et te dfendre !",action:{type:"combat",enemies:[{type:"squelette",count:2}],enemyPositions:[{x:0,y:0},{x:7,y:0}],next:"scene11"}}]},scene11:{text:"Aprs un combat acharn contre les gardiens d'outre-tombe, tu parviens  les vaincre. Leurs ossements s'effondrent sur le sol en une poigne de poussire. Le silence revient, encore plus lourd qu'avant. Tu dcides de fouiller les restes de la taverne et dcouvres, cach sous une dalle brise, un coffre vermoulu.  l'intrieur, un peu d'or et une fiole de potion de soin. Mais surtout, une ancienne carte partiellement brle indique le chemin vers une crypte situe plus loin dans les ruines. C'est peut-tre la piste qui te mnera  la vrit sur le symbole.",choices:[{text:"Prendre les objets et suivre le chemin de la crypte",next:{type:"item",item:"potionOfHealing",nextScene:"scene13"}},{text:"Ignorer la carte et faire demi-tour",next:"scene12"}]},scene12:{text:"Tu dcides de ne pas t'attarder dans cet endroit lugubre et fais le tour des ruines. Le chemin est long et parsem d'embches naturelles, mais tu vites le combat. Finalement, tu rejoins la route principale. Tu as l'impression d'avoir vit un danger, mais aussi d'avoir laiss derrire toi un secret bien gard. Le murmure des ruines s'loigne derrire toi, et tu continues ta route vers la prochaine tape.",choices:[{text:"Continuer l'aventure",next:"scene13"}]},scene13:{text:"Un sentier mne  une caverne mystrieuse, dont l'entre est masque par un rideau de lierre. L'air qui en mane est pais et charg de magie, avec une lgre odeur de souffre. Tu sens une prsence malveillante et un danger imminent qui t'attirent, comme si le mystre du symbole de ta main tait li  ce lieu.",choices:[{text:"Essayer de percevoir le danger",action:{type:"skillCheck",skill:"perception",dc:14,onSuccess:"scene13a",onPartialSuccess:"scene13b",onFailure:"scene13c"}},{text:"Rentrer directement dans la caverne",next:"scene14"}]},scene13a:{text:"Grce  tes sens d'elfe aiguiss et  ta concentration, tu perois clairement des bruits de pas et des chuchotements venant de l'intrieur de la caverne. Tu sens que des cratures t'attendent  l'afft, prtes  bondir. Le symbole sur ta paume s'illumine et une potion de sagesse tombe  tes pieds. Tu te prpares  un combat imminent.",choices:[{text:"Se tenir prt",next:{type:"item",item:"scrollOfSagesse",nextScene:"scene14"}}]},scene13b:{text:"Tu entends des bruits tranges venant de la caverne, comme des raclements de pierre et des chuchotements lointains, mais tu ne peux pas identifier clairement le danger. Tu dcides de rester sur tes gardes, sans savoir exactement  quoi t'attendre.",choices:[{text:"Rentrer dans la caverne",next:"scene14"}]},scene13c:{text:"Malgr tes efforts, tu n'entends rien de suspect. Le silence de la caverne te semble trompeur. Tu te sens un peu imprudent, mais tu dcides de continuer malgr tout, le symbole sur ta main te brlant lgrement.",choices:[{text:"Rentrer dans la caverne",next:"scene14"}]},scene14:{text:" l'intrieur de la caverne, l'odeur de soufre est plus forte. Deux diablotins surgissent des ombres, tout feu tout flamme, leurs corps de cratures infernales s'agitant de rage. Ils gardent l'entre de la salle principale et se jettent sur toi, prts  t'attaquer.",choices:[{text:"Engager le combat",action:{type:"combat",enemies:[{type:"diablotin",count:2}],enemyPositions:[{x:5,y:0},{x:6,y:1}],next:"scene15"}}]},scene15:{text:"Aprs le combat, tu trouves un lac magique qui scintille dans l'obscurit. Ses eaux mettent une lumire bleute et les vapeurs qui s'en chappent apaisent ton esprit. L'endroit est parfait pour te rgnrer compltement et panser tes blessures.",choices:[{text:"Faire un repos long (rcupre tous les PV et les ressources de classe)",action:{type:"longRest",nextScene:"scene16"}},{text:"Continuer l'exploration",next:"scene16"}]},scene16:{text:"Ressourc, tu explores un ancien temple cach au fond de la caverne. Des runes mystiques sont graves dans les murs, mettant une nergie sombre mais fascinante. L'une d'elles, en particulier, semble vibrer en harmonie avec le symbole sur ta main, dgageant une forte nergie dmoniaque.",choices:[{text:"tudier les runes",next:"scene17"},{text:"Ignorer et avancer",next:"scene17"}]},scene17:{text:"Au centre du temple, un Diable pineux, une crature dmoniaque  l'apparence de reptile, apparat dans un nuage de fume. Il se tient droit et t'observe, ses yeux brlants te fixant intensment. D'une voix caverneuse, il te dfie, voulant tester ta matrise des sorts et ton courage.",choices:[{text:"Combattre le Diable pineux",action:{type:"combat",enemies:[{type:"diable",count:1}],next:"scene18"}}]},scene18:{text:"La bataille est intense, mais tu parviens  vaincre la crature. Alors qu'elle disparat en poussire, tu trouves un parchemin de l'agilit qui renforce ta dextrit, ainsi que des notes sur l'art de la prestidigitation, laisses par un ancien mage qui a peut-tre lui aussi combattu le Diable pineux.",choices:[{text:"Prendre les parchemins",next:{type:"item",item:["scrollOfDexterity","bookArtHeal"],nextScene:"scene19"}}]},scene19:{text:"Alors que tu te prpares  quitter le temple, la voix d'un de tes matres de l'acadmie rsonne dans la caverne. Il te retrouve, impressionn par tes exploits et le chemin que tu as parcouru seul. Il te rvle que le symbole est la clef d'un ancien pouvoir, mais que de grands dangers t'attendent. Il te remet une dernire aide avant que vos chemins se sparent.",choices:[{text:"Accepter l'aide du Matre",next:{type:"item",item:["scrollOfDexterity","scrollOfIntelligence"],nextScene:"scene20"}}]},scene20:{text:"Aprs un dernier change, ton Matre te fait ses adieux. Tu quittes le temple et la caverne, laissant derrire toi les ruines de Valdoria. Le chemin vers Meresnya est long, et la route s'tend devant toi sous un ciel crpusculaire. Le symbole sur ta paume met une douce chaleur, comme une boussole interne te guidant vers ton destin. Tu t'engages sur la grande route, le cur rempli d'une nouvelle dtermination.",choices:[{text:"Continuer le voyage",next:"scene21"}]},scene21:{text:`Le lendemain, aprs une nuit de marche, tu arrives  une auberge isole au carrefour de deux routes. L'auberge "Le Dragon Endormi" est un refuge pour les voyageurs fatigus.  l'intrieur, un vieil homme aux yeux vifs te propose une carte. Il te dit que la route principale est plus sre mais plus longue, tandis qu'un sentier  travers les Marais de la Lune est plus court, mais rempli de btes et de dangers.`,choices:[{text:"Prendre la route principale (plus sre, mais plus longue)",next:"scene22"},{text:"Prendre le sentier des Marais (plus courte, mais plus dangereuse)",next:"scene23"}]},scene22:{text:"Tu dcides de prendre la route principale, plus longue mais plus sre. Aprs une journe de marche paisible, tu arrives sans encombre aux portes de Meresnya. La cit est immense, ses murs de marbre blanc s'lvent majestueusement, et l'animation de la ville se fait dj entendre.",choices:[{text:"Entrer dans la cit",next:"scene24"}]},scene23:{text:"Tu t'engages sur le sentier des Marais de la Lune. L'air est lourd et humide, et une brume persistante enveloppe les lieux. Soudain, un bruit de frottement se fait entendre, et une Crature de la Boue, une masse informe de terre et de vase, se dresse devant toi, ses yeux luisants de malice. Elle t'attaque !",choices:[{text:"Combattre la Crature de la Boue",action:{type:"combat",enemies:[{type:"mephiteBoueux",count:1}],enemyPositions:[{x:6,y:0}],next:"scene24"}}]},scene24:{text:"Tu te retrouves enfin aux portes de Meresnya. La cit s'tend devant toi, une mtropole bouillonnante de vie. Des marchands crient leurs offres, des mages changent des secrets, et l'architecture grandiose tmoigne de la richesse et du savoir qui s'y trouvent. Le symbole sur ta main t'indique que tu es au bon endroit. Ta qute pour percer son mystre peut enfin commencer.",choices:[{text:"Chercher un rudit pour t'aider",next:"scene1"}]}},L={TEXT:"text",DIALOGUE:"dialogue",INTERACTIVE:"interactive_scene",MERCHANT:"merchant",COMBAT:"combat",REST_LONG:"rest_long",REST_SHORT:"rest_short"},Ri={SCENE_TRANSITION:"scene_transition",COMBAT:"combat",SHORT_REST:"shortRest",LONG_REST:"longRest",ITEM_GAIN:"item",ALLY_JOIN:"ally",SKILL_CHECK:"skillCheck",SHOP_OPEN:"openShop",SHOP_SELL:"openSellInterface",FLAG_SET:"setFlag",REPUTATION_CHANGE:"changeReputation"},mo={metadata:{type:"string",chapter:"string",tags:"array",title:"string",character:"string",location:"string",background:"string",shop_type:"string"},content:{text:"string",speaker:"string",portrait:"string",description:"string",variations:{}}};({...mo.metadata});const Ag={metadata:{...mo.metadata,type:"dialogue",character:"string"},content:{...mo.content}};({...Ag.metadata});const Ng={isValidSceneType:r=>Object.values(L).includes(r),isValidActionType:r=>Object.values(Ri).includes(r),validateScene:r=>{const l=[];return r.metadata?.type||l.push("Scene must have a type"),r.content?.text||l.push("Scene must have text content"),(!r.choices||!Array.isArray(r.choices))&&l.push("Scene must have choices array"),{isValid:l.length===0,errors:l}}},qg={approche_discrete:{metadata:{type:L.TEXT,chapter:"acte3",tags:["stealth","success"],title:"Approche Silencieuse"},content:{text:"Tu t'approches discrtement des voix. Tes pas silencieux te permettent d'entendre clairement la conversation : une femme semble prisonnire d'un cercle magique et supplie pour de l'aide. Elle mentionne Dame Seraphina et une 'trahison'."},choices:[{text:"Rvler ta prsence pour l'aider",next:"rencontre_zara",consequences:{flags:{approachedQuietly:!0}}},{text:"couter plus longtemps",next:"ecoute_prolongee_zara"}]},approche_bruyante:{metadata:{type:L.TEXT,chapter:"acte3",tags:["stealth","failure"],title:"Pas Maladroit"},content:{text:"Un bruit de pierre qui roule trahit ta prsence. Les voix s'arrtent immdiatement : 'Qui va l ? Si vous pouvez m'entendre, je vous en prie, aidez-moi ! Je suis prisonnire ici !' Il n'y a plus de surprise possible."},choices:[{text:"Entrer directement dans la salle",next:"rencontre_zara",consequences:{flags:{alertedZara:!0}}}]},liberation_zara:{metadata:{type:L.TEXT,chapter:"acte3",tags:["puzzle","magic"],title:"Cercle de Captivit"},content:{text:"Tu examines le cercle magique qui emprisonne Zara. Les runes sont complexes, mais tu identifies le point faible : un cristal central qui alimente le sort. Briser le cristal devrait librer la prisonnire."},choices:[{text:"Briser le cristal avec prudence",next:"zara_liberee",action:{type:"skillCheck",skill:"arcane",dc:15,onSuccess:"zara_liberee",onFailure:"liberation_ratee"}},{text:"Chercher une autre mthode",next:"methode_alternative_liberation"}]},liberation_ratee:{metadata:{type:L.TEXT,chapter:"acte3",tags:["failure","backlash"],title:"Magie Instable"},content:{text:"Ton intervention provoque une instabilit magique ! Le cercle pulse violemment et Zara crie de douleur. Heureusement, aprs quelques secondes terrifiantes, le sort finit par se briser, mais l'exprience a t prouvante pour vous deux."},choices:[{text:"Vrifier que Zara va bien",next:"zara_liberee_difficile",consequences:{flags:{liberationDifficile:!0}}}]},zara_explication:{metadata:{type:L.DIALOGUE,chapter:"acte3",tags:["explanation","caution"],title:"Rvlations Prudentes",character:"zara_sorciere"},content:{text:"'Je suis Zara, une rudite en phnomnes planaires. J'tudiais les anomalies de cette rgion quand j'ai dcouvert que Dame Seraphina manipulait activement les nergies. Quand j'ai essay de partir pour alerter les autorits, elle m'a pige ici.'",speaker:"Zara la Sorcire",mood:"cautious"},choices:[{text:"Lui faire confiance et la librer",next:"liberation_zara"},{text:"Demander plus de preuves",next:"zara_preuves",action:{type:"skillCheck",skill:"intuition",dc:14,onSuccess:"zara_convaincante",onFailure:"zara_suspicion"}}]},zara_mefiance:{metadata:{type:L.TEXT,chapter:"acte3",tags:["suspicion","careful"],title:"Prudence Justifie"},content:{text:"Ta mfiance est comprhensible. Dans cette rgion, les apparences sont souvent trompeuses. Tu dcides d'observer Zara plus attentivement : ses vtements d'rudite semblent authentiques, ses connaissances magiques paraissent relles, et surtout, elle semble vraiment souffrir dans ce cercle."},choices:[{text:"Dcider de lui faire confiance",next:"liberation_zara"},{text:"Partir sans la librer",next:"abandon_zara",consequences:{flags:{abandonedZara:!0}}}]},zara_alliance:{metadata:{type:L.DIALOGUE,chapter:"acte3",tags:["alliance","team"],title:"Formation de l'Alliance",character:"zara_sorciere"},content:{text:"'Si vous cherchez la Lame ternelle, nous avons un ennemi commun en Seraphina. Mes connaissances sur les nergies planaires pourraient vous tre prcieuses. Acceptez-vous que je me joigne  vous ?'",speaker:"Zara la Sorcire",mood:"hopeful"},choices:[{text:"Accepter son aide avec plaisir",next:"team_complete",consequences:{flags:{zaraJoined:!0,teamComplete:!0},companions:["zara"]}},{text:"Accepter mais rester prudent",next:"alliance_prudente",consequences:{flags:{zaraJoined:!0,cautious:!0},companions:["zara"]}}]},gardiens_pacifies:{metadata:{type:L.TEXT,chapter:"acte3",tags:["diplomacy","success"],title:"Voix de la Raison"},content:{text:"Tes paroles atteignent quelque chose de profondment enfoui dans les gardiens corrompus. Leurs yeux rougeoyants vacillent, et lentement, ils baissent leurs armes. 'Matre... descendant...' murmure l'un d'eux avant qu'ils ne s'effondrent, enfin librs de leur corruption."},choices:[{text:"Honorer leur sacrifice et continuer",next:"decouverte_lame",consequences:{flags:{savedGuardians:!0,peacefulResolution:!0}}}]},tentative_negociation:{metadata:{type:L.TEXT,chapter:"acte3",tags:["diplomacy","attempt"],title:"Appel  l'Humanit"},content:{text:"'Vous tiez les gardiens de ma famille ! Souvenez-vous de votre honneur, de votre serment !' Tu tends la main vers eux, esprant rveiller leur humanit perdue. Les cratures hsitent un instant, comme si tes paroles rveillaient de lointains souvenirs."},choices:[{text:"Continuer  faire appel  leur humanit",next:"gardiens_pacifies",action:{type:"skillCheck",skill:"persuasion",dc:18,onSuccess:"gardiens_pacifies",onFailure:"combat_gardiens_corrompus"}}]},saisie_lame_rapide:{metadata:{type:L.TEXT,chapter:"acte3",tags:["action","blade"],title:"Rflexes clairs"},content:{text:"D'un mouvement rapide, tu saisis la Lame ternelle ! Elle pulse d'une nergie chaude et rconfortante entre tes mains. Mais les applaudissements continuent derrire toi..."},choices:[{text:"Te retourner, lame en main",next:"apparition_seraphina",consequences:{flags:{hasBladeEarly:!0}}}]},lame_saisie:{metadata:{type:L.TEXT,chapter:"acte3",tags:["success","heritage"],title:"L'Hritage Reclam"},content:{text:"Tes rflexes te permettent de saisir la Lame ternelle avant que Seraphina ne puisse ragir. L'pe semble reconnatre ton sang - elle pulse d'une lumire dore et tu sens immdiatement son pouvoir couler en toi. Tu es le vritable hritier."},choices:[{text:"Faire face  Seraphina, lame au poing",next:"confrontation_avec_lame",consequences:{flags:{hasBladeEarly:!0,bladeRecognizedHeir:!0}}}]},preparation_combat_final:{metadata:{type:L.TEXT,chapter:"acte4",tags:["preparation","tactical"],title:"Prparatifs de Bataille"},content:{text:"Sans perdre de temps en discussions, tu prpares tes dfenses et positionnes tes compagnons. Cette initiative te donne l'avantage : Seraphina semble surprise par ta rapidit de raction.",variations:{team_advantage:"Tes compagnons comprennent immdiatement et se positionnent strategiquement autour de la salle."}},conditions:{show_variation:{team_advantage:"gameFlags.kaelJoined || gameFlags.finnJoined || gameFlags.zaraJoined"}},choices:[{text:"Attaquer en premier !",next:"combat_seraphina",consequences:{flags:{preparedForFinalBattle:!0,combatAdvantage:!0}}}]},seraphina_hesitate:{metadata:{type:L.DIALOGUE,chapter:"acte4",tags:["redemption","hesitation"],title:"Moment d'Hsitation",character:"seraphina_enemy"},content:{text:"Tes paroles semblent toucher quelque chose en Seraphina. Ses yeux brillants vacillent un instant : 'Tu... tu ne comprends pas. Des sicles d'humiliation... ma famille dshonore...' Mais l'nergie sombre autour d'elle pulse plus fort, comme si elle luttait contre elle-mme.",speaker:"Dame Seraphina",mood:"conflicted"},choices:[{text:"Insister sur la rdemption",next:"redemption_seraphina",action:{type:"skillCheck",skill:"persuasion",dc:22,onSuccess:"seraphina_redeemed",onFailure:"combat_seraphina"}},{text:"Profiter de son hsitation pour attaquer",next:"combat_seraphina",consequences:{flags:{betrayedHesitation:!0}}}]},tentative_purification:{metadata:{type:L.TEXT,chapter:"acte4",tags:["magic","alternative"],title:"La Troisime Voie"},content:{text:"Au lieu de dtruire ou de garder la lame, tu tentes quelque chose d'indit : utiliser tes connaissances magiques pour purifier la Porte des Murmures elle-mme. C'est un dfi norme et dangereux.",variations:{zara_help:"Zara joint ses efforts aux tiens : 'C'est fou... mais cela pourrait marcher ! Essayons !'"}},conditions:{show_variation:{zara_help:"gameFlags.zaraJoined"}},choices:[{text:"Canaliser le pouvoir de purification",next:"fin_purification_reussie",action:{type:"skillCheck",skill:"arcane",dc:18,onSuccess:"fin_purification_reussie",onFailure:"fin_purification_ratee"}}]},fin_purification_ratee:{metadata:{type:L.TEXT,chapter:"epilogue",tags:["ending","failure"],title:"Purification Incomplte"},content:{text:"Malgr tes efforts hroques, la purification choue partiellement. La Porte des Murmures est stabilise mais non purifie, crant une situation prcaire. Tu devras surveiller ce site en permanence, devenant de facto le nouveau Gardien par ncessit plutt que par choix."},choices:[{text:"Accepter cette responsabilit",next:"epilogue_gardien_force",consequences:{flags:{forcedGuardianship:!0}}}]},epilogue_gardien:{metadata:{type:L.TEXT,chapter:"epilogue",tags:["ending","responsibility"],title:"Le Nouveau Gardien"},content:{text:"Tu t'installes dans l'ancien manoir familial, prenant officiellement le titre de Gardien de la Lame ternelle. Aldwin devient ton mentor, t'enseignant les secrets ancestraux. Bien que confin  cette rgion, tu sens que ton rle a un sens profond."},choices:[{text:"Embrasser pleinement ton nouveau rle",next:"epilogue_retour_village"}]},epilogue_chercheur:{metadata:{type:L.TEXT,chapter:"epilogue",tags:["ending","discovery"],title:"Chercheur de Mystres"},content:{text:"Ta dcouverte de la purification des Portes rvolutionne la comprhension des phnomnes planaires. Tu deviens un rudit reconnu, consultant pour d'autres sites mystrieux  travers le continent. Ton innovation ouvre de nouvelles possibilits."},choices:[{text:"Continuer tes recherches",next:"formation_nouvel_ordre"}]},reflexion_finale:{metadata:{type:L.TEXT,chapter:"epilogue",tags:["contemplation","choice"],title:"Temps de Rflexion"},content:{text:"'J'ai besoin de temps pour rflchir  tout ce qui s'est pass. Cette aventure m'a beaucoup appris sur moi-mme et ma famille.' Matre Aldwin hoche la tte avec comprhension : 'Sage dcision. Les grandes responsabilits ne doivent pas tre acceptes  la lgre. Je resterai ici si vous changez d'avis.'"},choices:[{text:"Prendre une anne de rflexion",next:"fin_reflexion_prolongee"},{text:"Finalement accepter aprs mre rflexion",next:"formation_nouvel_ordre"}]},retraite_heroique:{metadata:{type:L.TEXT,chapter:"epilogue",tags:["ending","retirement"],title:"La Retraite du Hros"},content:{text:"'J'ai fait ma part. D'autres peuvent reprendre le flambeau.' Matre Aldwin semble du mais respecte ton choix : 'Tu as sauv cette rgion, nul ne peut te reprocher de vouloir une vie paisible. Ton hritage parlera pour toi.'"},choices:[{text:"Retourner  ta vie d'avant",next:"fin_vie_paisible"},{text:"Rester dans la rgion mais sans responsabilits",next:"fin_resident_local"}]},team_complete:{metadata:{type:L.TEXT,chapter:"acte3",tags:["team","complete"],title:"L'quipe Runie"},content:{text:"Avec Zara qui se joint  votre groupe, votre quipe est maintenant complte. Kael apporte son expertise de chasseur, Finn ses inventions ingnieuses, et Zara ses connaissances des nergies planaires. Ensemble, vous formez une alliance redoutable pour affronter les dfis  venir.",variations:{without_kael:"Avec Zara, Finn et toi, vous formez une quipe quilibre entre science et magie.",without_finn:"Avec Zara et Kael, vous combinez expertise martiale et connaissances arcaniques.",solo_plus_zara:"Avec Zara  tes cts, tu as maintenant une allie experte en phnomnes planaires."}},conditions:{show_variation:{without_kael:"!gameFlags.kaelJoined && gameFlags.finnJoined",without_finn:"gameFlags.kaelJoined && !gameFlags.finnJoined",solo_plus_zara:"!gameFlags.kaelJoined && !gameFlags.finnJoined"}},choices:[{text:"Partir ensemble vers la chambre secrte",next:"recherche_lame",consequences:{flags:{teamComplete:!0,zaraJoined:!0}}},{text:"Prendre le temps de planifier ensemble",next:"planification_equipe"}]},alliance_prudente:{metadata:{type:L.TEXT,chapter:"acte3",tags:["alliance","caution"],title:"Alliance Prudente"},content:{text:"Tu acceptes l'aide de Zara tout en gardant une certaine rserve. Aprs tout, dans cette situation, il vaut mieux rester vigilant. Zara semble comprendre ta prudence : 'Sage prcaution. La confiance se gagne avec le temps.'"},choices:[{text:"Avancer ensemble vers la lame",next:"recherche_lame",consequences:{flags:{zaraJoined:!0,cautious:!0}}}]}},Mg={acceptation_heritage:{metadata:{type:L.TEXT,chapter:"prologue",tags:["heritage","acceptance"],title:"Acceptation de l'Hritage"},content:{text:"Tu acceptes solennellement de reprendre le flambeau familial. Aldwin sourit avec satisfaction : 'Excellent. Il est temps que tu apprennes tout sur ton hritage. La route sera difficile, mais tu n'es plus seul.'"},choices:[{text:"Demander  apprendre immdiatement",next:"aldwin_histoire_gardiens",consequences:{flags:{acceptedLegacy:!0,readyToLearn:!0}}}]},aldwin_explication_gardien:{metadata:{type:L.DIALOGUE,chapter:"prologue",tags:["explanation","guardian"],title:"Le Rle du Gardien",character:"maitre_aldwin"},content:{text:"'Un Gardien n'est pas qu'un protecteur de relique. Il maintient l'quilibre entre notre monde et les autres plans d'existence. La Lame ternelle n'est qu'un outil - le vrai pouvoir rside dans la volont et la sagesse du porteur.'",speaker:"Matre Aldwin",mood:"wise"},choices:[{text:"Comprendre les responsabilits",next:"responsabilites_gardien"},{text:"Demander des dtails sur les plans d'existence",next:"cours_plans_existence"}]},aldwin_histoire_famille:{metadata:{type:L.TEXT,chapter:"prologue",tags:["family","history"],title:"L'Histoire de la Ligne"},content:{text:"Aldwin te raconte l'histoire de ta famille : 'Les tiens gardent ce domaine depuis huit sicles. Chaque gnration a produit au moins un Gardien. Ton grand-pre Aldric tait le dernier d'une longue ligne de hros. Et maintenant, c'est ton tour.'"},choices:[{text:"Apprendre sur les prcdents Gardiens",next:"aldwin_histoire_gardiens"},{text:"Se concentrer sur Aldric",next:"histoire_aldric_aldwin"}]},aldwin_histoire_gardiens:{metadata:{type:L.TEXT,chapter:"prologue",tags:["lore","guardians"],title:"L'Ordre des Gardiens"},content:{text:"Aldwin droule un parchemin ancien montrant l'arbre gnalogique de ta famille : 'Chaque Gardien avait ses propres dfis. Certains ont affront des invasions planaires, d'autres ont dcouvert de nouveaux sites  protger. Ta destine sera unique, mais tu portes leur hritage.'"},choices:[{text:"Accepter cet hritage avec fiert",next:"serment_gardien",consequences:{flags:{proudOfHeritage:!0,learnedGuardianHistory:!0}}}]},aldwin_preuves:{metadata:{type:L.TEXT,chapter:"prologue",tags:["proof","verification"],title:"Preuves de Lgitimit"},content:{text:"Aldwin sort plusieurs objets personnels de ton grand-pre : sa bague avec le sceau familial, des lettres crites de sa main, et mme un portrait de lui tenant la Lame ternelle. 'Ces preuves suffisent-elles  dissiper tes doutes ?'"},choices:[{text:"tre convaincu par les preuves",next:"aldwin_confiance"},{text:"Garder une rserve prudente",next:"aldwin_resistance"}]},aldwin_confiance:{metadata:{type:L.TEXT,chapter:"prologue",tags:["trust","alliance"],title:"Confiance tablie"},content:{text:"Les preuves sont irrfutables et l'attitude d'Aldwin inspire confiance. Tu dcides de lui faire confiance et d'accepter son aide pour comprendre ton hritage familial."},choices:[{text:"Apprendre l'histoire complte",next:"aldwin_histoire_gardiens",consequences:{flags:{trustsAldwin:!0}}}]},aldwin_resistance:{metadata:{type:L.TEXT,chapter:"prologue",tags:["resistance","caution"],title:"Rserve Maintenue"},content:{text:"Malgr les preuves, tu maintiens une certaine rserve. Aldwin semble comprendre : 'Ta prudence t'honore. Un bon Gardien ne fait jamais confiance aveuglment. Prends le temps dont tu as besoin.'"},choices:[{text:"Demander  repartir pour rflchir",next:"retour_village_reflexion"},{text:"Rester mais garder ses distances",next:"cohabitation_prudente"}]},dialogue_seraphina_suspicion:{metadata:{type:L.DIALOGUE,chapter:"acte2",tags:["suspicion","confrontation"],title:"Soupons Exprims",character:"dame_seraphina"},content:{text:"'J'ai remarqu certains dtails troublants... votre pendentif, vos cartes...' Dame Seraphina ne semble pas surprise : 'Vous tes trs observateur. Oui, j'ai un intrt personnel dans cette affaire. Ma famille a aussi une histoire avec la Lame ternelle.'",speaker:"Dame Seraphina",mood:"defensive"},choices:[{text:"Demander des explications",next:"seraphina_verite_partielle"},{text:"Rester sur ses gardes",next:"seraphina_mefiance_mutuelle"}]},seraphina_motivations:{metadata:{type:L.DIALOGUE,chapter:"acte2",tags:["motivation","hidden"],title:"Motivations Caches",character:"dame_seraphina"},content:{text:"'Pourquoi cette fascination pour la Lame ternelle ?' Seraphina hsite un moment : 'Disons que ma famille a... des comptes  rgler avec l'histoire. Certaines injustices doivent tre rpares.'",speaker:"Dame Seraphina",mood:"evasive"},choices:[{text:"Insister pour plus de dtails",next:"seraphina_verite_partielle"},{text:"Accepter son aide malgr les mystres",next:"seraphina_aide"}]},seraphina_rejoint:{metadata:{type:L.TEXT,chapter:"acte2",tags:["companion","hidden"],title:"Une Allie Mystrieuse"},content:{text:"Dame Seraphina se joint  votre groupe avec ses propres prparatifs mystrieux. Elle semble connatre parfaitement la route vers les marais et possde des quipements inhabituels pour une simple noble. Ses vritables intentions restent nigmatiques."},choices:[{text:"Partir vers les marais avec elle",next:"marais_exploration",consequences:{flags:{seraphinaJoined:!0,seraphinaHidden:!0}}}]},refus_seraphina:{metadata:{type:L.TEXT,chapter:"acte2",tags:["refusal","independence"],title:"Refus Diplomatique"},content:{text:"Tu dclines poliment l'offre de Dame Seraphina. Ses yeux brillent d'une lueur trange un instant, mais elle maintient son sourire courtois : 'Comme vous voudrez. J'espre que vous trouverez ce que vous cherchez.' Il y a quelque chose d'inquitant dans son ton."},choices:[{text:"Partir vers les marais sans elle",next:"marais_exploration",consequences:{flags:{seraphinaRefused:!0,seraphinaHostile:!0}}}]},visions_aldric:{metadata:{type:L.TEXT,chapter:"acte2",tags:["visions","mystery"],title:"Les Visions d'Aldric"},content:{text:"'Il parlait de murmures dans les murs, d'ombres qui bougeaient toutes seules, de voix l'appelant depuis l'au-del. Vers la fin, il ne dormait plus, hant par des cauchemars qu'il ne pouvait dcrire.' Les derniers jours de ton grand-pre semblent avoir t terrifiants."},choices:[{text:"Demander plus de dtails",next:"details_visions_aldric"},{text:"Changer de sujet - c'est troublant",next:"localisation_forteresse"}]},disparition_aldric:{metadata:{type:L.TEXT,chapter:"acte2",tags:["disappearance","mystery"],title:"La Nuit de la Disparition"},content:{text:"'Il est parti une nuit d'orage, emportant seulement la Lame ternelle. On a retrouv ses traces qui menaient vers les marais, puis plus rien. Certains disent qu'il s'est sacrifi pour fermer une brche planaire. D'autres pensent qu'il a t consum par sa propre qute.'"},choices:[{text:"Demander o ont t vues ses dernires traces",next:"localisation_forteresse"}]},informations_forteresse:{metadata:{type:L.TEXT,chapter:"acte2",tags:["information","fortress"],title:"Dtails sur Sombremont"},content:{text:"'La forteresse de Sombremont tait le cur du pouvoir de votre famille. Construite sur un nexus planaire naturel, elle amplifiait les capacits des Gardiens. Mais depuis sa chute, l'endroit est devenu instable et dangereux.'"},choices:[{text:"Partir maintenant avec ces informations",next:"marais_exploration",consequences:{flags:{knowsForteressHistory:!0}}}]},arrivee_forteresse_sure:{metadata:{type:L.TEXT,chapter:"acte3",tags:["arrival","safe"],title:"Arrive Scurise"},content:{text:"Votre route prudente  travers les marais vous mne sains et saufs  la forteresse. Vous arrivez bien reposs et prts  affronter les dfis qui vous attendent dans les ruines de Sombremont."},choices:[{text:"Approcher de la forteresse",next:"forteresse_ruines"}]},caves_forteresse:{metadata:{type:L.TEXT,chapter:"acte3",tags:["underground","secret"],title:"Caves Secrtes"},content:{text:"Le passage secret vous mne dans les anciennes caves de la forteresse. L'air est stagnant et charg d'nergie magique. Des runes de protection anciennes brillent faiblement sur les murs, mais certaines semblent dfaillantes."},choices:[{text:"Explorer les caves prudemment",next:"exploration_caves"},{text:"Monter directement vers les tages suprieurs",next:"entree_forteresse"}]},decouverte_cartes:{metadata:{type:L.TEXT,chapter:"acte3",tags:["discovery","intelligence"],title:"Cartes Rvlatrices"},content:{text:"Les cartes sont annotes en plusieurs langues et montrent des points d'intrt dans toute la rgion. Plus troublant encore, elles marquent l'emplacement exact de sites planaires  travers le continent. Quelqu'un planifie quelque chose de grande envergure."},choices:[{text:"Emporter les cartes comme preuves",next:"rencontre_zara",consequences:{flags:{foundMaps:!0,evidenceGathered:!0}}}]},observation_salon:{metadata:{type:L.TEXT,chapter:"acte2",tags:["observation","inn"],title:"coute au Salon"},content:{text:"Au salon de l'auberge, tu coutes les conversations des autres clients. Les marchands parlent de routes dangereuses, les voyageurs mentionnent des phnomnes tranges dans les marais. Ces informations pourraient tre utiles."},choices:[{text:"Retourner te coucher avec ces informations",next:"reveil_millhaven",action:{type:"longRest"},consequences:{flags:{gatheredIntelligence:!0}}}]},reveil_millhaven:{metadata:{type:L.TEXT,chapter:"acte2",tags:["morning","preparation"],title:"Rveil  Millhaven"},content:{text:"Tu te rveilles repos dans ta chambre d'auberge. La lumire du matin filtre par la fentre et l'activit de Millhaven commence dj. Il est temps de continuer ton aventure."},choices:[{text:"Descendre rejoindre tes compagnons",next:"reunion_equipe_millhaven"},{text:"Aller parler  Dame Seraphina",next:"dialogue_seraphina_intro"}]},kael_preuve_heritage:{metadata:{type:L.TEXT,chapter:"prologue",tags:["proof","heritage"],title:"Lettre d'Hritage"},content:{text:"Tu montres  Kael la lettre officielle qui t'a amen ici. Il l'examine attentivement, vrifie le sceau et hoche la tte : 'Cette lettre semble authentique. Soit tu es vraiment l'hritier, soit tu es un faussaire trs dou.'"},choices:[{text:"Insister sur ton authenticit",next:"kael_convaincu",action:{type:"skillCheck",skill:"persuasion",dc:13,onSuccess:"kael_convaincu",onFailure:"kael_reste_mefiant"}}]},kael_convaincu:{metadata:{type:L.TEXT,chapter:"prologue",tags:["trust","acceptance"],title:"Confiance Accorde"},content:{text:"Kael semble convaincu par tes arguments et tes preuves : 'Trs bien, je vous fais confiance. Si vous tes vraiment de la ligne des Gardiens, alors nous avons peut-tre une chance de rsoudre ce problme.'"},choices:[{text:"Accepter son aide avec gratitude",next:"kael_rejoint",consequences:{flags:{kaelJoined:!0,provedHeritage:!0}}}]},kael_reste_mefiant:{metadata:{type:L.TEXT,chapter:"prologue",tags:["suspicion","doubt"],title:"Doutes Persistants"},content:{text:"Malgr tes efforts, Kael garde ses rserves : 'Les preuves peuvent tre falsifies, et j'ai vu trop de mensonges dans cette rgion. Prouvez-moi votre valeur par des actes, pas par des paroles.'"},choices:[{text:"Accepter de prouver ta valeur",next:"kael_test"},{text:"Partir sans insister davantage",next:"depart_sans_kael"}]},kael_preuve_alternative:{metadata:{type:L.TEXT,chapter:"prologue",tags:["alternative","proof"],title:"Autre Forme de Preuve"},content:{text:"'Je propose autre chose que le combat. Laissez-moi vous montrer mes connaissances sur les cratures d'ombre ou mes comptences magiques.' Kael rflchit : 'Intressant. Montrez-moi ce que vous savez sur ces cratures.'"},choices:[{text:"Dmontrer tes connaissances",next:"demonstration_connaissances",action:{type:"skillCheck",skill:"arcane",dc:14,onSuccess:"kael_impressionne",onFailure:"kael_decu"}}]},finn_applications_combat:{metadata:{type:L.TEXT,chapter:"acte2",tags:["gnome","combat"],title:"Inventions de Combat"},content:{text:"Finn te montre ses crations orientes combat : 'J'ai des projectiles  nergie concentre, des boucliers temporaires, et mme un disrupteur planaire exprimental ! Bien sr, ils ne sont pas tous... compltement tests.'"},choices:[{text:"tre impressionn par son arsenal",next:"finn_rejoint",consequences:{flags:{finnJoined:!0,sawCombatGear:!0}}},{text:"S'inquiter des quipements non tests",next:"finn_prudence"}]},etude_symbole_approfondie:{metadata:{type:L.TEXT,chapter:"acte1",tags:["study","magic"],title:"tude Arcanique Approfondie"},content:{text:"Ton tude approfondie du symbole rvle des dtails fascinants : il s'agit d'un verrou planaire  plusieurs niveaux, conu pour se renforcer au fil du temps. Mais il montre des signes d'affaiblissement rcent."},choices:[{text:"Continuer l'exploration avec ces connaissances",next:"chambre_scellee",consequences:{flags:{understoodPlanarRunes:!0,expertKnowledge:!0}}}]}},Dg=""+new URL("tom-aubergiste-CPKmkEtp.jpg",import.meta.url).href,kp=""+new URL("kael-eycW0aOW.png",import.meta.url).href,Rg=""+new URL("dame_seraphina-Cn8sDIVn.jpg",import.meta.url).href,Bp=""+new URL("finn-D3Ehn8y8.png",import.meta.url).href,Pp=""+new URL("zara-1aq3ZEXb.png",import.meta.url).href,zg=""+new URL("seraphina_corrupted-BYHZT4-e.png",import.meta.url).href,Tp=""+new URL("maitre_aldwin-Brc802y2.png",import.meta.url).href,Og=""+new URL("ruined_fortress-DgbLHuob.jpg",import.meta.url).href,Hg=""+new URL("underground_tunnels-DUFDfgmS.jpg",import.meta.url).href,wg={introduction:{metadata:{type:L.TEXT,chapter:"prologue",tags:["intro","heritage","mystery"],title:"L'Hritage Inattendu",location:"Route vers Ravenscroft"},content:{text:`Aprs des jours de voyage sur des routes poussireuses, tu arrives enfin aux Terres de Vethkar. Tu tiens dans ta main une lettre jaunie qui t'informe de ton hritage : un domaine familial dans le village isol de Ravenscroft. trangement, tu n'avais jamais entendu parler de cette branche de ta famille.
Le paysage devient plus sombre  mesure que tu approches du village. Les arbres semblent tordus, et une brume persistante flotte au-dessus des marais environnants. Au loin, tu aperois les toits de chaume de Ravenscroft et la lueur vacillante d'une enseigne de taverne.`,variations:{experienced:"Ton exprience d'aventurier te fait immdiatement remarquer que quelque chose cloche dans cette rgion. L'atmosphre est charge d'une nergie mystrieuse.",mage:"Tes sens magiques dtectent une perturbation dans les nergies planaires. Cette rgion cache quelque chose d'important."}},conditions:{show_variation:{experienced:"character.level >= 3",mage:"character.class === 'Magicien'"}},choices:[{text:"Se rendre directement  la taverne du village",next:"taverne_lanterne",consequences:{flags:{arrivedAtVillage:!0}}},{text:"Explorer les environs avant d'entrer au village",next:"exploration_perimetres",consequences:{flags:{exploredPerimeter:!0}}}]},exploration_perimetres:{metadata:{type:L.TEXT,chapter:"prologue",tags:["exploration","discovery"],title:"Signes Inquitants"},content:{text:`En explorant les alentours du village, tu dcouvres des traces troublantes : des empruntes tranges dans la boue qui semblent disparatre d'un seul coup, des arbres aux corces noircies par une force inconnue, et surtout, un silence anormal - pas un oiseau ne chante.
Sur une pierre tombale abandonne, tu lis un nom familier grav dans la pierre : 'Gardien Aldric {character.familyName} - Protecteur de la Lame ternelle'. Le nom te donne des frissons. Qui tait cet Aldric ? Et qu'est-ce que la Lame ternelle ?`},choices:[{text:"Se rendre  la taverne avec ces questions en tte",next:"taverne_lanterne",consequences:{flags:{discoveredTombstone:!0,arrivedAtVillage:!0}}}]},taverne_lanterne:{metadata:{type:L.DIALOGUE,chapter:"prologue",tags:["taverne","social","information"],title:"La Lanterne Vacillante",character:"aubergiste_tom",location:"Ravenscroft - Taverne"},content:{text:"Tu pousses la porte de la taverne 'La Lanterne Vacillante'. L'atmosphre y est lourde et les rares clients parlent  voix basse. L'aubergiste, un homme robuste aux cranes dgarni et  la barbe fournie, lve les yeux vers toi.",speaker:"Tom l'Aubergiste",portrait:Dg,mood:"wary",variations:{tombstone:"Ses yeux s'agrandissent lgrement quand tu mentionnes la pierre tombale que tu as trouve.",direct:"Il semble surpris de voir un tranger dans son tablissement."}},conditions:{show_variation:{tombstone:"gameFlags.discoveredTombstone",direct:"!gameFlags.discoveredTombstone"}},choices:[{text:"Demander des informations sur ton hritage familial",next:"dialogue_heritage",action:{type:"scene_transition"}},{text:"Poser des questions sur les vnements tranges",next:"dialogue_creatures",condition:"gameFlags.discoveredTombstone"},{text:"Commander une chambre pour la nuit",next:"chambre_repos",action:{type:"scene_transition"}}]},dialogue_heritage:{metadata:{type:L.DIALOGUE,chapter:"prologue",tags:["lore","family"],title:"L'Histoire Familiale",character:"aubergiste_tom"},content:{text:"Tom se penche vers toi en baissant la voix : 'Alors tu es de la ligne des Gardiens... Je me demandais si quelqu'un finirait par revenir. Ton grand-pre Aldric tait respect ici, mais il a disparu il y a vingt ans, la mme nuit o...' Il s'interrompt brusquement.",speaker:"Tom l'Aubergiste",mood:"secretive"},choices:[{text:"Insister pour connatre la suite",next:"dialogue_disparition",action:{type:"skillCheck",skill:"persuasion",dc:12,onSuccess:"dialogue_disparition",onFailure:"dialogue_resistance"}},{text:"Demander des dtails sur le domaine familial",next:"dialogue_domaine"}]},dialogue_creatures:{metadata:{type:L.DIALOGUE,chapter:"prologue",tags:["history"],title:"Des choses bizarres..",character:"aubergiste_tom"},content:{text:"Tom se met a parler tout bas : ' On sait pas trop ce qu'il de passe en ce moment, mais une chose est sr ce n'est pas normal'",speaker:"Tom l'Aubergiste",mood:"secretive"},choices:[{text:"Insister pour connatre la suite",next:"dialogue_disparition"},{text:"Demander des dtails sur le domaine familial",next:"dialogue_domaine"}]},dialogue_domaine:{metadata:{type:L.TEXT,chapter:"prologue",tags:["failure","alternate"],title:"l'ancien manoir"},content:{text:"Le Domaine {character.familyName} ?! tu peux pas le louper, il se trouve  l'ancien manoir, au bout du sentier nord. Mais mfie-toi... la nuit tombe bientt.'"},choices:[{text:"Accepter et partir vers le domaine",next:"route_domaine",consequences:{flags:{rejectedByVillagers:!0}}},{text:"Prendre une chambre et attendre le matin",next:"chambre_repos"}]},chambre_repos:{metadata:{type:L.TEXT,chapter:"prologue",tags:["repos"],title:"Rveil l'esprit embrum"},content:{text:"Tu n'as pas trs bien dormis cette nuit. a completer"},choices:[{text:"Partir vers le domaine",next:"route_domaine"},{text:"Aller parler a l'Aubergiste",next:"taverne_lanterne"},{text:"Retourner parler a Tom",next:"dialogue_ombre",condition:"gameFlags.rejectedByVillager"}]},dialogue_disparition:{metadata:{type:L.DIALOGUE,chapter:"prologue",tags:["revelation","mystery"],title:"La Nuit de la Disparition",character:"aubergiste_tom"},content:{text:"Tom jette un coup d'il nerveux autour de lui avant de continuer : 'La nuit o la Lame ternelle a disparu. Depuis, les ombres bougent toutes seules, les fermes isoles sont attaques par... des choses qui ne devraient pas exister. Aldric nous protgeait, mais maintenant...' Sa voix se brise.",speaker:"Tom l'Aubergiste",mood:"fearful"},choices:[{text:"Proposer ton aide pour rsoudre ce problme",next:"rencontre_kael",consequences:{flags:{knowsAboutBlade:!0,offeredHelp:!0,earnedTrust:!0}}},{text:"Demander o se trouve ton domaine",next:"dialogue_domaine",consequences:{flags:{knowsAboutBlade:!0}}}]},dialogue_resistance:{metadata:{type:L.TEXT,chapter:"prologue",tags:["failure","alternate"],title:"Mfiance"},content:{text:"Tom secoue la tte fermement : 'Non, j'en ai dj trop dit. Si tu veux vraiment savoir, va voir ton domaine. Il se trouve  l'ancien manoir, au bout du sentier nord. Mais mfie-toi... la nuit tombe bientt.'"},choices:[{text:"Accepter et partir vers le domaine",next:"route_domaine",consequences:{flags:{rejectedByVillagers:!0}}},{text:"Prendre une chambre et attendre le matin",next:"chambre_repos"}]},route_domaine:{metadata:{type:L.TEXT,chapter:"prologue",tags:["exploration","mystery","heritage"],title:"Le Sentier vers le Domaine",location:"Sentier du Manoir Abandonn"},content:{text:`Tu quittes la taverne sous les regards inquiets des villageois. Le sentier nord serpente  travers une fort de plus en plus dense, et la brume nocturne commence  s'lever du sol humide.
Aprs une marche de trente minutes, tu aperois au loin les silhouettes imposantes d'un ancien manoir. Ses tours se dressent contre le ciel crpusculaire, et une faible lueur vacille  l'une des fentres. trangement, le domaine semble en bien meilleur tat que les histoires du village ne le laissaient entendre.`,variations:{mage:"Tes sens magiques dtectent une puissante aura protectrice autour du manoir. Des runes de protection, bien qu'anciennes, semblent encore actives.",experienced:"Ton exprience t'alerte : ce manoir est trop bien prserv pour tre vraiment abandonn. Quelqu'un - ou quelque chose - l'entretient."}},conditions:{show_variation:{mage:"character.class === 'Magicien'",experienced:"character.level >= 3"}},choices:[{text:"Approcher directement du manoir",next:"entree_manoir_direct"},{text:"Faire le tour pour observer depuis les bois",next:"observation_manoir"},{text:"Retourner au village, c'est trop risqu la nuit",next:"retour_village_nuit"}]},entree_manoir_direct:{metadata:{type:L.TEXT,chapter:"prologue",tags:["bold","heritage","meeting"],title:"L'Approche Directe",location:"Devant le Manoir {character.familyName}"},content:{text:`Tu marches droit vers l'entre principale.  mesure que tu t'approches, tu remarques que les jardins, bien qu'envahis, montrent des signes d'entretien rcent. Quelqu'un a taill certaines haies et dsherb les alles.

Arriv devant la porte massive en chne, tu dcouvres une plaque de bronze grave : 'Domaine {character.familyName} - Gardiens de la Lame ternelle depuis 847'. Avant mme que tu ne frappes, la porte s'ouvre sur un vieil homme  la longue barbe blanche.`},choices:[{text:"Se prsenter poliment",next:"rencontre_aldwin_poli"},{text:"Demander qui il est avec mfiance",next:"rencontre_aldwin_mefiant"}]},observation_manoir:{metadata:{type:L.TEXT,chapter:"prologue",tags:["stealth","observation","discovery"],title:"Observation Prudente",location:"Lisire de la Fort"},content:{text:`Tu contournes le manoir en restant dans l'ombre des arbres. Tes observations rvlent plusieurs dtails troublants : des traces de pas rcentes dans la terre meuble, des fentres qui brillent d'une lumire douce mais constante, et surtout, une silhouette qui passe devant l'une des fentres - celle d'un vieil homme en robe.

Tu remarques aussi d'tranges symboles gravs dans l'corce de certains arbres entourant la proprit. Ils ressemblent aux motifs que tu as vus sur ta lettre d'hritage.`},choices:[{text:"Approcher maintenant que tu en sais plus",next:"entree_manoir_informe"},{text:"Attendre et observer plus longtemps",next:"observation_prolongee"},{text:"Retourner au village avec ces informations",next:"retour_village_infos"}]},retour_village_nuit:{metadata:{type:L.TEXT,chapter:"prologue",tags:["caution","retreat"],title:"Retraite Prudente",location:"Retour vers Ravenscroft"},content:{text:`La prudence l'emporte sur la curiosit. Tu rebrousses chemin vers le village, mais le trajet de retour te semble diffrent. Les bruits de la fort ont chang, et tu as l'impression d'tre observ.

En arrivant  Ravenscroft, tu constates que la plupart des maisons ont leurs volets ferms et que seule la taverne montre encore de la lumire. Un villageois t'aperoit et secoue la tte d'un air dsapprobateur.`},choices:[{text:"Retourner  la taverne pour la nuit",next:"chambre_repos"},{text:"Repartir vers le manoir immdiatement",next:"route_domaine_nuit"}]},entree_manoir_informe:{metadata:{type:L.TEXT,chapter:"prologue",tags:["informed","heritage","meeting"],title:"Approche claire",location:"Devant le Manoir {character.familyName}"},content:{text:`Fort de tes observations, tu t'approches du manoir avec plus d'assurance. Tu remarques maintenant des dtails qui t'avaient chapp : les runes de protection graves dans le linteau, la propret inhabituelle des vitres, et surtout, l'absence totale de toiles d'araignes ou de signes d'abandon.

Avant mme d'atteindre la porte, celle-ci s'ouvre et le vieil homme que tu as aperu apparat. Il te sourit calmement, comme s'il t'attendait depuis longtemps.`,variations:{mage:"Tes sens magiques confirment ce que tu souponnais : cet homme rayonne d'une puissante aura arcanique. C'est un mage accompli."}},conditions:{show_variation:{mage:"character.class === 'Magicien'"}},choices:[{text:"Mentionner tes observations",next:"rencontre_aldwin_observateur"},{text:"Se prsenter simplement",next:"rencontre_aldwin_poli"}]},observation_prolongee:{metadata:{type:L.TEXT,chapter:"prologue",tags:["patience","discovery","revelation"],title:"Vigile Nocturne",location:"Lisire de la Fort"},content:{text:`Tu t'installes confortablement contre un gros chne et observes patiemment. Ta patience est rcompense : au bout d'une heure, tu vois le vieil homme sortir du manoir avec une lanterne. Il fait le tour de la proprit en murmurant ce qui semble tre des incantations.

Tu remarques qu' chaque point qu'il visite, les runes graves dans les arbres s'illuminent brivement d'une lumire dore. Il entretient des protections magiques ! Quand il rentre, il jette un regard direct vers ta cachette et hoche la tte, comme s'il savait que tu tais l.`,variations:{mage:"Tu reconnais les incantations : il s'agit de sorts de protection et de purification de trs haut niveau. Cet homme est un mage extrmement puissant."}},conditions:{show_variation:{mage:"character.class === 'Magicien'"}},choices:[{text:"Sortir de ta cachette et t'approcher",next:"rencontre_aldwin_respectueux"},{text:"Attendre qu'il vienne te chercher",next:"aldwin_vient_chercher"},{text:"Partir discrtement, c'est trop dangereux",next:"retour_village_trouble"}]},rencontre_kael:{metadata:{type:L.DIALOGUE,chapter:"prologue",tags:["companion","recruitment"],title:"L'tranger Encapuchonn",character:"kael_ranger"},content:{text:"Alors que Tom termine son rcit, un homme encapuchonn assis dans un coin sombre se lve et s'approche. Ses mouvements sont fluides et silencieux. En repoussant sa capuche, il rvle les traits fins d'un elfe sombre aux yeux verts perants.",speaker:"Kael le Rdeur",portrait:kp,mood:"serious"},choices:[{text:"couter ce qu'il a  dire",next:"dialogue_kael_proposition"},{text:"Rester mfiant et demander qui il est",next:"dialogue_kael_mefiance"}]},dialogue_kael_proposition:{metadata:{type:L.DIALOGUE,chapter:"prologue",tags:["companion","alliance"],title:"Une Alliance Ncessaire",character:"kael_ranger"},content:{text:"'Je m'appelle Kael. Je traque ces cratures d'ombre depuis des mois. Elles ne se contentent plus d'attaquer les fermes isoles - elles se rassemblent, s'organisent. Si tu es vraiment de la ligne des Gardiens, j'ai besoin de ton aide. Et toi du mien.'",speaker:"Kael le Rdeur",mood:"determined"},choices:[{text:"Accepter son aide",next:"kael_rejoint",consequences:{flags:{kaelJoined:!0},companions:["kael"]}},{text:"Refuser poliment",next:"kael_refuse",consequences:{flags:{kaelRefused:!0}}},{text:"Demander des preuves de ses comptences",next:"kael_test",action:{type:"skillCheck",skill:"intuition",dc:10,onSuccess:"kael_trustworthy",onFailure:"kael_uncertain"}}]},kael_rejoint:{metadata:{type:L.TEXT,chapter:"prologue",tags:["companion","success"],title:"Alliance Forme"},content:{text:"Kael hoche la tte avec satisfaction. 'Bien. J'ai repr des tunnels sous le village qui mnent vers les anciennes fondations. C'est probablement l que se trouvent les rponses que tu cherches. Mais d'abord, nous devons nous prparer.'"},choices:[{text:"Explorer les tunnels immdiatement",next:"tunnels_entree",consequences:{flags:{exploringWithKael:!0}}},{text:"Prendre du repos avant l'exploration",next:"repos_avec_kael",action:{type:"shortRest"}}]},tunnels_entree:{metadata:{type:L.INTERACTIVE,chapter:"acte1",tags:["exploration","underground"],title:"Les Tunnels Oublis",background:Hg},content:{text:"Kael t'emmne vers une cave secrte derrire la taverne. Un passage troit descend dans les profondeurs rocheuses sous le village. L'air y est frais et humide, et des gravures anciennes ornent les murs de pierre."},hotspots:[{id:"ancient_carvings",coordinates:{x:585,y:0,width:286,height:500},text:"Examiner les gravures anciennes",action:{type:"scene_transition",next:"decouverte_gravures"}},{id:"deeper_passage",coordinates:{x:336,y:220,width:100,height:180},text:"Continuer vers les profondeurs",action:{type:"scene_transition",next:"chambre_scellee"}},{id:"strange_symbol",coordinates:{x:106,y:115,width:100,height:250},text:"tudier ce symbole trange",condition:"character.class === 'Magicien'",action:{type:"scene_transition",next:"symbole_magique"}}],choices:[{text:"Remonter  la surface",next:"taverne_lanterne"}]},decouverte_gravures:{metadata:{type:L.TEXT,chapter:"acte1",tags:["lore","discovery"],title:"Les Fresques du Pass"},content:{text:"Les gravures racontent une histoire ancienne : des guerriers tenant une pe lumineuse face  une faille sombre d'o sortent des cratures d'ombre. La lgende sous la fresque mentionne 'la Lame ternelle, Verrou des Mondes, Gardienne de la Porte des Murmures'.",variations:{with_kael:"Kael examine les gravures avec attention. 'Alors c'est vrai... Cette pe n'tait pas juste une arme, c'tait un verrou dimensionnel.'"}},conditions:{show_variation:{with_kael:"gameFlags.kaelJoined"}},choices:[{text:"Continuer l'exploration des tunnels",next:"chambre_scellee",consequences:{flags:{understoodHistory:!0}}}]},chambre_scellee:{metadata:{type:L.TEXT,chapter:"acte1",tags:["discovery","mystery"],title:"La Chambre Secrte"},content:{text:"Au bout du tunnel, vous dcouvrez une large chambre circulaire. Au centre, un pidestal vide o brillent encore des runes magiques. Sur les murs, des inscriptions en langue ancienne. Un passage secret mne vers les marais.",variations:{mage_bonus:"Tes connaissances magiques te permettent de dchiffrer partiellement les runes : 'L o la lumire ne peut atteindre, dans le cur des terres englouties.'"}},conditions:{show_variation:{mage_bonus:"character.class === 'Magicien'"}},choices:[{text:"Suivre le passage vers les marais",next:"premier_combat_ombres",consequences:{flags:{foundSecretPassage:!0}}},{text:"Retourner au village pour se prparer",next:"preparation_millhaven"}]},premier_combat_ombres:{metadata:{type:L.COMBAT,chapter:"acte1",tags:["combat","ombres"],title:"Attaque des Ombres Affames",nextScene:"apres_premier_combat"},content:{text:"En sortant des tunnels vers les marais, vous tes immdiatement attaqus par trois cratures d'ombre qui semblaient vous attendre. Leurs formes vaporeuses ondulent dans la brume nocturne, et leurs yeux rougeoyants fixent vos mes avec une faim dvorante."},enemies:[{type:"ombre",count:2}],enemyPositions:[{x:7,y:0},{x:7,y:1}],choices:[{text:"Engager le combat !",action:{type:"combat"}}]},apres_premier_combat:{metadata:{type:L.TEXT,chapter:"acte1",tags:["aftermath","discovery"],title:"Premires Rvlations"},content:{text:"Aprs avoir repouss les ombres, vous remarquez qu'elles se dissipent en murmurant des mots dans une langue inconnue. Kael examine les restes : 'Ces cratures ne sont pas naturelles. Elles viennent d'ailleurs, et quelque chose les guide.'",variations:{solo:"Tu examines seul les restes des cratures. Elles semblaient chercher quelque chose... ou quelqu'un.",with_kael:"Kael semble proccup par la faon dont ces cratures vous ont attendu. 'Elles savaient que nous viendrions. Nous sommes peut-tre suivis.'"}},conditions:{show_variation:{solo:"!gameFlags.kaelJoined",with_kael:"gameFlags.kaelJoined"}},choices:[{text:"Se diriger vers la ville de Millhaven",next:"route_millhaven",consequences:{flags:{firstCombatWon:!0}}},{text:"Retourner au village pour se reposer",next:"repos_village",action:{type:"shortRest"}}]},route_millhaven:{metadata:{type:L.TEXT,chapter:"acte2",tags:["voyage","transition"],title:"La Route vers Millhaven"},content:{text:"La route vers Millhaven serpente  travers les marais pendant deux jours. Cette ville plus importante possde des archives historiques qui pourraient contenir des informations sur ta famille et la Lame ternelle. En chemin, vous croisez des marchands nerveux qui parlent de 'loups tranges' dans la rgion."},choices:[{text:"Arriver  Millhaven",next:"millhaven_auberge"}]},millhaven_auberge:{metadata:{type:L.DIALOGUE,chapter:"acte2",tags:["auberge","information"],title:"Le Repos du Voyageur",character:"dame_seraphina",location:"Millhaven - Auberge"},content:{text:"L'auberge 'Le Repos du Voyageur' est bien plus raffine que la taverne de Ravenscroft. Dans le salon principal, une femme noble aux cheveux chtains consulte des parchemins anciens. Elle lve les yeux quand vous entrez.",speaker:"Dame Seraphina",portrait:Rg,mood:"curious"},choices:[{text:"Approcher et vous prsenter",next:"dialogue_seraphina_intro"},{text:"Demander une chambre d'abord",next:"chambre_millhaven"},{text:"Observer discrtement",next:"observation_seraphina",action:{type:"skillCheck",skill:"perception",dc:12,onSuccess:"observation_reussie",onFailure:"observation_ratee"}}]},dialogue_seraphina_intro:{metadata:{type:L.DIALOGUE,chapter:"acte2",tags:["noble","information"],title:"Rencontre avec Dame Seraphina",character:"dame_seraphina"},content:{text:"'Comme c'est intressant... Vous portez le nom des anciens Gardiens, n'est-ce pas ? Je suis Dame Seraphina de Valdris. Je possde dans mes archives des documents historiques sur votre ligne. Peut-tre pourrions-nous nous entraider ?'",speaker:"Dame Seraphina",mood:"friendly"},choices:[{text:"Accepter son aide avec reconnaissance",next:"seraphina_aide",consequences:{flags:{metSeraphina:!0,seraphinaFriendly:!0}}},{text:"Demander ce qu'elle veut en change",next:"seraphina_echange",consequences:{flags:{metSeraphina:!0,seraphinaCautious:!0}}}]},seraphina_aide:{metadata:{type:L.DIALOGUE,chapter:"acte2",tags:["revelation","lore"],title:"Les Archives Secrtes",character:"dame_seraphina"},content:{text:"'Vos anctres taient les gardiens d'un artefact appel la Lame ternelle. Selon mes documents, votre grand-pre Aldric l'a cache quelque part avant de disparatre. Il a laiss un indice : 'l o la lumire ne peut atteindre, dans le cur des terres englouties.''",speaker:"Dame Seraphina",mood:"helpful"},choices:[{text:"Demander plus de dtails sur Aldric",next:"histoire_aldric"},{text:"Demander o se trouvent ces 'terres englouties'",next:"localisation_forteresse",consequences:{flags:{knowsForteressLocation:!0}}}]},rencontre_finn:{metadata:{type:L.DIALOGUE,chapter:"acte2",tags:["companion","gnome"],title:"L'Inventeur Excentrique",character:"finn_inventeur"},content:{text:"Dans l'atelier adjacent  l'auberge, vous entendez des bruits mtalliques et des tincelles. Un gnome aux cheveux hirsutes sort la tte d'un assemblage d'engrenages complexe. 'Oh ! Des visiteurs ! Parfait, j'ai justement besoin de testeurs pour mon Dtecteur d'nergies Planaires Mark VII !'",speaker:"Finn l'Inventeur",portrait:Bp,mood:"excited"},choices:[{text:"Montrer de l'intrt pour ses inventions",next:"finn_inventions"},{text:"Lui parler de vos problmes avec les cratures d'ombre",next:"finn_detecteur",consequences:{flags:{finnIntrigued:!0}}},{text:"Poliment dcliner et partir",next:"finn_refuse"}]},finn_detecteur:{metadata:{type:L.DIALOGUE,chapter:"acte2",tags:["gnome","science"],title:"Dtection Planaire",character:"finn_inventeur"},content:{text:"'Des cratures d'ombre ? Fascinant ! Mon dtecteur indique effectivement des anomalies planaires dans cette rgion. Si vous me permettez de vous accompagner pour tudier ces phnomnes, je pourrais vous aider avec mes inventions !'",speaker:"Finn l'Inventeur",mood:"scientific"},choices:[{text:"Accepter qu'il se joigne  vous",next:"finn_rejoint",consequences:{flags:{finnJoined:!0},companions:["finn"]}},{text:"Demander une dmonstration de ses capacits",next:"finn_demonstration"}]},finn_rejoint:{metadata:{type:L.TEXT,chapter:"acte2",tags:["companion","equipment"],title:"Un Nouvel Alli"},content:{text:"Finn rassemble rapidement son quipement : dtecteurs tranges, fioles brillantes et gadgets mcaniques divers. 'Excellent ! Avec mon matriel, nous pourrons localiser les perturbations planaires et peut-tre mme prdire les apparitions de cratures !'"},choices:[{text:"Partir vers les marais pour chercher la forteresse",next:"marais_exploration",consequences:{flags:{teamFormed:!0}}},{text:"Se reposer avant l'expdition",next:"repos_millhaven",action:{type:"longRest"}}]},marais_exploration:{metadata:{type:L.TEXT,chapter:"acte2",tags:["marais","danger"],title:"Dans les Marais Maudits"},content:{text:"Les marais s'tendent  perte de vue, ponctus d'lots rocheux et de brumes paisses. Le dtecteur de Finn s'affole de plus en plus  mesure que vous progressez vers le cur de la rgion. L'air devient plus froid et des murmures tranges portent dans le vent."},choices:[{text:"Suivre les indications du dtecteur",next:"spectres_marais",consequences:{flags:{followedDetector:!0}}},{text:"Chercher un chemin plus sr",next:"chemin_detourne",action:{type:"skillCheck",skill:"survie",dc:14,onSuccess:"chemin_sur",onFailure:"spectres_marais"}}]},spectres_marais:{metadata:{type:L.COMBAT,chapter:"acte2",tags:["combat","spectres"],title:"Spectres des Marais",nextScene:"apres_spectres"},content:{text:"Des formes translucides mergent de la brume : des spectres de voyageurs perdus dans les marais. Contrairement aux ombres prcdentes, ces cratures sont plus organises et semblent communiquer entre elles dans un langage sifflant."},enemies:[{type:"spectre_marais",count:4}],enemyPositions:[{x:3,y:1},{x:4,y:4},{x:6,y:2},{x:7,y:5}],choices:[{text:"Combattre les spectres !",action:{type:"combat"}}]},apres_spectres:{metadata:{type:L.TEXT,chapter:"acte2",tags:["aftermath","discovery"],title:"Rvlations Spectrales"},content:{text:"Avant de se dissiper, l'un des spectres murmure : 'Elle... elle contrle... la Dame... cherche... la Lame...' Finn examine ses instruments : 'Les perturbations planaires viennent dfinitivement d'une structure au nord-ouest. Et ces cratures... elles taient diriges !'"},choices:[{text:"Se diriger vers la source des perturbations",next:"forteresse_ruines",consequences:{flags:{heardSpectreWarning:!0}}}]},forteresse_ruines:{metadata:{type:L.INTERACTIVE,chapter:"acte3",tags:["forteresse","exploration"],title:"Les Ruines de Sombremont",background:Og},content:{text:"Devant vous s'lvent les ruines imposantes de ce qui fut autrefois une forteresse majestueuse. Des tours croules percent la brume, et une nergie sombre pulse visiblement entre les pierres anciennes. C'tait le sige de votre famille."},hotspots:[{id:"main_entrance",coordinates:{x:446,y:202,width:87,height:138},text:"Entrer par l'entre principale",action:{type:"scene_transition",next:"entree_forteresse"}},{id:"side_passage",coordinates:{x:60,y:307,width:20,height:60},text:"Chercher un passage latral",action:{type:"scene_transition",next:"passage_secret"}},{id:"magical_observation",coordinates:{x:821,y:210,width:55,height:55},text:"Analyser les nergies magiques",condition:"character.class === 'Magicien' || gameFlags.finnJoined",action:{type:"scene_transition",next:"analyse_magique"}}],choices:[{text:"Faire le tour pour valuer la situation",next:"evaluation_forteresse"}]},entree_forteresse:{metadata:{type:L.TEXT,chapter:"acte3",tags:["exploration","tension"],title:"Dans les Ruines"},content:{text:"L'intrieur de la forteresse est dans un tat de dsolation contrle. Certaines parties semblent avoir t rcemment habites. Des symboles tranges sont peints sur les murs, et vous entendez des voix provenant des profondeurs. Quelqu'un d'autre est ici."},choices:[{text:"Avancer discrtement vers les voix",next:"rencontre_zara",action:{type:"skillCheck",skill:"discretion",dc:13,onSuccess:"approche_discrete",onFailure:"approche_bruyante"}},{text:"Explorer les autres salles d'abord",next:"exploration_salles"}]},rencontre_zara:{metadata:{type:L.DIALOGUE,chapter:"acte3",tags:["companion","sorcire"],title:"La Sorcire Prisonnire",character:"zara_sorciere"},content:{text:"Dans une salle circulaire, vous dcouvrez une femme aux cheveux noirs enferme dans un cercle de runes brillantes. Elle lve les yeux vers vous avec un mlange de soulagement et de mfiance. 'Enfin quelqu'un ! J'tudie les anomalies planaires ici depuis des mois, mais ce pige magique m'a capture !'",speaker:"Zara la Sorcire",portrait:Pp,mood:"desperate"},choices:[{text:"Essayer de briser le cercle magique",next:"liberation_zara",action:{type:"skillCheck",skill:"arcane",dc:15,onSuccess:"zara_liberee",onFailure:"liberation_ratee"}},{text:"Demander qui l'a pige avant d'agir",next:"zara_explication"},{text:"Rester mfiant - cela pourrait tre un pige",next:"zara_mefiance"}]},zara_liberee:{metadata:{type:L.DIALOGUE,chapter:"acte3",tags:["liberation","revelation"],title:"Une Nouvelle Allie",character:"zara_sorciere"},content:{text:"Le cercle se brise dans un flash de lumire. Zara se masse les poignets en souriant : 'Merci ! Je commenais  dsesprer. Je dois vous avertir : Dame Seraphina n'est pas celle qu'elle prtend tre. Elle contrle activement l'ouverture de la Porte des Murmures !'",speaker:"Zara la Sorcire",mood:"grateful"},choices:[{text:"Demander des explications sur Seraphina",next:"zara_revelation_seraphina",consequences:{flags:{zaraJoined:!0,knowsSeraphinaTruth:!0},companions:["zara"]}},{text:"Proposer qu'elle se joigne  votre groupe",next:"zara_alliance",consequences:{flags:{zaraJoined:!0},companions:["zara"]}}]},zara_revelation_seraphina:{metadata:{type:L.DIALOGUE,chapter:"acte3",tags:["revelation","betrayal"],title:"La Vritable Nature de Seraphina",character:"zara_sorciere"},content:{text:"'Seraphina n'est pas juste une noble curieuse. Elle descend d'une ligne rivale qui fut dpossde du titre de Gardien il y a des sicles. Elle ne veut pas dtruire la Porte des Murmures - elle veut la contrler pour invoquer une arme d'ombres et conqurir les royaumes !'",speaker:"Zara la Sorcire",mood:"urgent"},choices:[{text:"Partir immdiatement pour l'arrter",next:"course_contre_seraphina",consequences:{flags:{rushedToConfrontation:!0}}},{text:"Chercher d'abord la Lame ternelle",next:"recherche_lame",consequences:{flags:{soughtBladeFirst:!0}}}]},recherche_lame:{metadata:{type:L.TEXT,chapter:"acte3",tags:["exploration","discovery"],title:"La Chambre Secrte"},content:{text:"Zara vous guide vers la chambre secrte au cur de la forteresse. Mais devant l'entre, d'anciens gardiens corrompus par l'nergie planaire montent la garde. Leurs armures anciennes brillent d'une lumire malsaine, et leurs yeux ne refltent plus aucune humanit."},choices:[{text:"Engager le combat contre les gardiens",next:"combat_gardiens_corrompus"},{text:"Essayer de les raisonner",next:"tentative_negociation",action:{type:"skillCheck",skill:"persuasion",dc:18,onSuccess:"gardiens_pacifies",onFailure:"combat_gardiens_corrompus"}}]},combat_gardiens_corrompus:{metadata:{type:L.COMBAT,chapter:"acte3",tags:["combat","gardiens"],title:"Gardiens Corrompus",nextScene:"decouverte_lame"},content:{text:"Les gardiens corrompus attaquent sans merci ! Ces anciens protecteurs de votre ligne ont t transforms en cratures hybrides, mi-humaines mi-ombres. Leur corruption leur donne une force surnaturelle, mais aussi une vulnrabilit  la lumire pure."},enemies:[{type:"gardien_corrompu",count:3}],enemyPositions:[{x:4,y:2},{x:5,y:4},{x:6,y:1}],choices:[{text:"Librer les gardiens de leur corruption !",action:{type:"combat"}}]},decouverte_lame:{metadata:{type:L.TEXT,chapter:"acte3",tags:["discovery","artifact"],title:"La Lame ternelle"},content:{text:"Dans la chambre secrte, sur un autel de cristal noir, repose enfin la Lame ternelle. L'pe pulse d'une lumire argente qui semble repousser naturellement les ombres. Mais au moment o vous vous en approchez, des applaudissements lents rsonnent derrire vous."},choices:[{text:"Se retourner prudemment",next:"apparition_seraphina"},{text:"Saisir rapidement la lame",next:"saisie_lame_rapide",action:{type:"skillCheck",skill:"dexterite",dc:16,onSuccess:"lame_saisie",onFailure:"apparition_seraphina"}}]},apparition_seraphina:{metadata:{type:L.DIALOGUE,chapter:"acte4",tags:["betrayal","revelation"],title:"La Vritable Seraphina",character:"seraphina_enemy"},content:{text:"Dame Seraphina entre dans la chambre, accompagne de mercenaires en armure noire. Mais quelque chose a chang en elle - ses yeux brillent d'une lueur malsaine et des ombres dansent autour de sa silhouette. 'Merci de m'avoir mene jusqu'ici, descendant des usurpateurs !'",speaker:"Dame Seraphina",portrait:zg,mood:"hostile"},choices:[{text:"Demander des explications",next:"seraphina_revelation"},{text:"Prparer immdiatement le combat",next:"preparation_combat_final",consequences:{flags:{preparedForFinalBattle:!0}}}]},seraphina_revelation:{metadata:{type:L.DIALOGUE,chapter:"acte4",tags:["villain","motivation"],title:"L'Hritage Vol",character:"seraphina_enemy"},content:{text:"'Ma famille tait les vrais Gardiens avant que les vtres ne nous dpossdent par la ruse ! Pendant des sicles, nous avons planifi notre retour. Je ne veux pas dtruire la Porte des Murmures - je veux l'ouvrir compltement et commander une arme d'ombres pour reprendre ce qui nous revient de droit !'",speaker:"Dame Seraphina",mood:"vengeful"},choices:[{text:"Essayer de la raisonner",next:"tentative_redemption",action:{type:"skillCheck",skill:"persuasion",dc:20,onSuccess:"seraphina_hesitate",onFailure:"combat_seraphina"}},{text:"La dfier au combat",next:"combat_seraphina"}]},combat_seraphina:{metadata:{type:L.COMBAT,chapter:"acte4",tags:["boss","final"],title:"Seraphina la Corrompue",nextScene:"apres_combat_final"},content:{text:"Seraphina se transforme sous vos yeux, l'nergie planaire la corrompant en une crature mi-humaine mi-ombre. Ses mercenaires attaquent tandis qu'elle invoque des sorts puissants. C'est le combat le plus difficile que vous ayez jamais affront !"},enemies:[{type:"seraphina_boss",count:1},{type:"mercenaire_ombre",count:2}],enemyPositions:[{x:4,y:3},{x:2,y:1},{x:6,y:5}],choices:[{text:"Combattre pour sauver le monde !",action:{type:"combat"}}]},apres_combat_final:{metadata:{type:L.TEXT,chapter:"acte4",tags:["aftermath","choice"],title:"Le Dernier Acte de Seraphina"},content:{text:"Seraphina s'effondre, mortellement blesse, mais utilise ses dernires forces pour lancer un sort de destruction sur la Porte des Murmures. La faille planaire commence  se fissurer dangereusement. Vous devez agir vite !",variations:{with_allies:"Vos compagnons vous regardent avec confiance : 'Nous te suivrons, quel que soit ton choix !'",solo:"Seul face  ce choix crucial, tu sens le poids de la responsabilit sur tes paules."}},conditions:{show_variation:{with_allies:"gameFlags.kaelJoined || gameFlags.finnJoined || gameFlags.zaraJoined",solo:"!gameFlags.kaelJoined && !gameFlags.finnJoined && !gameFlags.zaraJoined"}},choices:[{text:"Dtruire la Lame ternelle pour fermer la porte  jamais",next:"fin_destruction_lame",consequences:{flags:{destroyedBlade:!0,porteClosed:!0}}},{text:"Devenir le nouveau Gardien et garder la lame",next:"fin_nouveau_gardien",consequences:{flags:{becameGuardian:!0,keptBlade:!0}}},{text:"Essayer de purifier la porte au lieu de la fermer",next:"tentative_purification",condition:"character.class === 'Magicien' || gameFlags.zaraJoined",action:{type:"skillCheck",skill:"arcane",dc:18,onSuccess:"fin_purification_reussie",onFailure:"fin_purification_ratee"}}]},fin_destruction_lame:{metadata:{type:L.TEXT,chapter:"epilogue",tags:["ending","sacrifice"],title:"Le Sacrifice Hroque"},content:{text:"Tu lves la Lame ternelle et, d'un geste dcisif, la brises contre l'autel de cristal. L'explosion de lumire pure scelle dfinitivement la Porte des Murmures, mais l'artefact lgendaire est perdu  jamais. Les villages environnants sont sauvs, mais tu portes le poids d'avoir dtruit un hritage millnaire.",variations:{with_team:"Tes compagnons approuvent ton choix courageux. Ensemble, vous avez sauv la rgion au prix d'un sacrifice immense."}},conditions:{show_variation:{with_team:"gameFlags.kaelJoined || gameFlags.finnJoined || gameFlags.zaraJoined"}},choices:[{text:"Retourner  Ravenscroft pour annoncer la nouvelle",next:"epilogue_retour_village"}]},fin_nouveau_gardien:{metadata:{type:L.TEXT,chapter:"epilogue",tags:["ending","responsibility"],title:"L'Hritage Assum"},content:{text:"Tu saisis fermement la Lame ternelle et canalises son pouvoir pour stabiliser la Porte des Murmures. Tu deviens le nouveau Gardien, assumant la responsabilit de surveiller cette rgion  vie. C'est un fardeau lourd, mais tu prserves  la fois la paix et l'hritage de ta famille."},choices:[{text:"Accepter ton nouveau rle avec honneur",next:"epilogue_gardien"}]},fin_purification_reussie:{metadata:{type:L.TEXT,chapter:"epilogue",tags:["ending","redemption"],title:"La Voie de la Rdemption"},content:{text:"Grce  tes connaissances magiques ou  l'aide de Zara, tu russis l'impossible : purifier la Porte des Murmures au lieu de la fermer. La faille devient un passage contrl qui pourrait mme tre bnfique dans le futur. Tu as trouv une troisime voie que personne n'avait envisage."},choices:[{text:"tudier cette nouvelle dcouverte",next:"epilogue_chercheur"}]},epilogue_retour_village:{metadata:{type:L.DIALOGUE,chapter:"epilogue",tags:["conclusion","sage"],title:"Le Sage Aldwin",character:"maitre_aldwin",location:"Ravenscroft - Taverne"},content:{text:"De retour  la taverne de Ravenscroft, vous rencontrez un vieil homme aux robes d'rudit qui vous attendait. 'Je suis Matre Aldwin, archiviste royal. J'ai entendu parler de vos exploits. Ce que vous avez accompli ici n'est que le dbut - il existe d'autres Portes dans le monde, d'autres sites o d'anciens Gardiens ont disparu.'",speaker:"Matre Aldwin",portrait:Tp,mood:"wise"},choices:[{text:"Accepter de former un nouvel Ordre des Gardiens",next:"formation_nouvel_ordre",consequences:{flags:{formedNewOrder:!0}}},{text:"Demander du temps pour rflchir",next:"reflexion_finale"},{text:"Refuser - tu en as assez fait",next:"retraite_heroique"}]},formation_nouvel_ordre:{metadata:{type:L.TEXT,chapter:"epilogue",tags:["new_beginning","hope"],title:"Un Nouvel Espoir"},content:{text:"Matre Aldwin sourit et droule une carte ancienne marque d'emplacements mystrieux  travers le continent. 'Parfait. Avec vos compagnons et la sagesse que vous avez acquise, nous pouvons crer un nouvel Ordre des Gardiens. Le monde a besoin de protecteurs comme vous.'",variations:{blade_destroyed:"Mme sans la Lame ternelle, votre exprience et votre dtermination seront des atouts prcieux.",became_guardian:"En tant que Gardien de la Lame ternelle, vous serez le pilier de ce nouvel ordre.",purified_gate:"Votre dcouverte de la purification des portes rvolutionne notre approche de ces sites."}},conditions:{show_variation:{blade_destroyed:"gameFlags.destroyedBlade",became_guardian:"gameFlags.becameGuardian",purified_gate:"gameFlags.purifiedGate"}},choices:[{text:"Commencer cette nouvelle aventure",next:"fin_ouverture_monde",consequences:{flags:{readyForSequal:!0}}}]},fin_ouverture_monde:{metadata:{type:L.TEXT,chapter:"epilogue",tags:["ending","future"],title:"De Nouveaux Horizons"},content:{text:`Votre groupe se prpare pour un priple  travers le continent. Selon vos choix et vos compagnons, vous avez diffrents outils  votre disposition, mais une mission commune : localiser et protger les autres sites planaires. L'aventure de Vethkar n'tait que le premier chapitre d'une pope bien plus vaste.
*** FIN DU CHAPITRE 1 : LES GARDIENS DE LA LAME TERNELLE ***
Vos choix et vos compagnons faonneront la suite de votre destine...`},choices:[{text:"Continuer l'aventure... ( suivre)",next:"introduction",consequences:{flags:{completedFirstChapter:!0}}}]},dialogue_ombre:{metadata:{type:L.DIALOGUE,chapter:"prologue",tags:["mystery","warning"],title:"Murmures dans l'Ombre",character:"aubergiste_tom"},content:{text:"Tom se penche vers toi, l'air plus sombre qu'avant : 'Cette nuit, j'ai entendu des choses... Des murmures venant des marais. Les ombres bougent diffremment depuis ton arrive. Je ne dis pas que c'est ta faute, mais...' Il s'interrompt en jetant un regard nerveux vers la fentre.",speaker:"Tom l'Aubergiste",mood:"worried"},choices:[{text:"Demander plus de dtails sur ces murmures",next:"dialogue_disparition"},{text:"Partir immdiatement vers le domaine",next:"route_domaine",consequences:{flags:{heardOmenWarning:!0}}}]},route_domaine_nuit:{metadata:{type:L.TEXT,chapter:"prologue",tags:["danger","night"],title:"Retour Nocturne Dangereux"},content:{text:"Cette fois, tu prends le sentier vers le manoir dans l'obscurit totale. Les bruits de la fort sont diffrents, plus menaants. Des formes sombres semblent te suivre entre les arbres, et tu entends parfois des murmures dans une langue inconnue. Ton instinct te dit que quelque chose d'hostile rde dans ces bois."},choices:[{text:"Continuer malgr le danger",next:"entree_manoir_direct",action:{type:"skillCheck",skill:"courage",dc:14,onSuccess:"arrivee_manoir_brave",onFailure:"attaque_ombres_route"}},{text:"Faire demi-tour prudemment",next:"retour_village_trouble"}]},retour_village_trouble:{metadata:{type:L.TEXT,chapter:"prologue",tags:["retreat","omen"],title:"Retraite Troublante"},content:{text:"Tu fais demi-tour, mais mme en retournant vers le village, tu sens une prsence malveillante dans ton dos. Les ombres semblent te suivre, et tu entends distinctement des rires touffs. En arrivant  Ravenscroft, tu remarques que plusieurs maisons ont leurs fentres barricades."},choices:[{text:"Retourner  la taverne pour la nuit",next:"chambre_repos",consequences:{flags:{sawDarkOmens:!0}}}]},retour_village_infos:{metadata:{type:L.TEXT,chapter:"prologue",tags:["information","planning"],title:"Retour avec des Renseignements"},content:{text:"Tu retournes au village avec les informations prcieuses que tu as rcoltes sur le manoir. Il est habit par un vieil homme mystrieux, et des protections magiques sont en place. Les villageois pourraient tre rassurs d'apprendre que quelqu'un veille encore sur l'ancien domaine familial."},choices:[{text:"Partager tes dcouvertes  la taverne",next:"taverne_lanterne",consequences:{flags:{sharedManorInfo:!0}}},{text:"Garder les informations et retourner au manoir",next:"entree_manoir_informe"}]},rencontre_aldwin_poli:{metadata:{type:L.DIALOGUE,chapter:"prologue",tags:["polite","heritage"],title:"Prsentation Courtoise",character:"maitre_aldwin"},content:{text:"'Bonsoir, je suis {character.name} {character.familyName}. J'ai hrit de ce domaine et je cherche  comprendre l'histoire de ma famille.' Le vieil homme sourit chaleureusement : 'Enfin ! Je suis Matre Aldwin, gardien temporaire de ce lieu. J'attendais le retour d'un descendant depuis des annes.'",speaker:"Matre Aldwin",portrait:Tp,mood:"welcoming"},choices:[{text:"Demander pourquoi il gardait le manoir",next:"aldwin_explication_gardien"},{text:"Questionner sur la famille et la Lame ternelle",next:"aldwin_histoire_famille",condition:"gameFlags.knowsAboutBlade"},{text:"Accepter son invitation  entrer",next:"interieur_manoir_aldwin"}]},rencontre_aldwin_mefiant:{metadata:{type:L.DIALOGUE,chapter:"prologue",tags:["suspicious","caution"],title:"Confrontation Mfiante",character:"maitre_aldwin"},content:{text:"'Qui tes-vous et que faites-vous dans MON manoir ?' Le vieil homme ne semble pas surpris par ta mfiance. 'Ta mfiance t'honore, jeune {character.familyName}. Oui, je connais ton nom. Je suis Aldwin, et je protge ce lieu depuis la disparition de ton grand-pre.'",speaker:"Matre Aldwin",mood:"understanding"},choices:[{text:"Exiger des preuves de ses dires",next:"aldwin_preuves",action:{type:"skillCheck",skill:"intuition",dc:12,onSuccess:"aldwin_confiance",onFailure:"aldwin_resistance"}},{text:"S'excuser et se prsenter poliment",next:"rencontre_aldwin_poli"}]},rencontre_aldwin_observateur:{metadata:{type:L.DIALOGUE,chapter:"prologue",tags:["observant","impressed"],title:"Respect Mutuel",character:"maitre_aldwin"},content:{text:"'J'ai remarqu que vous entreteniez des protections magiques autour du domaine. Votre travail est impressionnant.' Aldwin hoche la tte avec respect : 'Peu de gens auraient remarqu ces dtails. Tu as l'il aiguis de ton grand-pre. Entre, nous avons beaucoup  discuter.'",speaker:"Matre Aldwin",mood:"impressed"},choices:[{text:"Suivre Aldwin dans le manoir",next:"interieur_manoir_respect",consequences:{flags:{earnedAldwinRespect:!0}}}]},rencontre_aldwin_respectueux:{metadata:{type:L.DIALOGUE,chapter:"prologue",tags:["patience","wisdom"],title:"La Patience Rcompense",character:"maitre_aldwin"},content:{text:"Tu sors de ta cachette et t'approches calmement. Aldwin te sourit : 'Ta patience et ton respect pour les mystres de ce lieu me plaisent. Tu as observ sans juger, attendu sans imposer. Ces qualits faisaient de ton grand-pre un excellent Gardien.'",speaker:"Matre Aldwin",mood:"wise"},choices:[{text:"Exprimer ton honneur de cette comparaison",next:"interieur_manoir_honneur",consequences:{flags:{aldwinHighEsteem:!0}}}]},aldwin_vient_chercher:{metadata:{type:L.TEXT,chapter:"prologue",tags:["patient","mysterious"],title:"L'Invitation Inattendue"},content:{text:"Tu restes immobile, attendant de voir ce qui va se passer. Au bout de quelques minutes, tu entends des pas qui s'approchent de ta position. Aldwin apparat entre les arbres, une lanterne  la main, et te sourit calmement : 'Je pensais bien que tu prfrerais attendre. Viens, il est temps de parler.'"},choices:[{text:"Suivre Aldwin sans rsistance",next:"interieur_manoir_confiance",consequences:{flags:{trustedAldwin:!0}}},{text:"Rester prudent mais accepter",next:"interieur_manoir_aldwin"}]},interieur_manoir_aldwin:{metadata:{type:L.TEXT,chapter:"prologue",tags:["manor","discovery"],title:" l'Intrieur du Manoir"},content:{text:"L'intrieur du manoir est surprenant : bien que l'architecture soit ancienne, tout est impeccablement entretenu. Des livres rares tapissent les murs, et tu remarques plusieurs artefacts magiques disposs avec soin. Aldwin te guide vers un salon confortable o un feu crpite dans la chemine."},choices:[{text:"Demander des explications sur ton hritage",next:"aldwin_histoire_famille"},{text:"Questionner sur les vnements rcents",next:"aldwin_explication_gardien",condition:"gameFlags.knowsAboutBlade"}]},interieur_manoir_respect:{metadata:{type:L.TEXT,chapter:"prologue",tags:["respect","heritage"],title:"Un Accueil d'Honneur"},content:{text:"Aldwin te fait visiter le manoir avec fiert, te montrant des portraits de tes anctres et des objets ayant appartenu  ta famille. 'Ton grand-pre serait fier de voir que tu as hrit de son sens de l'observation. Les Gardiens ont toujours eu cette qualit.'"},choices:[{text:"Apprendre l'histoire des Gardiens",next:"aldwin_histoire_gardiens",consequences:{flags:{learnedGuardianHistory:!0}}}]},interieur_manoir_honneur:{metadata:{type:L.TEXT,chapter:"prologue",tags:["honor","legacy"],title:"L'Hritage d'Honneur"},content:{text:"Aldwin te mne vers un bureau o repose un portrait de ton grand-pre tenant la Lame ternelle. 'Aldric tait un homme remarquable. Sa sagesse et sa patience taient lgendaires. Je vois ces mmes qualits en toi.'"},choices:[{text:"Accepter de reprendre le flambeau familial",next:"acceptation_heritage",consequences:{flags:{acceptedLegacy:!0,aldwinHighEsteem:!0}}}]},interieur_manoir_confiance:{metadata:{type:L.TEXT,chapter:"prologue",tags:["trust","alliance"],title:"Une Alliance Naturelle"},content:{text:"Aldwin apprcie ta confiance immdiate. Dans son bureau, il sort une carte ancienne et des documents scells : 'Ton grand-pre m'a laiss des instructions prcises pour le jour o un hritier reviendrait. Je pense que ce moment est arriv.'"},choices:[{text:"tudier les documents ensemble",next:"revelation_documents",consequences:{flags:{sawSecretDocuments:!0,trustedAldwin:!0}}}]},dialogue_kael_mefiance:{metadata:{type:L.DIALOGUE,chapter:"prologue",tags:["suspicion","ranger"],title:"Mfiance Justifie",character:"kael_ranger"},content:{text:"'Qui es-tu vraiment ? Et qu'est-ce qui me prouve que tu n'es pas li  ces cratures ?' Kael garde sa main prs de son pe. 'J'ai vu trop d'innocents se rvler tre des suppts des ombres. Ta soudaine apparition ici n'est peut-tre pas une concidence.'",speaker:"Kael le Rdeur",mood:"suspicious"},choices:[{text:"Montrer ta lettre d'hritage comme preuve",next:"kael_preuve_heritage",action:{type:"skillCheck",skill:"persuasion",dc:13,onSuccess:"kael_convaincu",onFailure:"kael_reste_mefiant"}},{text:"Accepter sa mfiance et proposer un test",next:"kael_test"},{text:"Partir sans insister",next:"depart_sans_kael",consequences:{flags:{kaelRejected:!0}}}]},kael_test:{metadata:{type:L.TEXT,chapter:"prologue",tags:["test","proof"],title:"preuve de Confiance"},content:{text:"'Trs bien, si tu veux prouver tes intentions, accompagne-moi. Il y a un groupe d'ombres mineures prs du cimetire. Si tu m'aides  les liminer sans fuir ou me trahir, j'accepterai de t'aider.' Kael semble srieux dans sa proposition."},choices:[{text:"Accepter le test de combat",next:"test_combat_kael",consequences:{flags:{acceptedKaelTest:!0}}},{text:"Proposer un autre type de preuve",next:"kael_preuve_alternative"}]},kael_trustworthy:{metadata:{type:L.TEXT,chapter:"prologue",tags:["trust","success"],title:"Instinct Confirm"},content:{text:"Ton instinct te dit que Kael est sincre. Ses cicatrices, sa faon de scruter les ombres, sa connaissance des cratures - tout indique un vritable chasseur d'ombres. 'Je vois que tu as l'il pour juger les gens', dit-il en remarquant ton regard approbateur."},choices:[{text:"Faire confiance et accepter son aide",next:"kael_rejoint",consequences:{flags:{kaelJoined:!0,trustInstinct:!0}}}]},kael_uncertain:{metadata:{type:L.TEXT,chapter:"prologue",tags:["uncertainty","doubt"],title:"Doutes Persistants"},content:{text:"Quelque chose dans l'attitude de Kael te met mal  l'aise, sans que tu puisses identifier quoi exactement. Peut-tre est-ce juste de la prudence naturelle, mais ton instinct te conseille la mfiance."},choices:[{text:"Accepter son aide malgr tes doutes",next:"kael_rejoint",consequences:{flags:{kaelJoined:!0,hasDoubts:!0}}},{text:"Poliment dcliner son aide",next:"kael_refuse"}]},kael_refuse:{metadata:{type:L.DIALOGUE,chapter:"prologue",tags:["refusal","solo"],title:"Chemin Solitaire",character:"kael_ranger"},content:{text:"'Je vous remercie pour votre proposition, mais je prfre grer cette situation seul.' Kael hoche la tte avec comprhension : 'Je respecte ton choix. Mais si tu changes d'avis, je chasse ces cratures dans les marais au nord. Fais attention  toi.'",speaker:"Kael le Rdeur",mood:"understanding"},choices:[{text:"Partir explorer les tunnels seul",next:"tunnels_entree_solo",consequences:{flags:{kaelRefused:!0,goingSolo:!0}}},{text:"Retourner au manoir plutt",next:"route_domaine"}]},repos_avec_kael:{metadata:{type:L.TEXT,chapter:"prologue",tags:["rest","preparation"],title:"Prparatifs avec Kael"},content:{text:"Kael et toi prenez le temps de vous reposer et de planifier l'exploration. Il partage ses connaissances sur les cratures d'ombre et vous prpare des provisions. 'Les tunnels peuvent tre tratres. Mieux vaut tre prpar que dsol.'"},choices:[{text:"Explorer les tunnels ensemble",next:"tunnels_entree",consequences:{flags:{preparedWithKael:!0}}}]},chambre_millhaven:{metadata:{type:L.TEXT,chapter:"acte2",tags:["rest","inn"],title:"Chambre au Repos du Voyageur"},content:{text:"Tu prends une chambre  l'auberge pour la nuit. La chambre est confortable et bien plus luxueuse que celle de Ravenscroft. Par la fentre, tu peux observer l'activit nocturne de Millhaven - une ville qui ne dort jamais vraiment."},choices:[{text:"Te reposer pour la nuit",next:"reveil_millhaven",action:{type:"longRest"}},{text:"Redescendre au salon pour couter les conversations",next:"observation_salon"}]},seraphina_echange:{metadata:{type:L.DIALOGUE,chapter:"acte2",tags:["negotiation","information"],title:"Ngociation avec Dame Seraphina",character:"dame_seraphina"},content:{text:"'Mes informations ont une valeur, naturellement. En change de mes archives, j'aimerais que vous m'emmeniez avec vous quand vous irez rcuprer la Lame ternelle. Mon expertise historique pourrait vous tre prcieuse.' Ses yeux brillent d'un intrt particulier.",speaker:"Dame Seraphina",mood:"calculating"},choices:[{text:"Accepter qu'elle vous accompagne",next:"seraphina_rejoint",consequences:{flags:{seraphinaJoined:!0,seraphinaHidden:!0}}},{text:"Refuser et chercher les informations ailleurs",next:"refus_seraphina",consequences:{flags:{seraphinaRefused:!0}}},{text:"Demander pourquoi elle s'intresse tant  la lame",next:"seraphina_motivations"}]},observation_reussie:{metadata:{type:L.TEXT,chapter:"acte2",tags:["observation","discovery"],title:"Dtails Rvlateurs"},content:{text:"En observant discrtement Dame Seraphina, tu remarques plusieurs dtails troublants : elle porte un pendentif avec le mme symbole que celui grav prs du manoir, ses parchemins semblent contenir des cartes dtailles de la rgion, et surtout, elle a une cicatrice trange sur le poignet qui ressemble  une marque rituelle."},choices:[{text:"L'aborder avec ces observations",next:"dialogue_seraphina_suspicion",consequences:{flags:{noticedSeraphinaDetails:!0}}},{text:"Garder ces informations pour plus tard",next:"dialogue_seraphina_intro",consequences:{flags:{secretObservation:!0}}}]},observation_ratee:{metadata:{type:L.TEXT,chapter:"acte2",tags:["failure","noticed"],title:"Attention Attire"},content:{text:"Dame Seraphina lve les yeux et te remarque qui l'observes. Elle sourit avec amusement : 'Vous semblez intress par mon travail. Approchez-vous donc, ne restez pas l  m'pier depuis l'entre.' Son ton est amical mais tu sens qu'elle n'a rien rat de ton mange."},choices:[{text:"S'approcher et s'excuser",next:"dialogue_seraphina_intro",consequences:{flags:{caughtObserving:!0}}}]},repos_millhaven:{metadata:{type:L.TEXT,chapter:"acte2",tags:["rest","preparation"],title:"Prparatifs  Millhaven"},content:{text:"Votre groupe prend le temps de se reposer et de se prparer avant l'expdition vers les marais. Finn vrifie ses quipements, ajuste ses dtecteurs, et prpare des provisions spciales. 'Les marais sont imprvisibles, mais avec le bon matriel, nous devrions nous en sortir !'"},choices:[{text:"Partir bien reposs vers les marais",next:"marais_exploration",consequences:{flags:{wellRested:!0}}}]},finn_inventions:{metadata:{type:L.TEXT,chapter:"acte2",tags:["gnome","inventions"],title:"Merveilles Mcaniques"},content:{text:"Finn te fait visiter son atelier avec enthousiasme. Des gadgets tranges tapissent les tagres : dtecteurs  cristaux, automates de poche, et mme ce qui semble tre un 'Rpulseur d'nergies Ngatives Portable Mark III'. 'Chaque invention rsout un problme spcifique !'"},choices:[{text:"Demander une dmonstration de ses dtecteurs",next:"finn_detecteur"},{text:"S'intresser aux applications militaires",next:"finn_applications_combat"}]},finn_demonstration:{metadata:{type:L.TEXT,chapter:"acte2",tags:["proof","science"],title:"Dmonstration Scientifique"},content:{text:"Finn active plusieurs de ses appareils. Ses dtecteurs se mettent  bourdonner et affichent des lectures inquitantes : 'Regardez ces mesures ! L'activit planaire dans cette rgion est 300% au-dessus de la normale. Et voici...' Il pointe vers les marais : 'Un pic d'activit majeur l-bas !'"},choices:[{text:"Impressionn, accepter qu'il vous accompagne",next:"finn_rejoint",consequences:{flags:{finnJoined:!0,sawDemonstration:!0}}}]},finn_refuse:{metadata:{type:L.TEXT,chapter:"acte2",tags:["refusal","disappointment"],title:"Opportunit Manque"},content:{text:"Finn semble du mais comprend : 'Je respecte votre dcision, mais c'est dommage. Mes dtecteurs montrent des anomalies fascinantes dans cette rgion !' Il retourne  ses expriences en marmonnant sur les 'occasions scientifiques rates'."},choices:[{text:"Partir vers les marais sans lui",next:"marais_exploration",consequences:{flags:{finnRefused:!0}}}]},chemin_detourne:{metadata:{type:L.TEXT,chapter:"acte2",tags:["alternate","safe"],title:"Voie de Contournement"},content:{text:"Tu choisis un chemin plus long mais apparemment plus sr  travers les marais. Cette route vous fait contourner les zones les plus dangereuses, mais vous met  l'abri des rencontres hostiles."},choices:[{text:"Continuer prudemment",next:"arrivee_forteresse_sure"}]},chemin_sur:{metadata:{type:L.TEXT,chapter:"acte2",tags:["success","safe"],title:"Navigation Experte"},content:{text:"Tes comptences de survie te permettent de trouver un passage sr  travers les marais. Vous vitez les zones dangereuses et arrivez  destination sans incident, conservant vos forces pour les dfis  venir."},choices:[{text:"Approcher de la forteresse",next:"forteresse_ruines",consequences:{flags:{navigatedSafely:!0}}}]},analyse_magique:{metadata:{type:L.TEXT,chapter:"acte3",tags:["magic","analysis"],title:"Analyse Arcanique"},content:{text:"L'analyse magique rvle des informations troublantes : la forteresse est sature d'nergies planaires qui forment des motifs complexes. Au centre, une source d'nergie massive pulse comme un cur. Ces nergies ne sont pas naturelles - quelqu'un les canalise activement.",variations:{with_finn:"Finn confirme tes observations avec ses instruments : 'Les lectures sont ahurissantes ! Quelqu'un utilise cette forteresse comme amplificateur planaire !'"}},conditions:{show_variation:{with_finn:"gameFlags.finnJoined"}},choices:[{text:"Entrer avec ces informations cruciales",next:"entree_forteresse",consequences:{flags:{analyzedMagic:!0}}}]},passage_secret:{metadata:{type:L.TEXT,chapter:"acte3",tags:["stealth","secret"],title:"Entre Discrte"},content:{text:"Kael repre une brche dans le mur d'enceinte, camoufle par des lianes. 'Les anciens chteaux ont toujours des passages secrets. Celui-ci mne directement aux caves.' Cette approche vous permettra d'viter les gardes mais vous ne savez pas ce qui vous attend  l'intrieur."},choices:[{text:"Utiliser le passage secret",next:"caves_forteresse",consequences:{flags:{usedSecretPassage:!0}}},{text:"Changer d'avis et prendre l'entre principale",next:"entree_forteresse"}]},evaluation_forteresse:{metadata:{type:L.TEXT,chapter:"acte3",tags:["reconnaissance","planning"],title:"Reconnaissance Tactique"},content:{text:"Vous faites le tour de la forteresse pour valuer la situation. Plusieurs observations importantes : des lumires bougent dans certaines tours, des traces rcentes d'occupation, et surtout, le silence anormal - aucun bruit d'animal ou d'insecte dans un rayon de cent mtres."},choices:[{text:"Entrer par l'entre principale avec un plan",next:"entree_forteresse",consequences:{flags:{plannedEntry:!0}}},{text:"Chercher une autre entre",next:"passage_secret",condition:"gameFlags.kaelJoined"}]},exploration_salles:{metadata:{type:L.TEXT,chapter:"acte3",tags:["exploration","discovery"],title:"Salles Abandonnes"},content:{text:"Vous explorez les autres salles de la forteresse avant de vous diriger vers les voix. Vous dcouvrez des signes d'occupation rcente : des lits de fortune, des restes de repas, et surtout, des cartes dtailles de la rgion avec des annotations en plusieurs langues."},choices:[{text:"Examiner les cartes plus attentivement",next:"decouverte_cartes",consequences:{flags:{foundMaps:!0}}},{text:"Se diriger vers les voix maintenant",next:"rencontre_zara"}]},repos_village:{metadata:{type:L.TEXT,chapter:"acte1",tags:["rest","village"],title:"Repos au Village"},content:{text:"Vous retournez au village pour vous reposer aprs votre premier combat contre les cratures d'ombre. Les villageois vous regardent avec un mlange de respect et d'inquitude - vous avez prouv que les ombres peuvent tre combattues."},choices:[{text:"Partir vers Millhaven le lendemain",next:"route_millhaven",action:{type:"longRest"}}]},preparation_millhaven:{metadata:{type:L.TEXT,chapter:"acte1",tags:["preparation","journey"],title:"Prparatifs pour Millhaven"},content:{text:"Avant de partir vers les marais, vous dcidez de retourner  Millhaven pour vous quiper et rassembler des informations. La ville possde des ressources que le petit village de Ravenscroft ne peut offrir."},choices:[{text:"Se rendre  Millhaven",next:"millhaven_auberge"}]},symbole_magique:{metadata:{type:L.TEXT,chapter:"acte1",tags:["magic","discovery"],title:"Symbole Ancien"},content:{text:"En tant que magicien, tu reconnais ce symbole : c'est une rune de liaison planaire, utilise pour maintenir ouverts ou ferms les passages entre les mondes. Sa prsence ici confirme que ces tunnels sont lis au mystre de la Lame ternelle.",variations:{with_finn:"Finn confirme tes observations avec ses dtecteurs : 'Ce symbole met une signature nergtique unique ! Il est encore actif aprs toutes ces annes !'"}},conditions:{show_variation:{with_finn:"gameFlags.finnJoined"}},choices:[{text:"tudier le symbole plus attentivement",next:"etude_symbole_approfondie",consequences:{flags:{understoodPlanarRunes:!0}}},{text:"Continuer l'exploration",next:"chambre_scellee"}]},histoire_aldric:{metadata:{type:L.DIALOGUE,chapter:"acte2",tags:["lore","family"],title:"L'Histoire d'Aldric",character:"dame_seraphina"},content:{text:"'Votre grand-pre Aldric tait un homme tourment dans ses dernires annes. Il parlait de visions, de murmures venant d'au-del. Certains pensaient qu'il devenait fou, mais moi je crois qu'il percevait quelque chose que les autres ne pouvaient comprendre.'",speaker:"Dame Seraphina",mood:"mysterious"},choices:[{text:"Demander des dtails sur ces visions",next:"visions_aldric"},{text:"Questionner sur sa disparition",next:"disparition_aldric"}]},localisation_forteresse:{metadata:{type:L.TEXT,chapter:"acte2",tags:["location","quest"],title:"Les Terres Englouties"},content:{text:"Dame Seraphina droule une carte ancienne : 'Les 'terres englouties' font rfrence aux anciens marais de Sombremont, o se dressait autrefois la forteresse principale de votre famille. C'est l que les nergies planaires sont les plus fortes, et donc l'endroit le plus probable pour cacher la Lame.'"},choices:[{text:"Partir immdiatement vers la forteresse",next:"marais_exploration",consequences:{flags:{knowsForteressLocation:!0}}},{text:"Demander plus d'informations sur la forteresse",next:"informations_forteresse"}]},course_contre_seraphina:{metadata:{type:L.TEXT,chapter:"acte3",tags:["urgency","race"],title:"Course Contre la Montre"},content:{text:"Ralisant l'urgence de la situation, vous vous prcipitez vers la chambre secrte, esprant atteindre la Lame ternelle avant Seraphina. Mais en arrivant, vous dcouvrez qu'elle vous attendait dj, un sourire cruel aux lvres."},choices:[{text:"Confronter Seraphina immdiatement",next:"apparition_seraphina",consequences:{flags:{rushedConfrontation:!0}}}]},test_combat_kael:{metadata:{type:L.COMBAT,chapter:"prologue",tags:["test","trust"],title:"preuve des Ombres",nextScene:"apres_test_kael"},content:{text:"Kael vous mne vers le cimetire o trois ombres mineures rdent entre les tombes. 'Montrez-moi que vous pouvez tenir bon face  ces cratures', dit-il en dgainant son pe."},enemies:[{type:"ombre_mineure",count:3}],enemyPositions:[{x:4,y:1},{x:5,y:3},{x:6,y:2}],choices:[{text:"Prouver ta valeur !",action:{type:"combat"}}]},apres_test_kael:{metadata:{type:L.TEXT,chapter:"prologue",tags:["trust","earned"],title:"Confiance Gagne"},content:{text:"Aprs le combat, Kael hoche la tte avec approbation : 'Vous avez du courage et de la comptence. Je retire mes doutes - vous tes bien quelqu'un en qui je peux avoir confiance.' Il range son pe et vous tend la main."},choices:[{text:"Accepter son alliance",next:"kael_rejoint",consequences:{flags:{kaelJoined:!0,earnedTrust:!0,provedWorth:!0}}}]},tunnels_entree_solo:{metadata:{type:L.TEXT,chapter:"acte1",tags:["solo","exploration"],title:"Exploration Solitaire"},content:{text:"Sans l'aide de Kael, tu explores seul les tunnels sous le village. L'atmosphre est plus oppressante quand on est seul, et chaque bruit rsonne trangement dans l'obscurit. Tu avances avec prudence, ta seule source de lumire  la main."},choices:[{text:"Continuer malgr l'inquitude",next:"decouverte_gravures",consequences:{flags:{exploredsolo:!0}}},{text:"Retourner chercher de l'aide",next:"taverne_lanterne"}]},depart_sans_kael:{metadata:{type:L.TEXT,chapter:"prologue",tags:["departure","solo"],title:"Voie Solitaire"},content:{text:"Tu quittes la taverne sans insister auprs de Kael. Parfois, il vaut mieux faire confiance  son instinct. Tu continues ton aventure seul, comptant sur tes propres capacits pour rsoudre les mystres de ta famille."},choices:[{text:"Explorer les tunnels en solitaire",next:"tunnels_entree_solo"},{text:"Se diriger vers le manoir familial",next:"route_domaine"}]},...qg,...Mg},Lg="modulepreload",kg=function(r,l){return new URL(r,l).href},Ep={},Ai=function(l,s,i){let u=Promise.resolve();if(s&&s.length>0){let h=function(y){return Promise.all(y.map(b=>Promise.resolve(b).then(S=>({status:"fulfilled",value:S}),S=>({status:"rejected",reason:S}))))};const f=document.getElementsByTagName("link"),p=document.querySelector("meta[property=csp-nonce]"),g=p?.nonce||p?.getAttribute("nonce");u=h(s.map(y=>{if(y=kg(y,i),y in Ep)return;Ep[y]=!0;const b=y.endsWith(".css"),S=b?'[rel="stylesheet"]':"";if(!!i)for(let N=f.length-1;N>=0;N--){const q=f[N];if(q.href===y&&(!b||q.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${y}"]${S}`))return;const T=document.createElement("link");if(T.rel=b?"stylesheet":Lg,b||(T.as="script"),T.crossOrigin="",T.href=y,g&&T.setAttribute("nonce",g),document.head.appendChild(T),b)return new Promise((N,q)=>{T.addEventListener("load",N),T.addEventListener("error",()=>q(new Error(`Unable to preload CSS for ${y}`)))})}))}function m(f){const p=new Event("vite:preloadError",{cancelable:!0});if(p.payload=f,window.dispatchEvent(p),!p.defaultPrevented)throw f}return u.then(f=>{for(const p of f||[])p.status==="rejected"&&m(p.reason);return l().catch(m)})},Cp=r=>{let l;const s=new Set,i=(h,y)=>{const b=typeof h=="function"?h(l):h;if(!Object.is(b,l)){const S=l;l=y??(typeof b!="object"||b===null)?b:Object.assign({},l,b),s.forEach(A=>A(l,S))}},u=()=>l,p={setState:i,getState:u,getInitialState:()=>g,subscribe:h=>(s.add(h),()=>s.delete(h))},g=l=r(i,u,p);return p},Bg=r=>r?Cp(r):Cp,Pg=r=>r;function Ug(r,l=Pg){const s=Pe.useSyncExternalStore(r.subscribe,Pe.useCallback(()=>l(r.getState()),[r,l]),Pe.useCallback(()=>l(r.getInitialState()),[r,l]));return Pe.useDebugValue(s),s}const Ap=r=>{const l=Bg(r),s=i=>Ug(l,i);return Object.assign(s,l),s},ki=r=>r?Ap(r):Ap,Np={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1},ol=new Map,Ni=r=>{const l=ol.get(r);return l?Object.fromEntries(Object.entries(l.stores).map(([s,i])=>[s,i.getState()])):{}},Gg=(r,l,s)=>{if(r===void 0)return{type:"untracked",connection:l.connect(s)};const i=ol.get(s.name);if(i)return{type:"tracked",store:r,...i};const u={connection:l.connect(s),stores:{}};return ol.set(s.name,u),{type:"tracked",store:r,...u}},Xg=(r,l)=>{if(l===void 0)return;const s=ol.get(r);s&&(delete s.stores[l],Object.keys(s.stores).length===0&&ol.delete(r))},$g=r=>{var l,s;if(!r)return;const i=r.split(`
`),u=i.findIndex(f=>f.includes("api.setState"));if(u<0)return;const m=((l=i[u+1])==null?void 0:l.trim())||"";return(s=/.+ (.+) .+/.exec(m))==null?void 0:s[1]},Vg=(r,l={})=>(s,i,u)=>{const{enabled:m,anonymousActionType:f,store:p,...g}=l;let h;try{h=(m??(Np?"production":void 0)!=="production")&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!h)return r(s,i,u);const{connection:y,...b}=Gg(p,h,g);let S=!0;u.setState=(N,q,_)=>{const D=s(N,q);if(!S)return D;const G=_===void 0?{type:f||$g(new Error().stack)||"anonymous"}:typeof _=="string"?{type:_}:_;return p===void 0?(y?.send(G,i()),D):(y?.send({...G,type:`${p}/${G.type}`},{...Ni(g.name),[p]:u.getState()}),D)},u.devtools={cleanup:()=>{y&&typeof y.unsubscribe=="function"&&y.unsubscribe(),Xg(g.name,p)}};const A=(...N)=>{const q=S;S=!1,s(...N),S=q},T=r(u.setState,i,u);if(b.type==="untracked"?y?.init(T):(b.stores[b.store]=u,y?.init(Object.fromEntries(Object.entries(b.stores).map(([N,q])=>[N,N===b.store?T:q.getState()])))),u.dispatchFromDevtools&&typeof u.dispatch=="function"){let N=!1;const q=u.dispatch;u.dispatch=(..._)=>{(Np?"production":void 0)!=="production"&&_[0].type==="__setState"&&!N&&(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),N=!0),q(..._)}}return y.subscribe(N=>{var q;switch(N.type){case"ACTION":if(typeof N.payload!="string"){console.error("[zustand devtools middleware] Unsupported action format");return}return oo(N.payload,_=>{if(_.type==="__setState"){if(p===void 0){A(_.state);return}Object.keys(_.state).length!==1&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format.
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);const D=_.state[p];if(D==null)return;JSON.stringify(u.getState())!==JSON.stringify(D)&&A(D);return}u.dispatchFromDevtools&&typeof u.dispatch=="function"&&u.dispatch(_)});case"DISPATCH":switch(N.payload.type){case"RESET":return A(T),p===void 0?y?.init(u.getState()):y?.init(Ni(g.name));case"COMMIT":if(p===void 0){y?.init(u.getState());return}return y?.init(Ni(g.name));case"ROLLBACK":return oo(N.state,_=>{if(p===void 0){A(_),y?.init(u.getState());return}A(_[p]),y?.init(Ni(g.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return oo(N.state,_=>{if(p===void 0){A(_);return}JSON.stringify(u.getState())!==JSON.stringify(_[p])&&A(_[p])});case"IMPORT_STATE":{const{nextLiftedState:_}=N.payload,D=(q=_.computedStates.slice(-1)[0])==null?void 0:q.state;if(!D)return;A(p===void 0?D:D[p]),y?.send(null,_);return}case"PAUSE_RECORDING":return S=!S}return}}),T},Bi=Vg,oo=(r,l)=>{let s;try{s=JSON.parse(r)}catch(i){console.error("[zustand devtools middleware] Could not parse the received json",i)}s!==void 0&&l(s)},Yg=r=>(l,s,i)=>{const u=i.subscribe;return i.subscribe=(f,p,g)=>{let h=f;if(p){const y=g?.equalityFn||Object.is;let b=f(i.getState());h=S=>{const A=f(S);if(!y(b,A)){const T=b;p(b=A,T)}},g?.fireImmediately&&p(b,b)}return u(h)},r(l,s,i)},Qg=Yg;function Zg(r,l){let s;try{s=r()}catch{return}return{getItem:u=>{var m;const f=g=>g===null?null:JSON.parse(g,void 0),p=(m=s.getItem(u))!=null?m:null;return p instanceof Promise?p.then(f):f(p)},setItem:(u,m)=>s.setItem(u,JSON.stringify(m,void 0)),removeItem:u=>s.removeItem(u)}}const po=r=>l=>{try{const s=r(l);return s instanceof Promise?s:{then(i){return po(i)(s)},catch(i){return this}}}catch(s){return{then(i){return this},catch(i){return po(i)(s)}}}},Kg=(r,l)=>(s,i,u)=>{let m={storage:Zg(()=>localStorage),partialize:N=>N,version:0,merge:(N,q)=>({...q,...N}),...l},f=!1;const p=new Set,g=new Set;let h=m.storage;if(!h)return r((...N)=>{console.warn(`[zustand persist middleware] Unable to update item '${m.name}', the given storage is currently unavailable.`),s(...N)},i,u);const y=()=>{const N=m.partialize({...i()});return h.setItem(m.name,{state:N,version:m.version})},b=u.setState;u.setState=(N,q)=>{b(N,q),y()};const S=r((...N)=>{s(...N),y()},i,u);u.getInitialState=()=>S;let A;const T=()=>{var N,q;if(!h)return;f=!1,p.forEach(D=>{var G;return D((G=i())!=null?G:S)});const _=((q=m.onRehydrateStorage)==null?void 0:q.call(m,(N=i())!=null?N:S))||void 0;return po(h.getItem.bind(h))(m.name).then(D=>{if(D)if(typeof D.version=="number"&&D.version!==m.version){if(m.migrate){const G=m.migrate(D.state,D.version);return G instanceof Promise?G.then(re=>[!0,re]):[!0,G]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,D.state];return[!1,void 0]}).then(D=>{var G;const[re,F]=D;if(A=m.merge(F,(G=i())!=null?G:S),s(A,!0),re)return y()}).then(()=>{_?.(A,void 0),A=i(),f=!0,g.forEach(D=>D(A))}).catch(D=>{_?.(void 0,D)})};return u.persist={setOptions:N=>{m={...m,...N},N.storage&&(h=N.storage)},clearStorage:()=>{h?.removeItem(m.name)},getOptions:()=>m,rehydrate:()=>T(),hasHydrated:()=>f,onHydrate:N=>(p.add(N),()=>{p.delete(N)}),onFinishHydration:N=>(g.add(N),()=>{g.delete(N)})},m.skipHydration||T(),A||S},Jg=Kg,Sa={"Projectile Magique":{name:"Projectile Magique",level:0,school:"vocation",castingTime:"1 action",range:"36 mtres",description:"Vous crez trois flchettes faites d'nergie magique brillante. Chacune touche une crature de votre choix, situe  porte et dans votre champ de vision. Une flchette inflige 1d4+1 dgts de force  la cible. Toutes les flchettes frappent leur cible en mme temps, sachant que vous pouvez toutes les diriger contre une seule et mme crature ou les rpartir entre plusieurs.",damage:{dice:"1d4",bonus:1,type:"force"},projectiles:3,requiresAttackRoll:!1,castableOutOfCombat:!1,class:["Magicien"]},"Trait de Feu":{name:"Trait de Feu",level:1,school:"vocation",castingTime:"1 action",range:"36 mtres",duration:"instantane",description:"Vous lancez un trait enflamm sur une crature ou un objet  porte. Faites une attaque de sort  distance contre la cible. Si vous touchez, elle subit 1d10 dgts de feu. Si le sort touche un objet inflammable qui n'est ni port ni transport, il s'embrase.",damage:{dice:"1d10",bonus:0,type:"feu"},projectiles:1,requiresAttackRoll:!0,castableOutOfCombat:!1,class:["Magicien"]},"Rayon de givre":{name:"Rayon de givre",level:0,school:"vocation",castingTime:"1 action",range:"18 mtres",description:"Un rayon de lumire d'un blanc bleut file vers une crature  porte. Faites une attaque de sort  distance contre la cible. Si vous la touchez, elle subit 1d8 dgts de froid et sa vitesse est rduite de 3 mtres jusqu'au dbut de votre prochain tour.",damage:{dice:"1d8",bonus:0,type:"froid"},projectiles:1,requiresAttackRoll:!0,castableOutOfCombat:!1,class:["Magicien"]},"Rayon Ardent":{name:"Rayon Ardent",level:2,school:"vocation",castingTime:"1 action",range:"36 mtres",description:"Vous crez trois rayons de feu et les projetez sur des cibles  porte. Vous pouvez les diriger contre une mme cible ou contre des cibles diffrentes. Faites une attaque de sort  distance pour chaque rayon. Si vous touchez, la cible reoit 2d6 dgts.",damage:{dice:"2d6",bonus:0,type:"feu"},projectiles:3,requiresAttackRoll:!0,castableOutOfCombat:!1,class:["Magicien"]},"Boule de Feu":{name:"Boule de Feu",level:2,school:"vocation",castingTime:"1 action",range:"45 mtres",description:"Une boule de feu explose dans une sphre de 6 mtres de rayon centre sur un point  porte. Chaque crature dans la zone doit faire un jet de sauvegarde de Dextrit. En cas d'chec, elle subit 8d6 dgts de feu, ou la moiti en cas de russite.",damage:{dice:"8d6",bonus:0,type:"feu"},areaOfEffect:{shape:"sphere",radius:20},savingThrow:{ability:"dexterite",dc:"spell"},isAreaEffect:!0,saveType:"dexterite",saveDC:null,requiresAttackRoll:!1,castableOutOfCombat:!1,projectiles:1,class:["Magicien"]},"Toile d'araigne":{name:"Toile d'araigne",level:2,school:"Invocation",castingTime:"1 action",range:"18 mtres",description:"Vous invoquez une masse de toiles d'araigne paisses et collantes  un point de votre choix situ  porte. Les toiles remplissent un cube de 6 mtres d'arte  partir de ce point. Les cratures dans la zone sont entraves.",damage:null,areaOfEffect:{shape:"cube",size:20},savingThrow:{ability:"dexterite",dc:"spell"},isAreaEffect:!0,saveType:"dexterite",saveDC:null,effect:"restrained",duration:"1 heure",requiresAttackRoll:!1,castableOutOfCombat:!0,class:["Magicien","Sorcier"]},"Armure du Mage":{name:"Armure du Mage",level:1,school:"Abjuration",castingTime:"1 action",range:"Toucher",description:"Vous touchez une crature consentante et non-vtue d'une armure. Sa Classe d'Armure devient 13 + son modificateur de Dextrit.",requiresAttackRoll:!1,castableOutOfCombat:!0,class:["Magicien"]},Soins:{name:"Soins",level:1,school:"vocation",castingTime:"1 action",range:"Toucher",description:"Une crature que vous touchez rcupre un nombre de points de vie gal  1d8 + votre modificateur de caractristique d'incantation.",healing:{dice:"1d8",bonus:"wisdom"},requiresAttackRoll:!1,targetType:"ally",castableOutOfCombat:!0,class:["barde","clerc","druide","paladin","rodeur"]},Bndiction:{name:"Bndiction",level:1,school:"Enchantement",castingTime:"1 action",range:"9 mtres",duration:"Concentration, jusqu' 1 minute",description:"Vous bnissez jusqu' trois cratures de votre choix  porte. Chaque fois qu'une cible effectue un jet d'attaque ou de sauvegarde avant la fin du sort, elle peut lancer 1d4 et ajouter le rsultat au jet.",buff:{attackBonus:"1d4",saveBonus:"1d4",duration:600},targetType:"ally",maxTargets:3,requiresAttackRoll:!1,castableOutOfCombat:!0,class:["clerc","paladin"]},Sanctuaire:{name:"Sanctuaire",level:1,school:"Abjuration",castingTime:"1 action bonus",range:"9 mtres",duration:"1 minute",description:"Vous protgez une crature  porte contre les attaques. Jusqu' la fin du sort, toute crature qui cible la crature protge avec une attaque ou un sort offensif doit d'abord effectuer un jet de sauvegarde de Sagesse.",buff:{protection:"sanctuary",saveDC:"spell",duration:600},targetType:"ally",requiresAttackRoll:!1,castableOutOfCombat:!0,class:["clerc"]},Aide:{name:"Aide",level:2,school:"Abjuration",castingTime:"1 action",range:"9 mtres",duration:"8 heures",description:"Votre sort renforce vos allis avec endurance et rsolution. Choisissez jusqu' trois cratures  porte. Le maximum de points de vie de chaque cible augmente de 5 pour la dure du sort.",buff:{maxHPBonus:5,duration:28800},maxTargets:3,targetType:"ally",requiresAttackRoll:!1,castableOutOfCombat:!0,class:["clerc","paladin"]},Bouclier:{name:"Bouclier",level:1,school:"Abjuration",castingTime:"1 raction",range:"Personnel",duration:"1 round",description:"Une barrire invisible de force magique apparat et vous protge. Jusqu'au dbut de votre prochain tour, vous avez un bonus de +5  la CA.",buff:{acBonus:5,duration:1},targetType:"self",requiresAttackRoll:!1,castableOutOfCombat:!1,class:["ensorceleur","Magicien"]}},qi={wizard:{name:"Elarion",familyName:"Thalendor",level:1,currentXP:0,race:"Haut Elfe",class:"Magicien",historic:"rudit de l'Acadmie",maxHP:12,currentHP:12,ac:10,initiative:0,speed:"9m",proficiencyBonus:2,hitDice:1,hitDiceType:6,type:"player",stats:{force:10,dexterite:15,constitution:12,intelligence:16,sagesse:13,charisme:12},proficiencies:{saves:["intelligence","sagesse"],skills:["arcane","histoire","investigation","perspicacite"]},weaponProficiencies:["simple"],spellcasting:{ability:"intelligence",spellSlots:{},knownSpells:[],cantrips:["Projectile Magique","Rayon de givre"],preparedSpells:["Armure du Mage"],activeSpells:{}},weapons:["dagger"],inventory:[]},warrior:{name:"Gareth",familyName:"Stonehaven",level:1,currentXP:0,race:"Humain",class:"Guerrier",historic:"Soldat Vtran",maxHP:18,currentHP:18,ac:16,initiative:0,speed:"9m",proficiencyBonus:2,hitDice:1,hitDiceType:10,type:"player",stats:{force:16,dexterite:14,constitution:15,intelligence:10,sagesse:12,charisme:13},proficiencies:{saves:["force","constitution"],skills:["athletisme","intimidation","perception","survie"]},weaponProficiencies:["simple","martial"],armorProficiencies:["light","medium","heavy","shields"],weapons:["longsword","shortbow","heavybow","dagger"],armor:"chainmail",shield:!0,inventory:[]},rogue:{name:"Lyra",familyName:"Copperfoot",level:1,currentXP:0,race:"Halfelin",class:"Roublard",historic:"Criminel",maxHP:14,currentHP:14,ac:13,initiative:0,speed:"7.5m",proficiencyBonus:2,hitDice:1,hitDiceType:8,type:"player",stats:{force:15,dexterite:16,constitution:14,intelligence:13,sagesse:12,charisme:8},proficiencies:{saves:["dexterite","intelligence"],skills:["acrobaties","discretion","escamotage","investigation","perception","persuasion","tromperie"]},weaponProficiencies:["simple","longsword","rapier","shortsword","lightCrossbow"],armorProficiencies:["light"],weapons:["rapier","shortbow","dagger"],armor:"leather",specialAbilities:{sneakAttack:{name:"Attaque Sournoise",description:"1d6 dgts supplmentaires si avantage ou alli adjacent",damage:"1d6",level:1},expertise:{name:"Expertise",description:"Double le bonus de matrise pour certaines comptences",skills:["discretion","escamotage"]}},inventory:[]},paladin:{name:"Elara",familyName:"Brightlance",level:1,currentXP:0,race:"Elfe",class:"Paladin",historic:"Templier",maxHP:16,currentHP:16,ac:18,initiative:0,speed:"9m",proficiencyBonus:2,hitDice:1,hitDiceType:10,type:"player",stats:{force:15,dexterite:12,constitution:14,intelligence:10,sagesse:13,charisme:16},proficiencies:{saves:["force","charisme"],skills:["athletisme","intimidation","medecine","persuasion"]},weaponProficiencies:["simple","martial"],armorProficiencies:["light","medium","heavy","shields"],weapons:["longsword","shield"],armor:"chainmail",shield:!0,inventory:[]}},Ig={1:{1:2},2:{1:3},3:{1:4,2:2},4:{1:4,2:3},5:{1:4,2:3,3:2}},Oe=r=>Math.floor((r-10)/2),zi=r=>Math.floor(Math.random()*r)+1,Fg=()=>zi(20),cl=(r=0)=>Fg()+r,is=r=>{if(!r||!r.includes("d"))return 0;const[l,s]=r.split("d").map(Number);let i=0;for(let u=0;u<l;u++)i+=zi(s);return i},vt=(r,l)=>!r||!l||r.x===void 0||l.x===void 0?1/0:Math.abs(r.x-l.x)+Math.abs(r.y-l.y),Wg=""+new URL("tyrion-Cl-F8-rO.png",import.meta.url).href,ev=""+new URL("rhingann-CamkbPql.png",import.meta.url).href,_o={tyrion:{name:"Tyrion",level:1,race:"Humain",class:"Jeune Guerrier",historic:"Chercheur de Reliques",role:"tank",maxHP:12,currentHP:12,ac:18,initiative:0,speed:"9m",proficiencyBonus:2,hitDice:1,hitDiceType:6,type:"companion",stats:{force:18,dexterite:16,constitution:15,intelligence:13,sagesse:10,charisme:12},movement:6,image:Wg,attacks:[{name:"son pe longue",type:"melee",range:1,description:"Une attaque avec une pe longue",damageDice:"1d8",damageType:"tranchant",stat:"force"}],inventory:[],aiPriority:["protect","taunt","melee_attack"],spellcasting:null},rhingann:{name:"Rhingann",level:1,race:"Naine",class:"Clerc",historic:"",role:"healer",maxHP:13,currentHP:13,ac:14,initiative:0,speed:"9m",proficiencyBonus:2,hitDice:1,hitDiceType:8,type:"companion",stats:{force:14,dexterite:10,constitution:14,intelligence:10,sagesse:18,charisme:10},movement:6,image:ev,attacks:[{name:"son Marteau de guerre",type:"melee",range:1,description:"Une attaque avec un marteau de guerre",damageDice:"1d8",damageType:"contondant",stat:"force"}],inventory:[],aiPriority:["heal","buff","ranged_support"],spellcasting:{class:"Clerc",spellSlots:{1:{total:2,used:0}},knownSpells:["Soins","Bndiction"],preparedSpells:["Soins","Bndiction"],slotsRemaining:{1:2}}},kael:{name:"Kael",level:1,race:"Elfe des bois",class:"Rdeur",historic:"Chasseur Solitaire",role:"tank",maxHP:13,currentHP:13,ac:15,initiative:0,speed:"9m",proficiencyBonus:2,hitDice:1,hitDiceType:10,type:"companion",stats:{force:12,dexterite:16,constitution:12,intelligence:10,sagesse:14,charisme:8},movement:6,image:kp,attacks:[{name:"pe Courte",type:"melee",range:1,description:"Une attaque avec une pe courte.",damageDice:"1d6",damageType:"perforant",stat:"dexterite"}],inventory:[],aiPriority:["ranged_attack","support_skill"],spellcasting:{class:"Rdeur",spellSlots:null,knownSpells:[],preparedSpells:[]}},finn:{name:"Finn",level:1,race:"Gnome",class:"Inventeur",historic:"Gnie Mcanique",role:"support",maxHP:10,currentHP:10,ac:13,initiative:0,speed:"7.5m",proficiencyBonus:2,hitDice:1,hitDiceType:8,type:"companion",stats:{force:8,dexterite:14,constitution:12,intelligence:18,sagesse:13,charisme:11},movement:5,image:Bp,attacks:[{name:"Dague de prcision",type:"melee",range:1,description:"Une dague lgre et prcise",damageDice:"1d4",damageType:"perforant",stat:"dexterite"},{name:"Projectile nergtique",type:"ranged",range:6,description:"Dispositif de tir  nergie concentre",damageDice:"1d6",damageType:"force",stat:"intelligence"}],inventory:["Dtecteur planaire Mark VII","Kit d'inventeur","Composants mcaniques"],aiPriority:["support_skill","ranged_attack","heal"],spellcasting:{class:"Inventeur",spellSlots:{1:{total:1,used:0}},knownSpells:["Dtection de la magie","Rparation"],preparedSpells:["Dtection de la magie","Rparation"],slotsRemaining:{1:1}}},zara:{name:"Zara",level:2,race:"Humaine",class:"Sorcire",historic:"rudite Planaire",role:"dps",maxHP:14,currentHP:14,ac:12,initiative:0,speed:"9m",proficiencyBonus:2,hitDice:2,hitDiceType:6,type:"companion",stats:{force:9,dexterite:13,constitution:14,intelligence:16,sagesse:15,charisme:17},movement:6,image:Pp,attacks:[{name:"Bton mystique",type:"melee",range:1,description:"Un bton imprgn d'nergie magique",damageDice:"1d6",damageType:"contondant",stat:"force"},{name:"Trait de feu",type:"ranged",range:12,description:"Projectile magique enflamm",damageDice:"1d10",damageType:"feu",stat:"charisme"}],inventory:["Grimoire planaire","Composants de sorts","Cristal de focalisation"],aiPriority:["ranged_spell","area_damage","debuff"],spellcasting:{class:"Sorcire",spellSlots:{1:{total:3,used:0},2:{total:1,used:0}},knownSpells:["Trait de feu","Bouclier","Dtection de la magie","Invisibilit","Toile d'araigne"],preparedSpells:["Trait de feu","Bouclier","Dtection de la magie","Invisibilit"],slotsRemaining:{1:3,2:1}}}};class Be{static getProficiencyBonus(l){return Math.ceil(l/4)+1}static getSpellSaveDC(l){if(!l.spellcasting)return 8;const s=this.getSpellcastingAbility(l),i=Oe(l.stats[s]),u=this.getProficiencyBonus(l.level);return 8+i+u}static getSpellcastingAbility(l){return l.spellcasting?l.spellcasting.ability||(()=>{switch(l.class){case"Magicien":return"intelligence";case"Clerc":return"sagesse";case"Barde":return"charisme";case"Rdeur":case"Paladin":return"sagesse";case"Sorcier":case"Occultiste":return"charisme";default:return"intelligence"}})():"intelligence"}static getAttackBonus(l,s){const i=this.getProficiencyBonus(l.level);switch(s.actionType){case"spell":const u=this.getSpellcastingAbility(l);return Oe(l.stats[u])+i;case"weapon":let m=s.stat||"force";if(s.properties?.includes("finesse")){const g=Oe(l.stats.force);m=Oe(l.stats.dexterite)>g?"dexterite":"force"}const p=this.isWeaponProficient(l,s)?i:0;return Oe(l.stats[m])+p;default:return 0}}static isWeaponProficient(l,s){if(!l.weaponProficiencies)return!1;if(l.weaponProficiencies.includes(s.id))return!0;const i=["dagger","club","quarterstaff","lightCrossbow","shortbow"].includes(s.id);return!!(i&&l.weaponProficiencies.includes("simple")||!i&&l.weaponProficiencies.includes("martial"))}static levelUp(l){const s=l.level+1;if(s>20)return l;const i=this.getHitDie(l.class),u=Oe(l.stats.constitution),m=Math.max(1,zi(i)+u),f={...l,level:s,maxHP:l.maxHP+m,currentHP:l.currentHP+m,currentXP:l.currentXP||l.experience||0,proficiencyBonus:this.getProficiencyBonus(s)};if(l.spellcasting){const p=this.generateSpellSlotsForLevel(s,l.class);f.spellcasting={...l.spellcasting,spellSlots:p}}return f}static generateSpellSlotsForLevel(l,s){const i={1:{1:{max:2,used:0}},2:{1:{max:3,used:0}},3:{1:{max:4,used:0},2:{max:2,used:0}},4:{1:{max:4,used:0},2:{max:3,used:0}},5:{1:{max:4,used:0},2:{max:3,used:0},3:{max:2,used:0}}};return s==="Magicien"||s==="Clerc"?i[l]||{}:{}}static getHitDie(l){return{Guerrier:10,Magicien:6,Roublard:8,Clerc:8,Rdeur:10,Paladin:10}[l]||8}static shortRest(l,s=0){if(s<=0)return l;const i=this.getHitDie(l.class),u=Oe(l.stats.constitution);let m=0;const f=l.hitDice||Math.floor(l.level/2),p=Math.min(s,f);for(let g=0;g<p;g++)m+=Math.max(1,zi(i)+u);return{...l,currentHP:Math.min(l.maxHP,l.currentHP+m),hitDice:f-p}}static longRest(l){const s={...l,currentHP:l.maxHP,hitDice:l.level};return l.spellcasting&&(s.spellcasting={...l.spellcasting,slotsRemaining:{...l.spellcasting.slotsTotal}}),s}static takeDamage(l,s){return{...l,currentHP:Math.max(0,l.currentHP-s)}}static heal(l,s){return{...l,currentHP:Math.min(l.maxHP,l.currentHP+s)}}static consumeSpellSlot(l,s){if(!l.spellcasting||s<=0)return l;const i=l.spellcasting.slotsRemaining[s]||0;return i<=0?l:{...l,spellcasting:{...l.spellcasting,slotsRemaining:{...l.spellcasting.slotsRemaining,[s]:i-1}}}}static addExperience(l,s){const u=(l.currentXP||l.experience||0)+s;return this.processLevelUps({...l,currentXP:u})}static processLevelUps(l){let s={...l},i=0;const u=10,m=20;for(;i<u&&s.level<m;){const f=this.getXPToNextLevel(s.level);if(s.currentXP>=f){const p=s.level;if(s=this.levelUp(s),s.level<=p){console.error(` Level up failed to increase level (${p}  ${s.level})`);break}i++}else break}return i>=u&&console.warn(" Limite de montes de niveau atteinte pour viter une boucle infinie"),s}static getXPForLevel(l){return[0,300,900,2700,6500,14e3,23e3,34e3,48e3,64e3,85e3][l-1]||0}static getXPToNextLevel(l){return this.getXPForLevel(l+1)}}class It{static processSceneAction(l,s){if(typeof l=="string")return l;if(typeof l=="object")switch(l.type){case"combat":return this.processCombatAction(l);case"longRest":return this.processRestAction(l,s,"long");case"shortRest":return this.processRestAction(l,s,"short");case"item":return this.processItemAction(l,s);case"ally":return this.processAllyAction(l,s);case"skillCheck":return this.processSkillCheck(l,s);default:return console.warn("Type d'action inconnu :",l.type),null}return null}static processCombatAction(l){return{...l,enemies:l.enemies,enemyPositions:l.enemyPositions,next:l.next}}static processRestAction(l,s,i){return i==="long"?s.startLongRest(l.nextScene):s.startShortRest(l.nextScene),null}static processItemAction(l,s){return s.handleItemGain(l.item),l.nextScene}static processAllyAction(l,s){const i=_o[l.ally];return i?(s.setPlayerCompanion(i),s.addCombatMessage(`${i.name} te rejoint dans ton aventure !`,"upgrade"),l.nextScene):(console.error(`Compagnon '${l.ally}' introuvable.`),null)}static processSkillCheck(l,s){return s.handleSkillCheck(l.skill,l.dc,l.onSuccess,l.onPartialSuccess,l.onFailure),null}static performSkillCheck(l,s,i){const m=this.getSkillAbilityMapping()[s]||"force",f=getModifier(l.stats[m]),p=Be.getProficiencyBonus(l.level),g=l.skillProficiencies?.includes(s)||!1,h=f+(g?p:0),y=cl(h);return{roll:y,total:y,dc:i,success:y>=i,skill:s,ability:m,modifier:h,proficient:g}}static getSkillAbilityMapping(){return{Acrobaties:"dexterite",Arcanes:"intelligence",Athletisme:"force",Discrtion:"dexterite",Dressage:"sagesse",Escamotage:"dexterite",Histoire:"intelligence",Insight:"sagesse",Intimidation:"charisme",Investigation:"intelligence",Mdecine:"sagesse",Nature:"intelligence",Perception:"sagesse",Persuasion:"charisme",Religion:"intelligence",Representation:"charisme",Survie:"sagesse",Tromperie:"charisme"}}static calculateCombatExperience(l,s=1){const i=l.reduce((u,m)=>u+({0:10,"1/8":25,"1/4":50,"1/2":100,1:200,2:450,3:700,4:1100,5:1800}[m.challengeRating]||100),0);return Math.floor(i/s)}static processCombatRewards(l,s,i=null){const u=i?2:1,m=this.calculateCombatExperience(l,u),f={xpGained:m,messages:[],leveledUp:!1},p=Be.getXPToNextLevel(s.level);return s.experience+m>=p&&(f.leveledUp=!0,f.messages.push(`${s.name} gagne un niveau !`)),f.messages.push(`+${m} XP`),f}static isChoiceAvailable(l,s){return l.conditions?l.conditions.every(i=>{switch(i.type){case"hasItem":return s.playerCharacter.inventory.some(m=>m.id===i.itemId);case"hasCompanion":return s.playerCompanion!==null;case"minLevel":return s.playerCharacter.level>=i.level;case"hasSpell":return[...s.playerCharacter.spellcasting?.cantrips||[],...s.playerCharacter.spellcasting?.preparedSpells||[]].includes(i.spellName);case"statCheck":return s.playerCharacter.stats[i.stat]>=i.value;default:return!0}}):!0}static generateId(l="id"){return`${l}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}static deepClone(l){if(l===null||typeof l!="object")return l;if(l instanceof Date)return new Date(l.getTime());if(l instanceof Array)return l.map(i=>this.deepClone(i));const s={};for(const i in l)l.hasOwnProperty(i)&&(s[i]=this.deepClone(l[i]));return s}}const tv={hasSymbol:!1,manuscriptRead:!1,bridgeSecretFound:!1,tyrionMet:!1,tyrionRejected:!1,tyrionDelayed:!1,rhingannMet:!1,completedGoblinQuest:!1,visitedTavern:!1,coldWeather:!1,questActive:!1,reputation:0,companions:[],completedQuests:[],visitedLocations:[],majorChoices:[],npcRelations:{tyrion:0,aldric:0,rhingann:0},tutorialCompleted:!1,firstCombat:!0,discoveredSecrets:[],learnedSpells:[],lastTavernVisit:null,currentWeather:"clear",pacifistRun:!0,perfectDiplomat:!0,treasureHunter:0,academyReturns:0,tavernRoomKey:!1,aldricTrust:0},rt={getInitialFlags:()=>({...tv}),hasFlag:(r,l)=>r.hasOwnProperty(l),getFlag:(r,l,s=!1)=>r[l]??s,setFlag:(r,l,s)=>({...r,[l]:s}),setFlags:(r,l)=>({...r,...l}),addToList:(r,l,s)=>{const i=r[l]||[];return i.includes(s)?r:{...r,[l]:[...i,s]}},removeFromList:(r,l,s)=>{const i=r[l]||[];return{...r,[l]:i.filter(u=>u!==s)}},updateNpcRelation:(r,l,s)=>{const i=r.npcRelations?.[l]||0,u=Math.max(-100,Math.min(100,i+s));return{...r,npcRelations:{...r.npcRelations,[l]:u}}},updateReputation:(r,l)=>{const s=Math.max(-100,Math.min(100,(r.reputation||0)+l));return{...r,reputation:s}},addMajorChoice:(r,l,s,i)=>{const u={id:l,description:s,sceneId:i,timestamp:Date.now()};return{...r,majorChoices:[...r.majorChoices||[],u]}},visitLocation:(r,l)=>rt.addToList(r,"visitedLocations",l),completeQuest:(r,l)=>rt.addToList(r,"completedQuests",l),isQuestCompleted:(r,l)=>(r.completedQuests||[]).includes(l),getNpcRelation:(r,l)=>r.npcRelations?.[l]||0,getNpcRelationStatus:(r,l)=>{const s=rt.getNpcRelation(r,l);return s>=75?"Ador":s>=50?"Ami proche":s>=25?"Ami":s>=10?"Sympathique":s>=-10?"Neutre":s>=-25?"Mfiant":s>=-50?"Hostile":s>=-75?"Ennemi":"Ennemi jur"},debugFlags:r=>{console.group(" Game Flags Debug"),console.log("Reputation:",r.reputation),console.log("Companions:",r.companions),console.log("NPC Relations:",r.npcRelations),console.log("Completed Quests:",r.completedQuests),console.log("Visited Locations:",r.visitedLocations),console.log("Major Choices:",r.majorChoices),console.groupEnd()}},av={acrobaties:"dexterite",arcane:"intelligence",athletisme:"force",discretion:"dexterite",dressage:"sagesse",escamotage:"dexterite",histoire:"intelligence",intimidation:"charisme",intuition:"sagesse",investigation:"intelligence",medecine:"sagesse",nature:"intelligence",perception:"sagesse",persuasion:"charisme",religion:"intelligence",representation:"charisme",survie:"sagesse",tromperie:"charisme"},yt=ki(Bi((r,l)=>({gamePhase:"character-selection",currentScene:"forteresse_ruines",sceneHistory:[],combatLog:[],isShortResting:!1,isLongResting:!1,nextSceneAfterRest:null,combatKey:0,gameMessages:[],gameFlags:rt.getInitialFlags(),setGamePhase:s=>r({gamePhase:s}),setCurrentScene:s=>r(i=>({currentScene:s,sceneHistory:[...i.sceneHistory,i.currentScene]})),goToPreviousScene:()=>r(s=>s.sceneHistory.length>0?{currentScene:s.sceneHistory[s.sceneHistory.length-1],sceneHistory:s.sceneHistory.slice(0,-1)}:s),addCombatMessage:(s,i="default")=>r(u=>({combatLog:[...u.combatLog,{id:It.generateId("msg"),message:s,type:i,timestamp:new Date}]})),clearCombatLog:()=>r({combatLog:[]}),addGameMessage:(s,i="info")=>r(u=>({gameMessages:[...u.gameMessages,{id:It.generateId("game-msg"),message:s,type:i,timestamp:new Date}]})),clearGameMessages:()=>r({gameMessages:[]}),startShortRest:s=>r({isShortResting:!0,nextSceneAfterRest:s}),endShortRest:()=>r(s=>({isShortResting:!1,currentScene:s.nextSceneAfterRest,nextSceneAfterRest:null})),startLongRest:s=>r({isLongResting:!0,nextSceneAfterRest:s}),endLongRest:()=>r(s=>({isLongResting:!1,currentScene:s.nextSceneAfterRest,nextSceneAfterRest:null})),incrementCombatKey:()=>r(s=>({combatKey:s.combatKey+1})),handleSkillCheck:(s,i,u,m,f,p)=>{const g=av[s],h=p.stats[g],y=Oe(h),S=p.proficiencies?.skills?.includes(s)||!1?p.proficiencyBonus:0,A=y+S,T=cl(A),N=T,{addCombatMessage:q,setCurrentScene:_}=l();q(`Test de ${s} (${g}): ${T-A} (+${A} de bonus) = ${N}. DD: ${i}`,"skill-check");let D=f;N>=i?(D=u,q(" Russite !","success")):N>=i-5&&m?(D=m,q(" Russite partielle","partial")):(D=f,q(" chec","failure")),_(D)},updateSpellSlotsForLevel:s=>{if(!s.spellcasting)return s;const i=l().getSpellSlotsForLevel(s.level,s.class),u=l().getKnownSpells(s.level,s.class);return{...s,spellcasting:{...s.spellcasting,spellSlots:i,knownSpells:u}}},getSpellSlotsForLevel:(s,i)=>{let u=s;switch(i){case"Magicien":break;case"Paladin":case"Rdeur":u=Math.max(0,Math.floor((s-1)/2));break;case"Guerrier":if(s>=3)u=Math.max(0,Math.floor((s-2)/3));else return{};break;case"Roublard":if(s>=3)u=Math.max(0,Math.floor((s-2)/3));else return{};break;default:return{}}const m=Ig[u];if(!m)return{};const f={};for(const p in m)f[p]={total:m[p],used:0};return f},getKnownSpells:(s,i)=>{const u=l().getSpellSlotsForLevel(s,i),m=u?Math.max(...Object.keys(u).map(Number)):0,f=Object.values(Sa).filter(h=>{switch(i){case"Magicien":return!0;case"Guerrier":return h.school==="Abjuration"||h.school==="vocation"||h.level===0;case"Roublard":return h.school==="Enchantement"||h.school==="Illusion"||h.level===0;default:return!1}}),p=f.filter(h=>h.level===0).map(h=>h.name),g=f.filter(h=>h.level>0&&h.level<=m).map(h=>h.name);return[...p,...g]},setFlag:(s,i)=>r(u=>({gameFlags:rt.setFlag(u.gameFlags,s,i)})),setFlags:s=>r(i=>({gameFlags:rt.setFlags(i.gameFlags,s)})),getFlag:(s,i=!1)=>{const u=l();return rt.getFlag(u.gameFlags,s,i)},addToList:(s,i)=>r(u=>({gameFlags:rt.addToList(u.gameFlags,s,i)})),removeFromList:(s,i)=>r(u=>({gameFlags:rt.removeFromList(u.gameFlags,s,i)})),updateNpcRelation:(s,i)=>r(u=>({gameFlags:rt.updateNpcRelation(u.gameFlags,s,i)})),getNpcRelation:s=>{const i=l();return rt.getNpcRelation(i.gameFlags,s)},getNpcRelationStatus:s=>{const i=l();return rt.getNpcRelationStatus(i.gameFlags,s)},updateReputation:s=>r(i=>({gameFlags:rt.updateReputation(i.gameFlags,s)})),addMajorChoice:(s,i,u=null)=>r(m=>{const f=u||m.currentScene;return{gameFlags:rt.addMajorChoice(m.gameFlags,s,i,f)}}),visitLocation:s=>r(i=>({gameFlags:rt.visitLocation(i.gameFlags,s)})),completeQuest:s=>r(i=>({gameFlags:rt.completeQuest(i.gameFlags,s)})),isQuestCompleted:s=>{const i=l();return rt.isQuestCompleted(i.gameFlags,s)},getGameState:()=>{const s=l();return{flags:s.gameFlags,character:null,currentScene:s.currentScene}},applyConsequences:async s=>{if(!s)return;const{setFlags:i,updateReputation:u,addToList:m,updateNpcRelation:f,addMajorChoice:p,visitLocation:g}=l();if(s.flags&&i(s.flags),typeof s.reputation=="number"&&u(s.reputation),s.visitLocation&&g(s.visitLocation),s.items&&Array.isArray(s.items))try{Ai(async()=>{const{useCharacterStore:h}=await Promise.resolve().then(()=>qp);return{useCharacterStore:h}},void 0,import.meta.url).then(({useCharacterStore:h})=>{const{addItemToInventory:y}=h.getState();s.items.forEach(b=>{Promise.all([Ai(()=>Promise.resolve().then(()=>nv),void 0,import.meta.url),Ai(()=>Promise.resolve().then(()=>lv),void 0,import.meta.url)]).then(([{items:S},{weapons:A}])=>{let T=S[b];if(T||(T=A[b]),T){const N={...T,id:b};y(N),console.log(` Objet obtenu : ${T.name}`)}else console.error(` Item non trouv dans items.js ou weapons.js : ${b}`)}).catch(S=>{console.error("Erreur lors du chargement des donnes d'items:",S)})})}).catch(h=>{console.error("Erreur lors de l'ajout d'items:",h)})}catch(h){console.error("Erreur lors de l'ajout d'items:",h)}if(s.companions&&Array.isArray(s.companions))try{const{useCharacterStore:h}=await Ai(async()=>{const{useCharacterStore:A}=await Promise.resolve().then(()=>qp);return{useCharacterStore:A}},void 0,import.meta.url),{addCompanion:y,setActiveCompanions:b}=h.getState(),{addCombatMessage:S}=l();s.companions.forEach(A=>{m("companions",A);const T=_o[A];if(T){const N={...T,id:A.toLowerCase()};y(N);const _=[...h.getState().activeCompanions||[],N.id];b(_),S(`${T.name} te rejoint dans ton aventure !`,"upgrade")}else console.error(` Compagnon '${A}' introuvable dans companions.js`)})}catch(h){console.error("Erreur lors du recrutement du compagnon:",h)}s.npcRelations&&Object.entries(s.npcRelations).forEach(([h,y])=>{f(h,y)}),s.majorChoice&&p(s.majorChoice.id,s.majorChoice.description,s.majorChoice.sceneId)},debugFlags:()=>{const s=l();rt.debugFlags(s.gameFlags)}}),{name:"game-store"}));class ul{getSpellAttackBonus(l){if(!l.spellcasting)return 0;const s=l.spellcasting.ability||"intelligence",i=Oe(l.stats[s]),u=this.getProficiencyBonus(l.level);return i+u}getSpellSaveDC(l){if(!l.spellcasting)return 8;const s=l.spellcasting.ability||"intelligence",i=Oe(l.stats[s]),u=this.getProficiencyBonus(l.level);return 8+i+u}getProficiencyBonus(l){return Math.ceil(l/4)+1}getKnownSpells(l){return l.spellcasting?.knownSpells?l.spellcasting.knownSpells.map(s=>this.getSpellData(s)).filter(Boolean).filter(s=>s.level>0):[]}getPreparedSpells(l){return l.spellcasting?.preparedSpells?l.spellcasting.preparedSpells.map(s=>{const i=this.getSpellData(s);return i&&this.isSpellAvailableForClass(i,l)?i:null}).filter(Boolean):[]}getCantrips(l){return l.spellcasting?.cantrips?l.spellcasting.cantrips.map(s=>this.getSpellData(s)).filter(Boolean):[]}getMaxPreparedSpells(l){if(!l.spellcasting)return 0;const s=l.spellcasting.ability||"intelligence";return Math.max(1,Oe(l.stats[s]))+l.level}getSpellSlots(l){return!l.spellcasting?.spellSlots||Object.keys(l.spellcasting.spellSlots).length===0?this.generateDefaultSpellSlots(l):l.spellcasting.spellSlots}generateDefaultSpellSlots(l){const s={},i=l.level,m={1:{1:2},2:{1:3},3:{1:4,2:2},4:{1:4,2:3},5:{1:4,2:3,3:2},6:{1:4,2:3,3:3},7:{1:4,2:3,3:3,4:1},8:{1:4,2:3,3:3,4:2},9:{1:4,2:3,3:3,4:3,5:1},10:{1:4,2:3,3:3,4:3,5:2},11:{1:4,2:3,3:3,4:3,5:2,6:1},12:{1:4,2:3,3:3,4:3,5:2,6:1},13:{1:4,2:3,3:3,4:3,5:2,6:1,7:1},14:{1:4,2:3,3:3,4:3,5:2,6:1,7:1},15:{1:4,2:3,3:3,4:3,5:2,6:1,7:1,8:1},16:{1:4,2:3,3:3,4:3,5:2,6:1,7:1,8:1},17:{1:4,2:3,3:3,4:3,5:2,6:1,7:1,8:1,9:1},18:{1:4,2:3,3:3,4:3,5:3,6:1,7:1,8:1,9:1},19:{1:4,2:3,3:3,4:3,5:3,6:2,7:1,8:1,9:1},20:{1:4,2:3,3:3,4:3,5:3,6:2,7:2,8:1,9:1}}[Math.min(i,20)]||{};for(const[f,p]of Object.entries(m))s[f]={max:p,used:0,available:p};return s}getSpellData(l){if(Sa[l])return{id:l,...Sa[l]};const s=Object.entries(Sa).find(([i,u])=>u.name===l||u.name?.toLowerCase()===l?.toLowerCase());return s?{id:s[0],...s[1]}:null}filterSpells(l,s){return l.filter(i=>{if(s.school!=="all"&&i.school!==s.school)return!1;if(s.level!=="all"){const u=parseInt(s.level);if(i.level!==u)return!1}if(s.searchTerm){const u=s.searchTerm.toLowerCase(),m=i.name?.toLowerCase().includes(u),f=i.description?.toLowerCase().includes(u),p=i.school?.toLowerCase().includes(u);if(!m&&!f&&!p)return!1}return s.castableOnly&&i.level===0,!0})}sortSpells(l,s="level"){return[...l].sort((i,u)=>{switch(s){case"name":return(i.name||"").localeCompare(u.name||"");case"level":return i.level!==u.level?i.level-u.level:(i.name||"").localeCompare(u.name||"");case"school":return i.school!==u.school?(i.school||"").localeCompare(u.school||""):(i.name||"").localeCompare(u.name||"");case"range":return this.compareRange(i.range,u.range);default:return 0}})}compareRange(l,s){const i=u=>!u||u==="Personnel"?0:u==="Contact"?1:u.includes("mtres")?parseInt(u.match(/\d+/)?.[0]||"0"):999999;return i(l)-i(s)}canCastSpell(l,s,i=null){if(!l||!s.spellcasting)return!1;if(l.level===0)return!0;const u=this.getSpellSlots(s),m=i||l.level;for(let f=m;f<=9;f++){const p=u[f];if(p&&p.available>0)return!0}return!1}getAvailableCastingLevels(l,s){if(l.level===0)return[0];const i=this.getSpellSlots(s),u=[];for(let m=l.level;m<=9;m++){const f=i[m];f&&f.available>0&&u.push(m)}return u}calculateSpellDamage(l,s){if(!l.damage)return null;const i=l.damage,u=Math.max(0,s-l.level);return l.scalingDamage&&u>0?i+l.scalingDamage*u:i}getSchoolsOfMagic(){return["Abjuration","Invocation","Divination","Enchantement","vocation","Illusion","Ncromancie","Transmutation"]}getGrimoireSpells(l){if(!l.spellcasting)return[];const s=[];return Object.entries(Sa).forEach(([i,u])=>{this.isSpellAvailableForClass(u,l)&&s.push({id:i,...u,isPrepared:l.spellcasting.preparedSpells?.includes(i)||!1})}),this.sortSpells(s,"level")}getUnpreparedSpells(l){if(!l.spellcasting)return[];const s=this.getGrimoireSpells(l),i=l.spellcasting.preparedSpells||[];return s.filter(u=>u.level>0&&!i.includes(u.id))}isSpellAvailableForClass(l,s){if(!l.class||!Array.isArray(l.class)||!l.class.includes(s.class))return!1;if(l.level===0)return s.level>=1;const i={1:1,2:3,3:5,4:7,5:9,6:11,7:13,8:15,9:17};return s.level>=(i[l.level]||20)}isSpellActive(l,s){return s.activeEffects?s.activeEffects.some(u=>u.sourceSpellId===l||u.name===l):!1}canPrepareSpell(l,s){if(!s.spellcasting||s.spellcasting.preparedSpells?.includes(l))return!1;const i=s.spellcasting.preparedSpells?.length||0,u=this.getMaxPreparedSpells(s);if(i>=u)return!1;const m=this.getSpellData(l);return!m||m.level===0?!1:this.isSpellAvailableForClass(m,s)}canUnprepareSpell(l,s){return s.spellcasting?.preparedSpells?s.spellcasting.preparedSpells.includes(l):!1}}class Mi{static castSpell(l,s,i=[],u={}){const m={success:!1,character:l,messages:[],effects:[]},f=this.validateSpellcast(l,s);if(!f.success)return m.messages.push(f.message),m;s.level>0&&(m.character=this.consumeSpellSlot(m.character,s.level));const p=this.processSpellEffects(s,i,l,u);return m.effects=p.effects,m.messages=[...m.messages,...p.messages],m.character=this.applySpellEffectsToCharacter(m.character,s,p),m.success=!0,m}static validateSpellcast(l,s){if(!l.spellcasting)return{success:!1,message:"Ce personnage ne peut pas lancer de sorts"};if(![...l.spellcasting.cantrips||[],...l.spellcasting.preparedSpells||[]].includes(s.id))return{success:!1,message:"Sort non prpar"};if(s.level>0){const m=new ul().getSpellSlots(l);let f=!1;for(let p=s.level;p<=9;p++){const g=m[p];if(g&&g.available>0){f=!0;break}}if(!f)return{success:!1,message:"Aucun emplacement de sort disponible"}}return{success:!0}}static processSpellEffects(l,s,i,u={}){const m={effects:[],messages:[]};if(l.damage){const f=this.processDamageSpell(l,s,i,u);m.effects.push(...f.effects),m.messages.push(...f.messages)}if(l.healing){const f=this.processHealingSpell(l,s,i,u);m.effects.push(...f.effects),m.messages.push(...f.messages)}if(l.effects){const f=this.processUtilitySpell(l,s,i,u);m.effects.push(...f.effects),m.messages.push(...f.messages)}return m}static processDamageSpell(l,s,i,u){const m={effects:[],messages:[]};return s.forEach(f=>{let p=is(l.damage.dice)+(l.damage.bonus||0);if(u.spellLevel&&u.spellLevel>l.level){const g=u.spellLevel-l.level;if(l.damage.scaling){const h=is(l.damage.scaling)*g;p+=h}}m.effects.push({type:"damage",target:f,amount:p,damageType:l.damage.type}),m.messages.push(`${f.name} subit ${p} dgts ${l.damage.type} de ${l.name}`)}),m}static processHealingSpell(l,s,i,u){const m={effects:[],messages:[]};return s.forEach(f=>{let p=is(l.healing.dice)+(l.healing.bonus||0);if(u.spellLevel&&u.spellLevel>l.level){const g=u.spellLevel-l.level;if(l.healing.scaling){const h=is(l.healing.scaling)*g;p+=h}}m.effects.push({type:"healing",target:f,amount:p}),m.messages.push(`${f.name} rcupre ${p} points de vie grce  ${l.name}`)}),m}static processUtilitySpell(l,s,i,u){const m={effects:[],messages:[]};return l.effects.forEach(f=>{switch(f.type){case"ac_bonus":s.forEach(p=>{m.effects.push({type:"ac_modifier",target:p,modifier:f.value,duration:l.duration}),m.messages.push(`${p.name} gagne +${f.value} CA grce  ${l.name}`)});break;case"advantage":s.forEach(p=>{m.effects.push({type:"advantage",target:p,category:f.category,duration:l.duration}),m.messages.push(`${p.name} a l'avantage sur ${f.category} grce  ${l.name}`)});break;case"condition":s.forEach(p=>{m.effects.push({type:"condition",target:p,condition:f.condition,duration:l.duration}),m.messages.push(`${p.name} est affect par ${f.condition} (${l.name})`)});break;default:console.warn(`Unknown spell effect type: ${f.type}`)}}),m}static getAvailableSpellSlots(l){return l.spellcasting?l.spellcasting.slotsRemaining||{}:{}}static applySpellEffectsToCharacter(l,s,i){let u={...l};if(s.name==="Armure du Mage"){const f=13+Math.floor((l.stats.dexterite-10)/2);u={...u,ac:f,armorClass:f,activeEffects:[...l.activeEffects||[],{id:`armure_du_mage_${Date.now()}`,sourceSpellId:"Armure du Mage",name:"Armure du Mage",type:"spell_effect",description:"CA = 13 + modificateur de Dextrit",startTime:new Date}]}}return i.effects.forEach(m=>{if(m.target===l||m.target?.id===l.id)switch(m.type){case"ac_modifier":u.armorClass=(u.armorClass||10)+m.modifier;break;case"healing":u.currentHP=Math.min(u.maxHP,u.currentHP+m.amount);break}}),u}static consumeSpellSlot(l,s){if(!l.spellcasting||s<=0)return l;const u=new ul().getSpellSlots(l);let m=null;for(let p=s;p<=9;p++){const g=u[p];if(g&&g.available>0){m=p;break}}if(!m)return l;const f={...u,[m]:{...u[m],used:u[m].used+1,available:u[m].available-1}};return{...l,spellcasting:{...l.spellcasting,spellSlots:f}}}static getPreparedSpells(l){return l.spellcasting?[...l.spellcasting.cantrips||[],...l.spellcasting.preparedSpells||[]]:[]}static getMaxPreparedSpells(l){if(!l.spellcasting)return 0;const s=Be.getSpellcastingAbility(l),i=Math.max(1,Oe(l.stats[s]));return l.level+i}static prepareSpell(l,s){if(!l.spellcasting)return null;const i=l.spellcasting.preparedSpells||[],u=this.getMaxPreparedSpells(l);return i.includes(s)?l:i.length>=u?null:{...l,spellcasting:{...l.spellcasting,preparedSpells:[...i,s]}}}static unprepareSpell(l,s){if(!l.spellcasting)return l;const i=l.spellcasting.preparedSpells||[];return{...l,spellcasting:{...l.spellcasting,preparedSpells:i.filter(u=>u!==s)}}}}const hn={potionOfHealing:{name:"Potion de Soin",description:"Restaure 2d4 + 2 PV.",type:"consumable",iconType:"heal",weight:.5,use:r=>{const l=Math.floor(Math.random()*4)+1+Math.floor(Math.random()*4)+1+2,s=Math.min(r.maxHP,r.currentHP+l);return{...r,currentHP:s}},message:r=>`Tu as bu une Potion de Soin et rcupres ${r} PV.`},potionOfSuperiorHealing:{name:"Potion de Soin Suprieure",description:"Restaure 4d4 + 4 PV.",type:"consumable",iconType:"heal",weight:.5,use:r=>{let l=0;for(let i=0;i<4;i++)l+=Math.floor(Math.random()*4)+1;l+=4;const s=Math.min(r.maxHP,r.currentHP+l);return{...r,currentHP:s}},message:r=>`Tu as bu une Potion de Soin Suprieure et rcupres ${r} PV.`},scrollOfStrength:{name:"Parchemin de Force",description:"Augmente ta Force de 2 de manire permanente.",type:"consumable",iconType:"upgrade",weight:.1,use:r=>({...r,stats:{...r.stats,force:r.stats.force+2}}),message:()=>"Tu as lu un Parchemin de Force et te sens plus puissant !"},scrollOfDexterity:{name:"Parchemin d'Agilit",description:"Augmente ta Dextrit de 2 de manire permanente.",type:"consumable",iconType:"upgrade",weight:.1,use:r=>({...r,stats:{...r.stats,dexterite:r.stats.dexterite+2}}),message:()=>"Tu as lu un Parchemin d'Agilit et te sens plus agile !"},scrollOfConstitution:{name:"Parchemin de Vitalit",description:"Augmente ta Constitution de 2 de manire permanente et tes PV maximum de 2.",type:"consumable",iconType:"upgrade",weight:.1,use:r=>({...r,stats:{...r.stats,constitution:r.stats.constitution+2},maxHP:r.maxHP+2,currentHP:r.currentHP+2}),message:()=>"Tu as lu un Parchemin de Vitalit, ton corps se renforce et tu gagnes des PV !"},scrollOfIntelligence:{name:"Parchemin d'Intelligence",description:"Augmente ton Intelligence de 2 de manire permanente.",type:"consumable",iconType:"upgrade",rarity:"lgendaire",weight:.1,use:r=>({...r,stats:{...r.stats,intelligence:r.stats.intelligence+2}}),message:()=>"Tu as lu un Parchemin d'Intelligence et tes facults augmentent !"},scrollOfSagesse:{name:"Parchemin de Sagesse",description:"Augmente ta Sagesse de 2 de manire permanente.",type:"consumable",iconType:"upgrade",weight:.1,use:r=>({...r,stats:{...r.stats,sagesse:r.stats.sagesse+2}}),message:()=>"Tu as lu un Parchemin de Sagesse et te sens plus sae !"},bookArtHeal:{name:"Livre l'art de la prestidigitation",description:"C'est un jolie livre vous devriez le lire",type:"consumable",iconType:"heal",weight:.8,use:r=>{const s=Math.min(r.maxHP,r.currentHP+2);return{...r,currentHP:s}},message:()=>"Tu as lu ce livre pendant une heure et tu t'es un peu repos, tu as rcuperer 2PV"}},nv=Object.freeze(Object.defineProperty({__proto__:null,items:hn},Symbol.toStringTag,{value:"Module"})),ja={dagger:{name:"Dague",id:"dagger",type:"weapon",category:"melee",damage:{dice:"1d4",bonus:0,type:"force"},damageType:"perforant",properties:["finesse","light","thrown"],range:{melee:1,thrown:"20/60"},stat:"force",description:"Une petite lame facile  manier."},club:{name:"Gourdin",id:"club",type:"weapon",category:"melee",damage:{dice:"1d4",bonus:0,type:"force"},damageType:"contondant",properties:["light"],range:{melee:1},stat:"force",description:"Un simple bton de bois."},quarterstaff:{name:"Bton",id:"quarterstaff",type:"weapon",category:"melee",damage:{dice:"1d6",bonus:0,type:"force"},damageType:"contondant",properties:["versatile"],range:{melee:1},stat:"force",description:"Un bton solide pouvant tre mani  une ou deux mains."},longsword:{name:"pe longue",id:"longsword",type:"weapon",category:"melee",damage:{dice:"1d8",bonus:0,type:"force"},damageType:"tranchant",properties:["versatile"],range:{melee:1},stat:"force",description:"Une pe classique, quilibre et polyvalente."},shortsword:{name:"pe courte",id:"shortsword",type:"weapon",category:"melee",damage:{dice:"1d6",bonus:0,type:"force"},damageType:"perforant",properties:["finesse","light"],range:{melee:1},stat:"force",description:"Une lame courte et rapide."},rapier:{name:"Rapire",id:"rapier",type:"weapon",category:"melee",damage:{dice:"1d8",bonus:0,type:"dexterite"},damageType:"perforant",properties:["finesse"],range:{melee:1},stat:"dexterite",description:"Une pe d'estoc lgante et prcise."},battleaxe:{name:"Hache de bataille",id:"battleaxe",type:"weapon",category:"melee",damage:{dice:"1d8",bonus:0,type:"force"},damageType:"tranchant",properties:["versatile"],range:{melee:1},stat:"force",description:"Une hache lourde et tranchante."},warhammer:{name:"Marteau de guerre",id:"warhammer",type:"weapon",category:"melee",damage:{dice:"1d8",bonus:0,type:"force"},damageType:"contondant",properties:["versatile"],range:{melee:1},stat:"force",description:"Un marteau lourd conu pour le combat."},greatsword:{name:"pe  deux mains",id:"greatsword",type:"weapon",category:"melee",damage:{dice:"2d6",bonus:0,type:"force"},damageType:"tranchant",properties:["heavy","two-handed"],range:{melee:1},stat:"force",description:"Une pe massive ncessitant les deux mains."},lightCrossbow:{name:"Arbalte lgre",id:"lightCrossbow",type:"weapon",category:"ranged",damage:{dice:"1d8",bonus:0,type:"dexterite"},damageType:"perforant",properties:["ammunition","loading","two-handed"],range:{ranged:"80/320"},stat:"dexterite",description:"Une arbalte facile  manier."},shortbow:{name:"Arc court",id:"shortbow",type:"weapon",category:"ranged",damage:{dice:"1d6",bonus:0,type:"dexterite"},damageType:"perforant",properties:["ammunition","two-handed"],range:{ranged:"80/320"},stat:"dexterite",description:"Un arc compact et maniable."},longbow:{name:"Arc long",id:"longbow",type:"weapon",category:"ranged",damage:{dice:"1d8",bonus:0,type:"dexterite"},damageType:"perforant",properties:["ammunition","heavy","two-handed"],range:{ranged:"150/600"},stat:"dexterite",description:"Un arc puissant avec une longue porte."},heavybow:{name:"Arc lourd",id:"heavybow",type:"weapon",category:"ranged",damage:{dice:"1d10",bonus:0,type:"dexterite"},damageType:"perforant",properties:["ammunition","heavy","two-handed"],range:{ranged:"200/800"},stat:"dexterite",description:"Un arc de guerre exceptionnellement puissant, difficile  bander."},heavyCrossbow:{name:"Arbalte lourde",id:"heavyCrossbow",type:"weapon",category:"ranged",damage:{dice:"1d10",bonus:0,type:"dexterite"},damageType:"perforant",properties:["ammunition","heavy","loading","two-handed"],range:{ranged:"100/400"},stat:"dexterite",description:"Une arbalte puissante mais lente  recharger."},arccheat:{name:"Arc Du MJ",id:"arccheat",type:"weapon",category:"ranged",damage:{dice:"1d10",bonus:50,type:"intelligence"},damageType:"perforant",properties:["ammunition","heavy","two-handed"],range:{ranged:"150/600"},stat:"intelligence",description:"Un arc d'une grande prcision, fabriqu  partir du bois d'un arbre ancien.",rarity:"Lgendaire",weight:3}},sv={ammunition:"Ncessite des munitions pour attaquer  distance",finesse:"Peut utiliser la Dextrit au lieu de la Force",heavy:"Les cratures de taille P ont un dsavantage aux jets d'attaque",light:"Idale pour le combat  deux armes",loading:"Ne peut tirer qu'un projectile par action",range:"Peut tre utilise pour des attaques  distance",reach:"Ajoute 1,50 m  l'allonge",thrown:"Peut tre lance pour une attaque  distance","two-handed":"Ncessite les deux mains",versatile:"Peut tre utilise  une ou deux mains"},lv=Object.freeze(Object.defineProperty({__proto__:null,weaponProperties:sv,weapons:ja},Symbol.toStringTag,{value:"Module"})),gt=r=>(r.playerCharacter&&(r.selectedCharacter=r.playerCharacter),r),At=ki(Qg(Bi((r,l)=>({playerCharacter:null,playerCompanion:null,playerCompanions:[],activeCompanions:[],selectedCharacter:null,activeEffects:[],temporaryModifiers:{},experienceGains:[],levelUpPending:!1,levelUpData:null,setPlayerCharacter:s=>r(gt({playerCharacter:s?It.deepClone(s):null})),setPlayerCompanion:s=>r({playerCompanion:s?It.deepClone(s):null}),addCompanion:s=>r(i=>{if(i.playerCompanions.length>=3)return console.warn("Maximum 3 compagnons autoriss"),i;const u=It.deepClone(s);return u.id=u.id||u.name||It.generateId("companion"),{playerCompanions:[...i.playerCompanions,u]}}),removeCompanion:s=>r(i=>({playerCompanions:i.playerCompanions.filter(u=>u.id!==s),activeCompanions:i.activeCompanions.filter(u=>u!==s)})),setActiveCompanions:s=>r(i=>({activeCompanions:s.filter(m=>i.playerCompanions.some(f=>f.id===m))})),getCompanion:s=>{const{playerCompanions:i}=l();return i.find(u=>u.id===s)},getActiveCompanions:()=>{const{playerCompanions:s,activeCompanions:i}=l();return i.map(u=>s.find(m=>m.id===u)).filter(Boolean)},updatePlayerCharacter:s=>r(i=>({playerCharacter:i.playerCharacter?{...i.playerCharacter,...s}:null})),updatePlayerCompanion:s=>r(i=>({playerCompanion:i.playerCompanion?{...i.playerCompanion,...s}:null})),updateCompanion:(s,i)=>r(u=>({playerCompanions:u.playerCompanions.map(m=>m.id===s?{...m,...i}:m),playerCompanion:u.playerCompanion?.id===s?{...u.playerCompanion,...i}:u.playerCompanion})),takeDamagePlayer:s=>r(i=>{if(!i.playerCharacter)return i;const u=Be.takeDamage(i.playerCharacter,s);return gt({playerCharacter:u})}),takeDamageCompanion:s=>r(i=>i.playerCompanion?{playerCompanion:Be.takeDamage(i.playerCompanion,s)}:i),takeDamageCompanionById:(s,i)=>r(u=>{const m=u.playerCompanions.find(p=>p.id===s);if(!m)return u;const f=Be.takeDamage(m,i);return{playerCompanions:u.playerCompanions.map(p=>p.id===s?f:p),playerCompanion:u.playerCompanion?.id===s?f:u.playerCompanion}}),healPlayer:s=>r(i=>{if(!i.playerCharacter)return i;const u=Be.heal(i.playerCharacter,s);return gt({playerCharacter:u})}),healCompanion:s=>r(i=>i.playerCompanion?{playerCompanion:Be.heal(i.playerCompanion,s)}:i),healCompanionById:(s,i)=>r(u=>{const m=u.playerCompanions.find(p=>p.id===s);if(!m)return u;const f=Be.heal(m,i);return{playerCompanions:u.playerCompanions.map(p=>p.id===s?f:p),playerCompanion:u.playerCompanion?.id===s?f:u.playerCompanion}}),shortRestPlayer:(s=0)=>r(i=>{if(!i.playerCharacter)return i;const u=Be.shortRest(i.playerCharacter,s);return gt({playerCharacter:u})}),longRestPlayer:()=>r(s=>{if(!s.playerCharacter)return s;const i=Be.longRest(s.playerCharacter);return gt({playerCharacter:i})}),longRestCompanion:()=>r(s=>s.playerCompanion?{playerCompanion:Be.longRest(s.playerCompanion)}:s),longRestCompanionById:s=>r(i=>{const u=i.playerCompanions.find(f=>f.id===s);if(!u)return i;const m=Be.longRest(u);return{playerCompanions:i.playerCompanions.map(f=>f.id===s?m:f),playerCompanion:i.playerCompanion?.id===s?m:i.playerCompanion}}),longRestAll:()=>{const{longRestPlayer:s,longRestCompanion:i,playerCompanions:u}=l();s(),i(),u.forEach(m=>{l().longRestCompanionById(m.id)})},spendHitDie:(s="player")=>r(i=>{const u=s==="player"?i.playerCharacter:i.playerCompanion;if(!u||u.hitDice<=0||u.currentHP>=u.maxHP)return i;const m=u.hitDiceType||8,f=Math.floor((u.stats.constitution-10)/2),p=Math.floor(Math.random()*m)+1,g=Math.max(1,p+f),h=Math.min(u.maxHP,u.currentHP+g),y={...u,currentHP:h,hitDice:u.hitDice-1};return s==="player"?gt({playerCharacter:y}):{playerCompanion:y}}),addExperience:(s,i="player")=>r(u=>{const m=i==="player"?u.playerCharacter:u.playerCompanion;if(!m)return u;const f=Be.addExperience(m,s),p={...u};return f.level>m.level&&(p.levelUpPending=!0,p.levelUpData={character:i,oldLevel:m.level,newLevel:f.level,hpGained:f.maxHP-m.maxHP}),p.experienceGains=[...u.experienceGains,{id:It.generateId("xp"),amount:s,target:i,timestamp:new Date}],i==="player"?(p.playerCharacter=f,p.selectedCharacter=f):p.playerCompanion=f,p}),confirmLevelUp:()=>r(s=>({levelUpPending:!1,levelUpData:null})),castSpellPlayer:(s,i={})=>r(u=>u.playerCharacter?{playerCharacter:Mi.castSpell(u.playerCharacter,s,[],i).character}:u),consumeSpellSlot:(s,i="player")=>r(u=>{const m=i==="player"?u.playerCharacter:u.playerCompanion;if(!m)return u;const f=Be.consumeSpellSlot(m,s);return i==="player"?gt({playerCharacter:f}):{playerCompanion:f}}),prepareSpell:(s,i="player")=>{const u=l(),m=i==="player"?u.playerCharacter:u.playerCompanion;if(!m)return{success:!1,message:`Aucun personnage ${i} trouv`};const f=Mi.prepareSpell(m,s);if(!f){const p=m.spellcasting?.preparedSpells||[],g=Mi.getMaxPreparedSpells(m);return p.includes(s)?{success:!1,message:`${s} est dj prpar`}:p.length>=g?{success:!1,message:`Limite de sorts prpars atteinte (${g})`}:{success:!1,message:`Impossible de prparer ${s}`}}return r(i==="player"?gt({playerCharacter:f}):{playerCompanion:f}),{success:!0,message:`${s} prpar avec succs`}},unprepareSpell:(s,i="player")=>{const u=l(),m=i==="player"?u.playerCharacter:u.playerCompanion;if(!m)return{success:!1,message:`Aucun personnage ${i} trouv`};const f=Mi.unprepareSpell(m,s);return f?(r(i==="player"?gt({playerCharacter:f}):{playerCompanion:f}),{success:!0,message:`${s} retir des sorts prpars`}):{success:!1,message:`Impossible de retirer ${s}`}},equipItem:(s,i="player")=>r(u=>{const m=i==="player"?u.playerCharacter:u.playerCompanion;if(!m)return u;let f=m.inventory?.find(b=>(b.id||b.name||b.nom)===s);if(!f){const b=ja[s];b&&(f={...b,id:s})}if(!f)return u;const p=f.type;if(!["weapon","arme","armor","armure","accessory","accessoire"].includes(p))return u;let h={...m.equipment||{}},y=null;if(p==="weapon"||p==="arme"?y="mainHand":p==="armor"||p==="armure"?y="body":(p==="accessory"||p==="accessoire")&&(y="accessory"),!y)return u;if(h[y]){const b=h[y],S=m.inventory?.some(N=>(N.id||N.name||N.nom)===b);let A=[...m.inventory||[]];if(S){const N=ja[b];N&&A.push({...N,id:b})}h[y]=s,A=A.filter(N=>(N.id||N.name||N.nom)!==s);const T={inventory:A,equipment:h};return i==="player"?gt({playerCharacter:{...m,...T}}):{playerCompanion:{...m,...T}}}else{h[y]=s;const S={inventory:m.inventory?m.inventory.filter(A=>(A.id||A.name||A.nom)!==s):[],equipment:h};return i==="player"?gt({playerCharacter:{...m,...S}}):{playerCompanion:{...m,...S}}}}),unequipItem:(s,i="player")=>r(u=>{const m=i==="player"?u.playerCharacter:u.playerCompanion;if(!m||!m.equipment)return u;const f=m.equipment;let p=null;for(const[S,A]of Object.entries(f))if(A===s){p=S;break}if(!p)return u;const g={...f};delete g[p];const h=ja[s],y=[...m.inventory||[]];h&&y.push({...h,id:s});const b={inventory:y,equipment:g};return i==="player"?gt({playerCharacter:{...m,...b}}):{playerCompanion:{...m,...b}}}),addItemToInventory:(s,i="player")=>r(u=>{const m=i==="player"?u.playerCharacter:u.playerCompanion;if(!m)return u;const f=m.inventory||[],p=s.id||s.name||s.nom,g=s.quantity||1,h=f.findIndex(S=>(S.id||S.name||S.nom)===p);let y;h>=0?(y=[...f],y[h]={...y[h],quantity:(y[h].quantity||1)+g}):y=[...f,{...s,id:s.id||s.name||s.nom||It.generateId("item"),quantity:g}];const b={inventory:y};return i==="player"?gt({playerCharacter:{...m,...b}}):{playerCompanion:{...m,...b}}}),removeItemFromInventory:(s,i="player",u=1)=>r(m=>{const f=i==="player"?m.playerCharacter:m.playerCompanion;if(!f)return m;const p=f.inventory||[],g=p.findIndex(A=>(A.id||A.name||A.nom)===s);if(g===-1)return m;let h=[...p];const y=h[g],b=y.quantity||1;b<=u?h.splice(g,1):h[g]={...y,quantity:b-u};const S={inventory:h};return i==="player"?gt({playerCharacter:{...f,...S}}):{playerCompanion:{...f,...S}}}),useItem:(s,i="player")=>{const u=i==="player"?l().playerCharacter:l().playerCompanion;if(!u)return{success:!1,message:"Personnage non trouv"};const m=u.inventory.find(p=>(p.id||p.name||p.nom)===s);if(!m)return{success:!1,message:"Objet non trouv dans l'inventaire"};const f=hn[s]||hn[m.id]||hn[m.name]||hn[m.nom];if(f&&f.use)try{const p=u.currentHP,g=f.use(u),h=g.currentHP-p;return r(i==="player"?{playerCharacter:g,selectedCharacter:g}:{playerCompanion:g}),f.type==="consumable"&&l().removeItemFromInventory(s,i,1),{success:!0,message:typeof f.message=="function"?f.message(h):f.message,item:f}}catch(p){return console.error("Erreur lors de l'utilisation de l'objet:",p),{success:!1,message:`Erreur: ${p.message}`}}else{if(m.effects){let p={...u},g=`${m.name||m.nom} utilis`;return m.effects.forEach(h=>{switch(h.type){case"heal":const y=h.value;p.currentHP=Math.min(u.maxHP,u.currentHP+y),g=`Vous rcuprez ${y} PV`;break;default:console.warn(`Unknown item effect type: ${h.type}`)}}),r(i==="player"?{playerCharacter:p,selectedCharacter:p}:{playerCompanion:p}),(m.consumable||m.type==="consumable")&&l().removeItemFromInventory(s,i,1),{success:!0,message:g}}return{success:!1,message:"Cet objet ne peut pas tre utilis"}}},addEffect:s=>r(i=>({activeEffects:[...i.activeEffects,{...s,id:s.id||It.generateId("effect"),startTime:new Date}]})),removeEffect:s=>r(i=>({activeEffects:i.activeEffects.filter(u=>u.id!==s)})),clearExpiredEffects:()=>r(s=>{const i=new Date;return{activeEffects:s.activeEffects.filter(u=>u.duration?i-u.startTime<u.duration:!0)}}),consolidateInventory:(s="player")=>r(i=>{const u=s==="player"?i.playerCharacter:i.playerCompanion;if(!u||!u.inventory)return i;const m=[],f=new Map;u.inventory.forEach(g=>{const h=g.id||g.name||g.nom;if(f.has(h)){const y=f.get(h);y.quantity=(y.quantity||1)+(g.quantity||1)}else f.set(h,{...g,quantity:g.quantity||1})}),f.forEach(g=>m.push(g));const p={inventory:m};return s==="player"?gt({playerCharacter:{...u,...p}}):{playerCompanion:{...u,...p}}}),resetCharacters:()=>r({playerCharacter:null,playerCompanion:null,playerCompanions:[],activeCompanions:[],activeEffects:[],temporaryModifiers:{},experienceGains:[],levelUpPending:!1,levelUpData:null}),clearExperienceGains:()=>r({experienceGains:[]})}),{name:"character-store"}))),qp=Object.freeze(Object.defineProperty({__proto__:null,useCharacterStore:At},Symbol.toStringTag,{value:"Module"})),fo=8,ho=6,Tt={PLAYER:"player",COMPANION:"companion",ENEMY:"enemy"},ls=(r,l)=>r>=0&&r<fo&&l>=0&&l<ho,Oi=(r,l,s,i=[],u=null)=>{if(s.player&&s.player.x===r&&s.player.y===l)return!0;for(const m in s)if(m!=="player"&&m!==u&&!m.endsWith("StartPos")){const f=s[m];if(f&&f.x===r&&f.y===l)return!0}for(const m of i)if(m.name!==u&&m.currentHP>0){const f=s[m.name];if(f&&f.x===r&&f.y===l)return!0}return!1},Mp=(r,l,s)=>{if(!r||!l)return!1;const i=Math.abs(r.x-l.x)+Math.abs(r.y-l.y),u=iv(s);return i<=u},iv=r=>{if(r.actionType==="spell"){if(typeof r.range=="string"){if(r.range.includes("mtres")){const l=parseInt(r.range);return Math.floor(l/1.5)}return r.range==="Toucher"?1:12}return r.range||12}if(r.actionType==="weapon"){if(r.category==="melee")return r.range?.melee||1;if(r.category==="ranged"){const l=r.range?.ranged||"80/320",s=parseInt(l.split("/")[0]);return Math.floor(s/5)}return 1}return 1};class ia{static calculateDamage(l){let s=is(l.damageDice)+(l.damageBonus||0),i=`${s} dgts ${l.damageType}`;if(l.secondaryDamageDice){const u=is(l.secondaryDamageDice)+(l.secondaryDamageBonus||0);s+=u,i+=` + ${u} dgts ${l.secondaryDamageType} (${s}dmg)`}return{damage:s,message:i}}static getTargetsInRange(l,s,i,u){const{playerCharacter:m,activeCompanions:f=[],combatEnemies:p,combatPositions:g}=u,h=[];if(!s)return h;const y=Mp.getActionRange?Mp.getActionRange(i):i.range||1;return l.type===Tt.ENEMY&&m?.currentHP>0&&g.player&&vt(s,g.player)<=y&&h.push({...m,type:Tt.PLAYER,position:g.player}),l.type===Tt.ENEMY&&f.length>0&&f.forEach(b=>{if(b?.currentHP>0){const S=g[b.id];S&&vt(s,S)<=y&&h.push({...b,type:Tt.COMPANION,position:S})}}),[Tt.PLAYER,Tt.COMPANION].includes(l.type)&&p.forEach(b=>{if(b.currentHP>0){const S=g[b.name];S&&vt(s,S)<=y&&h.push({...b,type:Tt.ENEMY,position:S})}}),h}static calculateOptimalMovement(l,s,i){if(!s||l.currentHP<=0)return null;const u=this.findPotentialTargets(l,i);if(u.length===0)return null;const m=u.reduce((y,b)=>{const S=vt(s,b.position);return!y||S<y.distance?{target:b,distance:S}:y},null);if(!m)return null;const f=this.getIdealDistance(l);if(m.distance<=f)return null;const p=l.movement||6;let g=null,h=-1;for(let y=-p;y<=p;y++)for(let b=-p;b<=p;b++){const S=Math.abs(y)+Math.abs(b);if(S===0||S>p)continue;const A={x:s.x+y,y:s.y+b};if(!ls(A.x,A.y)||Oi(A.x,A.y,i.combatPositions,i.combatEnemies,l.name))continue;const T=vt(A,m.target.position),q=100-Math.abs(T-f)-S*.1;q>h&&(h=q,g=A)}return g}static findPotentialTargets(l,s){const{playerCharacter:i,combatEnemies:u,combatPositions:m,activeCompanions:f=[]}=s,p=[];return l.type===Tt.ENEMY?(i?.currentHP>0&&m.player&&p.push({entity:i,position:m.player}),f&&f.length>0&&f.forEach(g=>{if(g&&g.currentHP>0){const h=g.id||g.name.toLowerCase(),y=m[h];y&&p.push({entity:g,position:y})}})):u.forEach(g=>{g.currentHP>0&&m[g.name]&&p.push({entity:g,position:m[g.name]})}),p}static getIdealDistance(l){if(!l.attacks)return 1;const s=l.attacks.some(u=>u.type==="ranged"||u.range&&u.range>1),i=l.attacks.some(u=>u.type==="melee"||!u.range||u.range<=1);if(i&&!s)return 1;if(s&&!i){const u=l.attacks.find(m=>m.type==="ranged");return Math.min(4,u?.range||4)}else return 1}static calculateAoESquares(l,s){const i=[];if(!l||!s)return i;switch(s.shape){case"sphere":case"circle":const u=s.size||1;for(let p=l.x-u;p<=l.x+u;p++)for(let g=l.y-u;g<=l.y+u;g++)ls(p,g)&&vt(l,{x:p,y:g})<=u&&i.push({x:p,y:g});break;case"cone":const m=s.size||2;for(let p=1;p<=m;p++)for(let g=-p;g<=p;g++){const h=l.x+p,y=l.y+g;ls(h,y)&&i.push({x:h,y})}break;case"line":const f=s.size||3;for(let p=1;p<=f;p++){const g=l.x+p,h=l.y;ls(g,h)&&i.push({x:g,y:h})}break;default:i.push(l)}return i}static findBestTarget(l,s,i){const{playerCharacter:u,combatPositions:m,activeCompanions:f=[]}=i;if(!s)return console.warn(` Pas de position pour ${l.name}`),null;const p=[];if(l.type===Tt.ENEMY?(u&&u.currentHP>0&&m.player&&p.push({type:Tt.PLAYER,name:u.name,character:u,position:m.player}),f&&f.length>0&&f.forEach(y=>{if(y&&y.currentHP>0){const b=y.id||y.name.toLowerCase(),S=m[b];S&&p.push({type:Tt.COMPANION,name:y.name,character:y,position:S})}})):(l.type===Tt.COMPANION||l.type==="companion")&&i.combatEnemies&&i.combatEnemies.forEach(y=>{y.currentHP>0&&m[y.name]&&p.push({type:Tt.ENEMY,name:y.name,character:y,position:m[y.name]})}),p.length===0)return null;let g=null,h=1/0;return p.forEach(y=>{const b=vt(s,y.position);b<h?(h=b,g=y):b===h&&y.type===Tt.PLAYER&&(g=y)}),g&&(g.distance=h),g}static validateMovement(l,s,i,u){if(!ls(i.x,i.y))return console.warn(` Position invalide pour ${l.name}: (${i.x}, ${i.y})`),!1;const{combatPositions:m,combatEnemies:f}=u;if(Oi(i.x,i.y,m,f,l.name))return console.warn(` Position occupe pour ${l.name}: (${i.x}, ${i.y})`),!1;const g=vt(s,i),h=l.movement||6;return g>h?(console.warn(` Mouvement trop loin pour ${l.name}: ${g} > ${h}`),!1):!0}}const Up={ombre:{name:"Ombre",maxHP:16,currentHP:16,ac:12,xp:100,stats:{force:6,dexterite:14,constitution:13,intelligence:6,sagesse:10,charisme:8},attacks:[{name:"absorption de force",type:"melee",attackBonus:4,range:1,targets:1,damageDice:"2d6",damageBonus:2,damageType:"necrotique",description:"absorption de force"}],image:"https://www.aidedd.org/dnd/images/shadow.jpg"},gobelin:{name:"Gobelin",maxHP:7,currentHP:7,ac:15,xp:50,stats:{force:8,dexterite:14,constitution:10,intelligence:10,sagesse:8,charisme:8},attacks:[{name:"son Cimeterre",type:"melee",attackBonus:4,range:1,targets:1,damageDice:"1d6",damageBonus:2,damageType:"tranchant",description:"Attaque au corps  corps avec une arme : +4 au toucher, allonge 1,50 m, une cible. Touch : 5 (1d6 + 2) dgts tranchants."}],image:"https://www.aidedd.org/dnd/images/goblin.jpg"},mephiteBoueux:{name:"Mphite boueux",maxHP:27,currentHP:27,ac:11,xp:50,stats:{force:8,dexterite:12,constitution:12,intelligence:9,sagesse:11,charisme:7},attacks:[{name:"Poing",type:"melee",attackBonus:3,range:1,targets:1,damageDice:"1d6",damageBonus:1,damageType:"contondant",description:"Attaque au corps  corps avec une arme : +3 au toucher, allonge 1,50 m, une crature. Touch : 4 (1d6 + 1) dgts contondants."}],image:"https://www.aidedd.org/dnd/images/mud-mephit.jpg"},kobold:{name:"Kobold",maxHP:5,currentHP:5,ac:12,xp:25,movement:6,stats:{force:8,dexterite:15,constitution:10,intelligence:8,sagesse:8,charisme:8},attacks:[{name:"sa Dague",type:"melee",attackBonus:4,range:1,targets:1,damageDice:"1d4",damageBonus:2,damageType:"perforant",description:"Attaque au corps  corps : +4 au toucher, allonge 1 m, une cible. Touch : 4 (1d4 + 2) dgts perforants."}],image:"https://www.aidedd.org/dnd/images/kobold.jpg"},goule:{name:"Goule",maxHP:22,currentHP:22,ac:12,xp:200,movement:6,stats:{force:13,dexterite:15,constitution:10,intelligence:7,sagesse:10,charisme:6},attacks:[{name:"Griffes",type:"melee",attackBonus:4,range:1,targets:1,damageDice:"2d4",damageBonus:2,damageType:"tranchant",description:"Attaque au corps  corps avec une arme : +4 au toucher, allonge 1,50 m, une cible. Touch : 7 (2d4 + 2) dgts tranchants. Si la cible est une crature autre qu'un elfe ou un mort-vivant, celle-ci doit russir un jet de sauvegarde de Constitution DD 10 pour ne pas tre paralyse pendant 1 minute. La cible peut relancer le jet de sauvegarde  la fin de chacun de ses tours, mettant fin  l'effet qui l'affecte en cas de russite."}],image:"https://www.aidedd.org/dnd/images/ghoul.jpg"},squelette:{name:"Squelette",maxHP:13,currentHP:13,ac:13,xp:50,movement:6,stats:{force:10,dexterite:14,constitution:15,intelligence:6,sagesse:8,charisme:5},attacks:[{name:"son pe courte",type:"melee",attackBonus:4,range:1,targets:1,damageDice:"1d6",damageBonus:2,damageType:"perforant",description:"Attaque au corps  corps : +4 au toucher, allonge 1 m, une cible. Touch : 4 (1d4 + 2) dgts perforants."}],image:"https://www.aidedd.org/dnd/images/skeleton.jpg"},diablotin:{name:"Diablotin",maxHP:10,currentHP:10,ac:13,xp:200,movement:6,stats:{force:6,dexterite:17,constitution:13,intelligence:11,sagesse:12,charisme:14},attacks:[{name:"Dard",type:"melee",attackBonus:5,range:1,targets:1,damageDice:"1d4",damageBonus:3,damageType:"perforants",description:"Attaque au corps  corps : +4 au toucher, allonge 1 m, une cible. Touch : 4 (1d4 + 2) dgts perforants."}],image:"https://www.aidedd.org/dnd/images/imp.jpg"},diable:{name:"Diable pineux",maxHP:22,currentHP:22,ac:13,xp:450,stats:{force:10,dexterite:15,constitution:12,intelligence:11,sagesse:14,charisme:8},movement:8,attackSets:[{name:"Morsure et fourche",attacks:[{name:"Morsure",type:"melee",attackBonus:2,range:1,damageDice:"2d4",damageBonus:0,damageType:"tranchants",description:"Attaque avec ces crocs aceres"},{name:"Fourche",type:"melee",attackBonus:2,range:1,damageDice:"1d6",damageBonus:0,damageType:"perforants",description:"Attaque avec une fourche"}]},{name:"Double pine caudale",attacks:[{name:"pine caudale",type:"ranged",attackBonus:4,range:6,damageDice:"1d4",damageBonus:2,damageType:"perforants",secondaryDamageDice:"1d6",secondaryDamageBonus:0,secondaryDamageType:"feu",description:"Projette une pine de sa queue"},{name:"pine caudale",type:"ranged",attackBonus:4,range:6,damageDice:"1d4",damageBonus:2,damageType:"perforants",secondaryDamageDice:"1d6",secondaryDamageBonus:0,secondaryDamageType:"feu",description:"Projette une pine de sa queue"}]}],image:"https://www.aidedd.org/dnd/images/spined-devil.jpg"}};class be{static findMostWoundedAlly(l){const s=[];return l.playerCharacter&&l.playerCharacter.currentHP<l.playerCharacter.maxHP&&s.push({...l.playerCharacter,id:"player",hpPercentage:l.playerCharacter.currentHP/l.playerCharacter.maxHP}),l.activeCompanions&&l.activeCompanions.forEach(i=>{i&&i.currentHP<i.maxHP&&s.push({...i,hpPercentage:i.currentHP/i.maxHP})}),s.sort((i,u)=>i.hpPercentage-u.hpPercentage)[0]||null}static findClosestEnemy(l,s){if(!s||s.length===0)return null;const i=s.filter(u=>u.currentHP>0);return i.length===0?null:i.reduce((u,m)=>{const f=m.position||{x:0,y:0},p=vt(l,f);return!u||p<u.distance?{enemy:m,distance:p}:u},null)?.enemy}static canCastSpell(l,s){if(!l.spellcasting||!l.spellcasting.knownSpells)return!1;const i=Sa[s];if(!i)return!1;const u=i.level,m=l.spellcasting.slotsRemaining||{};return u===0?!0:(m[u.toString()]||0)>0}static getBestAttack(l,s=null,i=[]){if(!l.attacks||l.attacks.length===0)return null;let u=l.attacks;return s&&(u=l.attacks.filter(m=>m.type===s)),u.length===0?l.attacks[0]:u[0]}static getAvailableSpells(l){return!l.spellcasting||!l.spellcasting.knownSpells?[]:l.spellcasting.knownSpells.filter(s=>be.canCastSpell(l,s))}static isInRange(l,s,i){const u=vt(l,s),m=i.range||1;return u<=m}static tankAI={priority:(l,s)=>{const i=[],u=s.combatPositions?.[l.id],m=(s.combatEnemies||[]).filter(f=>f.currentHP>0);return u?(l.aiPriority?.forEach((f,p)=>{const g=100-p*10;switch(f){case"protect":const h=be.findMostWoundedAlly(s);h&&h.hpPercentage<.3&&i.push({type:"protect",target:h,priority:g,description:`Protger ${h.name}`});break;case"taunt":m.length>0&&i.push({type:"taunt",targets:m,priority:g,description:"Attirer l'attention"});break;case"melee_attack":const y=be.getBestAttack(l,"melee"),b=be.findClosestEnemy(u,m);b&&y&&i.push({type:"attack",attack:y,target:b,priority:g,description:`${y.name} sur ${b.name}`});break;case"ranged_attack":const S=be.getBestAttack(l,"ranged");if(S&&m.length>0){const A=be.findWeakestEnemy(m);i.push({type:"attack",attack:S,target:A,priority:g,description:`${S.name} sur ${A.name}`})}break}}),i.sort((f,p)=>p.priority-f.priority)):i}};static healerAI={priority:(l,s)=>{const i=[],u=s.combatPositions?.[l.id],m=(s.combatEnemies||[]).filter(f=>f.currentHP>0);return u?(l.aiPriority?.forEach((f,p)=>{const g=100-p*10;switch(f){case"heal":const h=be.findMostWoundedAlly(s);h&&h.hpPercentage<.6&&be.canCastSpell(l,"Soins")&&i.push({type:"spell",spell:"Soins",target:h,priority:g,description:`Soigner ${h.name} (${Math.round(h.hpPercentage*100)}% HP)`});break;case"buff":be.getAvailableSpells(l).includes("Bndiction")&&i.push({type:"spell",spell:"Bndiction",target:"party",priority:g,description:"Bnir l'quipe"});break;case"ranged_support":const b=be.getBestAttack(l,"ranged");if(b&&m.length>0){const T=be.findWeakestEnemy(m);i.push({type:"attack",attack:b,target:T,priority:g,description:`${b.name} sur ${T.name}`})}break;case"melee_attack":const S=be.getBestAttack(l,"melee"),A=be.findClosestEnemy(u,m);A&&S&&i.push({type:"attack",attack:S,target:A,priority:g,description:`${S.name} sur ${A.name} (dernier recours)`});break}}),i.sort((f,p)=>p.priority-f.priority)):i}};static dpsAI={priority:(l,s)=>{const i=[],u=s.combatPositions?.[l.id],m=(s.combatEnemies||[]).filter(f=>f.currentHP>0);return u?(l.aiPriority?.forEach((f,p)=>{const g=100-p*10;switch(f){case"ranged_spell":const h=be.getAvailableSpells(l),y=be.findWeakestEnemy(m);h.includes("Trait de feu")&&y?i.push({type:"spell",spell:"Trait de feu",target:y,priority:g,description:`Trait de feu sur ${y.name}`}):h.includes("Projectile Magique")&&y&&i.push({type:"spell",spell:"Projectile Magique",target:y,priority:g,description:`Projectile magique sur ${y.name}`});break;case"area_damage":const b=m.map(D=>({...D,position:s.combatPositions?.[D.name]||{x:0,y:0}})),S=be.findGroupedEnemies(b,2);if(S.length>=2){const D=be.getAvailableSpells(l);D.includes("Boule de Feu")?i.push({type:"spell",spell:"Boule de Feu",target:S,priority:g,description:`Boule de feu sur ${S.length} ennemis`}):D.includes("Toile d'araigne")&&i.push({type:"spell",spell:"Toile d'araigne",target:S,priority:g,description:`Toile d'araigne sur ${S.length} ennemis`})}break;case"debuff":const A=m.reduce((D,G)=>!D||G.currentHP>D.currentHP?G:D,null),T=be.getAvailableSpells(l);A&&T.includes("Lenteur")&&i.push({type:"spell",spell:"Lenteur",target:A,priority:g,description:`Ralentir ${A.name}`});break;case"ranged_attack":const N=be.getBestAttack(l,"ranged");if(N&&m.length>0){const D=be.findWeakestEnemy(m);i.push({type:"attack",attack:N,target:D,priority:g,description:`${N.name} sur ${D.name}`})}break;case"melee_attack":const q=be.getBestAttack(l,"melee"),_=be.findClosestEnemy(u,m);_&&q&&i.push({type:"attack",attack:q,target:_,priority:g,description:`${q.name} sur ${_.name}`});break}}),i.sort((f,p)=>p.priority-f.priority)):i}};static supportAI={priority:(l,s)=>{const i=[],u=s.combatPositions?.[l.id],m=(s.combatEnemies||[]).filter(f=>f.currentHP>0);return u?(l.aiPriority?.forEach((f,p)=>{const g=100-p*10;switch(f){case"support_skill":const h=be.getAvailableSpells(l);h.includes("Dtection de la magie")&&i.push({type:"spell",spell:"Dtection de la magie",target:"area",priority:g,description:"Dtecter la magie"}),h.includes("Rparation")&&i.push({type:"spell",spell:"Rparation",target:"party",priority:g-5,description:"Rparer les quipements"});break;case"ranged_attack":const y=be.getBestAttack(l,"ranged");if(y&&m.length>0){const T=be.findWeakestEnemy(m);i.push({type:"attack",attack:y,target:T,priority:g,description:`${y.name} sur ${T.name}`})}break;case"heal":const b=be.findMostWoundedAlly(s);b&&b.hpPercentage<.4&&i.push({type:"heal_support",target:b,priority:g,description:`Soigner ${b.name} avec inventions`});break;case"melee_attack":const S=be.getBestAttack(l,"melee"),A=be.findClosestEnemy(u,m);A&&S&&i.push({type:"attack",attack:S,target:A,priority:g,description:`${S.name} sur ${A.name}`});break}}),i.sort((f,p)=>p.priority-f.priority)):i}};static findWeakestEnemy(l){return!l||l.length===0?null:l.reduce((s,i)=>!s||i.currentHP<s.currentHP?i:s,null)}static findGroupedEnemies(l,s=2){if(!l||l.length<2)return[];const i=[],u=new Set;return l.forEach((m,f)=>{if(u.has(f)||!m.position)return;const p=[m];u.add(f),l.forEach((g,h)=>{if(h===f||u.has(h)||!g.position)return;vt(m.position,g.position)<=s&&(p.push(g),u.add(h))}),p.length>=2&&i.push(p)}),i.length>0?i.reduce((m,f)=>f.length>m.length?f:m):[]}static getBestAction(l,s){if(!l||!l.role)return console.warn("Compagnon invalide ou sans rle:",l),null;const i={...s,playerCharacter:s.playerCharacter,activeCompanions:s.activeCompanions||[],combatEnemies:s.combatEnemies||[],combatPositions:s.combatPositions||{}};let u;switch(l.role){case"tank":u=be.tankAI;break;case"healer":u=be.healerAI;break;case"dps":u=be.dpsAI;break;case"support":u=be.supportAI;break;default:return console.warn(`Rle de compagnon inconnu: ${l.role}`),null}const m=u.priority(l,i),f=m.length>0?m[0]:null;return f&&console.log(` ${l.name} (${l.role}): ${f.description}`),f}static calculateOptimalMovement(l,s,i){return ia.calculateOptimalMovement({...l,type:"companion"},s,i)}static getTargetsInRange(l,s,i,u){return ia.getTargetsInRange({...l,type:"companion"},s,i,u)}}class Ct{static EFFECT_TYPES={restrained:{name:"Entrav",icon:"",description:"Vitesse rduite  0, dsavantage aux attaques et Dextrit",mechanics:{speedMultiplier:0,attackDisadvantage:!0,dexterityDisadvantage:!0,canMove:!1}},poisoned:{name:"Empoisonn",icon:"",description:"Dsavantage aux jets d'attaque et de caractristique",mechanics:{attackDisadvantage:!0,abilityDisadvantage:!0}},stunned:{name:"tourdi",icon:"",description:"Incapacit totale, chec automatique Force/Dextrit",mechanics:{incapacitated:!0,canMove:!1,canAct:!1,autoFailStrDex:!0}},paralyzed:{name:"Paralys",icon:"",description:"Incapacit, chec auto Force/Dextrit, coups critiques au contact",mechanics:{incapacitated:!0,canMove:!1,canAct:!1,autoFailStrDex:!0,vulnerableToMelee:!0}},blessed:{name:"Bni",icon:"",description:"+1d4 aux jets d'attaque et de sauvegarde",mechanics:{attackBonus:"1d4",saveBonus:"1d4"}},haste:{name:"Acclr",icon:"",description:"Vitesse double, +1 action, +2 CA",mechanics:{speedMultiplier:2,extraAction:!0,acBonus:2}},frightened:{name:"Effray",icon:"",description:"Dsavantage si la source est visible, ne peut s'approcher",mechanics:{conditionalDisadvantage:!0,cannotApproachSource:!0}},charmed:{name:"Charm",icon:"",description:"Ne peut attaquer le charmeur, avantage aux interactions sociales",mechanics:{cannotAttackSource:!0,socialAdvantage:!0}}};static applyEffect(l,s,i=1,u=null,m=1){if(!Ct.EFFECT_TYPES[s])return console.warn(`Effet inconnu: ${s}`),null;const f={id:Ct.generateEffectId(),type:s,source:u,duration:i,intensity:m,turnsRemaining:i,startTurn:Date.now(),...Ct.EFFECT_TYPES[s]};l.activeEffects||(l.activeEffects=[]);const p=l.activeEffects.findIndex(g=>g.type===s);return p!==-1?i>l.activeEffects[p].turnsRemaining&&(l.activeEffects[p]=f):l.activeEffects.push(f),f}static removeEffect(l,s){if(!l.activeEffects)return!1;const i=l.activeEffects.findIndex(u=>u.id===s);return i!==-1?(l.activeEffects.splice(i,1),!0):!1}static removeEffectsByType(l,s){if(!l.activeEffects)return 0;const i=l.activeEffects.length;return l.activeEffects=l.activeEffects.filter(u=>u.type!==s),i-l.activeEffects.length}static updateEffectDurations(l){if(!l.activeEffects)return[];const s=[];return l.activeEffects=l.activeEffects.filter(i=>(i.turnsRemaining--,i.turnsRemaining<=0?(s.push(i),!1):!0)),s}static hasEffect(l,s){return l.activeEffects?.some(i=>i.type===s)||!1}static getEffectsByType(l,s){return l.activeEffects?.filter(i=>i.type===s)||[]}static calculateEffectModifiers(l){if(!l.activeEffects)return{};const s={speedMultiplier:1,attackBonus:0,attackDisadvantage:!1,acBonus:0,canMove:!0,canAct:!0,incapacitated:!1};return l.activeEffects.forEach(i=>{const u=i.mechanics||{};u.speedMultiplier!==void 0&&(s.speedMultiplier*=u.speedMultiplier),u.acBonus&&(s.acBonus+=u.acBonus),u.attackDisadvantage&&(s.attackDisadvantage=!0),u.canMove===!1&&(s.canMove=!1),u.canAct===!1&&(s.canAct=!1),u.incapacitated&&(s.incapacitated=!0)}),s}static generateEffectId(){return`effect_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}static getActiveEffectsDescription(l){return!l.activeEffects||l.activeEffects.length===0?[]:l.activeEffects.map(s=>({id:s.id,name:s.name,icon:s.icon,description:s.description,turnsRemaining:s.turnsRemaining,source:s.source}))}static canPerformAction(l,s){const i=Ct.calculateEffectModifiers(l);switch(s){case"move":return i.canMove;case"attack":case"spell":case"action":return i.canAct&&!i.incapacitated;default:return!0}}static processStartOfTurnEffects(l){if(!l.activeEffects)return[];const s=[];return l.activeEffects.forEach(u=>{if(u.mechanics?.periodicDamage){const m=Ct.rollDamage(u.mechanics.periodicDamage);s.push({text:`${u.icon} ${l.name} subit ${m} dgts de ${u.type}`,type:"periodic-damage",damage:m})}if(u.mechanics?.periodicHealing){const m=Ct.rollDamage(u.mechanics.periodicHealing);s.push({text:`${u.icon} ${l.name} rcupre ${m} PV`,type:"periodic-healing",healing:m})}}),Ct.updateEffectDurations(l).forEach(u=>{s.push({text:`${u.icon} L'effet ${u.name} sur ${l.name} se dissipe`,type:"effect-expired"})}),s}static rollDamage(l){const s=l.match(/(\d+)d(\d+)(\+(\d+))?/);if(!s)return 0;const[,i,u,,m]=s;let f=0;for(let p=0;p<parseInt(i);p++)f+=Math.floor(Math.random()*parseInt(u))+1;return f+(parseInt(m)||0)}}class dl{initializeCombat(l,s,i){const u=this.createEnemiesFromEncounter(i),m=this.rollInitiative(l,s,u),f=this.initializePositions(l,s,u,i.enemyPositions);return{enemies:u,turnOrder:m,positions:f,currentTurn:0}}createEnemiesFromEncounter(l){if(!l?.enemies?.length)throw new Error("Aucun ennemi dfini dans la rencontre");return l.enemies.flatMap((s,i)=>{const u=Up[s.type];return u?Array(s.count).fill(null).map((m,f)=>({...u,id:`${s.type}_${i}_${f}`,name:s.count>1?`${u.name} ${f+1}`:u.name,type:"enemy",currentHP:u.currentHP??u.maxHP??10,maxHP:u.maxHP??10,ac:u.ac??10,stats:{...u.stats},attacks:[...u.attacks||[]],image:u.image||"",isAlive:!0})):(console.error(`Template non trouv pour: ${s.type}`),[])})}rollInitiative(l,s,i){const u=[];if(!l||!l.stats)throw console.error("CombatService: playerCharacter ou playerCharacter.stats manquant"),new Error("Personnage joueur requis pour initialiser le combat");const m=this.rollD20()+Oe(l.stats.dexterite);if(u.push({...l,id:"player",type:"player",initiative:m,isAlive:!0}),s){const f=this.rollD20()+Oe(s.stats.dexterite);u.push({...s,id:"companion",type:"companion",initiative:f,isAlive:!0})}return i.forEach(f=>{const p=this.rollD20()+Oe(f.stats.dexterite);u.push({...f,initiative:p})}),u.sort((f,p)=>p.initiative===f.initiative?f.type==="player"?-1:p.type==="player"?1:f.type==="companion"?-1:p.type==="companion"?1:0:p.initiative-f.initiative)}initializePositions(l,s,i,u=null){const m={player:{x:1,y:2},companion:s?{x:0,y:2}:null,playerHasMoved:!1,companionHasMoved:!1};return u?i.forEach((f,p)=>{const g=u[p];g?m[f.id]={x:g.x,y:g.y}:m[f.id]=this.getDefaultEnemyPosition(p,i.length)}):i.forEach((f,p)=>{m[f.id]=this.getDefaultEnemyPosition(p,i.length)}),m}getDefaultEnemyPosition(l,s){const m=Math.floor(4.8),f=8-m;if(s===1)return{x:m+Math.floor(f/2),y:Math.floor(6/2)};const p=Math.min(f,s),g=Math.floor(l/p),h=l%p;return{x:m+h,y:Math.max(1,Math.min(4,g+1))}}executePlayerAction(l,s,i,u,m){const f=[],p={damage:[],effects:[],messages:f};if(!s||!i.length)return f.push({text:"Aucune action ou cible slectionne",type:"error"}),p;switch(s.type){case"attack":return this.executeAttack(l,s,i,p);case"spell":return this.executeSpell(l,s,i,p);default:return f.push({text:`Type d'action inconnu: ${s.type}`,type:"error"}),p}}executeAttack(l,s,i,u){return i.forEach(m=>{const f=this.rollD20(),p=this.getAttackBonus(l,s),g=f+p,h=f===20;if(g>=m.ac||h){let b=this.rollDamage(s.damage);h?(b*=2,u.messages.push({text:` Coup critique ! ${l.name} inflige ${b} dgts  ${m.name} !`,type:"critical"})):u.messages.push({text:` ${l.name} touche ${m.name} et inflige ${b} dgts`,type:"hit"}),u.damage.push({targetId:m.id,damage:b})}else u.messages.push({text:` ${l.name} manque ${m.name} (${g} vs CA ${m.ac})`,type:"miss"})}),u}executeSpell(l,s,i,u){if(s.isAreaEffect&&i.length>1){u.messages.push({text:` ${l.name} lance ${s.name} (zone d'effet sur ${i.length} cibles)`,type:"spell"});let m=0;s.damage&&(m=this.rollDamage(s.damage.dice)+(s.damage.bonus||0)),i.forEach(f=>{let p=m;if(s.saveType){const g=this.rollD20(),h=this.getSaveBonus(f,s.saveType),y=s.saveDC||8+this.getSpellAttackBonus(l);if(g+h>=y)p=Math.floor(p/2),u.messages.push({text:` ${f.name} rsiste partiellement (${p} dgts)`,type:"save-success"});else if(u.messages.push({text:` ${f.name} subit les pleins effets (${p} dgts)`,type:"save-fail"}),s.effect){const b=Ct.applyEffect(f,s.effect,3,l.name);u.effects.push({type:s.effect,targetId:f.id||f.name,source:l.name,duration:3,effectId:b?.id})}}else if(s.effect){const g=Ct.applyEffect(f,s.effect,3,l.name);u.effects.push({type:s.effect,targetId:f.id||f.name,source:l.name,duration:3,effectId:g?.id})}p>0&&u.damage.push({targetId:f.id||f.name,damage:p})})}else u.messages.push({text:` ${l.name} lance ${s.name}`,type:"spell"}),i.forEach(m=>{if(s.requiresAttackRoll){const f=this.rollD20(),p=this.getSpellAttackBonus(l),g=f+p,h=f===20;if(g>=m.ac||h){let b=0;s.damage&&(b=this.rollDamage(s.damage.dice)+(s.damage.bonus||0),h&&(b*=2)),u.messages.push({text:` ${s.name} touche ${m.name} et inflige ${b} dgts`,type:h?"critical":"hit"}),u.damage.push({targetId:m.id||m.name,damage:b})}else u.messages.push({text:` ${s.name} manque ${m.name} (${g} vs CA ${m.ac})`,type:"miss"})}else{let f=0;s.damage&&(f=this.rollDamage(s.damage.dice)+(s.damage.bonus||0)),u.messages.push({text:` ${s.name} touche automatiquement ${m.name} et inflige ${f} dgts`,type:"spell-hit"}),u.damage.push({targetId:m.id||m.name,damage:f})}});return u}getAttackBonus(l,s){if(s.attackBonus!==void 0)return s.attackBonus;const i=l.level?Math.ceil(l.level/4)+1:2;if(!l.stats)return console.error(" Character.stats manquant dans getAttackBonus:",l),0;let u="force";s.stat?u=s.stat:(s.category==="ranged"||s.type==="ranged"||s.range&&s.range>1)&&(u="dexterite");const m=l.stats[u];return m===void 0?(console.error(` Stat ${u} manquante pour character:`,l),i):Oe(m)+i}getSpellAttackBonus(l){const s=l.level?Math.ceil(l.level/4)+1:2;if(!l.spellcasting||!l.spellcasting.ability)return s;const i=l.spellcasting.ability,u=l.stats[i];return Oe(u||10)+s}getSaveBonus(l,s){if(!l.stats)return 0;const i=Oe(l.stats[s]||10),u=l.level?Math.ceil(l.level/4)+1:0,m=l.saveBonus?.[s]||0;return i+u+m}rollDamage(l){const s=l.match(/(\d+)d(\d+)(\+(\d+))?/);if(!s)return 0;const[,i,u,,m]=s;let f=0;for(let p=0;p<parseInt(i);p++)f+=Math.floor(Math.random()*parseInt(u))+1;return f+(parseInt(m)||0)}rollD20(){return Math.floor(Math.random()*20)+1}isDefeated(l){return l.currentHP<=0}checkCombatEnd(l,s,i){const u=this.isDefeated(l),m=s?this.isDefeated(s):!0,f=i.every(p=>this.isDefeated(p));return u&&m?"defeat":f?"victory":null}executeEntityAttack(l,s,i,u){if(!l||!s||!i)return console.error(" Paramtres manquants pour executeEntityAttack"),{success:!1,damage:0};if(i.character&&i.character.currentHP<=0)return console.warn(` ${l.name} tente d'attaquer ${i.name} qui est dj mort`),u(`${l.name} ralise que ${i.name} est dj tomb au combat.`),{success:!1,damage:0};const m=this.rollD20(),f=this.getAttackBonus(l,s);if(isNaN(f))return console.error(" Attack bonus est NaN pour:",l,s),{success:!1,damage:0};const p=m+f,g=m===20,h=i.character?i.character.ac:i.ac||10;if(isNaN(h))return console.error(" Target AC est NaN pour:",i),{success:!1,damage:0};if(p>=h||g){let b=0;return s.damageDice?b=this.rollDamage(s.damageDice)+(s.damageBonus||0):s.damage?b=this.rollDamage(s.damage):b=1,g?(b*=2,u(` Coup critique ! ${l.name} utilise ${s.name} et inflige ${b} dgts  ${i.name} !`,"critical")):u(` ${l.name} utilise ${s.name} et inflige ${b} dgts  ${i.name}`,l.type==="enemy"?"enemy-hit":"companion-hit"),{success:!0,damage:b,critical:g}}else return u(` ${l.name} manque ${i.name} avec ${s.name} (${p} vs CA ${h})`,"miss"),{success:!1,damage:0}}executeEntityMovement(l,s,i,u,m){return ia.validateMovement(l,s,i,u)?!0:(console.warn(` Mouvement invalide pour ${l.name}`),m(`${l.name} ne peut pas se dplacer  cette position.`),!1)}executeCompanionAction(l,s,i){const u={messages:[],damage:[],healing:[],effects:[],success:!1};try{const m=be.getBestAction(s,i);if(!m)return u.messages.push({text:`${s.name} ne trouve aucune action  effectuer`,type:"info"}),u;const f=i.combatPositions[l],p=be.calculateOptimalMovement(s,f,i);switch(m.type){case"attack":return this.executeCompanionAttack(s,m,i,u);case"spell":return this.executeCompanionSpell(s,m,i,u);case"heal_support":return this.executeCompanionHeal(s,m,i,u);case"protect":case"taunt":return this.executeCompanionSupport(s,m,i,u);default:return u.messages.push({text:`Action inconnue: ${m.type}`,type:"error"}),u}}catch(m){return console.error("Erreur lors de l'excution de l'action du compagnon:",m),u.messages.push({text:`Erreur lors de l'action de ${s.name}`,type:"error"}),u}}executeCompanionAttack(l,s,i,u){const m=s.attack||l.attacks[0],f=s.target;if(!m||!f)return u.messages.push({text:`${l.name} ne peut pas attaquer`,type:"error"}),u;const p=this.rollD20(),g=this.getAttackBonus(l,m),h=p+g,y=p===20;if(h>=f.ac||y){let S=ia.calculateDamage(m).damage;y&&(S*=2);const A=m.type==="ranged"?"":"",T=y?" (CRITIQUE!)":"";u.messages.push({text:`${A} ${l.name} utilise ${m.name} sur ${f.name} (${S} dgts)${T}`,type:y?"critical":"success"}),u.damage.push({targetId:f.name,damage:S,source:l.name,attackType:m.type}),u.success=!0}else u.messages.push({text:` ${l.name} rate son attaque sur ${f.name}`,type:"miss"});return u}executeCompanionSpell(l,s,i,u){const m=s.spell,f=s.target;if(!be.canCastSpell(l,m))return u.messages.push({text:`${l.name} ne peut pas lancer ${m}`,type:"error"}),u;switch(m){case"Soins":if(f&&f.id){const p=this.rollD8()+4;u.healing.push({targetId:f.id,amount:p,source:l.name}),u.messages.push({text:` ${l.name} soigne ${f.name} (+${p} PV)`,type:"healing"})}break;case"Trait de feu":if(f){const p=this.rollD10()+Oe(l.stats.charisme);u.damage.push({targetId:f.name,damage:p,source:l.name,damageType:"feu"}),u.messages.push({text:` ${l.name} lance un trait de feu sur ${f.name} (${p} dgts de feu)`,type:"spell"})}break;case"Boule de Feu":Array.isArray(f)&&(f.forEach(p=>{const g=this.rollD6()*6+Oe(l.stats.charisme);u.damage.push({targetId:p.name,damage:g,source:l.name,damageType:"feu"})}),u.messages.push({text:` ${l.name} lance une boule de feu sur ${f.length} ennemis`,type:"spell"}));break;case"Toile d'araigne":Array.isArray(f)&&(f.forEach(p=>{const g=Ct.applyEffect(p,"restrained",3,l.name);u.effects.push({type:"restrained",targetId:p.name,source:l.name,duration:3,effectId:g?.id})}),u.messages.push({text:` ${l.name} entoile ${f.length} ennemis (entravs pour 3 tours)`,type:"spell"}));break;case"Dtection de la magie":u.messages.push({text:` ${l.name} dtecte les auras magiques environnantes`,type:"spell"}),u.effects.push({type:"detection",source:l.name,duration:10});break;default:u.messages.push({text:` ${l.name} lance ${m}`,type:"spell"})}return this.consumeSpellSlot(l,m),u.success=!0,u}executeCompanionHeal(l,s,i,u){const m=s.target;if(!m)return u.messages.push({text:`${l.name} ne trouve personne  soigner`,type:"info"}),u;const f=this.rollD6()+2;return u.healing.push({targetId:m.id,amount:f,source:l.name}),u.messages.push({text:` ${l.name} soigne ${m.name} avec ses inventions (+${f} PV)`,type:"healing"}),u.success=!0,u}executeCompanionSupport(l,s,i,u){switch(s.type){case"protect":u.messages.push({text:` ${l.name} protge ${s.target.name}`,type:"support"}),u.effects.push({type:"protection",targetId:s.target.id,source:l.name,duration:1});break;case"taunt":u.messages.push({text:` ${l.name} attire l'attention des ennemis`,type:"support"}),u.effects.push({type:"taunt",source:l.name,targets:s.targets.map(m=>m.name),duration:1});break}return u.success=!0,u}rollD6(){return Math.floor(Math.random()*6)+1}rollD8(){return Math.floor(Math.random()*8)+1}rollD10(){return Math.floor(Math.random()*10)+1}consumeSpellSlot(l,s){console.log(`${l.name} a utilis un slot pour ${s}`)}}const la=ki(Bi((r,l)=>({isActive:!1,isInitialized:!1,combatPhase:"idle",combatKey:0,encounterData:null,combatEnemies:[],turnOrder:[],currentTurnIndex:0,turnCounter:0,combatPositions:{},showMovementFor:null,showTargetingFor:null,hasMovedThisTurn:!1,playerAction:null,actionTargets:[],selectedAoESquares:[],aoeCenter:null,defeated:!1,victory:!1,totalXpGained:0,initializeCombat:(s,i,u=[])=>r(m=>{const f=[];s.enemies.forEach((b,S)=>{const A=Up[b.type];if(!A){console.error(" Template ennemi non trouv:",b.type);return}for(let T=0;T<b.count;T++)f.push({...It.deepClone(A),name:`${A.name} ${T+1}`,id:It.generateId("enemy"),type:"enemy"})});const p=[],g=cl(Oe(i.stats.dexterite));p.push({type:"player",name:i.name,initiative:g,character:i}),u&&u.length>0?u.forEach((b,S)=>{if(b&&b.stats&&b.stats.dexterite){const A=cl(Oe(b.stats.dexterite));p.push({type:"companion",name:b.name,id:b.id,initiative:A,character:b})}else console.error(" COMBAT INIT: Compagnon invalide:",b)}):console.log(" COMBAT INIT: Aucun compagnon actif"),f.forEach(b=>{if(!b.stats||!b.stats.dexterite){console.error(" Enemy sans stats.dexterite:",b);return}const S=cl(Oe(b.stats.dexterite));p.push({type:"enemy",name:b.name,initiative:S,character:b})});const h=p.sort((b,S)=>S.initiative===b.initiative?b.type==="player"?-1:S.type==="player"?1:0:S.initiative-b.initiative),y=l().calculateInitialPositions(f,u,s.enemyPositions,s.playerPosition,s.companionPositions);return y.playerStartPos={...y.player},u&&u.length>0&&u.forEach(b=>{const S=b.id||b.name.toLowerCase();y[S]&&(y[`${S}StartPos`]={...y[S]})}),{...m,isActive:!0,isInitialized:!0,combatPhase:"initiative-display",encounterData:s,combatEnemies:f,turnOrder:h,currentTurnIndex:0,turnCounter:1,combatPositions:y,hasMovedThisTurn:!1,defeated:!1,victory:!1,totalXpGained:0}}),calculateInitialPositions:(s,i=[],u={},m=null,f=null)=>{const p={player:m||{x:0,y:5}};return i&&i.length>0&&i.forEach((g,h)=>{const y=g.id||g.name.toLowerCase();if(f&&f[y])p[y]=f[y];else if(f&&Array.isArray(f)&&f[h])p[y]=f[h];else{const b=p.player;p[y]={x:b.x+1+h,y:b.y-Math.floor(h/2)}}}),s.forEach((g,h)=>{if(u[g.name])p[g.name]=u[g.name];else{const y=Math.min(6,fo-2),b=Math.min(h,ho-1);p[g.name]={x:y+h%2,y:b}}}),p},resetCombat:()=>r({isActive:!1,isInitialized:!1,combatPhase:"idle",encounterData:null,combatEnemies:[],turnOrder:[],currentTurnIndex:0,turnCounter:0,combatPositions:{},showMovementFor:null,showTargetingFor:null,hasMovedThisTurn:!1,playerAction:null,actionTargets:[],selectedAoESquares:[],aoeCenter:null,defeated:!1,victory:!1,totalXpGained:0}),startCombat:()=>r({combatPhase:"turn"}),nextTurn:()=>r(s=>{let i=s.currentTurnIndex+1;i>=s.turnOrder.length&&(i=0,s.turnCounter++);const u=s.turnOrder.length;let m=0;for(;i!==s.currentTurnIndex&&m<u;){const h=s.turnOrder[i];let y=!1;if(h.type==="enemy"){const b=s.combatEnemies.find(S=>S.name===h.name);(!b||b.currentHP<=0)&&(y=!0)}else h.type;if(y){i++,m++,i>=s.turnOrder.length&&(i=0,s.turnCounter++);continue}break}const f=s.turnOrder[i];let p=[];if(f?.type==="enemy"){const h=s.combatEnemies.find(y=>y.name===f.name);h&&(p=Ct.processStartOfTurnEffects(h))}const g={...s.combatPositions};if(f?.type==="player")g.playerStartPos={...s.combatPositions.player};else if(f?.type==="companion"){const h=f.id||f.name.toLowerCase(),y=s.combatPositions[h];y&&(g[`${h}StartPos`]={...y})}return p.length>0&&console.log("Effets de dbut de tour:",p),{currentTurnIndex:i,turnCounter:s.turnCounter,combatPhase:"turn",hasMovedThisTurn:!1,showMovementFor:null,showTargetingFor:null,playerAction:null,actionTargets:[],combatPositions:g}}),setTurnPhase:s=>r({combatPhase:s}),getCurrentTurn:()=>{const{turnOrder:s,currentTurnIndex:i}=l();return s[i]},moveCharacter:(s,i)=>r(u=>{if(!ls(i.x,i.y)||Oi(i.x,i.y,u.combatPositions,u.combatEnemies,s))return u;const f=u.combatPositions[s];return l().checkOpportunityAttacks(s,f,i),{combatPositions:{...u.combatPositions,[s]:i},hasMovedThisTurn:s==="player"?!0:u.hasMovedThisTurn}}),checkOpportunityAttacks:(s,i,u)=>{const{combatPositions:m,combatEnemies:f}=l(),p=[];return f.forEach(g=>{if(g.currentHP<=0)return;const h=m[g.name];if(!h)return;const y=vt(i,h)<=1,b=vt(u,h)<=1;y&&!b&&p.push({attacker:g,target:s,position:h})}),p},updateEnemyPosition:(s,i)=>r(u=>({combatPositions:{...u.combatPositions,[s]:i}})),setPlayerAction:s=>r({playerAction:s}),setActionTargets:s=>r({actionTargets:s}),setShowMovementFor:s=>r({showMovementFor:s}),setShowTargetingFor:s=>r({showTargetingFor:s}),setSelectedAoESquares:s=>r({selectedAoESquares:s}),setAoECenter:s=>r({aoeCenter:s}),executeAction:()=>{const{playerAction:s,actionTargets:i,turnOrder:u,currentTurnIndex:m,combatPositions:f,combatEnemies:p}=l();if(!s||i.length===0)return;const g=u[m];f[g.name.toLowerCase()];const y=new dl().executePlayerAction(g.character,s,i,p,f);l().applyActionResults(y)},applyActionResults:s=>r(i=>{const u={...i};return s.damages?.forEach(m=>{if(m.target.type==="enemy"){const f=u.combatEnemies.findIndex(p=>p.name===m.target.name);f!==-1&&(u.combatEnemies[f]={...u.combatEnemies[f],currentHP:Math.max(0,u.combatEnemies[f].currentHP-m.amount)})}}),l().checkCombatEnd(),u}),_onPlayerDamage:null,_onCompanionDamageById:null,setDamageCallbacks:(s,i)=>r({_onPlayerDamage:s,_onCompanionDamageById:i}),dealDamageToPlayer:s=>{const{_onPlayerDamage:i}=l();i?i(s):console.warn("Player damage callback not set")},dealDamageToCompanion:s=>{console.warn("dealDamageToCompanion is deprecated, use dealDamageToCompanionById")},dealDamageToCompanionById:(s,i)=>{const{_onCompanionDamageById:u}=l();u?u(s,i):console.warn("Companion damage by ID callback not set")},dealDamageToEnemy:(s,i)=>r(u=>{const m=u.combatEnemies.findIndex(p=>p.name===s);if(m===-1)return u;const f=[...u.combatEnemies];return f[m]={...f[m],currentHP:Math.max(0,f[m].currentHP-i)},{combatEnemies:f}}),checkCombatEnd:()=>{const{combatEnemies:s}=l();if(s.filter(u=>u.currentHP>0).length===0){l().handleVictory();return}},handleVictory:()=>{const{combatEnemies:s}=l(),i=s.reduce((u,m)=>u+(m.xp||0),0);r(u=>({victory:!0,combatPhase:"end",isActive:!1,totalXpGained:i}))},handleDefeat:()=>r({defeated:!0,combatPhase:"end",isActive:!1}),endCombat:s=>r({[s?"victory":"defeated"]:!0,combatPhase:"end",isActive:!1}),executeEnemyTurn:(s,i,u=[])=>{const{combatEnemies:m,combatPositions:f}=l(),p=m.find(T=>T.name===s);if(!p||p.currentHP<=0)return;const g=f[s];if(!g)return;const h=Ct.calculateEffectModifiers(p);if(h.incapacitated){console.log(`${s} est incapacit par des effets et ne peut pas agir`);return}const y={playerCharacter:i,activeCompanions:u,combatEnemies:m,combatPositions:f};let b=g;if(h.canMove&&!Ct.hasEffect(p,"restrained")){const T=ia.calculateOptimalMovement({...p,type:"enemy"},g,y);T&&(l().moveCharacter(s,T),b=T)}else console.log(`${s} ne peut pas bouger  cause d'effets (${p.activeEffects?.map(T=>T.name).join(", ")||"aucun effet visible"})`);if(!h.canAct){console.log(`${s} ne peut pas attaquer  cause d'effets`);return}const S=p.attacks?.[0]||{name:"Attaque de base",type:"melee",range:1,damageDice:"1d6",damageBonus:0},A=ia.getTargetsInRange({...p,type:"enemy"},b,S,y);if(A.length>0){let T=A.find(_=>f.player&&_.position.x===f.player.x&&_.position.y===f.player.y);T||(T=A[0]);let N=ia.calculateDamage(S);h.attackDisadvantage&&(console.log(`${s} attaque avec dsavantage  cause d'effets`),N.damage=Math.floor(N.damage*.75));const q=f.player;if(q&&T.position.x===q.x&&T.position.y===q.y)l().dealDamageToPlayer(N.damage);else{const _=u.find(D=>{const G=f[D.id];return G&&G.x===T.position.x&&G.y===T.position.y});_&&l().dealDamageToCompanionById(_.id,N.damage)}}else console.log(`${s} n'a aucune cible  porte`)},executeCompanionTurnById:(s,i,u,m)=>{const{combatPositions:f,combatEnemies:p}=l();if(!i||i.currentHP<=0)return;const g=new dl,h={playerCharacter:m,activeCompanions:u,combatEnemies:p,combatPositions:f},y=g.executeCompanionAction(s,i,h);y&&y.success&&(y.damage?.forEach(b=>{l().dealDamageToEnemy(b.targetId,b.damage)}),y.healing?.forEach(b=>{b.targetId==="player"?l().dealDamageToPlayer(-b.amount):l().dealDamageToCompanionById(b.targetId,-b.amount)}))},incrementCombatKey:()=>r(s=>({combatKey:s.combatKey+1})),getValidMovementSquares:(s,i=6)=>{const{combatPositions:u,combatEnemies:m}=l(),f=u[s];if(!f)return[];const p=[];for(let g=0;g<fo;g++)for(let h=0;h<ho;h++)vt(f,{x:g,y:h})<=i&&!Oi(g,h,u,m,s)&&p.push({x:g,y:h});return p},getValidTargetSquares:(s,i)=>{const{combatPositions:u,combatEnemies:m}=l();return ia.getTargetsInRange({type:"player"},i,s,{combatPositions:u,combatEnemies:m}).map(f=>u[f.name])}}),{name:"combat-store"})),Ke=ki(Jg(Bi((r,l)=>({openPanels:new Set(["character-sheet"]),collapsedSections:new Set,activeModal:null,modalData:null,modalHistory:[],notifications:[],notificationCounter:0,isMobile:typeof window<"u"?window.innerWidth<=768:!1,sidebarCollapsed:!1,screenSize:typeof window<"u"?window.innerWidth<=480?"mobile":window.innerWidth<=768?"tablet":"desktop":"desktop",showCombatDetails:!0,showHealthBars:!0,showInitiativeOrder:!0,combatAnimationsEnabled:!0,theme:"default",showTooltips:!0,autoScrollLogs:!0,compactMode:!1,loading:!1,loadingMessage:"",hoveredElement:null,focusedElement:null,openPanel:s=>r(i=>({openPanels:new Set([...i.openPanels,s])})),closePanel:s=>r(i=>{const u=new Set(i.openPanels);return u.delete(s),{openPanels:u}}),togglePanel:s=>r(i=>{const u=new Set(i.openPanels);return u.has(s)?u.delete(s):u.add(s),{openPanels:u}}),closeAllPanels:()=>r({openPanels:new Set}),resetPanels:()=>r({openPanels:new Set(["character-sheet"])}),collapseSection:s=>r(i=>({collapsedSections:new Set([...i.collapsedSections,s])})),expandSection:s=>r(i=>{const u=new Set(i.collapsedSections);return u.delete(s),{collapsedSections:u}}),toggleSection:s=>r(i=>{const u=new Set(i.collapsedSections);return u.has(s)?u.delete(s):u.add(s),{collapsedSections:u}}),openModal:(s,i=null)=>r(u=>({modalHistory:u.activeModal?[...u.modalHistory,{type:u.activeModal,data:u.modalData}]:u.modalHistory,activeModal:s,modalData:i})),closeModal:()=>r(s=>{if(s.modalHistory.length>0){const i=s.modalHistory[s.modalHistory.length-1];return{activeModal:i.type,modalData:i.data,modalHistory:s.modalHistory.slice(0,-1)}}return{activeModal:null,modalData:null,modalHistory:[]}}),closeAllModals:()=>r({activeModal:null,modalData:null,modalHistory:[]}),addNotification:s=>r(i=>({notifications:[...i.notifications,{id:`notif-${i.notificationCounter}`,timestamp:Date.now(),type:"info",duration:5e3,...s}],notificationCounter:i.notificationCounter+1})),removeNotification:s=>r(i=>({notifications:i.notifications.filter(u=>u.id!==s)})),clearNotifications:()=>r({notifications:[]}),showSuccess:(s,i={})=>l().addNotification({type:"success",message:s,...i}),showError:(s,i={})=>l().addNotification({type:"error",message:s,duration:8e3,...i}),showWarning:(s,i={})=>l().addNotification({type:"warning",message:s,duration:6e3,...i}),showInfo:(s,i={})=>l().addNotification({type:"info",message:s,...i}),updateScreenSize:()=>r(s=>{const i=window.innerWidth;let u="desktop",m=!1;return i<=480?(u="mobile",m=!0):i<=768&&(u="tablet"),s.isMobile!==m||s.screenSize!==u?{isMobile:m,screenSize:u}:s}),toggleSidebar:()=>r(s=>({sidebarCollapsed:!s.sidebarCollapsed})),setSidebarCollapsed:s=>r({sidebarCollapsed:s}),toggleCombatDetails:()=>r(s=>({showCombatDetails:!s.showCombatDetails})),toggleHealthBars:()=>r(s=>({showHealthBars:!s.showHealthBars})),toggleInitiativeOrder:()=>r(s=>({showInitiativeOrder:!s.showInitiativeOrder})),toggleCombatAnimations:()=>r(s=>({combatAnimationsEnabled:!s.combatAnimationsEnabled})),setCombatUISettings:s=>r(i=>({showCombatDetails:s.showDetails??i.showCombatDetails,showHealthBars:s.showHealthBars??i.showHealthBars,showInitiativeOrder:s.showInitiativeOrder??i.showInitiativeOrder,combatAnimationsEnabled:s.animationsEnabled??i.combatAnimationsEnabled})),setTheme:s=>r({theme:s}),toggleTooltips:()=>r(s=>({showTooltips:!s.showTooltips})),toggleAutoScrollLogs:()=>r(s=>({autoScrollLogs:!s.autoScrollLogs})),toggleCompactMode:()=>r(s=>({compactMode:!s.compactMode})),updatePreferences:s=>r(i=>({theme:s.theme??i.theme,showTooltips:s.showTooltips??i.showTooltips,autoScrollLogs:s.autoScrollLogs??i.autoScrollLogs,compactMode:s.compactMode??i.compactMode})),setLoading:(s,i="")=>r({loading:s,loadingMessage:s?i:""}),setHoveredElement:s=>r({hoveredElement:s}),setFocusedElement:s=>r({focusedElement:s}),clearHover:()=>r({hoveredElement:null}),clearFocus:()=>r({focusedElement:null}),resetUI:()=>r({openPanels:new Set(["character-sheet"]),collapsedSections:new Set,activeModal:null,modalData:null,modalHistory:[],notifications:[],sidebarCollapsed:!1,showCombatDetails:!0,showHealthBars:!0,showInitiativeOrder:!0,combatAnimationsEnabled:!0,hoveredElement:null,focusedElement:null,loading:!1,loadingMessage:""}),savePreferences:()=>{console.log("Preferences saved automatically")}}),{name:"ui-store"}),{name:"rpg-ui-preferences",partialize:r=>({theme:r.theme,showTooltips:r.showTooltips,autoScrollLogs:r.autoScrollLogs,compactMode:r.compactMode,sidebarCollapsed:r.sidebarCollapsed,showCombatDetails:r.showCombatDetails,showHealthBars:r.showHealthBars,showInitiativeOrder:r.showInitiativeOrder,combatAnimationsEnabled:r.combatAnimationsEnabled,openPanels:Array.from(r.openPanels),collapsedSections:Array.from(r.collapsedSections)}),onRehydrateStorage:()=>r=>{r&&(r.openPanels=new Set(r.openPanels||["character-sheet"]),r.collapsedSections=new Set(r.collapsedSections||[]))}}));if(typeof window<"u"){const r=()=>{Ke.getState().updateScreenSize()};window.addEventListener("resize",r)}const Te=({children:r,variant:l="default",size:s="medium",className:i="",onClick:u,disabled:m=!1,...f})=>{const p="card",g=`card--${l}`,h=`card--${s}`,S=[p,g,h,m?"card--disabled":"",u?"card--clickable":"",i].filter(Boolean).join(" ");return c.jsx("div",{className:S,onClick:m?void 0:u,...f,children:r})},Qt=({children:r,className:l=""})=>c.jsx("div",{className:`card__header ${l}`,children:r}),at=({children:r,className:l=""})=>c.jsx("div",{className:`card__body ${l}`,children:r}),Pi=({children:r,className:l=""})=>c.jsx("div",{className:`card__footer ${l}`,children:r}),ce=({children:r,variant:l="primary",size:s="medium",disabled:i=!1,loading:u=!1,icon:m,iconPosition:f="left",fullWidth:p=!1,className:g="",onClick:h,type:y="button",...b})=>{const S=Ke(ee=>ee.compactMode),A="btn",T=`btn--${l}`,N=`btn--${s}`,re=[A,T,N,S?"btn--compact":"",i?"btn--disabled":"",u?"btn--loading":"",p?"btn--full-width":"",g].filter(Boolean).join(" "),F=ee=>{i||u||h?.(ee)};return c.jsxs("button",{type:y,className:re,onClick:F,disabled:i||u,...b,children:[u&&c.jsx("span",{className:"btn__spinner"}),m&&f==="left"&&c.jsx("span",{className:"btn__icon btn__icon--left",children:m}),c.jsx("span",{className:"btn__content",children:r}),m&&f==="right"&&c.jsx("span",{className:"btn__icon btn__icon--right",children:m})]})},Ta=({children:r,variant:l="horizontal",spacing:s="medium",className:i=""})=>{const u=["btn-group",`btn-group--${l}`,`btn-group--spacing-${s}`,i].filter(Boolean).join(" ");return c.jsx("div",{className:u,children:r})},Dp=({children:r,variant:l="secondary",size:s="medium",disabled:i=!1,selected:u=!1,cooldown:m=!1,onClick:f,className:p="",...g})=>{const h=["action-button",u&&"action-button--selected",m&&"action-button--cooldown",p].filter(Boolean).join(" ");return c.jsxs(ce,{variant:u?"primary":l,size:s,disabled:i||m,onClick:f,className:h,...g,children:[r,m&&c.jsx("div",{className:"action-button__cooldown-overlay",children:c.jsx("span",{className:"action-button__cooldown-text",children:""})})]})};var rv=Lp();const cv=xo(rv);var Gp={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},Rp=Pe.createContext&&Pe.createContext(Gp),ov=["attr","size","title"];function uv(r,l){if(r==null)return{};var s=dv(r,l),i,u;if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(r);for(u=0;u<m.length;u++)i=m[u],!(l.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(r,i)&&(s[i]=r[i])}return s}function dv(r,l){if(r==null)return{};var s={};for(var i in r)if(Object.prototype.hasOwnProperty.call(r,i)){if(l.indexOf(i)>=0)continue;s[i]=r[i]}return s}function Hi(){return Hi=Object.assign?Object.assign.bind():function(r){for(var l=1;l<arguments.length;l++){var s=arguments[l];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(r[i]=s[i])}return r},Hi.apply(this,arguments)}function zp(r,l){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);l&&(i=i.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),s.push.apply(s,i)}return s}function wi(r){for(var l=1;l<arguments.length;l++){var s=arguments[l]!=null?arguments[l]:{};l%2?zp(Object(s),!0).forEach(function(i){mv(r,i,s[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):zp(Object(s)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(s,i))})}return r}function mv(r,l,s){return l=pv(l),l in r?Object.defineProperty(r,l,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[l]=s,r}function pv(r){var l=fv(r,"string");return typeof l=="symbol"?l:l+""}function fv(r,l){if(typeof r!="object"||!r)return r;var s=r[Symbol.toPrimitive];if(s!==void 0){var i=s.call(r,l);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(l==="string"?String:Number)(r)}function Xp(r){return r&&r.map((l,s)=>Pe.createElement(l.tag,wi({key:s},l.attr),Xp(l.child)))}function ct(r){return l=>Pe.createElement(hv,Hi({attr:wi({},r.attr)},l),Xp(r.child))}function hv(r){var l=s=>{var{attr:i,size:u,title:m}=r,f=uv(r,ov),p=u||s.size||"1em",g;return s.className&&(g=s.className),r.className&&(g=(g?g+" ":"")+r.className),Pe.createElement("svg",Hi({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},s.attr,i,f,{className:g,style:wi(wi({color:r.color||s.color},s.style),r.style),height:p,width:p,xmlns:"http://www.w3.org/2000/svg"}),m&&Pe.createElement("title",null,m),r.children)};return Rp!==void 0?Pe.createElement(Rp.Consumer,null,s=>l(s)):l(Gp)}function gv(r){return ct({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"},child:[]}]})(r)}function vv(r){return ct({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"},child:[]}]})(r)}function $p(r){return ct({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"},child:[]}]})(r)}function Vp(r){return ct({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"},child:[]}]})(r)}function yv(r){return ct({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"m19 9 1.25-2.75L23 5l-2.75-1.25L19 1l-1.25 2.75L15 5l2.75 1.25zM19 15l-1.25 2.75L15 19l2.75 1.25L19 23l1.25-2.75L23 19l-2.75-1.25zM11.5 9.5 9 4 6.5 9.5 1 12l5.5 2.5L9 20l2.5-5.5L17 12l-5.5-2.5zm-1.51 3.49L9 15.17l-.99-2.18L5.83 12l2.18-.99L9 8.83l.99 2.18 2.18.99-2.18.99z"},child:[]}]})(r)}const So=({type:r,title:l,children:s,size:i="medium",showCloseButton:u=!0,closeOnBackdrop:m=!0,closeOnEscape:f=!0,className:p="",onClose:g})=>{const h=Ke(D=>D.activeModal),y=Ke(D=>D.modalData),b=Ke(D=>D.closeModal),S=Ke(D=>D.isMobile),A=h===r;se.useEffect(()=>{if(!A||!f)return;const D=G=>{G.key==="Escape"&&T()};return document.addEventListener("keydown",D),()=>document.removeEventListener("keydown",D)},[A,f]),se.useEffect(()=>{if(A)return document.body.style.overflow="hidden",()=>{document.body.style.overflow=""}},[A]);const T=()=>{g?.(),b()},N=D=>{D.target===D.currentTarget&&m&&T()};if(!A)return null;const q=["modal",`modal--${i}`,S&&"modal--mobile",p].filter(Boolean).join(" "),_=c.jsx("div",{className:"modal__backdrop",onClick:N,children:c.jsxs("div",{className:q,role:"dialog","aria-modal":"true",children:[(l||u)&&c.jsxs("div",{className:"modal__header",children:[l&&c.jsx("h2",{className:"modal__title",children:l}),u&&c.jsx(ce,{variant:"ghost",size:"small",icon:c.jsx(vv,{}),onClick:T,className:"modal__close-button","aria-label":"Fermer la modal"})]}),c.jsx("div",{className:"modal__content",children:typeof s=="function"?s({data:y,onClose:T}):s})]})});return cv.createPortal(_,document.body)},xv=()=>{const r=Ke(u=>u.openModal),l=Ke(u=>u.closeModal),s=Ke(u=>u.activeModal),i=Ke(u=>u.modalData);return{openModal:r,closeModal:l,activeModal:s,modalData:i,isOpen:u=>s===u}},Li=({current:r,max:l,label:s,showNumbers:i=!0,showPercentage:u=!1,size:m="medium",variant:f="health",animated:p=!0,className:g=""})=>{const h=Ke(N=>N.showHealthBars),y=Ke(N=>N.combatAnimationsEnabled);if(!h)return null;const b=l>0?Math.max(0,Math.min(100,r/l*100)):0,S=Math.max(0,r);let A="";b>75?A="health-bar--high":b>50?A="health-bar--medium":b>25?A="health-bar--low":A="health-bar--critical";const T=["health-bar",`health-bar--${m}`,`health-bar--${f}`,"flex flex--column flex--center",A,p&&y&&"health-bar--animated",g].filter(Boolean).join(" ");return c.jsxs("div",{className:T,children:[s&&c.jsxs("div",{className:"health-bar__label",children:[c.jsxs("span",{className:"health-bar__label-text",children:[s," "]}),i&&c.jsxs("span",{className:"health-bar__numbers",children:[S,"/",l,u&&` (${Math.round(b)}%)`]})]}),c.jsxs("div",{className:"health-bar__container",children:[c.jsx("div",{className:"health-bar__background",children:c.jsx("div",{className:"health-bar__fill",style:{width:`${b}%`,transition:p&&y?"width 0.3s ease-out":"none"}})}),!s&&i&&c.jsx("div",{className:"health-bar__overlay",children:c.jsxs("span",{className:"health-bar__overlay-text",children:[S,"/",l,u&&` (${Math.round(b)}%)`]})})]})]})},bv=({character:r})=>{if(!r?.spellcasting)return null;const s=new ul().getSpellSlots(r);if(!s||Object.keys(s).length===0)return null;const i=Object.values(s).reduce((f,p)=>f+(p?.max||0),0),u=Object.values(s).reduce((f,p)=>f+(p?.used||0),0),m=i-u;return i>0?c.jsx(Li,{current:m,max:i,label:" Emplacements de sorts",variant:"mana",showNumbers:!0,size:"small"}):null},_v=({character:r,characterStats:l,layout:s="vertical"})=>{if(!r)return null;const i=["resource-bars",`resource-bars--${s}`].join(" ");return c.jsxs("div",{className:i,children:[c.jsx(Li,{current:r.currentHP,max:r.maxHP,label:" Points de vie",variant:"health",showNumbers:!0}),r.hitDice&&c.jsx(Li,{current:r.hitDice,max:r.level,label:" Ds de vie",variant:"energy",showNumbers:!0,size:"small"}),c.jsx(bv,{character:r})]})},rl=({id:r,title:l,children:s,defaultExpanded:i=!0,persistState:u=!0,showIcon:m=!0,headerLevel:f=4,className:p="",headerClassName:g="",contentClassName:h="",onToggle:y})=>{const b=Ke(ee=>u?ee.collapsedSections.has(r):!1),S=Ke(ee=>ee.toggleSection),A=Ke(ee=>ee.combatAnimationsEnabled),[T,N]=Pe.useState(!i),q=u?!b:!T,_=()=>{u&&r?S(r):N(!T),y?.(q)},D=["collapsible-section",q&&"collapsible-section--expanded",A&&"collapsible-section--animated",p].filter(Boolean).join(" "),G=["collapsible-section__header",`collapsible-section__header--h${f}`,g].filter(Boolean).join(" "),re=["collapsible-section__content",h].filter(Boolean).join(" "),F=`h${f}`;return c.jsxs("div",{className:D,children:[c.jsxs(F,{className:G,onClick:_,role:"button",tabIndex:0,onKeyDown:ee=>{(ee.key==="Enter"||ee.key===" ")&&(ee.preventDefault(),_())},"aria-expanded":q,"aria-controls":r?`${r}-content`:void 0,children:[c.jsx("span",{className:"collapsible-section__title",children:l}),m&&c.jsx("span",{className:"collapsible-section__icon",children:q?c.jsx($p,{}):c.jsx(Vp,{})})]}),q&&c.jsx("div",{className:re,id:r?`${r}-content`:void 0,children:s})]})};function Sv(r){return ct({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M500 224h-30.364C455.724 130.325 381.675 56.276 288 42.364V12c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v30.364C130.325 56.276 56.276 130.325 42.364 224H12c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h30.364C56.276 381.675 130.325 455.724 224 469.636V500c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12v-30.364C381.675 455.724 455.724 381.675 469.636 288H500c6.627 0 12-5.373 12-12v-40c0-6.627-5.373-12-12-12zM288 404.634V364c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40.634C165.826 392.232 119.783 346.243 107.366 288H148c6.627 0 12-5.373 12-12v-40c0-6.627-5.373-12-12-12h-40.634C119.768 165.826 165.757 119.783 224 107.366V148c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12v-40.634C346.174 119.768 392.217 165.757 404.634 224H364c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40.634C392.232 346.174 346.243 392.217 288 404.634zM288 256c0 17.673-14.327 32-32 32s-32-14.327-32-32c0-17.673 14.327-32 32-32s32 14.327 32 32z"},child:[]}]})(r)}function jv(r){return ct({attr:{viewBox:"0 0 480 512"},child:[{tag:"path",attr:{d:"M106.75 215.06L1.2 370.95c-3.08 5 .1 11.5 5.93 12.14l208.26 22.07-108.64-190.1zM7.41 315.43L82.7 193.08 6.06 147.1c-2.67-1.6-6.06.32-6.06 3.43v162.81c0 4.03 5.29 5.53 7.41 2.09zM18.25 423.6l194.4 87.66c5.3 2.45 11.35-1.43 11.35-7.26v-65.67l-203.55-22.3c-4.45-.5-6.23 5.59-2.2 7.57zm81.22-257.78L179.4 22.88c4.34-7.06-3.59-15.25-10.78-11.14L17.81 110.35c-2.47 1.62-2.39 5.26.13 6.78l81.53 48.69zM240 176h109.21L253.63 7.62C250.5 2.54 245.25 0 240 0s-10.5 2.54-13.63 7.62L130.79 176H240zm233.94-28.9l-76.64 45.99 75.29 122.35c2.11 3.44 7.41 1.94 7.41-2.1V150.53c0-3.11-3.39-5.03-6.06-3.43zm-93.41 18.72l81.53-48.7c2.53-1.52 2.6-5.16.13-6.78l-150.81-98.6c-7.19-4.11-15.12 4.08-10.78 11.14l79.93 142.94zm79.02 250.21L256 438.32v65.67c0 5.84 6.05 9.71 11.35 7.26l194.4-87.66c4.03-1.97 2.25-8.06-2.2-7.56zm-86.3-200.97l-108.63 190.1 208.26-22.07c5.83-.65 9.01-7.14 5.93-12.14L373.25 215.06zM240 208H139.57L240 383.75 340.43 208H240z"},child:[]}]})(r)}function Tv(r){return ct({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M243.2 189.9V258c26.1 5.9 49.3 15.6 73.6 22.3v-68.2c-26-5.8-49.4-15.5-73.6-22.2zm223.3-123c-34.3 15.9-76.5 31.9-117 31.9C296 98.8 251.7 64 184.3 64c-25 0-47.3 4.4-68 12 2.8-7.3 4.1-15.2 3.6-23.6C118.1 24 94.8 1.2 66.3 0 34.3-1.3 8 24.3 8 56c0 19 9.5 35.8 24 45.9V488c0 13.3 10.7 24 24 24h16c13.3 0 24-10.7 24-24v-94.4c28.3-12.1 63.6-22.1 114.4-22.1 53.6 0 97.8 34.8 165.2 34.8 48.2 0 86.7-16.3 122.5-40.9 8.7-6 13.8-15.8 13.8-26.4V95.9c.1-23.3-24.2-38.8-45.4-29zM169.6 325.5c-25.8 2.7-50 8.2-73.6 16.6v-70.5c26.2-9.3 47.5-15 73.6-17.4zM464 191c-23.6 9.8-46.3 19.5-73.6 23.9V286c24.8-3.4 51.4-11.8 73.6-26v70.5c-25.1 16.1-48.5 24.7-73.6 27.1V286c-27 3.7-47.9 1.5-73.6-5.6v67.4c-23.9-7.4-47.3-16.7-73.6-21.3V258c-19.7-4.4-40.8-6.8-73.6-3.8v-70c-22.4 3.1-44.6 10.2-73.6 20.9v-70.5c33.2-12.2 50.1-19.8 73.6-22v71.6c27-3.7 48.4-1.3 73.6 5.7v-67.4c23.7 7.4 47.2 16.7 73.6 21.3v68.4c23.7 5.3 47.6 6.9 73.6 2.7V143c27-4.8 52.3-13.6 73.6-22.5z"},child:[]}]})(r)}function Ev(r){return ct({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M496 448H16c-8.84 0-16 7.16-16 16v32c0 8.84 7.16 16 16 16h480c8.84 0 16-7.16 16-16v-32c0-8.84-7.16-16-16-16zm-304-64l-64-32 64-32 32-64 32 64 64 32-64 32-16 32h208l-86.41-201.63a63.955 63.955 0 0 1-1.89-45.45L416 0 228.42 107.19a127.989 127.989 0 0 0-53.46 59.15L64 416h144l-16-32zm64-224l16-32 16 32 32 16-32 16-16 32-16-32-32-16 32-16z"},child:[]}]})(r)}function Cv(r){return ct({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3 0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z"},child:[]}]})(r)}function Av(r){return ct({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 0C114.6 0 0 100.3 0 224c0 70.1 36.9 132.6 94.5 173.7 9.6 6.9 15.2 18.1 13.5 29.9l-9.4 66.2c-1.4 9.6 6 18.2 15.7 18.2H192v-56c0-4.4 3.6-8 8-8h16c4.4 0 8 3.6 8 8v56h64v-56c0-4.4 3.6-8 8-8h16c4.4 0 8 3.6 8 8v56h77.7c9.7 0 17.1-8.6 15.7-18.2l-9.4-66.2c-1.7-11.7 3.8-23 13.5-29.9C475.1 356.6 512 294.1 512 224 512 100.3 397.4 0 256 0zm-96 320c-35.3 0-64-28.7-64-64s28.7-64 64-64 64 28.7 64 64-28.7 64-64 64zm192 0c-35.3 0-64-28.7-64-64s28.7-64 64-64 64 28.7 64 64-28.7 64-64 64z"},child:[]}]})(r)}function Nv(r){return ct({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M214.02 19.115l-.02.06c38.033 14.387 73.867 34.09 106.393 58.446L368.02 158.4C292.254 72.063 181.72 20.678 64.66 20.604c-14.96-.01-30.027.834-45.14 2.535v18.8c108.174-12.774 213.91 21.292 293.527 88.554l42.314 97.416C290.887 132.486 182.425 73.885 66.395 73.21c-2.45-.013-4.9-.002-7.357.036-13.106.2-26.297 1.157-39.522 2.87v18.85c98.998-13.552 196.12 18.532 267.11 82.264l30.708 87.82C263.412 179.47 168.852 126.394 67.348 125.36c-15.818-.162-31.804.958-47.83 3.398v18.914c93.33-15.18 185.38 18.05 247.677 83.27l20.694 83.917C246.555 230.42 160.67 176.716 67.7 175.423c-1.256-.018-2.514-.025-3.774-.024-14.688.02-29.54 1.36-44.408 4.084v19.036c89.513-17.794 178.655 19.16 230.357 89.468l4.62 73.348c-28.973-83.013-107.888-136.692-193.257-135.87-13.8.132-27.768 1.693-41.72 4.78v19.188c77.22-18.904 155.333 13.983 197.095 77.14l5.873 57.49c23.33-6.283 47.534-13.218 68.727-20.873 19.194-6.93 35.884-14.525 46.596-22.038 5.354-3.756 9.142-7.478 11.174-10.574 2.033-3.096 2.47-5.184 2.098-7.59l-1.252-8.123 137.074-39.556C446.897 159.92 363.67 69.964 260.654 19.114H214.02zm278.86 273.922l-40.196 11.6c1.63 18.66-4.666 36.567-16.397 52.043-14.18 18.707-35.934 34.627-62.363 48.257-45.23 23.33-104.45 39.877-164.397 47.97l4.38 16.35c68.63-7.66 143.34-22.038 198.17-48.538 30.517-14.75 54.633-33.123 68.722-55.33 12.74-20.084 17.775-43.384 12.08-72.353zm-58.513 16.885l-65.027 18.765c-.736 4.345-2.345 8.51-4.733 12.147-3.925 5.98-9.462 10.986-16.068 15.62-13.213 9.266-30.996 17.098-50.978 24.316-31.927 11.53-68.41 20.998-99.558 29.134l6.644 24.79c59.027-7.79 117.64-24.153 160.71-46.366 24.828-12.805 44.388-27.573 56.037-42.94 8.804-11.614 13.283-23.135 12.972-35.466zm-261.754 77.43l-33.033 8.85 8.197 30.59c10.812 3.95 18.623 14.38 18.623 26.485 0 6.87-2.52 13.2-6.673 18.114l4.716 17.6 33.034-8.85-24.864-92.788zM138.22 443.79c-1.49 0-2.88.33-4.12.91l-75.6 20.255c2.926 4.706 4.625 10.24 4.625 16.14 0 .67-.03 1.33-.072 1.987l75.96-20.352c4.96-.386 8.698-4.37 8.698-9.453 0-5.35-4.138-9.488-9.49-9.488zM32.327 468.985c-6.798 0-12.11 5.312-12.11 12.11 0 6.798 5.312 12.11 12.11 12.11 6.798 0 12.111-5.312 12.111-12.11 0-6.798-5.313-12.11-12.11-12.11z"},child:[]}]})(r)}function qv(r){return ct({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M30.936 23.332c-.97 100.412 10.37 192.13 100.757 231.064 109.81 47.303 46.883 118.85-58.246 83.002 76.11 65.222 145.665 141.652 200.928 159.985 6.78 2.995 14.26 4.674 22.12 4.674 11.404 0 22.023-3.508 30.835-9.495 31.55 8.544 59.065 11.345 82.4 9.23 19.94-.195 38.412-6.676 53.524-17.556 49.986-33.49 55.46-109.83 11.715-201.34 1.573-8.565 1.077-16.997-1.154-25.322-1.973-9.506-6.227-18.195-12.152-25.476-28.97-42.765-97.358-83.18-159.58-124.506 77.79 99.205 67.214 143.1 10.635 94.234 1.09-7.624-1.225-15.174-6.103-23.178-1.8-3.4-4.032-6.54-6.625-9.343-17.988-22.57-52.22-49.85-87.02-92.078 38.056 186.15-97.83 83.32-182.036-53.895zM267.79 173.836c14.032 0 25.208 11.176 25.208 25.21 0 14.032-11.175 25.208-25.21 25.208-14.032 0-25.208-11.176-25.208-25.21 0-14.032 11.175-25.208 25.21-25.208zm147.575 54.834c22.756 0 41.004 18.248 41.004 41.004 0 22.756-18.248 41.004-41.005 41.004-5.145 0-10.056-.942-14.582-2.65-.746-19.392-10.64-36.512-25.476-47.16 3.997-18.478 20.328-32.198 40.058-32.198zm-75.45 39.473c23.44 0 42.24 18.802 42.24 42.242 0 23.44-18.8 42.242-42.24 42.242s-42.243-18.802-42.243-42.242c0-23.44 18.8-42.242 42.242-42.242zm68.886 65.464c41.396 0 74.755 33.36 74.755 74.754 0 41.397-33.357 74.755-74.754 74.755-23.397 0-44.22-10.662-57.91-27.404.458-2.85.704-5.772.704-8.75 0-15.814-6.752-30.113-17.506-40.183.268-12.963 3.804-25.092 9.828-35.61 23.163-1.518 42.872-16.092 51.803-36.403 4.247-.746 8.613-1.157 13.08-1.157zm-145.53 10.59c12.626 0 22.662 10.038 22.662 22.664 0 12.628-10.035 22.663-22.662 22.663-12.627 0-22.663-10.035-22.663-22.662 0-12.625 10.035-22.663 22.663-22.663zm33.226 66.35c20.22 0 36.414 16.194 36.414 36.414 0 20.222-16.192 36.413-36.414 36.413-20.22 0-36.412-16.192-36.412-36.412s16.19-36.413 36.412-36.413z"},child:[]}]})(r)}function Mv(r){return ct({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 23c-3.7 0-7.4.1-11.1.27l.8 17.98c3.4-.16 6.8-.25 10.3-.25 118.8 0 215 96.2 215 215s-96.2 215-215 215c-89.6 0-166.35-54.7-198.65-132.6l27.63-8.3-48.43-34.3-19.05 54.5 22.55-6.7C74.68 428.8 158.4 489 256 489c128.6 0 233-104.4 233-233S384.6 23 256 23zm-30.8 2.04c-13.3 1.75-26.1 4.6-38.6 8.48l5.6 17.09c11.4-3.54 23.3-6.15 35.4-7.75l-2.4-17.82zm-57 15.12c-12.4 5.05-24.2 11.12-35.4 18.12l9.5 15.21c10.3-6.44 21.2-12.03 32.6-16.67l-6.7-16.66zM116.4 69.5a234.139 234.139 0 0 0-29.35 26.12l13.05 12.28c8.3-8.77 17.4-16.81 27-24.06l-4.8-6.57-5.9-7.77zm69.5 8.58l-4.4 17.44 217 55.48 4.4-17.4-217-55.52zM74.07 110.5c-8.19 10.2-15.54 21.2-21.94 32.7l15.65 8.8c5.91-10.7 12.69-20.8 20.26-30.3l-13.97-11.2zm127.63 8.8c-3.9 26 2.8 55.2 14.2 79.2 6.4 13.4 14.2 25.2 21.9 33.8 4.2 4.7 8.4 8.3 12.2 10.9l-5.4 21.2c-4.6.4-10 1.6-16 3.7-10.9 3.8-23.4 10.4-35.4 19.1-21.6 15.6-41.4 37.9-50.4 62.6l167.5 42.9c3.9-26-2.8-55.2-14.2-79.2-6.4-13.4-14.2-25.2-21.9-33.8-4.2-4.7-8.4-8.3-12.2-10.9l5.4-21.2c4.5-.5 10-1.6 16-3.7 10.9-3.8 23.4-10.4 35.4-19.1 21.6-15.6 41.4-37.9 50.4-62.6l-167.5-42.9zM43.24 160.9c-5.33 12-9.7 24.4-13 37.3l17.48 4.2c3.03-11.8 7.04-23.2 11.95-34.2l-16.43-7.3zM26.2 217.5C24.11 230 23 242.9 23 256v.9l18-.2v-.7c0-12.1 1.02-24 2.95-35.6l-17.75-2.9zM113.5 361l-4.4 17.4 217 55.5 4.4-17.4-217-55.5z"},child:[]}]})(r)}function Dv(r){return ct({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M230.125 18.156V247h49.313V18.156h-49.313zM78.812 21.438l-16 136.906c48.707 30.112 97.637 47.843 148.625 53.094V33.125c-44.244-1.822-88.46-5.89-132.625-11.688zm349.438.28c-43.398 6.814-86.784 10.647-130.125 11.97v175c46.732-7.458 95.816-24.375 148.438-50.844L428.25 21.72zm-1.938 166.532c-44.474 19.847-87.06 32.836-128.187 38.97V247h37.031v143.188h-37.031v8.718c0 34.41-20.516 56.084-43.25 56.28-22.734.2-43.438-21.34-43.438-56.28v-8.72l-27.656.002h-9.343V247h37.001v-17.188c-43.774-4.164-86.14-16.857-127.687-38.062 5.04 92.69 3.66 185.37-5.063 278.063 117.402 32.047 234.788 31.002 352.188 0-6.853-93.858-9.223-187.706-4.563-281.563zm-233.187 77.438V371.5H316.47V265.687H193.124zm20.47 18.156H296v67.5H213.594v-67.5zm18.686 18.687v30.126h45.032V302.53h-45.03zm-2.155 87.658v8.718c0 28.23 13.32 37.692 24.594 37.594 11.27-.098 24.718-10.018 24.718-37.594v-8.72l-49.313.002z"},child:[]}]})(r)}function Rv(r){return ct({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 16c-22.5 72-45 72-45 120 0 0 22.5 24 45 24s45-24 45-24c0-48-22.5-48-45-120zm0 144c-49.706 0-90 42.98-90 96s40.294 96 90 96c49.705 0 90-42.98 90-96s-40.295-96-90-96zm0 192c-22.5 0-45 24-45 24 0 48 22.5 48 45 120 22.5-72 45-72 45-120 0 0-22.5-24-45-24zm-22.5-168h45v48h45v48h-45v48h-45v-48h-45v-48h45v-48z"},child:[]}]})(r)}function zv(r){return ct({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M319.61 20.654c13.145 33.114 13.144 33.115-5.46 63.5 33.114-13.145 33.116-13.146 63.5 5.457-13.145-33.114-13.146-33.113 5.457-63.498-33.114 13.146-33.113 13.145-63.498-5.459zM113.024 38.021c-11.808 21.04-11.808 21.04-35.724 24.217 21.04 11.809 21.04 11.808 24.217 35.725 11.808-21.04 11.808-21.04 35.724-24.217-21.04-11.808-21.04-11.808-24.217-35.725zm76.55 56.184c-.952 50.588-.95 50.588-41.991 80.18 50.587.95 50.588.95 80.18 41.99.95-50.588.95-50.588 41.99-80.18-50.588-.95-50.588-.95-80.18-41.99zm191.177 55.885c-.046 24.127-.048 24.125-19.377 38.564 24.127.047 24.127.046 38.566 19.375.047-24.126.046-24.125 19.375-38.564-24.126-.047-24.125-.046-38.564-19.375zm-184.086 83.88c-1.191.024-2.36.07-3.492.134-18.591 1.064-41.868 8.416-77.445 22.556L76.012 433.582c78.487-20.734 132.97-21.909 170.99-4.615V247.71c-18.076-8.813-31.79-13.399-46.707-13.737a91.166 91.166 0 0 0-3.629-.002zm122.686 11.42c-2.916-.026-5.81.011-8.514.098-12.81.417-27.638 2.215-45.84 4.522V427.145c43.565-7.825 106.85-4.2 171.244 7.566l-39.78-177.197c-35.904-8.37-56.589-11.91-77.11-12.123zm2.289 16.95c18.889.204 36.852 2.768 53.707 5.02l4.437 16.523c-23.78-3.75-65.966-4.906-92.467-.98l-.636-17.805c11.959-2.154 23.625-2.88 34.959-2.758zm-250.483 4.658l-10.617 46.004h24.094l10.326-46.004H71.158zm345.881 0l39.742 177.031 2.239 9.973 22.591-.152-40.855-186.852h-23.717zm-78.857 57.82c16.993.026 33.67.791 49.146 2.223l3.524 17.174c-32.645-3.08-72.58-2.889-102.995 0l-.709-17.174c16.733-1.533 34.04-2.248 51.034-2.223zm-281.793 6.18l-6.924 30.004h24.394l6.735-30.004H56.389zm274.418 27.244c4.656.021 9.487.085 14.716.203l2.555 17.498c-19.97-.471-47.115.56-59.728 1.05l-.7-17.985c16.803-.493 29.189-.828 43.157-.766zm41.476.447c8.268.042 16.697.334 24.121.069l2.58 17.74c-8.653-.312-24.87-.83-32.064-.502l-2.807-17.234a257.25 257.25 0 0 1 8.17-.073zm-326.97 20.309l-17.985 77.928 25.035-.17 17.455-77.758H45.313zm303.164 11.848c19.608-.01 38.66.774 56.449 2.572l2.996 20.787c-34.305-4.244-85.755-7.697-119.1-3.244l-.14-17.922c20.02-1.379 40.186-2.183 59.795-2.193zm-166.606 44.05c-30.112.09-67.916 6.25-115.408 19.76l-7.22 2.053 187.759-1.27v-6.347c-16.236-9.206-37.42-14.278-65.13-14.196zm134.41 6.174c-19.63.067-37.112 1.439-51.283 4.182v10.064l177.594-1.203c-44.322-8.634-89.137-13.17-126.31-13.043zM26 475v18h460v-18H26z"},child:[]}]})(r)}function Ov(r){return ct({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 29.816l-231 154v106.368l231-154 231 154V183.816zm0 128.043L105 259.783v90.283l151-101.925 151 101.925v-90.283zm0 112l-87 58.725v67.6l87-58 87 58v-67.6zm0 89.957l-87 58v64.368l87-58 87 58v-64.368z"},child:[]}]})(r)}const Nt=(r,l="")=>({className:s="",...i})=>c.jsx(r,{className:`icon ${l} ${s}`,...i}),Yp=Nt(Cv,"heal-icon"),Hv=Nt(Nv,"damage-icon"),wv=Nt(Ev,"magic-icon"),Lv=Nt(jv,"dice-icon"),kv=Nt(Sv,"miss-icon"),Bv=Nt(Av,"defeat-icon"),Pv=Nt(Tv,"victory-icon"),Uv=Nt(Dv,"bag-icon"),Gv=Nt(Ov,"upgrade-icon"),Xv=Nt(Rv,"levelup-icon"),$v=Nt(yv,"exp-icon"),Vv=Nt(zv,"spell-icon"),Yv=Nt(qv,"burning-blobs-icon"),Qv=Nt(Mv,"duration-icon"),Et={PLAYER_DAMAGE:"player-damage",ENEMY_DAMAGE:"enemy-damage",VICTORY:"victory",HEAL:"heal",MISS:"miss",DEFEAT:"defeat",INITIATIVE:"initiative",BAG:"bag",UPGRADE:"upgrade",LEVEL_UP:"levelup",EXPERIENCE:"experience",SPELL:"spell",BURNING_BLOBS:"burning-blobs",DURATION:"duration"},Zv=r=>{const s={[Et.PLAYER_DAMAGE]:wv,[Et.ENEMY_DAMAGE]:Hv,[Et.VICTORY]:Pv,[Et.HEAL]:Yp,[Et.MISS]:kv,[Et.DEFEAT]:Bv,[Et.INITIATIVE]:Lv,[Et.BAG]:Uv,[Et.UPGRADE]:Gv,[Et.LEVEL_UP]:Xv,[Et.EXPERIENCE]:$v,[Et.SPELL]:Vv,[Et.BURNING_BLOBS]:Yv,[Et.DURATION]:Qv}[r];return s?c.jsx(s,{}):null},Kv=Pe.memo(({entry:r,showTimestamp:l=!1})=>{const s=r.timestamp?new Date(r.timestamp).toLocaleTimeString():"";return c.jsxs("div",{className:`combat-log__entry combat-log__entry--${r.type}`,children:[c.jsxs("div",{className:"combat-log__entry-content",children:[c.jsx("span",{className:"combat-log__entry-icon",children:Zv(r.type)}),c.jsx("span",{className:"combat-log__entry-message",children:r.message})]}),l&&s&&c.jsx("span",{className:"combat-log__entry-timestamp",children:s})]})}),sa=({title:r="Journal",maxEntries:l=100,showTimestamps:s=!1,showClearButton:i=!0,collapsible:u=!1,compact:m=!1,className:f=""})=>{const p=se.useRef(null),g=yt(D=>D.combatLog),h=yt(D=>D.clearCombatLog),y=Ke(D=>D.autoScrollLogs),b=Ke(D=>D.compactMode),[S,A]=Pe.useState(!1);se.useEffect(()=>{y&&p.current&&!S&&(p.current.scrollTop=p.current.scrollHeight)},[g,y,S]);const T=se.useMemo(()=>g.slice(-l),[g,l]),N=se.useMemo(()=>T.map(D=>c.jsx(Kv,{entry:D,showTimestamp:s},D.id||`${D.message}-${D.timestamp}`)),[T,s]),q=["combat-log",m||b?"combat-log--compact":"",S?"combat-log--collapsed":"",f].filter(Boolean).join(" "),_=T.length>0;return c.jsxs("div",{className:q,children:[c.jsxs("div",{className:"combat-log__header",children:[c.jsxs("div",{className:"combat-log__title-section",children:[u&&c.jsx("button",{className:"combat-log__toggle",onClick:()=>A(!S),"aria-expanded":!S,children:S?c.jsx(Vp,{}):c.jsx($p,{})}),c.jsx("h3",{className:"combat-log__title",children:r}),_&&c.jsxs("span",{className:"combat-log__count",children:["(",T.length,")"]})]}),i&&_&&!S&&c.jsx(ce,{size:"small",variant:"ghost",icon:c.jsx(gv,{}),onClick:h,className:"combat-log__clear-button",title:"Vider le journal",children:"Vider"})]}),!S&&c.jsxs("div",{className:"combat-log__content",children:[c.jsx("div",{className:"combat-log__entries",ref:p,children:_?N:c.jsxs("div",{className:"combat-log__empty",children:[c.jsx("span",{className:"combat-log__empty-icon",children:""}),c.jsx("p",{className:"combat-log__empty-message",children:"En attente d'actions..."})]})}),_&&!y&&c.jsx("div",{className:"combat-log__controls",children:c.jsx(ce,{size:"small",variant:"ghost",onClick:()=>{p.current&&(p.current.scrollTop=p.current.scrollHeight)},children:" Aller au bas"})})]})]})};Pe.memo(sa);const fn=({label:r,value:l,modifier:s,tooltip:i,size:u="medium",variant:m="default",showModifier:f=!1,onClick:p,className:g=""})=>{const h=Ke(T=>T.showTooltips),y=Ke(T=>T.compactMode),b=["stat-block",`stat-block--${u}`,`stat-block--${m}`,y&&"stat-block--compact",p&&"stat-block--clickable",g].filter(Boolean).join(" "),S=s!==void 0?s:typeof l=="number"&&f?Math.floor((l-10)/2):null,A=c.jsxs("div",{className:b,onClick:p,children:[c.jsx("div",{className:"stat-block__label",children:r}),c.jsxs("div",{className:"stat-block__value",children:[l,S!==null&&c.jsxs("span",{className:"stat-block__modifier",children:["(",S>=0?"+":"",S,")"]})]})]});return i&&h?c.jsx("div",{className:"stat-block-wrapper",title:i,children:A}):A},Qp=({children:r,layout:l="horizontal",spacing:s="medium",className:i=""})=>{const u=["stat-group",`stat-group--${l}`,`stat-group--spacing-${s}`,i].filter(Boolean).join(" ");return c.jsx("div",{className:u,children:r})},Jv=Pe.memo(({statName:r,score:l,hasSaveProficiency:s=!1,proficiencyBonus:i=0,onClick:u,showSaveBonus:m=!1,compact:f=!1})=>{const p=Oe(l),g=p+(s?i:0),h={force:"FOR",dexterite:"DEX",constitution:"CON",intelligence:"INT",sagesse:"SAG",charisme:"CHA"},y={force:"Force",dexterite:"Dextrit",constitution:"Constitution",intelligence:"Intelligence",sagesse:"Sagesse",charisme:"Charisme"},b=f?h[r]||r.toUpperCase():y[r]||r,S=`${y[r]}: ${l} (${p>=0?"+":""}${p})${m?`
Jet de sauvegarde: ${g>=0?"+":""}${g}`:""}`;return c.jsxs("div",{className:`ability-score ${f?"ability-score--compact":""}`,children:[c.jsx(fn,{label:b,value:l,modifier:p,tooltip:S,variant:s?"highlighted":"default",onClick:u,size:f?"small":"medium",showModifier:!0}),m&&c.jsxs("div",{className:`ability-score__save ${s?"ability-score__save--proficient":""}`,children:[c.jsx("span",{className:"ability-score__save-label",children:"JdS:"}),c.jsxs("span",{className:"ability-score__save-value",children:[g>=0?"+":"",g]})]})]})}),Iv=({stats:r,saves:l=[],proficiencyBonus:s=2,onStatClick:i,layout:u="grid",compact:m=!1,showSaveBonuses:f=!1})=>{const p=["ability-scores",`ability-scores--${u}`,m&&"ability-scores--compact"].filter(Boolean).join(" "),g=["force","dexterite","constitution","intelligence","sagesse","charisme"];return c.jsx("div",{className:p,children:c.jsx(Qp,{layout:u==="grid"?"grid":u,children:g.map(h=>c.jsx(Jv,{statName:h,score:r[h]||10,hasSaveProficiency:l.includes(h),proficiencyBonus:s,onClick:()=>i?.(h),showSaveBonus:f,compact:m},h))})})},go={acrobaties:"dexterite",arcanes:"intelligence",athletisme:"force",discretion:"dexterite",dressage:"sagesse",escamotage:"dexterite",histoire:"intelligence",intimidation:"charisme",intuition:"sagesse",investigation:"intelligence",medecine:"sagesse",nature:"intelligence",perception:"sagesse",persuasion:"charisme",religion:"intelligence",representation:"charisme",survie:"sagesse",tromperie:"charisme"},Zp={acrobaties:"Acrobaties",arcanes:"Arcanes",athletisme:"Athltisme",discretion:"Discrtion",dressage:"Dressage",escamotage:"Escamotage",histoire:"Histoire",intimidation:"Intimidation",intuition:"Intuition",investigation:"Investigation",medecine:"Mdecine",nature:"Nature",perception:"Perception",persuasion:"Persuasion",religion:"Religion",representation:"Reprsentation",survie:"Survie",tromperie:"Tromperie"},Fv={force:"FOR",dexterite:"DEX",constitution:"CON",intelligence:"INT",sagesse:"SAG",charisme:"CHA"},uo=Pe.memo(({skillName:r,character:l,proficiencyBonus:s,onSkillClick:i,layout:u="default",showProficiencyIndicator:m=!0})=>{const f=go[r],p=l.proficiencies?.skills?.includes(r)||!1,g=Oe(l.stats[f]||10),h=g+(p?s:0),y=Zp[r]||r,b=Fv[f]||f.toUpperCase(),S=["skill-item",`skill-item--${u}`,p&&"skill-item--proficient"].filter(Boolean).join(" "),A=`${y} (${b}): ${h>=0?"+":""}${h}${p?" (matris)":""}`;return u==="compact"?c.jsx("div",{className:S,children:c.jsx(fn,{label:y,value:`${h>=0?"+":""}${h}`,variant:p?"highlighted":"default",size:"small",tooltip:A,onClick:()=>i?.(r)})}):c.jsxs("div",{className:S,onClick:()=>i?.(r),children:[c.jsxs("div",{className:"skill-item__header",children:[m&&c.jsx("div",{className:`skill-item__proficiency ${p?"skill-item__proficiency--active":""}`,children:p?"":""}),c.jsxs("div",{className:"skill-item__name",children:[y,c.jsxs("span",{className:"skill-item__stat",children:["(",b,")"]})]}),c.jsxs("div",{className:"skill-item__bonus",children:[h>=0?"+":"",h]})]}),u==="detailed"&&c.jsx("div",{className:"skill-item__details",children:c.jsxs("div",{className:"skill-item__breakdown",children:["Stat: ",g>=0?"+":"",g,p&&c.jsxs("span",{children:[" + Matrise: +",s]})]})})]})}),Wv=({character:r,proficiencyBonus:l=2,onSkillClick:s,layout:i="default",groupByAbility:u=!1,showSearch:m=!1,compact:f=!1})=>{const[p,g]=Pe.useState(""),h=Object.keys(go).filter(b=>!p||Zp[b].toLowerCase().includes(p.toLowerCase())),y=["skills-list",`skills-list--${i}`,f&&"skills-list--compact"].filter(Boolean).join(" ");if(u){const b={};h.forEach(A=>{const T=go[A];b[T]||(b[T]=[]),b[T].push(A)});const S={force:"Force",dexterite:"Dextrit",constitution:"Constitution",intelligence:"Intelligence",sagesse:"Sagesse",charisme:"Charisme"};return c.jsxs("div",{className:y,children:[m&&c.jsx("div",{className:"skills-list__search",children:c.jsx("input",{type:"text",placeholder:"Rechercher une comptence...",value:p,onChange:A=>g(A.target.value),className:"skills-list__search-input"})}),Object.entries(b).map(([A,T])=>c.jsx(rl,{id:`skills-${A}`,title:`${S[A]} (${T.length})`,defaultExpanded:!f,children:c.jsx("div",{className:"skills-list__ability-group",children:T.map(N=>c.jsx(uo,{skillName:N,character:r,proficiencyBonus:l,onSkillClick:s,layout:f?"compact":i},N))})},A))]})}return c.jsxs("div",{className:y,children:[m&&c.jsx("div",{className:"skills-list__search",children:c.jsx("input",{type:"text",placeholder:"Rechercher une comptence...",value:p,onChange:b=>g(b.target.value),className:"skills-list__search-input"})}),c.jsx("div",{className:"skills-list__items",children:i==="compact"?c.jsx(Qp,{layout:"grid",children:h.map(b=>c.jsx(uo,{skillName:b,character:r,proficiencyBonus:l,onSkillClick:s,layout:i},b))}):h.map(b=>c.jsx(uo,{skillName:b,character:r,proficiencyBonus:l,onSkillClick:s,layout:i},b))})]})},ey=({currentXP:r=0,nextLevelXP:l,progress:s=0,level:i,showNumbers:u=!0,showLevelUpIndicator:m=!0,size:f="medium",animated:p=!0})=>{const g=At(A=>A.levelUpPending),h=At(A=>A.experienceGains),y=h.length>0,b=y?h[h.length-1]:null,S=["xp-bar",`xp-bar--${f}`,p&&"xp-bar--animated",g&&"xp-bar--can-level-up",y&&"xp-bar--recent-gain"].filter(Boolean).join(" ");return c.jsxs("div",{className:S,children:[u&&c.jsx("div",{className:"xp-bar__info",children:c.jsx("div",{className:"xp-bar__current",children:c.jsxs("span",{className:"xp-bar__value",children:[" XP:  ",Math.max(0,Math.round(r))," / ",Math.max(0,Math.round(l))]})})}),c.jsxs("div",{className:"xp-bar__container",children:[c.jsxs("div",{className:"xp-bar__background",children:[c.jsx("div",{className:"xp-bar__fill",style:{width:`${Math.min(100,s)}%`,transition:p?"width 0.5s ease-out":"none"}}),y&&c.jsxs("div",{className:"xp-bar__recent-gain-indicator",children:["+",b.amount," XP"]})]}),g&&m&&c.jsx("div",{className:"xp-bar__level-up-indicator",children:" Niveau suivant disponible !"})]}),s>=100&&!g&&c.jsx("div",{className:"xp-bar__max-level",children:"Niveau maximum atteint"})]})},Kp=({characterType:r="player",compact:l=!1,showControls:s=!1})=>{const i=At(f=>r==="player"?f.playerCharacter:f.playerCompanion),u=se.useMemo(()=>{if(!i)return null;const f=Be.getXPToNextLevel(i.level),p=Be.getXPForLevel(i.level),g=i.currentXP||i.experience||0,h=Be.generateSpellSlotsForLevel(i.level,i.class),y=g-p,b=f-p,S=b>0?y/b*100:100,A=i.spellcasting?Be.getAttackBonus(i,{actionType:"spell"}):null,T=i.class==="Roublard"?"dexterite":"force",N=Oe(i.stats[T])+Be.getProficiencyBonus(i.level),q=i.spellcasting?Be.getSpellSaveDC(i):null;return{xpToNext:b,xpProgress:S,spellAttackBonus:A,weaponAttackBonus:N,spellSaveDC:q,spellSlots:h,proficiencyBonus:Be.getProficiencyBonus(i.level)}},[i]);if(!i)return c.jsx(Te,{className:"character-sheet character-sheet--empty",children:c.jsx(at,{children:c.jsxs("p",{children:["Aucun ",r==="player"?"personnage":"compagnon"]})})});const m=["character-sheet",l&&"character-sheet--compact",`character-sheet--${r}`].filter(Boolean).join(" ");return c.jsxs(Te,{className:m,children:[c.jsx(Qt,{children:c.jsxs("div",{className:"character-sheet__header",children:[c.jsx("h3",{className:"character-sheet__name",children:i.name}),c.jsx("h5",{className:"character-sheet__name",children:i.familyName}),!l&&c.jsx(ey,{currentXP:Math.max(0,(i.currentXP||i.experience||0)-Be.getXPForLevel(i.level)),nextLevelXP:u.xpToNext,progress:u.xpProgress,level:i.level}),c.jsxs("p",{className:"character-sheet__details",children:["Niv. ",i.level," ",i.race," ",i.class]}),i.historic&&c.jsx("p",{className:"character-sheet__background",children:i.historic})]})}),c.jsxs(at,{children:[c.jsxs("div",{className:"character-sheet__main-stats",children:[c.jsx("div",{className:"character-sheet__combat-stats",children:c.jsx(fn,{label:"CA",value:i.ac,tooltip:"Classe d'Armure"})}),!l&&c.jsx(rl,{id:`${r}-resources`,title:"Ressources",defaultExpanded:!0,children:c.jsx(_v,{character:i,characterStats:u,layout:"vertical"})})]}),c.jsx(rl,{id:`${r}-abilities`,title:"Caractristiques",defaultExpanded:l,children:c.jsx(Iv,{stats:i.stats,saves:i.proficiencies?.saves||[],proficiencyBonus:u.proficiencyBonus,compact:!l,showSaveBonus:!1})}),c.jsx(rl,{id:`${r}-combat`,title:"Combat",defaultExpanded:l,children:c.jsxs("div",{className:"character-sheet__combat-info",children:[c.jsx(fn,{label:"Bonus de Matrise",value:`+${u.proficiencyBonus}`}),u.spellAttackBonus!==null&&c.jsx(fn,{label:"Att. Sorts",value:`+${u.spellAttackBonus}`,tooltip:"Bonus d'attaque des sorts"}),c.jsx(fn,{label:"Att. Armes",value:`+${u.weaponAttackBonus}`,tooltip:"Bonus d'attaque des armes"}),u.spellSaveDC&&c.jsx(fn,{label:"DD des sorts",value:u.spellSaveDC,tooltip:"Difficult des jets de sauvegarde contre vos sorts"})]})}),c.jsx(rl,{id:`${r}-skills`,title:"Comptences",defaultExpanded:l,children:c.jsx(Wv,{character:i,proficiencyBonus:u.proficiencyBonus,compact:l})})]})]})},ty=({characterType:r="player"})=>c.jsx(Kp,{characterType:r,compact:!0}),ay=({character:r,isSelected:l=!1,onSelect:s,onPreview:i,icon:u,description:m,showStats:f=!0,className:p=""})=>{const g=["character-selection-card",l&&"character-selection-card--selected",p].filter(Boolean).join(" "),h=y=>{y.target.closest("button")||s?.(r)};return r.stats.force,r.stats.dexterite,r.stats.constitution,r.stats.intelligence,r.stats.sagesse,r.stats.charisme,c.jsxs(Te,{className:g,onClick:h,variant:l?"primary":"default",children:[c.jsx(Qt,{children:c.jsxs("div",{className:"character-portrait",children:[c.jsx("div",{className:"character-avatar",children:u}),c.jsxs("div",{className:"character-info",children:[c.jsx("h3",{className:"character-selection-card__name",children:r.name}),c.jsxs("p",{className:"character-selection-card__class",children:[r.race," ",r.class]}),c.jsxs("p",{className:"character-selection-card__level",children:["Niveau ",r.level]})]})]})}),c.jsxs(at,{children:[c.jsxs("div",{className:"character-stats-preview",children:[c.jsxs("div",{className:"stat-preview",children:[c.jsx("span",{className:"main-stat__label",children:""}),c.jsxs("span",{className:"main-stat__value",children:[r.maxHP," PV"]})]}),c.jsxs("div",{className:"stat-preview",children:[c.jsx("span",{className:"main-stat__label",children:""}),c.jsxs("span",{className:"main-stat__value",children:["CA ",r.ac]})]})]}),c.jsxs("div",{className:"character-specialties",children:[r.class==="Magicien"&&c.jsx("div",{className:"specialty",children:" Sorts puissants"}),r.class==="Guerrier"&&c.jsx("div",{className:"specialty",children:" Combat rapproch"}),r.class==="Roublard"&&c.jsx("div",{className:"specialty",children:" Attaques prcises"}),r.class==="Paladin"&&c.jsx("div",{className:"specialty",children:" Dfense sacre"})]})]})]})},ny=({onCharacterSelect:r})=>{const[l,s]=se.useState(null),[i,u]=se.useState(!1),m=yt(T=>T.setGamePhase),f=At(T=>T.setPlayerCharacter),{openModal:p}=xv(),g=[qi.wizard,qi.warrior,qi.rogue,qi.paladin].filter(Boolean),h=T=>{s(T)},y=T=>{p("character-preview",T)},b=async()=>{if(l){u(!0);try{await new Promise(T=>setTimeout(T,500)),f(l),r?.(l),m("game")}catch(T){console.error("Erreur lors de la slection du personnage:",T)}finally{u(!1)}}},S=T=>({Magicien:"Matre des arcanes, ce personnage utilise des sorts puissants pour vaincre ses ennemis. Fragile mais redoutable  distance, il excelle dans le contrle du champ de bataille.",Guerrier:"Combattant expriment, ce hros excelle au corps--corps avec ses armes. Robuste et polyvalent au combat, il peut encaisser et infliger de lourds dgts.",Roublard:"Expert en furtivit, ce personnage frappe avec prcision et vite les coups. Agile et mortel par surprise, il excelle dans les situations qui demandent de la finesse.",Paladin:"Chevalier sacr, ce hros allie force et foi. Capable de soigner ses allis et de frapper avec puissance, il est un pilier de dfense et de soutien."})[T.class]||"Un aventurier prt  affronter tous les dfis.",A=T=>({Magicien:"",Guerrier:"",Roublard:"",Paladin:""})[T]||"";return c.jsxs("div",{className:"character-selection-screen",children:[c.jsxs("div",{className:"selection-header",children:[c.jsx("h1",{className:"character-selection__title",children:" Choisis ton Hros "}),c.jsx("p",{className:"character-selection__subtitle",children:"Slectionne le personnage avec lequel tu veux vivre cette aventure pique !"})]}),c.jsx("div",{className:"character-grid",children:g.map((T,N)=>c.jsx(ay,{character:T,isSelected:l?.name===T.name,onSelect:()=>h(T),onPreview:()=>y(T),icon:A(T.class),description:S(T)},`${T.name}-${N}`))}),l&&c.jsxs(Te,{className:"character-details",children:[c.jsxs(Qt,{children:[c.jsxs("h3",{children:[A(l.class)," ",l.name]}),c.jsxs("p",{children:[l.level,"e niveau ",l.race," ",l.class]})]}),c.jsxs(at,{children:[c.jsx("p",{className:"character-selection__description",children:S(l)}),c.jsxs("div",{className:"character-stats-preview",children:[c.jsxs("div",{className:"stat-preview",children:[c.jsx("span",{className:"quick-stat__label",children:" PV "}),c.jsx("span",{className:"quick-stat__value",children:l.maxHP})]}),c.jsxs("div",{className:"stat-preview",children:[c.jsx("span",{className:"quick-stat__label",children:" CA "}),c.jsx("span",{className:"quick-stat__value",children:l.ac})]}),c.jsxs("div",{className:"stat-preview",children:[c.jsx("span",{className:"quick-stat__label",children:" Initiative "}),c.jsxs("span",{className:"quick-stat__value",children:["+ ",Math.floor((l.stats.dexterite-10)/2)]})]})]})]}),c.jsx(Pi,{children:c.jsx("div",{className:"character-selection__actions",children:c.jsx(ce,{variant:"primary",onClick:b,loading:i,disabled:!l,size:"large",children:i?"Prparation...":" Commencer l'aventure !"})})})]}),!l&&c.jsx("div",{className:"character-selection__help",children:c.jsx(Te,{variant:"ghost",className:"character-selection__help-card",children:c.jsx(at,{children:c.jsx("p",{children:' Clique sur un personnage pour le slectionner, ou sur "Voir les dtails" pour examiner ses caractristiques compltes.'})})})}),c.jsx(So,{type:"character-preview",size:"large",title:"Aperu du personnage",children:({data:T,onClose:N})=>c.jsx("div",{className:"character-preview-modal",children:T&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"character-preview-modal__header",children:[c.jsxs("h2",{children:[A(T.class)," ",T.name]}),c.jsxs("p",{children:[T.level,"e niveau ",T.race," ",T.class]})]}),c.jsxs("div",{className:"character-preview-modal__content",children:[c.jsx("div",{className:"character-preview-modal__description",children:c.jsx("p",{children:S(T)})}),c.jsx("div",{className:"character-preview-modal__sheet",children:c.jsx(ty,{characterData:T})})]}),c.jsxs("div",{className:"character-preview-modal__actions",children:[c.jsx(ce,{variant:"secondary",onClick:N,children:"Fermer"}),c.jsx(ce,{variant:"primary",onClick:()=>{s(T),N()},children:"Choisir ce personnage"})]})]})})})]})},sy=({character:r,variant:l="default",className:s="",onAbilityUse:i})=>{if(!r?.specialAbilities||Object.keys(r.specialAbilities).length===0)return null;const u=["special-abilities-panel",`special-abilities-panel--${l}`,s].filter(Boolean).join(" "),m=(f,p)=>{i&&p.uses&&p.uses.current>0&&i(f,p)};return c.jsxs(Te,{className:u,children:[c.jsx(Qt,{children:c.jsx("h4",{children:"Capacits Spciales"})}),c.jsx(at,{children:c.jsx("div",{className:"abilities-list",children:Object.entries(r.specialAbilities).map(([f,p])=>c.jsxs("div",{className:"ability-item",children:[c.jsxs("div",{className:"ability-header",children:[c.jsx("h5",{className:"ability-name",children:p.name}),p.level&&c.jsxs("span",{className:"ability-level",children:["Niveau ",p.level]})]}),c.jsx("p",{className:"ability-description",children:p.description}),p.damage&&c.jsx("div",{className:"ability-stats",children:c.jsxs("span",{className:"ability-damage",children:["Dgts: ",p.damage]})}),p.uses&&c.jsxs("div",{className:"ability-uses",children:[c.jsxs("span",{className:"ability-uses-text",children:["Utilisations: ",p.uses.current||0,"/",p.uses.max]}),l==="interactive"&&p.uses.current>0&&c.jsx("button",{className:"ability-use-button",onClick:()=>m(f,p),title:`Utiliser ${p.name}`,children:"Utiliser"})]}),p.skills&&c.jsx("div",{className:"ability-skills",children:c.jsxs("span",{className:"ability-skills-text",children:["Comptences affectes: ",p.skills.join(", ")]})})]},f))})})]})},Jp=({companion:r,variant:l="default",className:s="",showActions:i=!1,showRole:u=!1,onAction:m})=>{if(!r)return null;const f=["companion-display",`companion-display--${l}`,s].filter(Boolean).join(" "),p=r.maxHP>0?Math.max(0,r.currentHP/r.maxHP*100):0,g=r.currentHP>0,h=p<=25&&p>0,y=S=>{switch(S){case"tank":return"";case"healer":return"";case"dps":return"";default:return""}},b=S=>{switch(S){case"tank":return"Tank";case"healer":return"Soigneur";case"dps":return"DPS";default:return"Compagnon"}};return c.jsxs(Te,{className:f,children:[c.jsx(Qt,{children:c.jsxs("h4",{children:[u&&r.role&&c.jsx("span",{className:"companion-role-icon",title:b(r.role),children:y(r.role)}),u?b(r.role):"Compagnon"]})}),c.jsx(at,{children:c.jsxs("div",{className:"companion-card",children:[r.image&&c.jsx("div",{className:"companion-image-container",children:c.jsx("img",{src:r.image,alt:r.name,className:"companion-image"})}),c.jsxs("div",{className:"companion-info",children:[c.jsxs("div",{className:"companion-header",children:[c.jsx("span",{className:"companion-name",children:r.name}),l!=="compact"&&c.jsxs("span",{className:"companion-ac",children:["CA: ",r.ac]})]}),c.jsxs("div",{className:"companion-health",children:[c.jsxs("div",{className:"companion-hp-display",children:[c.jsx(Yp,{className:`hp-icon ${g?"":"hp-icon--dead"}`}),c.jsxs("span",{className:`hp-text ${g?"":"hp-text--dead"}`,children:[Math.max(0,r.currentHP)," / ",r.maxHP," PV"]})]}),c.jsx(Li,{current:r.currentHP,max:r.maxHP,size:l==="compact"?"small":"medium",animated:!0,showPercentage:l==="detailed"})]}),l==="detailed"&&c.jsxs("div",{className:"companion-details",children:[c.jsxs("div",{className:"companion-stats",children:[c.jsxs("span",{children:["Initiative: +",Be.getInitiativeModifier(r)]}),c.jsxs("span",{children:["Vitesse: ",r.speed||30," ft"]})]}),r.attacks&&r.attacks.length>0&&c.jsxs("div",{className:"companion-attacks",children:[c.jsx("h5",{children:"Attaques:"}),r.attacks.map((S,A)=>c.jsxs("div",{className:"attack-info",children:[c.jsx("span",{className:"attack-name",children:S.name}),c.jsxs("span",{className:"attack-damage",children:["(",S.damage,")"]})]},A))]})]}),i&&g&&c.jsxs("div",{className:"companion-actions",children:[c.jsx("button",{className:"action-button action-button--heal",onClick:()=>m?.("heal",r),disabled:r.currentHP>=r.maxHP,children:"Soigner"}),c.jsx("button",{className:"action-button action-button--rest",onClick:()=>m?.("rest",r),children:"Repos"})]}),!g&&c.jsxs("div",{className:"companion-status companion-status--dead",children:[c.jsx("span",{children:" Inconscient"}),i&&c.jsx("button",{className:"action-button action-button--revive",onClick:()=>m?.("revive",r),children:"Ranimer"})]}),h&&g&&c.jsx("div",{className:"companion-status companion-status--wounded",children:c.jsx("span",{children:" Gravement bless"})})]})]})})]})},ly=({companions:r=[],variant:l="default",showRoles:s=!0,layout:i="grid",className:u="",onCompanionAction:m})=>{if(!r||r.length===0)return c.jsx("div",{className:"companion-party companion-party--empty",children:c.jsx("p",{children:"Aucun compagnon actif"})});const f=["companion-party",`companion-party--${i}`,`companion-party--${l}`,u].filter(Boolean).join(" ");return c.jsxs("div",{className:f,children:[i!=="compact"&&c.jsx("div",{className:"companion-party__header",children:c.jsxs("h3",{children:["Compagnons (",r.length,"/3)"]})}),c.jsx("div",{className:"companion-party__grid",children:r.map((p,g)=>c.jsx(Jp,{companion:p,variant:l,showRole:s,showActions:l==="interactive",onAction:(h,y)=>m?.(h,y)},p.id||p.name||g))}),r.length<3&&l==="management"&&c.jsx("div",{className:"companion-party__add-slot",children:c.jsx("div",{className:"companion-add-button",children:c.jsx("span",{children:"+ Recruter un compagnon"})})})]})},iy=({playerCharacter:r,playerCompanion:l,activeCompanions:s=[],enemies:i,positions:u,selectedAction:m,selectedTargets:f,currentTurn:p,phase:g,onTargetSelect:h,onMoveCharacter:y})=>{const[T,N]=se.useState(null),[q,_]=se.useState([]),D=se.useCallback(($,U)=>{if(u.player?.x===$&&u.player?.y===U)return{...r,id:"player",type:"player"};if(s&&s.length>0)for(const E of s){const B=E.id||E.name.toLowerCase(),Y=u[B];if(Y?.x===$&&Y?.y===U)return{...E,id:B,type:"companion"}}for(const E of i){const B=u[E.name];if(B?.x===$&&B?.y===U&&E.currentHP>0)return E}return null},[u,r,l,s,i]),G=($,U)=>{const E=$/U;return E>.6?"#4caf50":E>.3?"#ff9800":"#f44336"},re=($,U,E,B)=>Math.abs($-E)+Math.abs(U-B),F=($,U)=>{if(g!=="player-movement")return!1;const E=u.player,B=u.playerStartPos||E;return!E||!B?!1:re(B.x,B.y,$,U)<=6&&!D($,U)},ee=($,U)=>{if(!m||g!=="player-turn")return!1;const E=D($,U);return m.type==="attack"?E?.type==="enemy"&&E.currentHP>0:m.areaOfEffect?!0:m.type==="spell"?E?.type==="enemy"&&E.currentHP>0:!1},I=se.useCallback(($,U,E)=>{const B=[];switch(E.shape){case"sphere":{const Y=Math.floor(E.radius/5);for(let J=0;J<8;J++)for(let j=0;j<6;j++)Math.sqrt(Math.pow(J-$,2)+Math.pow(j-U,2))<=Y&&B.push({x:J,y:j});break}case"cube":{const Y=Math.floor(E.size/5);for(let J=$;J<Math.min($+Y,8);J++)for(let j=U;j<Math.min(U+Y,6);j++)J>=0&&j>=0&&B.push({x:J,y:j});break}}return B},[]),ne=($,U)=>{if(N({x:$,y:U}),m?.areaOfEffect&&g==="player-turn"){const E=I($,U,m.areaOfEffect);_(E)}else _([])},K=()=>{N(null),_([])},he=($,U)=>{if(g==="player-movement"){F($,U)&&y?.("player",{x:$,y:U});return}if(g==="player-turn"&&m)if(m.areaOfEffect)h?.({x:$,y:U,isPosition:!0});else{const E=D($,U);E&&ee($,U)&&h?.(E)}},oe=($,U)=>{const E=["combat-grid__cell"],B=D($,U);return B&&(E.push("combat-grid__cell--occupied"),E.push(`combat-grid__cell--${B.type}`),p<u.turnOrder?.length&&u.turnOrder[p]?.id===B.id&&E.push("combat-grid__cell--current-turn"),f.some(Y=>Y.id===B.id)&&E.push("combat-grid__cell--selected-target")),T?.x===$&&T?.y===U&&E.push("combat-grid__cell--hovered"),q.some(Y=>Y.x===$&&Y.y===U)&&E.push("combat-grid__cell--aoe-highlight"),F($,U)&&E.push("combat-grid__cell--valid-movement"),ee($,U)&&E.push("combat-grid__cell--valid-target"),E.join(" ")},Ce=$=>{switch($.type){case"player":return"";case"companion":return"";case"enemy":return"";default:return""}},Ye=($,U)=>{const E=D($,U),B=`${$}-${U}`;return c.jsxs("div",{className:oe($,U),onMouseEnter:()=>ne($,U),onMouseLeave:K,onClick:()=>he($,U),title:E?`${E.name} (${E.currentHP}/${E.maxHP} PV)`:`Case (${$}, ${U})`,children:[c.jsxs("span",{className:"combat-grid__coordinates",children:[$,",",U]}),E&&c.jsxs("div",{className:"combat-grid__combatant",children:[E.image?c.jsx("img",{src:E.image,alt:E.name,className:"combat-grid__combatant-image"}):c.jsx("span",{className:"combat-grid__combatant-icon",children:Ce(E)}),c.jsx("span",{className:"combat-grid__combatant-name",children:E.name}),c.jsxs("span",{className:"combat-grid__combatant-ac",children:["CA",E.ac]}),c.jsxs("span",{className:"combat-gird-health",children:[E.currentHP,"/",E.maxHP,""]}),c.jsx("div",{className:"combat-grid__health-bar w-95",children:c.jsx("div",{className:"combat-grid__health-fill",style:{width:`${E.currentHP/E.maxHP*100}%`,backgroundColor:G(E.currentHP,E.maxHP)}})})]}),F($,U)&&c.jsx("div",{className:"combat-grid__movement-indicator",children:""}),ee($,U)&&!E&&c.jsx("div",{className:"combat-grid__target-indicator",children:""})]},B)};return c.jsxs("div",{className:"combat-grid",children:[c.jsx("div",{className:"combat-grid__container",style:{gridTemplateColumns:"repeat(8, 1fr)",gridTemplateRows:"repeat(6, 1fr)"},children:Array.from({length:6},($,U)=>Array.from({length:8},(E,B)=>Ye(B,U)))}),c.jsxs("div",{className:"combat-grid__legend",children:[c.jsxs("div",{className:"combat-grid__legend-item",children:[c.jsx("span",{className:"combat-grid__legend-icon",children:""}),c.jsx("span",{children:"Joueur"})]}),l&&c.jsxs("div",{className:"combat-grid__legend-item",children:[c.jsx("span",{className:"combat-grid__legend-icon",children:""}),c.jsx("span",{children:"Compagnon"})]}),c.jsxs("div",{className:"combat-grid__legend-item",children:[c.jsx("span",{className:"combat-grid__legend-icon",children:""}),c.jsx("span",{children:"Ennemis"})]})]})]})},ry=({currentTurn:r,turnOrder:l,phase:s,onPhaseChange:i,onNextTurn:u})=>{const{combatEnemies:m,combatPositions:f,dealDamageToEnemy:p,updateEnemyPosition:g,setDamageCallbacks:h}=la(),{addCombatMessage:y}=yt(),{takeDamagePlayer:b,takeDamageCompanionById:S,playerCharacter:A,playerCompanion:T,getActiveCompanions:N}=At(),q=new dl;se.useEffect(()=>{h(b,S)},[h,b,S]);const _=se.useCallback(($,U)=>{const E=$.type==="companion"?$.id||"companion":$.name,B=U.combatPositions[E];if(!B)return{moved:!1,newPosition:B};const Y=ia.calculateOptimalMovement($,B,U);if(!Y)return{moved:!1,newPosition:B};if(q.executeEntityMovement($,B,Y,U,y)){g(E,Y);const j=Math.abs(Y.x-B.x)+Math.abs(Y.y-B.y);return y(`${$.name} se dplace de ${j} case(s).`),{moved:!0,newPosition:Y}}else return{moved:!1,newPosition:B}},[q,g,y]),D=se.useCallback(($,U)=>{const E=$.type==="companion"?$.id||"companion":$.name,B=U.combatPositions[E],Y=N(),J=ia.findBestTarget($,B,{...U,playerCharacter:A,activeCompanions:Y});return J||y(`${$.name} ne trouve aucune cible.`),J},[A,T,y,N]),G=se.useCallback(($,U)=>{$.type==="player"?b(U):$.type==="companion"?S($.character.id,U):$.type==="enemy"&&(p($.name,U),setTimeout(()=>{const E=m.find(B=>B.name===$.name);E&&E.currentHP<=0&&y(` ${$.name} tombe au combat !`,"enemy-death")},100))},[b,S,p,y,m]),re=se.useCallback(($,U)=>{const E=$.filter(J=>J.attacks.some(j=>{const k=j.range||1;return U<=k}));if(E.length===0)return null;const B=E.filter(J=>J.attacks.some(j=>j.type==="melee"&&U<=(j.range||1))),Y=E.filter(J=>J.attacks.some(j=>j.type==="ranged"&&U<=(j.range||6)));return U<=1&&B.length>0?B[0]:Y.length>0?Y[0]:E[0]},[]),F=se.useCallback(($,U,E,B)=>{const J=($.attacks||[{name:"Attaque de base",damageDice:"1d6",damageBonus:0,range:1}]).filter(Q=>{const Z=Q.range||1;return B<=Z});if(J.length===0)return y(`${$.name} est trop loin pour attaquer.`),!1;const j=J[Math.floor(Math.random()*J.length)],k=q.executeEntityAttack($,j,U,y);return k.success&&G(U,k.damage),k.success},[q,y,G]),ee=se.useCallback(($,U,E,B)=>{const Y=re($.attackSets,B);if(!Y)return y(`${$.name} ne peut pas attaquer  cette distance.`),!1;y(`${$.name} lance ${Y.name}.`);let J=!1,j=0;for(const k of Y.attacks){if(U.character.currentHP<=0)break;j++;const Q=q.executeEntityAttack($,k,U,y);Q.success&&(J=!0,G(U,Q.damage),j<Y.attacks.length&&setTimeout(()=>{},200))}return J},[q,y,re,G]),I=se.useCallback(($,U,E)=>{if(!U||!U.character)return!1;if(U.character.currentHP<=0)return y(`${$.name} ralise que ${U.name} est dj tomb au combat.`),!1;const B=$.type==="companion"?$.id||"companion":$.name,Y=E.combatPositions[B],J=vt(Y,U.position);return $.attackSets&&$.attackSets.length>0?ee($,U,E,J):F($,U,E,J)},[ee,F,y]),ne=se.useCallback($=>{const U=m.find(Q=>Q.name===$.name);if(!U||U.currentHP<=0){setTimeout(()=>{oe(!1),u()},200);return}console.log("enemyturn");const E=N(),B={combatPositions:la.getState().combatPositions,combatEnemies:m,playerCharacter:A,activeCompanions:E},Y=_(U,B),J=m.find(Q=>Q.name===$.name);if(!J||J.currentHP<=0){setTimeout(()=>{oe(!1),u()},200);return}const j={...B,combatPositions:la.getState().combatPositions,activeCompanions:E},k=D(J,j);if(!k){setTimeout(()=>{oe(!1),u()},200);return}setTimeout(()=>{const Q=m.find(Z=>Z.name===$.name);if(!Q||Q.currentHP<=0){oe(!1),u();return}I(Q,k,j),setTimeout(()=>{oe(!1),u()},300)},Y.moved?800:400)},[m,A,T,_,D,I,u,i]),K=se.useCallback($=>{console.log(" handleCompanionTurn called with:",$);const U=N();console.log(" Active companions available:",U);const E=$.character||T;if(console.log(" Actual companion to use:",E),!E||E.currentHP<=0){console.log(" Companion cannot act - injured or missing"),y(`${$.name} est trop bless pour agir.`),setTimeout(()=>{oe(!1),u()},500);return}const B={combatPositions:la.getState().combatPositions,combatEnemies:m.filter(k=>k.currentHP>0),playerCharacter:null,activeCompanions:[]},Y={...E,name:$.name,id:$.id||$.name.toLowerCase(),type:"companion",attacks:E.attacks||[{name:"Attaque de base",damageDice:"1d6",damageBonus:0,range:1}]},J=_(Y,B),j={...B,combatPositions:la.getState().combatPositions,activeCompanions:U};setTimeout(()=>{const k=D(Y,j);if(!k){y(`${$.name} ne trouve aucune cible.`),setTimeout(()=>{oe(!1),u()},500);return}I(Y,k,j),setTimeout(()=>{oe(!1),u()},500)},J.moved?1e3:500)},[T,m,q,g,y,I,u,i]),[he,oe]=Pe.useState(!1),[Ce,Ye]=Pe.useState(null);return se.useEffect(()=>{if(console.log(" TurnManager useEffect - phase:",s,"currentTurn:",r,"isExecuting:",he),s!=="executing-turn"||!r||he)return;const{turnCounter:$,currentTurnIndex:U}=la.getState(),E=`${r.name}-${r.type}-${$}-${U}`;if(console.log(" Turn key:",E,"last executed:",Ce),Ce===E){console.log(" Skipping already executed turn");return}oe(!0),Ye(E);const B=m.every(k=>k.currentHP<=0),Y=!A||A.currentHP<=0;if(B){oe(!1),i("victory");return}else if(Y){oe(!1),i("defeat");return}if((()=>{if(r.type==="player"){const k=!A||A.currentHP<=0;return console.log(" Player death check:",k,"HP:",A?.currentHP),k}else if(r.type==="companion"){const Q=N().find(te=>te.id&&te.id===r.id||te.name&&te.name===r.name),Z=!Q||Q.currentHP<=0;return console.log(" Companion death check:",r.name,"isDead:",Z,"companion:",Q,"HP:",Q?.currentHP),Z}else if(r.type==="enemy"){const k=m.find(Z=>Z.name===r.name),Q=!k||k.currentHP<=0;return console.log(" Enemy death check:",r.name,"isDead:",Q,"HP:",k?.currentHP),Q}return!1})()){console.log(" Entity is dead, skipping turn:",r.name),oe(!1);const k=m.every(Z=>Z.currentHP<=0),Q=!A||A.currentHP<=0;if(k){i("victory");return}else if(Q){i("defeat");return}u();return}const j=k=>{try{k()}catch(Q){console.error(` Erreur pendant l'excution du tour ${r.name}:`,Q),oe(!1),u()}};switch(r.type){case"enemy":j(()=>{ne(r),setTimeout(()=>oe(!1),800)});break;case"companion":console.log(" Starting companion turn execution:",r.name),j(()=>{K(r),setTimeout(()=>oe(!1),800)});break;case"player":A&&A.currentHP>0?(oe(!1),setTimeout(()=>{m.every(Q=>Q.currentHP<=0)&&i("victory")},100)):(oe(!1),i("defeat"));break;default:console.warn(` Type de tour inconnu: ${r.type}`),oe(!1),u()}},[s,r,he,Ce,ne,K,u,i,A,T,m]),null},cy=({playerCharacter:r,selectedAction:l,selectedTargets:s,onSelectAction:i,onExecuteAction:u,onPassTurn:m,canMove:f=!0,onMoveToggle:p})=>{const h=(()=>{const N=[];if(r.equipment?.mainHand){const _=r.equipment.mainHand,D=ja[_];D&&N.push({...D,id:_})}const q=(r.weapons||[]).map(_=>ja[_]).filter(_=>_).map(_=>({..._,id:_.id}));return N.push(...q),N})(),y=h.length>0?h.map(N=>({id:`attack_${N.id||N.name}`,type:"attack",name:N.name,description:`Attaque avec ${N.name}`,damage:typeof N.damage=="object"?`${N.damage.dice}${N.damage.bonus>0?`+${N.damage.bonus}`:""}`:N.damage,damageType:N.damageType,range:N.category==="ranged"?N.range?.ranged:N.range?.melee||1,stat:N.stat,icon:N.category==="ranged"?"":""})):[{id:"attack_unarmed",type:"attack",name:"Attaque  mains nues",description:"Attaque de base sans arme",damage:"1d4",damageType:"contondant",range:1,stat:"force",icon:""}],b=[];if(r.spellcasting){const N=(r.spellcasting.cantrips||[]).map(_=>{const D=Sa[_]||{};return{id:`cantrip_${_}`,type:"spell",name:_,description:`Cantrip: ${_}`,level:0,range:D.range||60,projectiles:D.projectiles||1,damage:D.damage,requiresAttackRoll:D.requiresAttackRoll,icon:""}}),q=(r.spellcasting.preparedSpells||[]).filter(_=>{const G=(Sa[_]||{}).level||1,re=r.spellcasting.spellSlots||{};for(let F=G;F<=9;F++){const ee=re[F];if(ee&&ee.available>0)return!0}return!1}).map(_=>{const D=Sa[_]||{};return{id:`spell_${_}`,type:"spell",name:_,description:`Sort: ${_}`,level:D.level||1,range:D.range||30,projectiles:D.projectiles||1,damage:D.damage,requiresAttackRoll:D.requiresAttackRoll,icon:""}});b.push(...N,...q)}const S=N=>c.jsx(Dp,{variant:l?.id===N.id?"primary":"secondary",onClick:()=>i(N),disabled:l&&l.id!==N.id,children:c.jsxs("div",{className:"action-button__content",children:[c.jsx("span",{className:"action-button__icon",children:N.icon}),c.jsxs("div",{className:"action-button__details",children:[c.jsx("span",{className:"action-button__name",children:N.name}),N.damage&&c.jsxs("span",{className:"action-button__damage",children:["Dgts: ",typeof N.damage=="string"?N.damage:`${N.damage.dice}${N.damage.bonus>0?`+${N.damage.bonus}`:""}`]}),N.level>0&&c.jsxs("span",{className:"action-button__level",children:["Niveau ",N.level]})]})]})},N.id);l&&s.length>0;const A=l?.projectiles||1,T=s.length<A;return c.jsxs(Te,{className:"combat-action-panel",children:[c.jsxs(Qt,{children:[c.jsxs("h3",{children:[" Actions de ",r.name]}),c.jsx("div",{className:"combat-action-panel__status",children:l&&c.jsxs("span",{className:"selected-action",children:[l.name," slectionn",T&&c.jsxs("span",{className:"target-count",children:["(",s.length,"/",A," cibles)"]})]})})]}),c.jsxs(at,{children:[f&&c.jsxs("div",{className:"combat-action-section",children:[c.jsx("h4",{children:"Mouvement"}),c.jsx(Dp,{variant:"ghost",onClick:p,disabled:!!l,children:c.jsxs("div",{className:"action-button__content",children:[c.jsx("span",{className:"action-button__icon",children:""}),c.jsx("span",{className:"action-button__name",children:"Se dplacer"})]})})]}),y.length>0&&c.jsxs("div",{className:"combat-action-section",children:[c.jsx("h4",{children:"Attaques"}),c.jsx("div",{className:"combat-actions-grid",children:y.map(S)})]}),b.length>0&&c.jsxs("div",{className:"combat-action-section",children:[c.jsx("h4",{children:"Sorts"}),c.jsx("div",{className:"combat-actions-grid",children:b.map(S)})]}),l&&c.jsx("div",{className:"combat-action-instructions",children:c.jsx("p",{children:l.areaOfEffect?"Cliquez sur une case pour cibler la zone d'effet":T?`Slectionnez ${A-s.length} cible(s) pour excuter l'action`:"Action prte  tre excute"})}),s.length>0&&c.jsxs("div",{className:"combat-selected-targets",children:[c.jsx("h5",{children:"Cibles slectionnes:"}),c.jsx("ul",{className:"combat-selected-targets__list",children:s.map((N,q)=>c.jsxs("li",{className:"selected-target",children:[N.name," (PV: ",N.currentHP,"/",N.maxHP,")"]},q))})]})]}),c.jsx(Pi,{children:c.jsxs("div",{className:"combat-action-panel__controls",children:[l&&c.jsx(ce,{variant:"ghost",onClick:()=>i(null),children:"Annuler"}),c.jsx(ce,{variant:"secondary",onClick:m,children:"Passer le tour"})]})})]})},Op=({playerCharacter:r,playerCompanion:l,activeCompanions:s=[],encounterData:i,onCombatEnd:u,onReplayCombat:m,combatKey:f})=>{const{combatPhase:p,currentTurnIndex:g,turnOrder:h,combatEnemies:y,combatPositions:b,playerAction:S,actionTargets:A,defeated:T,victory:N,isInitialized:q,initializeCombat:_,startCombat:D,setTurnPhase:G,nextTurn:re,setPlayerAction:F,setActionTargets:ee,resetCombat:I,moveCharacter:ne}=la(),K=h[g],he=()=>ee([]),{addCombatMessage:oe,combatLog:Ce,clearCombatLog:Ye}=yt();se.useEffect(()=>{!i||!i.enemies?.length||(f!==void 0&&I(),q||(s.length>0&&s[0],_(i,r,s)))},[i,f,q,r,l,s,_,D,I,oe,h]),se.useEffect(()=>{p==="initiative-display"&&(oe("Un combat commence !","combat-start"),h.forEach(J=>{const j=`${J.name} a obtenu ${J.initiative} en initiative !`;oe(j,"combat-start")}))},[p]),se.useEffect(()=>{if(p==="turn"&&K){console.log(" Phase transition - Current turn:",K);const J=y.every(k=>k.currentHP<=0),j=!r||r.currentHP<=0;if(J){console.log(" All enemies dead - Victory!"),G("victory");return}else if(j){console.log(" Player dead - Defeat!"),G("defeat");return}K.type==="player"?(console.log(" Player turn starting"),G("player-turn")):K.type==="enemy"?(console.log(" Enemy turn starting:",K.name),G("executing-turn")):K.type==="companion"&&(console.log(" Companion turn starting:",K.name),G("executing-turn"))}},[p,K,G,y,r,l]);const $=se.useCallback(J=>{F(J)},[F]),U=se.useCallback(J=>{if(!S)return;const j=[...A,J];ee(j);const k=S.projectiles||1;j.length>=k&&setTimeout(()=>{const Z=new dl().executePlayerAction(r,S,j,y,b);Z.messages.forEach(te=>oe(te.text,te.type)),Z.damage&&Z.damage.length>0&&Z.damage.forEach(te=>{const pe=y.find(ie=>ie.name===te.targetId||ie.id===te.targetId);if(pe){const{dealDamageToEnemy:ie}=la.getState();ie(pe.name,te.damage),setTimeout(()=>{const Je=y.find(Ae=>Ae.name===pe.name);Je&&Je.currentHP<=0&&pe.currentHP>0&&oe(` ${pe.name} tombe au combat !`,"enemy-death")},100)}}),he(),F(null),re()},500)},[S,A,ee,r,y,b,oe,he,F,re]),E=se.useCallback(()=>{if(!S||!A.length)return;new dl().executePlayerAction(r,S,A,y,b).messages.forEach(k=>oe(k.text,k.type)),he(),F(null),re()},[S,A,r,y,b,oe,he,F,re]),B=()=>{oe(`${r.name} passe son tour.`),he(),F(null),re()},Y=()=>{switch(p){case"initializing":return c.jsx(Te,{children:c.jsxs("div",{className:"combat-phase-content",children:[c.jsx("h3",{children:"Initialisation du combat..."}),c.jsx("p",{children:"Prparation des combattants et jets d'initiative"})]})});case"initiative-display":return c.jsx(Te,{children:c.jsxs("div",{className:"combat-phase-content",children:[c.jsx("h3",{children:"Initiative lance !"}),c.jsx("p",{children:"Les jets d'initiative ont t effectus. Prt  commencer le combat ?"}),c.jsx(ce,{onClick:()=>D(),children:"Commencer le combat"})]})});case"player-turn":return c.jsx(cy,{playerCharacter:r,selectedAction:S,selectedTargets:A,onSelectAction:$,onExecuteAction:E,onPassTurn:B,canMove:!b.playerHasMoved,onMoveToggle:()=>G("player-movement")});case"player-movement":return c.jsx(Te,{children:c.jsxs("div",{className:"combat-phase-content",children:[c.jsx("h3",{children:"Phase de mouvement"}),c.jsx("p",{children:"Cliquez sur une case pour vous dplacer (maximum 6 cases)"}),c.jsx(ce,{onClick:()=>G("player-turn"),children:"Terminer le mouvement"})]})});case"victory":return c.jsx(Te,{children:c.jsxs("div",{className:"combat-phase-content",children:[c.jsx("h3",{children:" Victoire !"}),c.jsx("p",{children:"Tous les ennemis ont t vaincus !"}),c.jsx(ce,{onClick:()=>{Ye(),u?.(i)},children:"Continuer l'aventure"})]})});case"defeat":return c.jsx(Te,{variant:"danger",children:c.jsxs("div",{className:"combat-phase-content",children:[c.jsx("h3",{children:" Dfaite"}),c.jsx("p",{children:"Vous avez t vaincu..."}),c.jsx("div",{className:"combat-defeat-actions",children:c.jsx(ce,{variant:"secondary",onClick:m,children:"Rejouer le combat"})})]})});case"enemy-turn":console.log("enemy");case"companion-turn":case"executing-turn":return c.jsx(Te,{children:c.jsxs("div",{className:"combat-phase-content",children:[c.jsx("h3",{children:"Tour en cours"}),c.jsxs("p",{children:[K?.type==="enemy"&&`${K.name} rflchit...`,K?.type==="companion"&&`${K.name} agit...`,(!K||K.type==="player")&&"Attendez la fin du tour en cours..."]})]})});default:return c.jsx(Te,{children:c.jsxs("div",{className:"combat-phase-content",children:[c.jsx("h3",{children:"Combat en cours"}),c.jsxs("p",{children:["Phase: ",p," - Attendez..."]})]})})}};return q?c.jsxs("div",{className:"combat-container",children:[c.jsx(ry,{currentTurn:K,turnOrder:h,phase:p,onPhaseChange:G,onNextTurn:re}),c.jsxs("div",{className:"combat-layout",children:[c.jsx("div",{className:"combat-grid-section",children:c.jsx(iy,{playerCharacter:r,playerCompanion:l,activeCompanions:s,enemies:y,positions:b,selectedAction:S,selectedTargets:A,currentTurn:K,phase:p,onTargetSelect:U,onMoveCharacter:(J,j)=>{ne(J,j)}})}),c.jsxs("div",{className:"combat-side-container",children:[c.jsx("div",{className:"combat-controls",children:Y()}),c.jsx("div",{className:"combat-log-section",children:c.jsx(sa,{title:"Combat",maxEntries:10,showTimestamps:!1})})]})]})]}):c.jsx("div",{className:"combat-container",children:c.jsx(Te,{children:c.jsx("div",{className:"combat-loading",children:c.jsx("h3",{children:"Chargement du combat..."})})})})},oy=({item:r,character:l,viewMode:s="grid",onClick:i,onUse:u,onEquip:m,onUnequip:f,className:p=""})=>{const g=r.nom||r.name||"Objet inconnu",h=r.description||"Aucune description",y=r.quantity||1,b=r.poids||r.weight||.1,S=r.rarity||"commun",A=r.type||"misc",T=r.equipped||!1,N=["inventory-item",`inventory-item--${s}`,`inventory-item--${A}`,`inventory-item--${S.replace(/\s+/g,"-")}`,T&&"inventory-item--equipped",p].filter(Boolean).join(" "),q=()=>{switch(A){case"weapon":case"arme":return"";case"armor":case"armure":return"";case"consumable":case"potion":return"";case"accessory":case"accessoire":return"";case"outil":return"";case"livre":return"";default:return""}},_=()=>{switch(S?.toLowerCase()){case"commun":return"";case"peu commun":return"";case"rare":return"";case"trs rare":return"";case"lgendaire":return"";case"artfact":return"";default:return""}},D=I=>{switch(I?.toLowerCase()){case"commun":return"#9e9e9e";case"peu commun":return"#4caf50";case"rare":return"#2196f3";case"trs rare":return"#9c27b0";case"lgendaire":return"#ff9800";case"artfact":return"#f44336";default:return"#9e9e9e"}},G=()=>["weapon","armor","accessory"].includes(A)&&!T,re=()=>r.effet||r.action||A==="potion"||A==="consumable",F=()=>c.jsx(Te,{className:N,onClick:i,style:{borderColor:D(S)},children:c.jsxs("div",{className:"inventory-item__content",children:[c.jsxs("div",{className:"inventory-item__header",title:`${g} - ${h} item ${S}`,children:[c.jsx("span",{className:"inventory-item__icon",children:q()}),c.jsx("h5",{className:"inventory-item__name",children:g}),y>1&&c.jsxs("span",{className:"inventory-item__quantity",children:["x ",y]}),c.jsx("span",{className:"inventory-item__icon",children:_()}),T&&c.jsx("span",{className:"inventory-item__equipped-badge",children:""})]}),c.jsx("div",{className:"inventory-item__info",children:s!=="compact"&&c.jsxs(c.Fragment,{children:[c.jsx("p",{className:"inventory-item__description",children:h.length>100?`${h.substring(0,100)}...`:h}),c.jsxs("div",{className:"inventory-item__stats",children:[b>0&&c.jsxs("span",{className:"inventory-item__weight",children:[" ",b," kg"]}),c.jsx("span",{className:"inventory-item__rarity",children:S})]})]})}),s!=="compact"&&c.jsxs("div",{className:"inventory-item__actions",children:[re()&&c.jsx(ce,{size:"small",variant:"primary",onClick:I=>{I.stopPropagation(),u?.()},children:"Utiliser"}),G()&&c.jsx(ce,{size:"small",variant:"secondary",onClick:I=>{I.stopPropagation(),m?.()},children:"quiper"}),T&&c.jsx(ce,{size:"small",variant:"ghost",onClick:I=>{I.stopPropagation(),f?.()},children:"Retirer"})]})]})}),ee=()=>c.jsx("div",{className:N,onClick:i,children:c.jsxs("div",{className:"inventory-item__list-content",children:[c.jsxs("div",{className:"inventory-item__header",title:`${g} - ${h} item ${S}`,children:[c.jsx("span",{className:"inventory-item__icon",children:q()}),c.jsx("h5",{className:"inventory-item__name",children:g}),y>1&&c.jsxs("span",{className:"inventory-item__quantity",children:["x ",y]}),c.jsx("span",{className:"inventory-item__icon",children:_()}),T&&c.jsx("span",{className:"inventory-item__equipped-badge",children:""})]}),c.jsxs("div",{className:"inventory-item__list-actions",children:[re()&&c.jsx(ce,{size:"small",variant:"primary",onClick:I=>{I.stopPropagation(),u?.()},children:"Utiliser"}),G()&&c.jsx(ce,{size:"small",variant:"secondary",onClick:I=>{I.stopPropagation(),m?.()},children:"quiper"}),T&&c.jsx(ce,{size:"small",variant:"ghost",onClick:I=>{I.stopPropagation(),f?.()},children:"Retirer"})]})]})});switch(s){case"list":return ee();case"compact":case"grid":default:return F()}},uy=({items:r=[],viewMode:l="grid",onItemClick:s,onItemUse:i,onItemEquip:u,onItemUnequip:m,character:f,className:p=""})=>{const g=["inventory-grid",`inventory-grid--${l}`,p].filter(Boolean).join(" ");return r.length===0?c.jsx("div",{className:"inventory-grid-empty"}):c.jsx("div",{className:g,children:r.map((h,y)=>c.jsx(oy,{item:h,character:f,viewMode:l,onClick:()=>s?.(h),onUse:()=>i?.(h),onEquip:()=>u?.(h),onUnequip:()=>m?.(h)},h.id||h.nom||h.name||y))})},dy=({filters:r={},onFilterChange:l,sortBy:s="name",onSortChange:i,availableItems:u=[],className:m=""})=>{const f=q=>{l?.({searchTerm:q.target.value})},p=q=>{l?.({category:q})},g=q=>{l?.({rarity:q})},h=()=>{l?.({category:"all",rarity:"all",searchTerm:""})},y=q=>q.type==="weapon"||q.type==="arme"||q.degats?"weapons":q.type==="armor"||q.type==="armure"||q.ca?"armor":q.type==="consumable"||q.type==="potion"||q.effet?"consumables":q.type==="accessoire"?"accessories":"misc",b=[{value:"all",label:"Tout",icon:""},{value:"weapons",label:"Armes",icon:""},{value:"armor",label:"Armures",icon:""},{value:"consumables",label:"Consommables",icon:""},{value:"accessories",label:"Accessoires",icon:""},{value:"misc",label:"Divers",icon:""}],S=Pe.useMemo(()=>{const q=new Set(["all"]);return u.forEach(_=>{q.add(y(_))}),b.filter(_=>q.has(_.value))},[u]),A=[{value:"all",label:"Toutes",color:"#9e9e9e",icon:""},{value:"commun",label:"Commun",color:"#9e9e9e",icon:""},{value:"peu commun",label:"Peu commun",color:"#4caf50",icon:""},{value:"rare",label:"Rare",color:"#2196f3",icon:""},{value:"trs rare",label:"Trs rare",color:"#9c27b0",icon:""},{value:"lgendaire",label:"Lgendaire",color:"#ff9800",icon:""}],T=Pe.useMemo(()=>{const q=new Set(["all"]);return u.forEach(_=>{const D=_.rarity||"commun";q.add(D)}),A.filter(_=>q.has(_.value))},[u]),N=[{value:"name",label:"Nom",icon:""},{value:"type",label:"Type",icon:""},{value:"weight",label:"Poids",icon:""},{value:"rarity",label:"Raret",icon:""}];return c.jsxs("div",{className:`inventory-filters ${m}`,children:[c.jsx("div",{className:"inventory-filters__search",children:c.jsxs("div",{className:"search-input-group",children:[c.jsx("span",{className:"search-icon",children:""}),c.jsx("input",{type:"text",placeholder:"Rechercher un objet...",value:r.searchTerm||"",onChange:f,className:"search-input"}),r.searchTerm&&c.jsx("button",{type:"button",className:"search-clear",onClick:()=>l?.({searchTerm:""}),children:""})]})}),c.jsxs("div",{className:"inventory-filters__section",children:[c.jsx("h5",{className:"inventory-filters__label",children:"Catgories"}),c.jsx(Ta,{className:"inventory-filters__category-buttons",children:S.map(q=>c.jsxs(ce,{variant:r.category===q.value?"primary":"ghost",size:"small",onClick:()=>p(q.value),children:[c.jsx("span",{className:"button-icon",children:q.icon}),q.label]},q.value))})]}),c.jsxs("div",{className:"inventory-filters__section",children:[c.jsx("h5",{className:"inventory-filters__label",children:"Raret"}),c.jsx(Ta,{className:"inventory-filters__rarity-buttons",children:T.map(q=>c.jsxs(ce,{variant:r.rarity===q.value?"primary":"ghost",size:"small",onClick:()=>g(q.value),style:r.rarity===q.value?{borderColor:q.color}:{},children:[c.jsx("span",{className:"button-icon",children:q.icon}),q.label]},q.value))})]}),c.jsxs("div",{className:"inventory-filters__section",children:[c.jsx("h5",{className:"inventory-filters__label",children:"Trier par"}),c.jsx(Ta,{className:"inventory-filters__sort-buttons",children:N.map(q=>c.jsxs(ce,{variant:s===q.value?"primary":"ghost",size:"small",onClick:()=>i?.(q.value),children:[c.jsx("span",{className:"button-icon",children:q.icon}),q.label]},q.value))})]}),c.jsx("div",{className:"inventory-filters__actions",children:c.jsx(ce,{variant:"ghost",size:"small",onClick:h,disabled:r.category==="all"&&r.rarity==="all"&&!r.searchTerm,children:" Effacer les filtres"})})]})},my=({item:r,character:l,onClose:s,onUse:i,onEquip:u,onUnequip:m})=>{if(!r)return null;const f=r.nom||r.name||"Objet inconnu",p=r.description||"Aucune description disponible",g=r.quantity||1,h=r.poids||r.weight||0,y=r.rarity||"commun",b=r.type||"misc",S=r.equipped||!1,A=()=>{const G=[];return r.degats&&G.push({label:"Dgts",value:r.degats,icon:""}),r.ca!==void 0&&G.push({label:"Classe d'Armure",value:`+${r.ca}`,icon:""}),r.portee&&G.push({label:"Porte",value:`${r.portee} m`,icon:""}),r.proprietes&&r.proprietes.length>0&&G.push({label:"Proprits",value:r.proprietes.join(", "),icon:""}),r.effet&&G.push({label:"Effet",value:r.effet,icon:""}),r.duree&&G.push({label:"Dure",value:r.duree,icon:""}),r.prix&&G.push({label:"Prix",value:`${r.prix} po`,icon:""}),G},T=()=>{switch(b){case"arme":return"";case"armure":return"";case"potion":return"";case"accessoire":return"";case"outil":return"";case"livre":return"";case"gemme":return"";case"composant":return"";default:return""}},N=G=>{switch(G?.toLowerCase()){case"commun":return"#9e9e9e";case"peu commun":return"#4caf50";case"rare":return"#2196f3";case"trs rare":return"#9c27b0";case"lgendaire":return"#ff9800";case"artfact":return"#f44336";default:return"#9e9e9e"}},q=()=>["arme","armure","accessoire"].includes(b)&&!S,_=()=>r.effet||r.action||b==="potion",D=A();return c.jsx(So,{onClose:s,size:"medium",children:c.jsxs(Te,{className:"item-detail-modal",children:[c.jsx(Qt,{children:c.jsxs("div",{className:"item-detail-header",children:[c.jsxs("div",{className:"item-detail-icon-container",children:[c.jsx("span",{className:"item-detail-icon",style:{color:N(y)},children:T()}),g>1&&c.jsxs("span",{className:"item-detail-quantity",children:["x",g]})]}),c.jsxs("div",{className:"item-detail-title",children:[c.jsx("h2",{className:"item-detail-name",children:f}),c.jsxs("div",{className:"item-detail-meta",children:[c.jsx("span",{className:"item-detail-rarity",style:{color:N(y)},children:y}),c.jsx("span",{className:"item-detail-type",children:b}),S&&c.jsx("span",{className:"item-detail-equipped",children:" quip"})]})]})]})}),c.jsxs(at,{children:[c.jsxs("div",{className:"item-detail-section",children:[c.jsx("h4",{children:"Description"}),c.jsx("p",{className:"item-detail-description",children:p})]}),D.length>0&&c.jsxs("div",{className:"item-detail-section",children:[c.jsx("h4",{children:"Proprits"}),c.jsx("div",{className:"item-detail-properties",children:D.map((G,re)=>c.jsxs("div",{className:"item-detail-property",children:[c.jsx("span",{className:"property-icon",children:G.icon}),c.jsxs("span",{className:"property-label",children:[G.label,":"]}),c.jsx("span",{className:"property-value",children:G.value})]},re))})]}),c.jsxs("div",{className:"item-detail-section",children:[c.jsx("h4",{children:"Informations"}),c.jsxs("div",{className:"item-detail-stats",children:[c.jsxs("div",{className:"stat-item",children:[c.jsx("span",{className:"stat-icon",children:""}),c.jsx("span",{className:"stat-label",children:"Poids:"}),c.jsxs("span",{className:"stat-value",children:[h," kg"]})]}),g>1&&c.jsxs("div",{className:"stat-item",children:[c.jsx("span",{className:"stat-icon",children:""}),c.jsx("span",{className:"stat-label",children:"Quantit:"}),c.jsx("span",{className:"stat-value",children:g})]})]})]}),(r.prerequis||r.restrictions)&&c.jsxs("div",{className:"item-detail-section",children:[c.jsx("h4",{children:"Restrictions"}),c.jsxs("div",{className:"item-detail-restrictions",children:[r.prerequis&&c.jsxs("p",{className:"restriction",children:[c.jsx("span",{className:"restriction-icon",children:""}),"Prrequis: ",r.prerequis]}),r.restrictions&&c.jsxs("p",{className:"restriction",children:[c.jsx("span",{className:"restriction-icon",children:""}),r.restrictions]})]})]})]}),c.jsx(Pi,{children:c.jsxs("div",{className:"item-detail-actions",children:[c.jsx(ce,{variant:"ghost",onClick:s,children:"Fermer"}),_()&&c.jsx(ce,{variant:"primary",onClick:()=>{i?.(r),s()},children:" Utiliser"}),q()&&c.jsx(ce,{variant:"secondary",onClick:()=>{u?.(r),s()},children:" quiper"}),S&&c.jsx(ce,{variant:"ghost",onClick:()=>{m?.(r),s()},children:" Retirer"})]})})]})})},py=({className:r="",characterInventory:l,onUseItem:s})=>{const{selectedCharacter:i,useItem:u,equipItem:m,unequipItem:f}=At(),p=i,{addCombatMessage:g}=yt(),[h,y]=se.useState(null),[b,S]=se.useState({category:"all",rarity:"all",searchTerm:""}),[A,T]=se.useState("name"),[N,q]=se.useState("grid"),_=se.useMemo(()=>{if(!p)return{items:[],totalWeight:0,maxWeight:0,allItems:[]};const ne=p.equipment?Object.values(p.equipment).filter(Boolean).map(U=>{const E=ja[U];return E?{...E,id:U,equipped:!0}:null}).filter(Boolean):[],K=[...p.inventory||[],...ne,...p.equipement?.inventaire||[],...p.equipement?.armes||[],...p.equipement?.armures||[],...p.equipement?.accessoires||[]];let he=K.filter(U=>{if(b.category!=="all"&&vo(U)!==b.category||b.rarity!=="all"&&(U.rarity||"commun")!==b.rarity)return!1;if(b.searchTerm){const E=b.searchTerm.toLowerCase();return U.nom?.toLowerCase().includes(E)||U.description?.toLowerCase().includes(E)||U.name?.toLowerCase().includes(E)}return!0});he=fy(he,A);const oe=K.reduce((U,E)=>U+(E.poids||E.weight||.1)*(E.quantity||1),0),Ce=hy(p),Ye=K.reduce((U,E)=>U+(E.quantity||1),0),$=he.reduce((U,E)=>U+(E.quantity||1),0);return{items:he,totalWeight:oe,maxWeight:Ce,totalItemCount:Ye,filteredItemCount:$,allItems:K}},[p?.inventory,p?.equipement,b,A]),D=ne=>{try{const K=u(ne.id||ne.nom||ne.name);K.success?(g(K.message,"item"),s&&s(ne.id||ne.nom||ne.name)):g(K.message,"error")}catch(K){console.error("Erreur lors de l'utilisation de l'objet:",K),g(`Erreur: ${K.message}`,"error")}},G=ne=>{try{const K=ne.id||ne.name||ne.nom;m(K,"player"),g(`${ne.nom||ne.name} quip !`,"success")}catch(K){console.error("Erreur lors de l'quipement:",K),g(`Erreur lors de l'quipement: ${K.message}`,"error")}},re=ne=>{try{const K=ne.id||ne.name||ne.nom;f(K,"player"),g(`${ne.nom||ne.name} retir !`,"info")}catch(K){console.error("Erreur lors du dsquipement:",K),g(`Erreur lors du dsquipement: ${K.message}`,"error")}},F=ne=>{S({...b,...ne})},ee=ne=>{T(ne)};if(!p)return c.jsx(Te,{className:`inventory-panel ${r}`,children:c.jsx(at,{children:c.jsx("p",{children:"Aucun personnage slectionn"})})});const I=_.totalWeight>_.maxWeight;return c.jsxs(Te,{className:`inventory-panel ${r}`,children:[c.jsx(Qt,{children:c.jsxs("div",{className:"inventory-panel__header",children:[c.jsxs("h3",{className:"inventory--title",children:[" Inventaire de ",p.name]}),c.jsxs("div",{className:"inventory-panel__stats",children:[c.jsxs("div",{className:`inventory-weight ${I?"inventory-weight--overloaded":""}`,children:[c.jsxs("span",{children:[" Poids: ",_.totalWeight.toFixed(1),"/",_.maxWeight," kg"]}),I&&c.jsx("span",{className:"overload-warning",children:" Surcharge"})]}),c.jsx("div",{className:"inventory-count",children:c.jsxs("span",{children:[" Objets: ",_.filteredItemCount,"/",_.totalItemCount]})})]}),c.jsxs("div",{className:"inventory-panel__controls",children:[c.jsx(ce,{variant:N==="grid"?"primary":"ghost",size:"small",onClick:()=>q("grid"),children:" Grille"}),c.jsx(ce,{variant:N==="list"?"primary":"ghost",size:"small",onClick:()=>q("list"),children:" Liste"})]})]})}),c.jsxs(at,{children:[c.jsx(dy,{filters:b,onFilterChange:F,sortBy:A,onSortChange:ee,availableItems:_.allItems}),c.jsx(uy,{items:_.items,viewMode:N,onItemClick:y,onItemUse:D,onItemEquip:G,onItemUnequip:re,character:p}),_.items.length===0&&c.jsx("div",{className:"inventory-empty",children:_.allItemsCount===0?c.jsx("p",{children:" Votre inventaire est vide"}):c.jsx("p",{children:" Aucun objet ne correspond aux filtres appliqus"})})]}),h&&c.jsx(my,{item:h,character:p,onClose:()=>y(null),onUse:D,onEquip:G,onUnequip:re})]})};function vo(r){return r.type==="weapon"||r.type==="arme"||r.degats?"weapons":r.type==="armor"||r.type==="armure"||r.ca?"armor":r.type==="consumable"||r.type==="potion"||r.effet?"consumables":r.type==="accessoire"?"accessories":"misc"}function fy(r,l){return[...r].sort((s,i)=>{switch(l){case"name":return(s.nom||s.name||"").localeCompare(i.nom||i.name||"");case"weight":return(s.poids||s.weight||0)-(i.poids||i.weight||0);case"rarity":const u={commun:0,"peu commun":1,rare:2,"trs rare":3,lgendaire:4};return(u[s.rarity]||0)-(u[i.rarity]||0);case"type":return vo(s).localeCompare(vo(i));default:return 0}})}function hy(r){return r?.stats?.force?r.stats.force*7.5:50}const gy=({spellSlots:r={},onSlotUse:l,onSlotRestore:s,showDetails:i=!0,className:u=""})=>{const m=Object.keys(r).map(h=>parseInt(h)).sort((h,y)=>h-y);if(m.length===0)return c.jsx(Te,{className:`spell-slot-tracker ${u}`,children:c.jsx("div",{className:"spell-slot-tracker__empty",children:c.jsx("p",{children:"Aucun emplacement de sort disponible"})})});const f=m.reduce((h,y)=>{const b=r[y];return h+(b?.max||0)},0),p=m.reduce((h,y)=>{const b=r[y];return h+(b?.used||0)},0),g=f-p;return c.jsx(Te,{className:`spell-slot-tracker ${u}`,children:c.jsxs("div",{className:"spell-slot-tracker__content",children:[c.jsxs("div",{className:"spell-slot-tracker__header",children:[c.jsx("h4",{className:"spell-slot-tracker__title",children:" Emplacements de sorts"}),c.jsx("div",{className:"spell-slot-tracker__summary",children:c.jsxs("span",{className:"slot-summary",children:[g,"/",f," disponibles"]})})]}),c.jsx("div",{className:"spell-slot-tracker__grid",children:m.map(h=>{const y=r[h];if(!y||y.max===0)return null;const b=y.max-(y.used||0),S=y.max>0?(y.used||0)/y.max*100:0;return c.jsxs("div",{className:"spell-slot-level",children:[c.jsxs("div",{className:"spell-slot-level__header",children:[c.jsxs("h5",{className:"spell-slot-level__title",children:["Niveau ",h]}),c.jsxs("span",{className:"spell-slot-level__count",children:[b,"/",y.max]})]}),c.jsx("div",{className:"spell-slot-level__progress",children:c.jsx("div",{className:"spell-slot-progress-bar",children:c.jsx("div",{className:"spell-slot-progress-fill",style:{width:`${100-S}%`,backgroundColor:b>0?"#4caf50":"#f44336"}})})}),i&&c.jsx("div",{className:"spell-slot-level__details",children:c.jsx("div",{className:"spell-slot-dots",children:Array.from({length:y.max},(A,T)=>c.jsx("span",{className:`spell-slot-dot ${T<(y.used||0)?"spell-slot-dot--used":"spell-slot-dot--available"}`,title:T<(y.used||0)?"Emplacement utilis":"Emplacement disponible",children:T<(y.used||0)?"":""},T))})})]},h)})}),p===f&&c.jsxs("div",{className:"spell-slot-tracker__warning",children:[c.jsx("span",{className:"warning-icon",children:""}),c.jsx("span",{children:"Tous les emplacements de sorts ont t utiliss"})]})]})})},Hp=({spell:r,character:l,spellSlots:s={},viewMode:i="list",actions:u={},isOutOfCombat:m=!1,onClick:f,onCast:p,onPrepare:g,onUnprepare:h,className:y=""})=>{const[b,S]=se.useState(!1),A=["spell-item",`spell-item--${i}`,`spell-item--level-${r.level}`,`spell-item--${r.school?.toLowerCase().replace(/\s+/g,"-")}`,y].filter(Boolean).join(" "),T=()=>{switch(r.school){case"vocation":return"";case"Abjuration":return"";case"Enchantement":return"";case"Illusion":return"";case"Divination":return"";case"Invocation":return"";case"Ncromancie":return"";case"Transmutation":return"";default:return""}},N=()=>{if(!u.canCast||m&&r.castableOutOfCombat!==!0||m&&r.castableOutOfCombat===!0&&new ul().isSpellActive(r.id,l))return!1;if(r.level===0)return!0;for(let I=r.level;I<=9;I++){const ne=s[I];if(ne&&ne.available>0)return!0}return!1},q=()=>{if(r.level===0)return[];const I=[];for(let ne=r.level;ne<=9;ne++){const K=s[ne];K&&K.available>0&&I.push(ne)}return I},_=(I=null)=>{p?.(r,I),S(!1)},D=()=>{const I=q();r.level===0||I.length<=1?_(I[0]||r.level):S(!0)},G=()=>c.jsx("div",{className:A,onClick:f,children:c.jsxs("div",{className:"spell-item__compact-content",children:[c.jsx("span",{className:"spell-item__icon",children:T()}),c.jsxs("div",{className:"spell-item__compact-info",children:[c.jsx("span",{className:"spell-item__name",children:r.name}),c.jsx("span",{className:"spell-item__level",children:r.level===0?"Cantrip":`Niv. ${r.level}`})]}),u.canCast&&N()&&c.jsx(ce,{size:"small",variant:"primary",onClick:I=>{I.stopPropagation(),D()},children:"Lancer"})]})}),re=()=>c.jsx(Te,{className:A,onClick:f,children:c.jsxs("div",{className:"spell-item__grid-content",children:[c.jsxs("div",{className:"spell-item__header",children:[T(),r.name,c.jsxs("div",{className:"spell-item__title",children:[c.jsx("h4",{className:"spell-item__name",children:r.name}),c.jsxs("div",{className:"spell-item__meta",children:[c.jsx("span",{className:"spell-item__level",children:r.level===0?"Cantrip":`Niveau ${r.level}`}),c.jsx("span",{className:"spell-item__school",children:r.school})]})]})]}),c.jsx("div",{className:"spell-item__description",children:c.jsx("p",{children:r.description?.length>80?`${r.description.substring(0,80)}...`:r.description})}),c.jsxs("div",{className:"spell-item__properties",children:[r.castingTime&&c.jsxs("span",{className:"spell-property",children:[" ",r.castingTime]}),r.range&&c.jsxs("span",{className:"spell-property",children:[" ",r.range]}),r.duration&&c.jsxs("span",{className:"spell-property",children:[" ",r.duration]})]}),c.jsx("div",{className:"spell-item__actions",children:ee()})]})}),F=()=>c.jsx("div",{className:A,onClick:f,children:c.jsxs("div",{className:"spell-item__list-content",children:[c.jsxs("div",{className:"spell-item__list-header",children:[T()," ",c.jsx("h4",{className:"spell-item__name",children:r.name}),c.jsx("span",{className:"spell-item__level",children:r.level===0?"Cantrip":`Niveau ${r.level}`}),c.jsx("span",{className:"spell-item__school",children:r.school}),c.jsxs("div",{className:"spell-item__list-properties",children:[r.castingTime&&c.jsxs("span",{children:[" ",r.castingTime]}),r.range&&c.jsxs("span",{children:[" ",r.range]}),r.duration&&c.jsxs("span",{children:[" ",r.duration]}),r.components&&c.jsxs("span",{children:[" ",r.components.join(", ")]})]})]}),c.jsx("div",{className:"spell-item__list-info",children:r.description&&c.jsx("p",{className:"spell-item__list-description",children:r.description})}),c.jsx("div",{className:"spell-item__list-actions",children:ee()})]})}),ee=()=>c.jsx("div",{className:"spell-item__action-buttons",children:b?c.jsxs("div",{className:"spell-casting-options",children:[c.jsx("span",{className:"casting-options-label",children:"Lancer au niveau:"}),c.jsx(Ta,{children:q().map(I=>c.jsx(ce,{size:"small",variant:"primary",onClick:ne=>{ne.stopPropagation(),_(I)},children:I},I))}),c.jsx(ce,{size:"small",variant:"ghost",onClick:I=>{I.stopPropagation(),S(!1)},children:"Annuler"})]}):c.jsxs(c.Fragment,{children:[u.canCast&&N()&&c.jsx(ce,{size:"small",variant:"primary",onClick:I=>{I.stopPropagation(),D()},children:" Lancer"}),u.canPrepare&&c.jsx(ce,{size:"small",variant:"secondary",onClick:I=>{I.stopPropagation(),g?.(r)},children:" Prparer"}),u.canUnprepare&&c.jsx(ce,{size:"small",variant:"ghost",onClick:I=>{I.stopPropagation(),h?.(r)},children:" Retirer"})]})});switch(i){case"compact":return G();case"grid":return re();case"list":default:return F()}},vy=({spells:r=[],character:l,activeTab:s="prepared",spellSlots:i={},isOutOfCombat:u=!1,viewMode:m="list",onSpellClick:f,onCastSpell:p,onPrepareSpell:g,onUnprepareSpell:h,className:y=""})=>{const b=["spell-list",`spell-list--${m}`,`spell-list--${s}`,y].filter(Boolean).join(" "),S=r.reduce((q,_)=>{const D=_.level===0?"Cantrips":`Niveau ${_.level}`;return q[D]||(q[D]=[]),q[D].push(_),q},{}),A=Object.keys(S).sort((q,_)=>{if(q==="Cantrips")return-1;if(_==="Cantrips")return 1;const D=parseInt(q.replace("Niveau ","")),G=parseInt(_.replace("Niveau ",""));return D-G});if(r.length===0)return c.jsx("div",{className:"spell-list-empty",children:c.jsxs("div",{className:"spell-empty-state",children:[c.jsx("span",{className:"spell-empty-icon",children:""}),c.jsx("p",{children:"Aucun sort  afficher"})]})});const N=(()=>{switch(s){case"prepared":return{canCast:!0,canUnprepare:!0,canPrepare:!1};case"grimoire":case"unprepared":return{canCast:!1,canUnprepare:!1,canPrepare:!0};case"cantrips":return{canCast:!0,canUnprepare:!1,canPrepare:!1};default:return{canCast:!1,canUnprepare:!1,canPrepare:!1}}})();return c.jsx("div",{className:b,children:m==="compact"?c.jsx("div",{className:"spell-list__compact",children:r.map((q,_)=>c.jsx(Hp,{spell:q,character:l,spellSlots:i,viewMode:"compact",actions:N,isOutOfCombat:u,onClick:()=>f?.(q),onCast:p,onPrepare:g,onUnprepare:h},q.id||_))}):c.jsx("div",{className:"spell-list__grouped",children:A.map(q=>c.jsxs("div",{className:"spell-level-group",children:[c.jsxs("h4",{className:"spell-level-group__title",children:[q,c.jsxs("span",{className:"spell-level-group__count",children:["(",S[q].length,")"]})]}),c.jsx("div",{className:`spell-level-group__content spell-level-group__content--${m}`,children:S[q].map((_,D)=>c.jsx(Hp,{spell:_,character:l,spellSlots:i,viewMode:m,actions:N,isOutOfCombat:u,onClick:()=>f?.(_),onCast:p,onPrepare:g,onUnprepare:h},_.id||D))})]},q))})})},yy=({filters:r={},onFilterChange:l,activeTab:s="prepared",availableSpells:i=[],className:u=""})=>{const m=T=>{l?.({searchTerm:T.target.value})},f=T=>{l?.({school:T})},p=T=>{l?.({level:T})},g=()=>{l?.({castableOnly:!r.castableOnly})},h=()=>{l?.({school:"all",level:"all",searchTerm:"",castableOnly:!1})},y=[{value:"all",label:"Toutes les coles",icon:""},{value:"Abjuration",label:"Abjuration",icon:""},{value:"Invocation",label:"Invocation",icon:""},{value:"Divination",label:"Divination",icon:""},{value:"Enchantement",label:"Enchantement",icon:""},{value:"vocation",label:"vocation",icon:""},{value:"Illusion",label:"Illusion",icon:""},{value:"Ncromancie",label:"Ncromancie",icon:""},{value:"Transmutation",label:"Transmutation",icon:""}],b=[{value:"all",label:"Tous niveaux"},{value:"0",label:"Tours de magie"},{value:"1",label:"Niveau 1"},{value:"2",label:"Niveau 2"},{value:"3",label:"Niveau 3"},{value:"4",label:"Niveau 4"},{value:"5",label:"Niveau 5"},{value:"6",label:"Niveau 6"},{value:"7",label:"Niveau 7"},{value:"8",label:"Niveau 8"},{value:"9",label:"Niveau 9"}],S=Pe.useMemo(()=>{const T=new Set(["all"]);return i.forEach(N=>{N.school&&T.add(N.school)}),y.filter(N=>T.has(N.value))},[i]),A=Pe.useMemo(()=>{const T=new Set(["all"]);return i.forEach(N=>{T.add(N.level.toString())}),b.filter(N=>T.has(N.value))},[i]);return c.jsxs("div",{className:`spell-filters ${u}`,children:[c.jsx("div",{className:"spell-filters__search",children:c.jsxs("div",{className:"search-input-group",children:[c.jsx("span",{className:"search-icon",children:""}),c.jsx("input",{type:"text",placeholder:"Rechercher un sort...",value:r.searchTerm||"",onChange:m,className:"search-input"}),r.searchTerm&&c.jsx("button",{type:"button",className:"search-clear",onClick:()=>l?.({searchTerm:""}),children:""})]})}),c.jsxs("div",{className:"spell-filters__controls",children:[c.jsxs("div",{className:"spell-filters__section",children:[c.jsx("h5",{className:"spell-filters__label",children:"cole de magie"}),c.jsx("div",{className:"spell-filters__school-grid",children:S.map(T=>c.jsxs(ce,{variant:r.school===T.value?"primary":"ghost",size:"small",onClick:()=>f(T.value),className:"school-filter-button",title:T.label,children:[c.jsx("span",{className:"button-icon",children:T.icon}),T.value==="all"?"Toutes":T.value]},T.value))})]}),c.jsxs("div",{className:"spell-filters__section",children:[c.jsx("h5",{className:"spell-filters__label",children:"Niveau de sort"}),c.jsx(Ta,{className:"spell-filters__level-buttons",children:A.slice(0,6).map(T=>c.jsx(ce,{variant:r.level===T.value?"primary":"ghost",size:"small",onClick:()=>p(T.value),children:T.value==="all"?"Tous":T.value==="0"?"CT":T.value},T.value))}),A.length>6&&c.jsx(Ta,{className:"spell-filters__level-buttons spell-filters__level-buttons--high",children:A.slice(6).map(T=>c.jsx(ce,{variant:r.level===T.value?"primary":"ghost",size:"small",onClick:()=>p(T.value),children:T.value},T.value))})]}),c.jsxs("div",{className:"spell-filters__section",children:[c.jsx("h5",{className:"spell-filters__label",children:"Options"}),c.jsx("div",{className:"spell-filters__options",children:s==="prepared"&&c.jsxs(ce,{variant:r.castableOnly?"primary":"ghost",size:"small",onClick:g,children:[r.castableOnly?"":""," Lanables uniquement"]})})]}),c.jsx("div",{className:"spell-filters__actions",children:c.jsx(ce,{variant:"ghost",size:"small",onClick:h,disabled:r.school==="all"&&r.level==="all"&&!r.searchTerm&&!r.castableOnly,children:" Effacer"})})]})]})},xy=({spell:r,character:l,spellSlots:s={},onClose:i,onCast:u,onPrepare:m,onUnprepare:f})=>{const[p,g]=se.useState(null);if(!r)return null;const h=()=>{switch(r.school){case"vocation":return"";case"Abjuration":return"";case"Enchantement":return"";case"Illusion":return"";case"Divination":return"";case"Invocation":return"";case"Ncromancie":return"";case"Transmutation":return"";default:return""}},y=()=>({0:"#9e9e9e",1:"#4caf50",2:"#2196f3",3:"#ff9800",4:"#9c27b0",5:"#f44336",6:"#795548",7:"#607d8b",8:"#e91e63",9:"#ffc107"})[r.level]||"#9e9e9e",b=()=>{if(r.level===0)return!0;for(let _=r.level;_<=9;_++){const D=s[_];if(D&&D.available>0)return!0}return!1},S=()=>{if(r.level===0)return[];const _=[];for(let D=r.level;D<=9;D++){const G=s[D];G&&G.available>0&&_.push(D)}return _},A=_=>{if(!r.upcast||_<=r.level)return null;const D=_-r.level;return r.upcast.replace(/\{level\}/g,D.toString())},T=()=>{const _=p||r.level;u?.(r,_>0?_:null),i()},N=S(),q=r.level===0;return c.jsx(So,{onClose:i,size:"large",children:c.jsxs(Te,{className:"spell-detail-modal",children:[c.jsx(Qt,{children:c.jsxs("div",{className:"spell-detail-header",children:[c.jsx("div",{className:"spell-detail-icon-container",children:c.jsx("span",{className:"spell-detail-icon",style:{color:y()},children:h()})}),c.jsxs("div",{className:"spell-detail-title",children:[c.jsx("h2",{className:"spell-detail-name",children:r.name}),c.jsxs("div",{className:"spell-detail-meta",children:[c.jsx("span",{className:"spell-detail-level",style:{color:y()},children:q?"Tour de magie":`Sort de niveau ${r.level}`}),c.jsx("span",{className:"spell-detail-school",children:r.school})]})]})]})}),c.jsxs(at,{children:[c.jsxs("div",{className:"spell-detail-section",children:[c.jsx("h4",{children:"Description"}),c.jsx("p",{className:"spell-detail-description",children:r.description})]}),c.jsxs("div",{className:"spell-detail-section",children:[c.jsx("h4",{children:"Lancement"}),c.jsxs("div",{className:"spell-detail-casting-properties",children:[c.jsxs("div",{className:"spell-casting-property",children:[c.jsx("span",{className:"property-icon",children:""}),c.jsx("span",{className:"property-label",children:"Temps d'incantation:"}),c.jsx("span",{className:"property-value",children:r.castingTime||"Action"})]}),c.jsxs("div",{className:"spell-casting-property",children:[c.jsx("span",{className:"property-icon",children:""}),c.jsx("span",{className:"property-label",children:"Porte:"}),c.jsx("span",{className:"property-value",children:r.range||"Personnel"})]}),c.jsxs("div",{className:"spell-casting-property",children:[c.jsx("span",{className:"property-icon",children:""}),c.jsx("span",{className:"property-label",children:"Composants:"}),c.jsx("span",{className:"property-value",children:r.components?r.components.join(", "):"Aucun"})]}),c.jsxs("div",{className:"spell-casting-property",children:[c.jsx("span",{className:"property-icon",children:""}),c.jsx("span",{className:"property-label",children:"Dure:"}),c.jsx("span",{className:"property-value",children:r.duration||"Instantan"})]}),r.concentration&&c.jsxs("div",{className:"spell-casting-property",children:[c.jsx("span",{className:"property-icon",children:""}),c.jsx("span",{className:"property-label",children:"Concentration:"}),c.jsx("span",{className:"property-value",children:"Oui"})]}),r.ritual&&c.jsxs("div",{className:"spell-casting-property",children:[c.jsx("span",{className:"property-icon",children:""}),c.jsx("span",{className:"property-label",children:"Rituel:"}),c.jsx("span",{className:"property-value",children:"Oui"})]})]})]}),(r.damage||r.healing||r.effect)&&c.jsxs("div",{className:"spell-detail-section",children:[c.jsx("h4",{children:"Effets"}),c.jsxs("div",{className:"spell-detail-effects",children:[r.damage&&c.jsxs("div",{className:"spell-effect",children:[c.jsx("span",{className:"effect-icon",children:""}),c.jsx("span",{className:"effect-label",children:"Dgts:"}),c.jsx("span",{className:"effect-value",children:r.damage})]}),r.healing&&c.jsxs("div",{className:"spell-effect",children:[c.jsx("span",{className:"effect-icon",children:""}),c.jsx("span",{className:"effect-label",children:"Soins:"}),c.jsx("span",{className:"effect-value",children:r.healing})]}),r.effect&&c.jsxs("div",{className:"spell-effect",children:[c.jsx("span",{className:"effect-icon",children:""}),c.jsx("span",{className:"effect-label",children:"Effet:"}),c.jsx("span",{className:"effect-value",children:r.effect})]}),r.areaOfEffect&&c.jsxs("div",{className:"spell-effect",children:[c.jsx("span",{className:"effect-icon",children:""}),c.jsx("span",{className:"effect-label",children:"Zone d'effet:"}),c.jsxs("span",{className:"effect-value",children:[r.areaOfEffect.shape," de ",r.areaOfEffect.radius||r.areaOfEffect.size,r.areaOfEffect.shape==="sphere"?" pieds de rayon":" pieds"]})]})]})]}),r.upcast&&!q&&c.jsxs("div",{className:"spell-detail-section",children:[c.jsx("h4",{children:"Aux niveaux suprieurs"}),c.jsx("p",{className:"spell-detail-upcast",children:r.upcast})]}),b()&&!q&&N.length>1&&c.jsxs("div",{className:"spell-detail-section",children:[c.jsx("h4",{children:"Niveau de lancement"}),c.jsxs("div",{className:"spell-casting-levels",children:[c.jsx(Ta,{children:N.map(_=>c.jsxs(ce,{variant:p===_?"primary":"secondary",size:"small",onClick:()=>g(_),children:["Niveau ",_,c.jsxs("span",{className:"level-slots",children:["(",s[_]?.available," empl.)"]})]},_))}),p&&p>r.level&&c.jsxs("div",{className:"upcast-preview",children:[c.jsxs("h5",{children:["Effet au niveau ",p,":"]}),c.jsx("p",{children:A(p)})]})]})]}),r.classes&&c.jsxs("div",{className:"spell-detail-section",children:[c.jsx("h4",{children:"Classes"}),c.jsx("div",{className:"spell-detail-classes",children:r.classes.map(_=>c.jsx("span",{className:"spell-class-tag",children:_},_))})]})]}),c.jsx(Pi,{children:c.jsxs("div",{className:"spell-detail-actions",children:[c.jsx(ce,{variant:"ghost",onClick:i,children:"Fermer"}),b()&&c.jsxs(ce,{variant:"primary",onClick:T,disabled:!q&&N.length===0,children:[" Lancer",p?` (Niv. ${p})`:""]}),m&&c.jsx(ce,{variant:"secondary",onClick:()=>{m(r),i()},children:" Prparer"}),f&&c.jsx(ce,{variant:"ghost",onClick:()=>{f(r),i()},children:" Retirer"})]})})]})})},by=({className:r="",character:l,onCastSpell:s,isOutOfCombat:i=!1})=>{const{selectedCharacter:u,castSpell:m,prepareSpell:f,unprepareSpell:p}=At(),g=l||u,{addCombatMessage:h}=yt(),y=se.useMemo(()=>new ul,[]),[b,S]=se.useState(null),[A,T]=se.useState("prepared"),[N,q]=se.useState({school:"all",level:"all",searchTerm:"",castableOnly:!1});if(!g?.spellcasting)return c.jsx(Te,{className:`spell-panel ${r}`,children:c.jsx(at,{children:c.jsxs("div",{className:"spell-panel__no-spells",children:[c.jsx("span",{className:"no-spells-icon",children:""}),c.jsx("p",{children:"Ce personnage ne peut pas lancer de sorts"})]})})});const _=se.useMemo(()=>{const he=g.spellcasting.ability||"intelligence",oe=y.getSpellAttackBonus(g),Ce=y.getSpellSaveDC(g);let Ye=y.getPreparedSpells(g),$=y.getGrimoireSpells(g),U=y.getUnpreparedSpells(g),E=y.getCantrips(g);(i||s)&&(Ye=Ye.filter(J=>J.castableOutOfCombat===!0?!y.isSpellActive(J.id,g):!0),E=E.filter(J=>J.castableOutOfCombat===!0));const B=y.getMaxPreparedSpells(g),Y=y.getSpellSlots(g);return{spellcastingAbility:he,spellAttackBonus:oe,spellSaveDC:Ce,grimoireSpells:$,preparedSpells:Ye,unpreparedSpells:U,cantrips:E,maxPrepared:B,spellSlots:Y}},[g,y]),D=se.useMemo(()=>{let K=[];switch(A){case"prepared":K=_.preparedSpells;break;case"grimoire":K=_.unpreparedSpells;break;case"cantrips":K=_.cantrips;break;default:K=[]}return y.filterSpells(K,N)},[_,A,N,y]),G=async(K,he=null)=>{try{if(s){s(K,he);return}const oe=await m(K.id,he);oe.success?h(`${K.name} lanc avec succs !`,"spell-cast"):h(oe.message,"error")}catch(oe){console.error("Erreur lors du lancement du sort:",oe),h(`Impossible de lancer ${K.name}: ${oe.message}`,"error")}},re=async K=>{try{const he=await f(K.id);he.success?h(`${K.name} prpar`,"spell-prepare"):h(he.message,"error")}catch(he){console.error("Erreur lors de la prparation:",he),h(`Impossible de prparer ${K.name}`,"error")}},F=async K=>{try{const he=await p(K.id);he.success?h(`${K.name} retir des sorts prpars`,"spell-unprepare"):h(he.message,"error")}catch(he){console.error("Erreur lors de la suppression:",he)}},ee=K=>{T(K)},I=K=>{q({...N,...K})},ne={prepared:_.preparedSpells.length,grimoire:_.unpreparedSpells.length,cantrips:_.cantrips.length};return c.jsxs(Te,{className:`spell-panel ${r}`,children:[c.jsx(Qt,{children:c.jsxs("div",{className:"spell-panel__header",children:[c.jsxs("h3",{children:[" Sorts de ",g.name]}),c.jsxs("div",{className:"spell-panel__stats",children:[c.jsxs("div",{className:"spell-stat",children:[c.jsx("span",{className:"spell-stat__label",children:"Bonus d'attaque:"}),c.jsxs("span",{className:"spell-stat__value",children:["+",_.spellAttackBonus]})]}),c.jsxs("div",{className:"spell-stat",children:[c.jsx("span",{className:"spell-stat__label",children:"DD de sauvegarde:"}),c.jsx("span",{className:"spell-stat__value",children:_.spellSaveDC})]}),c.jsxs("div",{className:"spell-stat",children:[c.jsx("span",{className:"spell-stat__label",children:"Sorts prpars:"}),c.jsxs("span",{className:"spell-stat__value",children:[_.preparedSpells.length,"/",_.maxPrepared]})]})]})]})}),c.jsxs(at,{children:[c.jsx(gy,{spellSlots:_.spellSlots,onSlotUse:K=>{}}),c.jsxs("div",{className:"spell-panel__tabs",children:[c.jsxs(ce,{variant:A==="prepared"?"primary":"ghost",onClick:()=>ee("prepared"),children:[" Prpars (",ne.prepared,")"]}),c.jsxs(ce,{variant:A==="grimoire"?"primary":"ghost",onClick:()=>ee("grimoire"),children:[" Grimoire (",ne.grimoire,")"]})]}),c.jsx(yy,{filters:N,onFilterChange:I,activeTab:A,availableSpells:(()=>{switch(A){case"prepared":return _.preparedSpells;case"grimoire":return _.unpreparedSpells;case"cantrips":return _.cantrips;default:return[]}})()}),c.jsx(vy,{spells:D,character:g,activeTab:A,spellSlots:_.spellSlots,isOutOfCombat:i||!!s,onSpellClick:S,onCastSpell:G,onPrepareSpell:re,onUnprepareSpell:F}),D.length===0&&c.jsx("div",{className:"spell-panel__empty",children:A==="prepared"&&_.preparedSpells.length===0?c.jsx("p",{children:" Aucun sort prpar. Prparez des sorts depuis votre grimoire."}):A==="grimoire"&&_.grimoireSpells.length===0?c.jsx("p",{children:" Aucun sort disponible dans le grimoire. Montez de niveau pour dbloquer plus de sorts."}):A==="cantrips"&&_.cantrips.length===0?c.jsx("p",{children:" Aucun tour de magie connu."}):c.jsx("p",{children:" Aucun sort ne correspond aux filtres appliqus."})})]}),b&&c.jsx(xy,{spell:b,character:g,spellSlots:_.spellSlots,onClose:()=>S(null),onCast:G,onPrepare:re,onUnprepare:F})]})};class _y{canTakeShortRest(l){return!0}canTakeLongRest(l){return!0}getShortRestBenefits(l){const s={hitDiceRecovery:!1,spellSlotRecovery:[],classFeatureRecovery:[],description:[]};if(l.hitDice>0&&l.currentHP<l.maxHP&&(s.hitDiceRecovery=!0,s.description.push("Possibilit de dpenser des ds de vie pour rcuprer des PV")),l.class==="Magicien"&&l.level>=1){const i=l.level,u=Math.ceil(i/2);s.spellSlotRecovery.push({level:u,amount:1,source:"Rcupration arcanique"}),s.description.push(`Rcupration d'un emplacement de sort de niveau ${u} ou moins`)}return l.class==="Guerrier"&&l.level>=3&&(s.classFeatureRecovery.push("Action Surge"),s.description.push("Rcupration de l'Action Surge")),l.class==="Roublard"&&l.level>=3&&(s.classFeatureRecovery.push("Cunning Action uses"),s.description.push("Rcupration des utilisations d'actions spciales")),s}getLongRestBenefits(l){const s={fullHPRecovery:!0,hitDiceRecovery:Math.max(1,Math.floor(l.level/2)),allSpellSlotsRecovery:!0,allClassFeaturesRecovery:!0,description:[]};return s.description.push("Rcupration complte des points de vie"),s.description.push(`Rcupration de ${s.hitDiceRecovery} d${s.hitDiceRecovery>1?"s":""} de vie`),l.spellcasting&&s.description.push("Rcupration de tous les emplacements de sorts"),s.description.push("Rcupration de toutes les capacits de classe"),s}calculateHitDieHealing(l){const s=l.hitDiceType||8,i=Oe(l.stats.constitution),u=Math.floor(Math.random()*s)+1,m=u+i;return{roll:u,modifier:i,total:Math.max(1,m)}}applyShortRest(l){const s={...l},i={success:!0,message:"Repos court termin",changes:[]};if(l.class==="Magicien"&&l.level>=1){const u=l.level,m=Math.ceil(u/2);if(s.spellcasting?.spellSlots)for(let f=m;f>=1;f--){const p=s.spellcasting.spellSlots[f];if(p&&p.used>0){p.used=Math.max(0,p.used-1),p.available=p.max-p.used,i.changes.push(`Rcupration d'un emplacement de sort de niveau ${f}`);break}}}if(l.class==="Ensorceleur"&&l.sorceryPoints){const u=l.level;s.sorceryPoints.current=u,i.changes.push("Rcupration des points de sorcellerie")}return l.class==="Guerrier"&&l.level>=2&&s.classFeatures?.actionSurge&&(s.classFeatures.actionSurge.used=0,i.changes.push("Rcupration de l'Action Surge")),{character:s,results:i}}applyLongRest(l){const s={...l},i={success:!0,message:"Repos long termin",changes:[]},u=l.maxHP-l.currentHP;s.currentHP=l.maxHP,u>0&&i.changes.push(`${u} points de vie rcuprs`);const m=Math.max(1,Math.floor(l.level/2)),f=l.level,p=l.hitDice||0,g=Math.min(f,p+m);if(g>p&&(s.hitDice=g,i.changes.push(`${g-p} d${g-p>1?"s":""} de vie rcupr${g-p>1?"s":""}`)),s.spellcasting?.spellSlots){let h=0;Object.values(s.spellcasting.spellSlots).forEach(y=>{y.used>0&&(h+=y.used,y.used=0,y.available=y.max)}),h>0&&i.changes.push("Tous les emplacements de sorts rcuprs")}return s.classFeatures&&(Object.values(s.classFeatures).forEach(h=>{h.used!==void 0&&(h.used=0)}),i.changes.push("Toutes les capacits de classe rcupres")),l.class==="Moine"&&s.ki&&(s.ki.current=s.ki.max,i.changes.push("Points de ki rcuprs")),l.class==="Ensorceleur"&&s.sorceryPoints&&(s.sorceryPoints.current=s.sorceryPoints.max,i.changes.push("Points de sorcellerie rcuprs")),s.activeSpells&&(Object.keys(s.activeSpells).forEach(h=>{delete s.activeSpells[h]}),i.changes.push("Sorts temporaires dissips")),{character:s,results:i}}hasUsedSpellSlots(l){return l.spellcasting?.spellSlots?Object.values(l.spellcasting.spellSlots).some(s=>s.used>0):!1}getRestDuration(l){switch(l){case"short":return{duration:1,unit:"heure",description:"Au moins 1 heure de repos lger"};case"long":return{duration:8,unit:"heures",description:"Au moins 8 heures de sommeil ou de repos"};default:return null}}canInterruptRest(l,s){return l==="short"||l==="long"?s<60:!1}calculateInterruptionPenalties(l,s){const i={lostProgress:!1,reducedBenefits:!1,description:[]};return l==="short"&&(i.lostProgress=!0,i.description.push("Le repos court doit tre recommenc")),l==="long"&&s<480&&(i.reducedBenefits=!0,i.description.push("Bnfices du repos long perdus")),i}}const Sy=({character:r,restData:l,onSpendHitDie:s,onCompleteRest:i,onCancelRest:u,className:m=""})=>{const f=()=>l.hitDiceAvailable>0&&l.currentHP<l.maxHP,p=async()=>{if(f())try{await s()}catch(h){console.error("Erreur lors de la dpense du d de vie:",h)}},g=l.currentHP>=l.maxHP;return c.jsx(Te,{className:`short-rest-manager ${m}`,children:c.jsx(at,{children:c.jsxs("div",{className:"short-rest-manager__content",children:[c.jsxs("div",{className:"short-rest-manager__header",children:[c.jsx("h4",{children:" Repos court en cours"}),c.jsx("p",{className:"rest-description",children:"Prenez une heure pour vous reposer et rcuprer des forces. Vous pouvez dpenser des ds de vie pour rcuprer des points de vie."})]}),c.jsx("div",{className:"short-rest-manager__status",children:c.jsxs("div",{className:"rest-status-grid",children:[c.jsxs("div",{className:"rest-status-item",children:[c.jsx("span",{className:"rest-status-label",children:"Points de vie"}),c.jsxs("span",{className:"rest-status-value",children:[l.currentHP,"/",l.maxHP]})]}),c.jsxs("div",{className:"rest-status-item",children:[c.jsx("span",{className:"rest-status-label",children:"Ds de vie restants"}),c.jsxs("span",{className:"rest-status-value",children:[l.hitDiceAvailable," (d",l.hitDiceType,")"]})]})]})}),c.jsxs("div",{className:"short-rest-manager__health-bar",children:[c.jsx("div",{className:"health-bar-container",children:c.jsx("div",{className:"health-bar-fill",style:{width:`${l.currentHP/l.maxHP*100}%`}})}),c.jsxs("span",{className:"health-bar-label",children:["PV : ",l.currentHP,"/",l.maxHP]})]}),c.jsxs("div",{className:"short-rest-manager__hit-dice",children:[c.jsx("h5",{children:"Ds de vie"}),c.jsxs("p",{className:"hit-dice-description",children:["Lancez un d de vie (d",l.hitDiceType,") et ajoutez votre modificateur de Constitution (+",Math.floor((r.stats.constitution-10)/2),") pour rcuprer des points de vie."]}),c.jsxs("div",{className:"hit-dice-controls",children:[c.jsxs(ce,{variant:"secondary",disabled:!f(),onClick:p,children:[" Dpenser un d de vie",!f()&&c.jsx("span",{className:"button-disabled-reason",children:l.hitDiceAvailable===0?" (aucun restant)":" (PV au maximum)"})]}),c.jsx("div",{className:"hit-dice-info",children:c.jsxs("span",{children:["Ds restants : ",l.hitDiceAvailable]})})]})]}),c.jsxs("div",{className:"short-rest-manager__benefits",children:[c.jsx("h5",{children:"Autres bnfices du repos court"}),c.jsxs("ul",{className:"rest-benefits-list",children:[r.class==="Magicien"&&r.level>=1&&c.jsx("li",{children:" Rcupration arcanique disponible"}),r.class==="Guerrier"&&r.level>=2&&c.jsx("li",{children:" Action Surge rcupre"}),r.class==="Ensorceleur"&&c.jsx("li",{children:" Points de sorcellerie rcuprs"}),c.jsx("li",{children:" Rcupration mentale et physique"})]})]}),g&&c.jsxs("div",{className:"rest-message rest-message--success",children:[c.jsx("span",{className:"rest-message-icon",children:""}),c.jsx("span",{children:"Vous tes  pleine sant ! Vous pouvez terminer le repos."})]}),!g&&l.hitDiceAvailable>0&&c.jsxs("div",{className:"rest-message rest-message--info",children:[c.jsx("span",{className:"rest-message-icon",children:""}),c.jsx("span",{children:"Vous pouvez dpenser d'autres ds de vie ou terminer le repos maintenant."})]}),c.jsx("div",{className:"short-rest-manager__actions",children:c.jsxs(Ta,{children:[c.jsx(ce,{variant:"primary",onClick:i,children:" Terminer le repos"}),c.jsx(ce,{variant:"ghost",onClick:u,children:" Annuler le repos"})]})})]})})})},jy=({character:r,restData:l,onCompleteRest:s,onCancelRest:i,className:u=""})=>{const[m,f]=se.useState(0),[p,g]=se.useState(!1);se.useEffect(()=>{const T=setInterval(()=>{f(N=>{const q=N+30;return q>=480?(g(!0),clearInterval(T),480):q})},1e3);return()=>clearInterval(T)},[]);const y=(()=>{const T=[],N=l.maxHP-l.currentHP;N>0&&T.push({icon:"",text:`+${N} points de vie (rcupration complte)`});const q=Math.max(1,Math.floor(r.level/2)),_=r.level,D=l.hitDiceAvailable,G=Math.min(q,_-D);return G>0&&T.push({icon:"",text:`+${G} d${G>1?"s":""} de vie`}),r.spellcasting?.spellSlots&&Object.values(r.spellcasting.spellSlots).reduce((F,ee)=>F+(ee.used||0),0)>0&&T.push({icon:"",text:"Tous les emplacements de sorts rcuprs"}),T.push({icon:"",text:"Toutes les capacits de classe rcupres"}),r.class==="Magicien"&&T.push({icon:"",text:"Possibilit de changer les sorts prpars"}),r.class==="Ensorceleur"&&T.push({icon:"",text:"Points de sorcellerie rcuprs"}),r.class==="Moine"&&T.push({icon:"",text:"Points de ki rcuprs"}),T})(),b=m/480*100,S=Math.floor(m/60),A=m%60;return c.jsx(Te,{className:`long-rest-manager ${u}`,children:c.jsx(at,{children:c.jsxs("div",{className:"long-rest-manager__content",children:[c.jsxs("div",{className:"long-rest-manager__header",children:[c.jsx("h4",{children:" Repos long en cours"}),c.jsx("p",{className:"rest-description",children:"Prenez 8 heures pour dormir ou vous reposer paisiblement. Toutes vos capacits seront restaures."})]}),c.jsxs("div",{className:"long-rest-manager__progress",children:[c.jsxs("div",{className:"rest-progress-header",children:[c.jsx("h5",{children:"Progression du repos"}),c.jsxs("span",{className:"rest-time",children:[S,"h ",A,"min / 8h 00min"]})]}),c.jsx("div",{className:"rest-progress-bar",children:c.jsx("div",{className:"rest-progress-fill",style:{width:`${b}%`}})}),c.jsx("div",{className:"rest-progress-status",children:p?c.jsx("span",{className:"rest-status-complete",children:" Repos termin ! Vous vous sentez compltement repos."}):c.jsxs("span",{className:"rest-status-resting",children:[" Repos en cours... (",Math.floor(100-b),"% restant)"]})})]}),c.jsxs("div",{className:"long-rest-manager__benefits",children:[c.jsx("h5",{children:"Bnfices du repos long"}),c.jsx("div",{className:"rest-benefits-grid",children:y.map((T,N)=>c.jsxs("div",{className:`rest-benefit-item ${p?"rest-benefit-item--available":""}`,children:[c.jsx("span",{className:"rest-benefit-icon",children:T.icon}),c.jsx("span",{className:"rest-benefit-text",children:T.text}),p&&c.jsx("span",{className:"rest-benefit-check",children:""})]},N))})]}),c.jsx("div",{className:"long-rest-manager__health-comparison",children:c.jsxs("div",{className:"health-comparison-grid",children:[c.jsxs("div",{className:"health-comparison-item",children:[c.jsx("h6",{children:"tat actuel"}),c.jsxs("div",{className:"health-stats",children:[c.jsxs("span",{className:"health-stat",children:[" PV: ",l.currentHP,"/",l.maxHP]}),c.jsxs("span",{className:"health-stat",children:[" Ds: ",l.hitDiceAvailable]})]})]}),c.jsx("div",{className:"health-comparison-arrow",children:""}),c.jsxs("div",{className:"health-comparison-item",children:[c.jsx("h6",{children:"Aprs le repos"}),c.jsxs("div",{className:"health-stats",children:[c.jsxs("span",{className:"health-stat health-stat--improved",children:[" PV: ",l.maxHP,"/",l.maxHP]}),c.jsxs("span",{className:"health-stat health-stat--improved",children:[" Ds: ",Math.min(r.level,l.hitDiceAvailable+Math.max(1,Math.floor(r.level/2)))]})]})]})]})}),!p&&c.jsx("div",{className:"long-rest-manager__info",children:c.jsxs("div",{className:"rest-info-box",children:[c.jsx("h6",{children:" Pendant votre repos"}),c.jsxs("ul",{className:"rest-info-list",children:[c.jsx("li",{children:"Votre corps et votre esprit rcuprent naturellement"}),c.jsx("li",{children:"Les blessures gurissent compltement"}),c.jsx("li",{children:"Votre nergie magique se rgnre"}),c.jsx("li",{children:"Vos capacits spciales retrouvent leur pleine puissance"})]})]})}),c.jsxs("div",{className:"long-rest-manager__warnings",children:[c.jsxs("div",{className:"rest-warning",children:[c.jsx("span",{className:"rest-warning-icon",children:""}),c.jsx("span",{className:"rest-warning-text",children:"Vous ne pouvez bnficier que d'un repos long par priode de 24 heures."})]}),!p&&c.jsxs("div",{className:"rest-warning",children:[c.jsx("span",{className:"rest-warning-icon",children:""}),c.jsx("span",{className:"rest-warning-text",children:"Annuler maintenant vous fera perdre les bnfices du repos long."})]})]}),c.jsx("div",{className:"long-rest-manager__actions",children:c.jsxs(Ta,{children:[c.jsx(ce,{variant:"primary",disabled:!p,onClick:s,children:p?" Terminer le repos":` Repos en cours... ${Math.floor(100-b)}%`}),c.jsx(ce,{variant:"ghost",onClick:i,children:" Annuler le repos"})]})})]})})})},Ty=({character:r,restData:l,onSelect:s,className:i=""})=>{const u=(p,g,h,y,b,S=!0)=>c.jsxs(Te,{className:`rest-option ${S?"":"rest-option--disabled"}`,children:[c.jsxs("div",{className:"rest-option__header",children:[c.jsx("span",{className:"rest-option__icon",children:h}),c.jsx("h4",{className:"rest-option__title",children:g}),c.jsx("span",{className:"rest-option__duration",children:y})]}),c.jsxs("div",{className:"rest-option__benefits",children:[c.jsx("h5",{children:"Bnfices :"}),c.jsx("ul",{className:"rest-benefits-list",children:b.map((A,T)=>c.jsx("li",{className:"rest-benefit",children:A},T))})]}),c.jsx("div",{className:"rest-option__actions",children:c.jsx(ce,{variant:"primary",disabled:!S,onClick:()=>s(p),children:S?`Commencer le ${g.toLowerCase()}`:"Indisponible"})})]},p),m=[];if(l.hitDiceAvailable>0&&l.currentHP<l.maxHP&&m.push(`Dpenser jusqu' ${l.hitDiceAvailable} d${l.hitDiceAvailable>1?"s":""} de vie pour rcuprer des PV`),r.class==="Magicien"&&r.level>=1){const p=Math.ceil(r.level/2);m.push(`Rcupration arcanique (1 emplacement  niv. ${p})`)}r.class==="Guerrier"&&r.level>=2&&m.push("Rcupration de l'Action Surge"),r.class==="Ensorceleur"&&m.push("Rcupration des points de sorcellerie"),m.length===0&&m.push("Moment de rcupration et de planification");const f=["Rcupration complte des points de vie",`Rcupration de ${Math.max(1,Math.floor(r.level/2))} d${Math.floor(r.level/2)>1?"s":""} de vie`];return r.spellcasting&&f.push("Rcupration de tous les emplacements de sorts"),f.push("Rcupration de toutes les capacits de classe"),r.class==="Magicien"&&f.push("Prparation de nouveaux sorts"),c.jsxs("div",{className:`rest-type-selector ${i}`,children:[c.jsx("div",{className:"rest-type-selector__intro",children:c.jsx("p",{children:"Choisissez le type de repos que vous souhaitez prendre. Un repos permet de rcuprer des forces et des capacits."})}),c.jsxs("div",{className:"rest-options",children:[u("short","Repos court","","1 heure",m,l.canTakeShortRest),u("long","Repos long","","8 heures",f,l.canTakeLongRest)]}),c.jsxs("div",{className:"rest-type-selector__info",children:[c.jsxs("div",{className:"rest-info-section",children:[c.jsx("h5",{children:"tat actuel :"}),c.jsxs("ul",{children:[c.jsxs("li",{children:["Points de vie : ",l.currentHP,"/",l.maxHP,l.currentHP<l.maxHP&&c.jsx("span",{className:"rest-info-highlight",children:" (rcupration ncessaire)"})]}),c.jsxs("li",{children:["Ds de vie : ",l.hitDiceAvailable," disponible",l.hitDiceAvailable>1?"s":"","(d",l.hitDiceType,")"]}),r.spellcasting&&c.jsxs("li",{children:["Emplacements de sorts :",Object.entries(r.spellcasting.spellSlots||{}).some(([,p])=>p.used>0)?" certains utiliss":" tous disponibles"]})]})]}),c.jsxs("div",{className:"rest-info-section",children:[c.jsx("h5",{children:"Conseils :"}),c.jsxs("ul",{children:[c.jsx("li",{children:"Les repos courts sont idaux pour une rcupration rapide entre les combats"}),c.jsx("li",{children:"Les repos longs restaurent toutes vos capacits mais prennent plus de temps"}),c.jsx("li",{children:"Vous ne pouvez bnficier que d'un repos long par priode de 24 heures"})]})]})]})]})},Di=({type:r,character:l,onRestComplete:s,className:i=""})=>{const{playerCharacter:u,shortRestPlayer:m,longRestPlayer:f,spendHitDie:p}=At(),g=l||u,{addCombatMessage:h,gamePhase:y,setGamePhase:b}=yt(),S=se.useMemo(()=>new _y,[]),[A,T]=se.useState(r||null),[N,q]=se.useState(!1);if(!g)return c.jsx(Te,{className:`rest-panel ${i}`,children:c.jsx(at,{children:c.jsxs("div",{className:"rest-panel__no-character",children:[c.jsx("span",{className:"no-character-icon",children:""}),c.jsx("p",{children:"Aucun personnage slectionn pour se reposer"})]})})});const _=se.useMemo(()=>({canTakeShortRest:S.canTakeShortRest(g),canTakeLongRest:S.canTakeLongRest(g),shortRestBenefits:S.getShortRestBenefits(g),longRestBenefits:S.getLongRestBenefits(g),hitDiceAvailable:g.hitDice||0,hitDiceType:g.hitDiceType||8,currentHP:g.currentHP||0,maxHP:g.maxHP||0,needsRest:g.currentHP<g.maxHP||g.spellcasting&&S.hasUsedSpellSlots(g)}),[g,S]),D=I=>{T(I)},G=()=>{try{m(),h("Repos court termin !","rest-complete"),q(!1),T(null),s?.("short")}catch(I){console.error("Erreur lors du repos court:",I),h("Erreur lors du repos court","error")}},re=()=>{try{f(),h("Repos long termin ! Tous vos points de vie et emplacements de sorts ont t restaurs.","rest-complete"),q(!1),T(null),s?.("long")}catch(I){console.error("Erreur lors du repos long:",I),h("Erreur lors du repos long","error")}},F=()=>{try{p("player"),h("D de vie dpens !","healing")}catch(I){console.error("Erreur lors de la dpense du d de vie:",I),h("Impossible de dpenser le d de vie","error")}},ee=()=>{q(!1),T(null),b("normal"),h("Repos annul","rest-cancel")};return!A&&!N?c.jsxs(Te,{className:`rest-panel ${i}`,children:[c.jsxs(Qt,{children:[c.jsxs("h3",{children:[" Repos pour ",g.name]}),c.jsxs("div",{className:"rest-panel__status",children:[c.jsxs("div",{className:"rest-status-item",children:[c.jsx("span",{className:"rest-status-label",children:"Points de vie:"}),c.jsxs("span",{className:`rest-status-value ${_.currentHP<_.maxHP?"rest-status-value--low":""}`,children:[_.currentHP,"/",_.maxHP]})]}),c.jsxs("div",{className:"rest-status-item",children:[c.jsx("span",{className:"rest-status-label",children:"Ds de vie:"}),c.jsxs("span",{className:"rest-status-value",children:[_.hitDiceAvailable," disponible",_.hitDiceAvailable>1?"s":""]})]}),_.needsRest&&c.jsxs("div",{className:"rest-need-indicator",children:[c.jsx("span",{className:"rest-need-icon",children:""}),c.jsx("span",{children:"Repos recommand"})]})]})]}),c.jsx(at,{children:c.jsx(Ty,{character:g,restData:_,onSelect:D})})]}):c.jsxs(Te,{className:`rest-panel ${i}`,children:[c.jsx(Qt,{children:c.jsxs("h3",{children:[" ",A==="short"?"Repos court":"Repos long"," en cours"]})}),c.jsx(at,{children:A==="short"?c.jsx(Sy,{character:g,restData:_,onSpendHitDie:F,onCompleteRest:G,onCancelRest:ee}):c.jsx(jy,{character:g,restData:_,onCompleteRest:re,onCancelRest:ee})})]})};class Yt{static evaluateCondition(l,s){if(!l)return!0;if(typeof l!="string")return!!l;try{const i={gameFlags:s.flags||{},character:s.character||{},inventory:s.character?.inventory||[],companions:s.flags?.companions||[]};let u=l;const m={hasItem:p=>i.inventory.some(g=>g.id===p),hasCompanion:p=>i.companions.includes(p),hasFlag:p=>!!i.gameFlags[p],getRelation:p=>i.gameFlags.npcRelations?.[p]||0};return new Function("gameFlags","character","inventory","companions","hasItem","hasCompanion","hasFlag","getRelation",`return ${u}`)(i.gameFlags,i.character,i.inventory,i.companions,m.hasItem,m.hasCompanion,m.hasFlag,m.getRelation)}catch(i){return console.warn(`Erreur d'valuation de condition: ${l}`,i),!1}}static getSceneText(l,s){let i=l.content?.text||"";if(l.content?.variations){const u=[];for(const[m,f]of Object.entries(l.content.variations)){if(m==="default")continue;const p=l.conditions?.show_variation?.[m];p&&this.evaluateCondition(p,s)&&u.push(f)}u.length>0&&(i+=`
`+u.join(`
`))}return this.interpolateText(i,s)}static interpolateText(l,s){return!l||typeof l!="string"?l:l.replace(/\{([^}]+)\}/g,(i,u)=>{if(u.includes(".")){const m=u.split(".");let f=s;for(const p of m)if(f=f?.[p],f===void 0)break;return f!==void 0?f:i}switch(u){case"playerName":return s.character?.name||"Aventurier";case"playerClass":return s.character?.class||"Aventurier";case"gold":return s.character?.gold||0;default:return s.flags?.[u]||i}})}static getAvailableChoices(l,s){return l.choices?l.choices.filter(i=>i.condition?this.evaluateCondition(i.condition,s):!0):[]}static getAvailableHotspots(l,s){return l.hotspots?l.hotspots.filter(i=>i.condition?this.evaluateCondition(i.condition,s):!0):[]}static renderInteractiveScene(l,s){const i=this.getAvailableHotspots(l,s);return{...l,hotspots:i,content:{...l.content,text:this.getSceneText(l,s)}}}static processShopAction(l,s,i){const{character:u,flags:m}=s,f=i.shop;switch(l.type){case"purchase":return this.handlePurchase(l.itemId,u,f,m);case"sell":return this.handleSell(l.itemId,u,f);default:return{success:!1,message:"Action non supporte"}}}static handlePurchase(l,s,i,u){const m=i.inventory.find(p=>p.id===l);if(!m)return{success:!1,message:"Objet non trouv"};if(m.stock!==-1&&m.stock<=0)return{success:!1,message:"Objet en rupture de stock"};let f=m.price;return i.reputation_discount&&u.reputation>=i.reputation_discount.threshold&&(f=Math.floor(f*i.reputation_discount.discount)),s.gold<f?{success:!1,message:"Pas assez d'or"}:{success:!0,message:`Vous achetez ${m.name||l} pour ${f} or`,effects:{gold:-f,items:[l],shopStock:m.stock!==-1?{[l]:m.stock-1}:null}}}static handleSell(l,s,i){const u=s.inventory?.find(f=>f.id===l);if(!u)return{success:!1,message:"Vous ne possdez pas cet objet"};const m=Math.floor((u.value||0)*.5);return{success:!0,message:`Vous vendez ${u.name||l} pour ${m} or`,effects:{gold:m,removeItems:[l]}}}static applyConsequences(l,s){if(!l)return{};const i={};return l.flags&&(i.flags={...l.flags}),typeof l.reputation=="number"&&(i.reputation=l.reputation),l.items&&Array.isArray(l.items)&&(i.items=l.items),l.companions&&Array.isArray(l.companions)&&(i.companions=l.companions),i}static getDialogueData(l,s){const i=l.content?.speaker||"Inconnu",u=l.content?.portrait||null,m=l.content?.mood||"neutral";return{speaker:i,portrait:u,mood:m,text:this.getSceneText(l,s)}}static shouldShowScene(l,s){return l.conditions?.show_if?this.evaluateCondition(l.conditions.show_if,s):!0}static executeSceneEffects(l,s,i="on_enter"){const u=l.effects?.[i];if(!u||typeof u!="function")return null;try{return u(s)}catch(m){return console.warn(`Erreur lors de l'excution de l'effet ${i}:`,m),null}}static validateScene(l){return Ng.validateScene(l)}static getSceneDebugInfo(l,s){const i=this.validateScene(l),u=this.getAvailableChoices(l,s),m=this.shouldShowScene(l,s);return{isValid:i.isValid,errors:i.errors,type:l.metadata?.type||"unknown",shouldShow:m,choicesCount:l.choices?.length||0,availableChoicesCount:u.length,hasVariations:!!l.content?.variations,hasConditions:!!l.conditions}}static getNextScene(l,s){if(l.action){const i=this.processAction(l.action,s);if(i?.nextScene)return i.nextScene}return typeof l.next=="string"?l.next:typeof l.next=="object"&&l.next.nextScene?l.next.nextScene:null}static processAction(l,s){switch(l.type){case Ri.SCENE_TRANSITION:return{nextScene:l.nextScene};case Ri.SKILL_CHECK:return this.processSkillCheck(l,s);case Ri.SHOP_OPEN:return{openShop:!0};default:return null}}static processSkillCheck(l,s){return{onSuccess:l.onSuccess,onPartialSuccess:l.onPartialSuccess,onFailure:l.onFailure}}}const Ip=({scene:r,gameState:l,onChoice:s,onBack:i})=>{const u=Yt.getDialogueData(r,l),m=Yt.getAvailableChoices(r,l),f=p=>{s&&s(p)};return c.jsxs("div",{className:"dialogue-scene",children:[c.jsxs("div",{className:"dialogue-header",children:[u.portrait&&c.jsx("div",{className:"character-portrait",children:c.jsx("img",{src:u.portrait,alt:u.speaker,className:`portrait mood-${u.mood}`})}),c.jsxs("div",{className:"character-info",children:[c.jsx("h3",{className:"character-name",children:u.speaker}),r.metadata?.location&&c.jsxs("p",{className:"location-text",children:[" ",r.metadata.location]})]})]}),c.jsx("div",{className:"dialogue-content",children:c.jsx("div",{className:"dialogue-text",children:u.text.split(`
`).map((p,g)=>p.trim()===""?c.jsx("br",{},g):c.jsx("p",{children:p},g))})}),c.jsx("div",{className:"dialogue-choices",children:m.map((p,g)=>c.jsxs("button",{className:`dialogue-choice ${p.action?.type==="openShop"?"shop-choice":""}`,onClick:()=>f(p),children:[c.jsx("span",{className:"choice-text",children:p.text}),p.condition&&c.jsx("span",{className:"choice-requirement"})]},g))}),i&&c.jsx("div",{className:"dialogue-controls",children:c.jsx("button",{className:"back-button",onClick:i,children:" Retour"})})]})},Ey=({scene:r,gameState:l,onHotspotClick:s,onChoice:i})=>{const[u,m]=se.useState(null),[f,p]=se.useState(!1),g=se.useRef(null),h=Yt.getAvailableHotspots(r,l),y=Yt.getAvailableChoices(r,l),b=Yt.getSceneText(r,l),S=q=>{s&&s(q)},A=q=>{i&&i(q)},T=()=>{},N=q=>({left:`${q.coordinates.x}px`,top:`${q.coordinates.y}px`,width:`${q.coordinates.width}px`,height:`${q.coordinates.height}px`});return c.jsxs("div",{className:"interactive-scene",children:[c.jsx("h3",{className:"title-scene",children:r.metadata.title}),c.jsxs("div",{className:"scene-image-container",children:[c.jsx("img",{ref:g,src:r.metadata.background,alt:r.metadata.title||"Scne interactive",className:"scene-background",onLoad:T}),c.jsx("div",{className:"hotspots-overlay",children:h.map(q=>c.jsxs("div",{className:`hotspot ${u===q.id?"hovered":""} ${f?"visible":""}`,style:N(q),onClick:()=>S(q),onMouseEnter:()=>m(q.id),onMouseLeave:()=>m(null),title:q.text,children:[c.jsx("div",{className:"hotspot-highlight"}),u===q.id&&c.jsx("div",{className:"hotspot-tooltip",children:q.text})]},q.id))}),c.jsx("button",{className:"toggle-hotspots",onClick:()=>p(!f),title:"Rvler les zones interactives",children:f?"":""})]}),h.length>0&&c.jsx("p",{className:"hint-text",children:" Cliquez sur les lments de l'image pour interagir"}),c.jsxs("div",{className:"scene-description",children:[c.jsx("div",{className:"scene-text",children:b.split(`
`).map((q,_)=>q.trim()===""?c.jsx("br",{},_):c.jsx("p",{children:q},_))}),r.content.description&&c.jsx("div",{className:"additional-description",children:r.content.description.split(`
`).map((q,_)=>q.trim()===""?c.jsx("br",{},_):c.jsx("p",{children:q},_))})]}),y.length>0&&c.jsxs("div",{className:"",children:[c.jsx("h4",{children:"Actions disponibles :"}),c.jsx("div",{className:"scene-choices",children:y.map((q,_)=>c.jsx("button",{className:"scene-choice",onClick:()=>A(q),children:q.text},_))})]})]})},Cy=({mode:r,availableItems:l,playerInventory:s,playerGold:i,onPurchase:u,onSell:m,getItemPrice:f,shopCurrency:p="or"})=>{const[g,h]=se.useState(null),[y,b]=se.useState(1),S=_=>hn[_]||ja[_]||null,A=_=>{if(!u)return;u(_.id,y).success&&(h(null),b(1))},T=_=>{if(!m)return;m(_.id,y).success&&(h(null),b(1))},q=r==="buy"?l:s.filter(_=>{const D=S(_.id);return D&&D.value>0});return c.jsxs("div",{className:"shop-interface",children:[c.jsx("div",{className:"items-grid",children:q.length===0?c.jsx("div",{className:"empty-shop",children:r==="buy"?"Aucun objet en vente":"Aucun objet vendable"}):q.map((_,D)=>{const G=S(_.id);if(!G)return null;const re=r==="buy"?f(_):Math.floor((G.value||0)*.5),F=r==="buy"?i>=re:!0,ee=r==="buy"?_.stock===-1||_.stock>0:!0;return c.jsxs("div",{className:`shop-item ${!F||!ee?"unavailable":""} ${g?.id===_.id?"selected":""}`,onClick:()=>h(_),children:[c.jsxs("div",{className:"item-info",children:[c.jsx("h4",{className:"item-name",children:G.name}),c.jsx("p",{className:"item-description",children:G.description}),G.type==="weapon"&&c.jsx("div",{className:"item-stats",children:c.jsxs("span",{children:["Dgts: ",G.damage]})}),G.effect&&c.jsxs("div",{className:"item-effect",children:["Effet: ",G.effect.description||G.effect]})]}),c.jsxs("div",{className:"item-pricing",children:[c.jsxs("div",{className:"price",children:[re," ",p]}),r==="buy"&&_.stock!==-1&&c.jsxs("div",{className:"stock",children:["Stock: ",_.stock]}),r==="sell"&&_.quantity&&_.quantity>1&&c.jsxs("div",{className:"quantity-owned",children:["Possd: ",_.quantity]}),!F&&r==="buy"&&c.jsx("div",{className:"insufficient-funds",children:"Pas assez d'or"}),!ee&&r==="buy"&&c.jsx("div",{className:"out-of-stock",children:"Rupture de stock"})]})]},D)})}),g&&c.jsx("div",{className:"item-details",children:c.jsxs("div",{className:"details-content",children:[c.jsx("h3",{children:S(g.id)?.name}),c.jsx("p",{children:S(g.id)?.description}),c.jsxs("div",{className:"quantity-selector",children:[c.jsx("label",{children:"Quantit:"}),c.jsxs("div",{className:"quantity-controls",children:[c.jsx("button",{onClick:()=>b(Math.max(1,y-1)),disabled:y<=1,children:"-"}),c.jsx("span",{className:"quantity-value",children:y}),c.jsx("button",{onClick:()=>{const _=r==="buy"?g.stock===-1?10:g.stock:g.quantity||1;b(Math.min(_,y+1))},disabled:r==="buy"?g.stock!==-1&&y>=g.stock:g.quantity&&y>=g.quantity,children:"+"})]})]}),c.jsx("div",{className:"total-price",children:c.jsxs("strong",{children:["Total: ",r==="buy"?f(g)*y:Math.floor((S(g.id)?.value||0)*.5)*y," ",p]})}),c.jsxs("div",{className:"action-buttons",children:[r==="buy"?c.jsx("button",{className:"buy-button",onClick:()=>A(g),disabled:i<f(g)*y||g.stock!==-1&&g.stock<y,children:" Acheter"}):c.jsx("button",{className:"sell-button",onClick:()=>T(g),disabled:g.quantity&&g.quantity<y,children:" Vendre"}),c.jsx("button",{className:"cancel-button",onClick:()=>h(null),children:"Annuler"})]})]})})]})},Ay=({scene:r,gameState:l,onChoice:s,onPurchase:i,onSell:u,onBack:m})=>{const[f,p]=se.useState("dialogue"),[g,h]=se.useState("buy"),y=_=>{if(_.action?.type==="openShop"){p("shop"),h("buy");return}if(_.action?.type==="openSellInterface"){p("shop"),h("sell");return}s&&s(_)},b=()=>{p("dialogue")},S=(_,D=1)=>{const G=Yt.processShopAction({type:"purchase",itemId:_,quantity:D},l,r);return i&&i(G),G},A=(_,D=1)=>{const G=Yt.processShopAction({type:"sell",itemId:_,quantity:D},l,r);return u&&u(G),G},T=_=>{let D=_.price;const G=r.shop;return G.reputation_discount&&l.flags.reputation>=G.reputation_discount.threshold&&(D=Math.floor(D*G.reputation_discount.discount)),D},N=()=>r.shop?.inventory?r.shop.inventory.filter(_=>!(_.condition&&!Yt.evaluateCondition(_.condition,l)||_.stock!==-1&&_.stock<=0)):[],q=()=>r.shop?.special_offers?r.shop.special_offers.filter(_=>Yt.evaluateCondition(_.condition,l)):[];return f==="dialogue"?c.jsxs("div",{className:"merchant-scene",children:[c.jsx(Ip,{scene:r,gameState:l,onChoice:y,onBack:m}),q().length>0&&c.jsxs("div",{className:"special-offers",children:[c.jsx("h4",{children:" Offres spciales"}),q().map((_,D)=>c.jsxs("div",{className:"special-offer",children:[c.jsx("p",{children:_.message}),_.reward&&c.jsxs("div",{className:"offer-reward",children:[_.reward.type==="item"&&`Rcompense: ${_.reward.item}`,_.reward.type==="gold"&&`Rcompense: ${_.reward.amount} or`,_.reward.type==="discount"&&`Rduction: ${_.reward.amount}%`]})]},D))]})]}):c.jsxs("div",{className:"merchant-scene shop-mode",children:[c.jsxs("div",{className:"shop-header",children:[c.jsxs("div",{className:"merchant-info",children:[r.content.portrait&&c.jsx("img",{src:r.content.portrait,alt:r.content.speaker,className:"merchant-portrait"}),c.jsxs("div",{children:[c.jsx("h3",{children:r.content.speaker}),c.jsx("p",{className:"shop-type",children:r.metadata.shop_type})]})]}),c.jsxs("div",{className:"player-gold",children:[" ",l.character?.gold||0," or"]})]}),c.jsxs("div",{className:"shop-tabs",children:[c.jsx("button",{className:`tab ${g==="buy"?"active":""}`,onClick:()=>h("buy"),children:" Acheter"}),c.jsx("button",{className:`tab ${g==="sell"?"active":""}`,onClick:()=>h("sell"),children:" Vendre"})]}),c.jsx("div",{className:"shop-content",children:c.jsx(Cy,{mode:g,availableItems:N(),playerInventory:l.character?.inventory||[],playerGold:l.character?.gold||0,onPurchase:S,onSell:A,getItemPrice:T,shopCurrency:r.shop?.currency||"or"})}),c.jsxs("div",{className:"shop-controls",children:[c.jsx("button",{className:"back-to-dialogue",onClick:b,children:" Parler"}),m&&c.jsx("button",{className:"leave-shop",onClick:m,children:" Quitter"})]})]})},yo=(r,l)=>{if(typeof r=="string")return r;if(typeof r=="object"){if(r.nextScene)return Ny(r,l),r.nextScene;switch(r.type){case"combat":return{...r,enemies:r.enemies,enemyPositions:r.enemyPositions,next:r.next};case"longRest":return l.startLongRest(r.nextScene),null;case"shortRest":return l.startShortRest(r.nextScene),null;case"items":return l.handleItemGain(r.item),r.nextScene;case"ally":return Fp(r,l);case"skillCheck":return qy(r,l);case"setFlag":return My(r);case"changeReputation":return Dy(r,l);case"openShop":return r;case"openSellInterface":return r;case"scene_transition":return r.next;default:return console.warn("Type d'action inconnu :",r.type),null}}return null},Ny=(r,l)=>{const s=yt.getState();switch(r.consequences&&s.applyConsequences(r.consequences),r.type){case"item":r.item&&l.handleItemGain(r.item);break;case"ally":r.ally&&Fp(r,l);break}},Fp=(r,l)=>{const s=_o[r.ally];if(s){const i={...s,id:r.ally.toLowerCase()};if(l.addCompanion){l.addCompanion(i);const f=[...At.getState().activeCompanions,i.id];l.setActiveCompanions(f)}return l.setPlayerCompanion&&!At.getState().playerCompanion&&l.setPlayerCompanion(s),yt.getState().addToList("companions",r.ally),l.addCombatMessage(`${s.name} te rejoint dans ton aventure !`,"upgrade"),r.nextScene}else return console.error(`Compagnon '${r.ally}' introuvable.`),null},qy=(r,l)=>{const s=At.getState().playerCharacter;return s?(r.onSuccess&&typeof r.onSuccess=="object"&&r.onSuccess.consequences?l.handleSkillCheckWithConsequences?.(r.skill,r.dc,r.onSuccess,r.onPartialSuccess,r.onFailure,s)||l.handleSkillCheck(r.skill,r.dc,r.onSuccess.next||r.onSuccess,r.onPartialSuccess,r.onFailure,s):l.handleSkillCheck(r.skill,r.dc,r.onSuccess,r.onPartialSuccess,r.onFailure,s),null):(console.error("Aucun personnage joueur trouv pour le test de comptence"),null)},My=(r,l)=>{const s=yt.getState();return r.flags?s.setFlags(r.flags):r.flag&&r.value!==void 0&&s.setFlag(r.flag,r.value),r.nextScene},Dy=(r,l)=>{const s=yt.getState();return typeof r.change=="number"&&(s.updateReputation(r.change),l.addCombatMessage(`Rputation ${r.change>0?"augmente":"diminue"} de ${Math.abs(r.change)}`,"info")),r.nextScene},Ry=async(r,l,s)=>{if(r.consequences&&await yt.getState().applyConsequences(r.consequences),r.action){const i=yo(r.action,s);if(i)return i;if(i===null)return null}return r.next},zy=()=>{const r=yt.getState(),l=At.getState();return{flags:r.gameFlags,character:l.playerCharacter,currentScene:r.currentScene}};function wp({error:r,resetErrorBoundary:l}){return c.jsxs("div",{className:"error-boundary",children:[c.jsx("h2",{children:"Quelque chose s'est mal pass :"}),c.jsx("pre",{children:r.message}),c.jsx("button",{onClick:l,children:"Ressayer"})]})}function Oy(){const{gamePhase:r,currentScene:l,combatLog:s,isShortResting:i,isLongResting:u,nextSceneAfterRest:m,combatKey:f,gameFlags:p,setGamePhase:g,setCurrentScene:h,addCombatMessage:y,handleSkillCheck:b,startShortRest:S,startLongRest:A,endShortRest:T,endLongRest:N,applyConsequences:q}=yt(),{playerCharacter:_,playerCompanion:D,playerCompanions:G,activeCompanions:re,setPlayerCharacter:F,setPlayerCompanion:ee,addCompanion:I,setActiveCompanions:ne,getActiveCompanions:K,takeDamagePlayer:he,takeDamageCompanion:oe,addItemToInventory:Ce,useItem:Ye,castSpellPlayer:$,shortRestPlayer:U,longRestPlayer:E,longRestAll:B,addExperience:Y}=At(),{isActive:J,initializeCombat:j,resetCombat:k,incrementCombatKey:Q}=la(),{showError:Z}=Ke(),te=W=>{const He={...W,gold:W.gold||100};F(He),g("game"),y("La fortune sourit aux audacieux")},pe=()=>{const{totalXpGained:W,combatEnemies:He}=la.getState(),Le=W||He.reduce((Se,Fe)=>Se+(Fe.xp||0),0);Le>0&&(Y(Le,"player"),y(`Vous gagnez ${Le} points d'exprience !`,"victory"),D&&(Y(Le,"companion"),y(`${D.name} gagne aussi ${Le} points d'exprience !`,"victory")));const Ie=l.next;if(k(),y("Combat termin ! Victoire !","victory"),Ie){const Se=yo(Ie,{startLongRest:A,startShortRest:S,handleItemGain:ie,setPlayerCompanion:ee,addCompanion:I,setActiveCompanions:ne,addCombatMessage:y,handleSkillCheck:b});Se&&h(Se)}else console.warn("Aucune scne suivante n'est dfinie aprs le combat."),h("fin_du_jeu")},ie=W=>{(Array.isArray(W)?W:[W]).forEach(Le=>{let Ie=hn[Le];if(Ie||(Ie=ja[Le]),Ie){const Se={...Ie,id:Le};Ce(Se),y(`Objet obtenu : ${Ie.name}`,"item")}else console.error(` Item non trouv dans items.js ou weapons.js : ${Le}`)})},Je=()=>{U(),T()},Ae=()=>{B(),N(),y("Repos long termin - PV et sorts restaurs","rest")},Ft=(W,He=null)=>{try{$(W,He?{spellLevel:He}:{}),y(`Sort lanc : ${W.name}`,"spell")}catch(Le){console.error("Erreur lors du lancement du sort:",Le),Z(`Impossible de lancer le sort : ${Le.message}`)}};if(r==="character-selection")return c.jsx(jp,{FallbackComponent:wp,children:c.jsx(ny,{onCharacterSelect:te})});if(!_)return c.jsx("div",{className:"game-container",children:c.jsx("div",{className:"main-content",children:c.jsx("p",{children:"Chargement de ton personnage..."})})});const Za=typeof l=="object"&&l.type==="combat",gn=`game-container ${Za?"combat-mode":""}`,rs=`main-content ${Za?"combat-mode":""}`,cs=`sidebar ${Za?"combat-mode":""}`,vn=()=>{const W=zy();return W.character=_,W},yn=async W=>{const He=vn(),Le=await Ry(W,He,{startLongRest:A,startShortRest:S,handleItemGain:ie,setPlayerCompanion:ee,addCompanion:I,setActiveCompanions:ne,addCombatMessage:y,handleSkillCheck:b});Le&&h(Le)},Ui=W=>{if(W.action){const He=yo(W.action,{startLongRest:A,startShortRest:S,handleItemGain:ie,setPlayerCompanion:ee,addCompanion:I,setActiveCompanions:ne,addCombatMessage:y,handleSkillCheck:b});He&&h(He)}},wt=W=>{if(W.success){const He={..._,gold:(_.gold||0)+W.effects.gold};F(He),W.effects.items&&ie(W.effects.items),y(W.message,"success")}else y(W.message,"error")},Gi=W=>{if(W.success){const He={..._,gold:(_.gold||0)+W.effects.gold};F(He),W.effects.removeItems&&console.log("Items to remove:",W.effects.removeItems),y(W.message,"success")}else y(W.message,"error")},ml=W=>{const He=vn();if(!Yt.shouldShowScene(W,He))return c.jsx("p",{children:"Cette scne n'est pas disponible actuellement."});switch(W.metadata.type){case L.DIALOGUE:return c.jsxs("div",{className:"scene-dialogue",children:[c.jsx(Ip,{scene:W,gameState:He,onChoice:yn}),c.jsx(sa,{title:"Journal",compact:!0})]});case L.INTERACTIVE:return c.jsxs("div",{className:"scene-interactive",children:[c.jsx(Ey,{scene:W,gameState:He,onHotspotClick:Ui,onChoice:yn}),c.jsx(sa,{title:"Journal",compact:!0})]});case L.MERCHANT:return c.jsxs("div",{className:"scene-merchant",children:[c.jsx(Ay,{scene:W,gameState:He,onChoice:yn,onPurchase:wt,onSell:Gi}),c.jsx(sa,{title:"Journal",compact:!0})]});case L.REST_LONG:return c.jsxs("div",{className:"scene-rest-long",children:[c.jsx(Di,{type:"long",character:_,onRestComplete:()=>{Ae(),W.metadata.nextScene&&h(W.metadata.nextScene)}}),c.jsx(sa,{title:"Journal",compact:!0})]});case L.REST_SHORT:return c.jsxs("div",{className:"scene-rest-short",children:[c.jsx(Di,{type:"short",character:_,onRestComplete:()=>{Je(),W.metadata.nextScene&&h(W.metadata.nextScene)}}),c.jsx(sa,{title:"Journal",compact:!0})]});case L.COMBAT:const Le={};W.enemyPositions&&Array.isArray(W.enemyPositions)&&W.enemyPositions.forEach((Se,Fe)=>{if(W.enemies&&W.enemies[0]){const We=W.enemies[0].type,$i=`${{name:We.charAt(0).toUpperCase()+We.slice(1)}.name} ${Fe+1}`;Le[$i]=Se}});const Ie={type:"combat",enemies:W.enemies||[],enemyPositions:Le,playerPosition:W.playerPosition||null,companionPositions:W.companionPositions||null,next:W.metadata.nextScene||W.next};return console.log(" Combat scene data:",W),console.log(" Combat data for CombatPanel:",Ie),console.log(" Enemy positions converted:",Le),c.jsx(Op,{playerCharacter:_,playerCompanion:D,activeCompanions:K(),encounterData:Ie,onCombatEnd:()=>{pe(),W.metadata.nextScene&&h(W.metadata.nextScene)},onReplayCombat:()=>{_&&F({..._,currentHP:_.maxHP}),D&&ee({...D,currentHP:D.maxHP}),k(),Q(),y(" Combat rinitialis !","info"),setTimeout(()=>{const Se={..._,currentHP:_.maxHP},Fe=K().map(We=>({...We,currentHP:We.maxHP}));j(W,Se,Fe)},100)}},f);case L.TEXT:default:return c.jsxs("div",{className:"scene-textuel-new",children:[c.jsxs("div",{className:"scene-content",children:[c.jsx("h3",{children:W.metadata.title}),c.jsx("div",{className:"scene-text",children:Yt.getSceneText(W,He).split(`
`).map((Se,Fe)=>Se.trim()===""?c.jsx("br",{},Fe):c.jsx("p",{children:Se},Fe))})]}),c.jsx("div",{className:"scene-choices",children:Yt.getAvailableChoices(W,He).map((Se,Fe)=>c.jsx("button",{className:"choice-button",onClick:()=>yn(Se),children:Se.text},Fe))}),c.jsx(sa,{title:"Journal",compact:!0})]})}},pl=()=>{if(u)return c.jsxs("div",{className:"long-rest-panel",children:[c.jsx(Di,{type:"long",character:_,onRestComplete:Ae}),c.jsx(sa,{title:"Journal",compact:!0})]});if(i)return c.jsxs("div",{className:"short-rest-panel",children:[c.jsx(Di,{type:"short",character:_,onRestComplete:Je}),c.jsx(sa,{title:"Journal",compact:!0})]});if(typeof l=="object"&&l.type==="combat")return c.jsx(Op,{playerCharacter:_,playerCompanion:D,activeCompanions:K(),encounterData:l,onCombatEnd:pe,onReplayCombat:()=>{_&&F({..._,currentHP:_.maxHP}),D&&ee({...D,currentHP:D.maxHP}),k(),Q(),y(" Combat rinitialis !","info"),setTimeout(()=>{const Le={..._,currentHP:_.maxHP},Ie=K().map(Se=>({...Se,currentHP:Se.maxHP}));j(l,Le,Ie)},100)}},f);const W=wg[l];return W?ml(W):Cg[l]?(console.error(` Scne legacy non migre: ${l} - Veuillez la migrer vers le nouveau format`),c.jsxs("div",{className:"scene-error",children:[c.jsx("h3",{children:" Scne non migre"}),c.jsxs("p",{children:['La scne "',l,`" utilise l'ancien format et doit tre migre.`]}),c.jsx("p",{children:"Veuillez contacter les dveloppeurs pour migrer cette scne."})]})):c.jsx("p",{children:"Fin du jeu"})},xn=_?.spellcasting;_?.weapons&&_.weapons.length>0;const Xi=_?.specialAbilities;return c.jsx(jp,{FallbackComponent:wp,children:c.jsxs("div",{className:gn,children:[c.jsx("div",{className:rs,children:pl()}),c.jsxs("div",{className:`${cs} right-sidebar`,children:[c.jsx(Kp,{character:_,variant:"interactive"}),c.jsx(ly,{companions:K(),variant:"default",showRoles:!0}),!K().length&&D&&c.jsx(Jp,{companion:D}),c.jsx(py,{}),xn&&c.jsx(by,{character:_,onCastSpell:Ft,isOutOfCombat:!0}),Xi&&c.jsx(sy,{character:_})]})]})})}jg.createRoot(document.getElementById("root")).render(c.jsx(Oy,{}));
