(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))i(u);new MutationObserver(u=>{for(const m of u)if(m.type==="childList")for(const p of m.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&i(p)}).observe(document,{childList:!0,subtree:!0});function s(u){const m={};return u.integrity&&(m.integrity=u.integrity),u.referrerPolicy&&(m.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?m.credentials="include":u.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function i(u){if(u.ep)return;u.ep=!0;const m=s(u);fetch(u.href,m)}})();function lo(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var Xc={exports:{}},tl={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tf;function og(){if(tf)return tl;tf=1;var o=Symbol.for("react.transitional.element"),l=Symbol.for("react.fragment");function s(i,u,m){var p=null;if(m!==void 0&&(p=""+m),u.key!==void 0&&(p=""+u.key),"key"in u){m={};for(var f in u)f!=="key"&&(m[f]=u[f])}else m=u;return u=m.ref,{$$typeof:o,type:i,key:p,ref:u!==void 0?u:null,props:m}}return tl.Fragment=l,tl.jsx=s,tl.jsxs=s,tl}var af;function ug(){return af||(af=1,Xc.exports=og()),Xc.exports}var c=ug(),Vc={exports:{}},pe={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var nf;function dg(){if(nf)return pe;nf=1;var o=Symbol.for("react.transitional.element"),l=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),u=Symbol.for("react.profiler"),m=Symbol.for("react.consumer"),p=Symbol.for("react.context"),f=Symbol.for("react.forward_ref"),v=Symbol.for("react.suspense"),g=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),b=Symbol.iterator;function E(S){return S===null||typeof S!="object"?null:(S=b&&S[b]||S["@@iterator"],typeof S=="function"?S:null)}var C={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},_=Object.assign,A={};function D(S,k,Z){this.props=S,this.context=k,this.refs=A,this.updater=Z||C}D.prototype.isReactComponent={},D.prototype.setState=function(S,k){if(typeof S!="object"&&typeof S!="function"&&S!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,S,k,"setState")},D.prototype.forceUpdate=function(S){this.updater.enqueueForceUpdate(this,S,"forceUpdate")};function j(){}j.prototype=D.prototype;function q(S,k,Z){this.props=S,this.context=k,this.refs=A,this.updater=Z||C}var B=q.prototype=new j;B.constructor=q,_(B,D.prototype),B.isPureReactComponent=!0;var F=Array.isArray,W={H:null,A:null,T:null,S:null,V:null},le=Object.prototype.hasOwnProperty;function ae(S,k,Z,K,re,he){return Z=he.ref,{$$typeof:o,type:S,key:k,ref:Z!==void 0?Z:null,props:he}}function J(S,k){return ae(S.type,k,void 0,void 0,void 0,S.props)}function ee(S){return typeof S=="object"&&S!==null&&S.$$typeof===o}function ie(S){var k={"=":"=0",":":"=2"};return"$"+S.replace(/[=:]/g,function(Z){return k[Z]})}var Ne=/\/+/g;function Me(S,k){return typeof S=="object"&&S!==null&&S.key!=null?ie(""+S.key):k.toString(36)}function X(){}function Y(S){switch(S.status){case"fulfilled":return S.value;case"rejected":throw S.reason;default:switch(typeof S.status=="string"?S.then(X,X):(S.status="pending",S.then(function(k){S.status==="pending"&&(S.status="fulfilled",S.value=k)},function(k){S.status==="pending"&&(S.status="rejected",S.reason=k)})),S.status){case"fulfilled":return S.value;case"rejected":throw S.reason}}throw S}function P(S,k,Z,K,re){var he=typeof S;(he==="undefined"||he==="boolean")&&(S=null);var me=!1;if(S===null)me=!0;else switch(he){case"bigint":case"string":case"number":me=!0;break;case"object":switch(S.$$typeof){case o:case l:me=!0;break;case y:return me=S._init,P(me(S._payload),k,Z,K,re)}}if(me)return re=re(S),me=K===""?"."+Me(S,0):K,F(re)?(Z="",me!=null&&(Z=me.replace(Ne,"$&/")+"/"),P(re,k,Z,"",function(ea){return ea})):re!=null&&(ee(re)&&(re=J(re,Z+(re.key==null||S&&S.key===re.key?"":(""+re.key).replace(Ne,"$&/")+"/")+me)),k.push(re)),1;me=0;var lt=K===""?".":K+":";if(F(S))for(var Oe=0;Oe<S.length;Oe++)K=S[Oe],he=lt+Me(K,Oe),me+=P(K,k,Z,he,re);else if(Oe=E(S),typeof Oe=="function")for(S=Oe.call(S),Oe=0;!(K=S.next()).done;)K=K.value,he=lt+Me(K,Oe++),me+=P(K,k,Z,he,re);else if(he==="object"){if(typeof S.then=="function")return P(Y(S),k,Z,K,re);throw k=String(S),Error("Objects are not valid as a React child (found: "+(k==="[object Object]"?"object with keys {"+Object.keys(S).join(", ")+"}":k)+"). If you meant to render a collection of children, use an array instead.")}return me}function N(S,k,Z){if(S==null)return S;var K=[],re=0;return P(S,K,"","",function(he){return k.call(Z,he,re++)}),K}function G(S){if(S._status===-1){var k=S._result;k=k(),k.then(function(Z){(S._status===0||S._status===-1)&&(S._status=1,S._result=Z)},function(Z){(S._status===0||S._status===-1)&&(S._status=2,S._result=Z)}),S._status===-1&&(S._status=0,S._result=k)}if(S._status===1)return S._result.default;throw S._result}var Q=typeof reportError=="function"?reportError:function(S){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var k=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof S=="object"&&S!==null&&typeof S.message=="string"?String(S.message):String(S),error:S});if(!window.dispatchEvent(k))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",S);return}console.error(S)};function I(){}return pe.Children={map:N,forEach:function(S,k,Z){N(S,function(){k.apply(this,arguments)},Z)},count:function(S){var k=0;return N(S,function(){k++}),k},toArray:function(S){return N(S,function(k){return k})||[]},only:function(S){if(!ee(S))throw Error("React.Children.only expected to receive a single React element child.");return S}},pe.Component=D,pe.Fragment=s,pe.Profiler=u,pe.PureComponent=q,pe.StrictMode=i,pe.Suspense=v,pe.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=W,pe.__COMPILER_RUNTIME={__proto__:null,c:function(S){return W.H.useMemoCache(S)}},pe.cache=function(S){return function(){return S.apply(null,arguments)}},pe.cloneElement=function(S,k,Z){if(S==null)throw Error("The argument must be a React element, but you passed "+S+".");var K=_({},S.props),re=S.key,he=void 0;if(k!=null)for(me in k.ref!==void 0&&(he=void 0),k.key!==void 0&&(re=""+k.key),k)!le.call(k,me)||me==="key"||me==="__self"||me==="__source"||me==="ref"&&k.ref===void 0||(K[me]=k[me]);var me=arguments.length-2;if(me===1)K.children=Z;else if(1<me){for(var lt=Array(me),Oe=0;Oe<me;Oe++)lt[Oe]=arguments[Oe+2];K.children=lt}return ae(S.type,re,void 0,void 0,he,K)},pe.createContext=function(S){return S={$$typeof:p,_currentValue:S,_currentValue2:S,_threadCount:0,Provider:null,Consumer:null},S.Provider=S,S.Consumer={$$typeof:m,_context:S},S},pe.createElement=function(S,k,Z){var K,re={},he=null;if(k!=null)for(K in k.key!==void 0&&(he=""+k.key),k)le.call(k,K)&&K!=="key"&&K!=="__self"&&K!=="__source"&&(re[K]=k[K]);var me=arguments.length-2;if(me===1)re.children=Z;else if(1<me){for(var lt=Array(me),Oe=0;Oe<me;Oe++)lt[Oe]=arguments[Oe+2];re.children=lt}if(S&&S.defaultProps)for(K in me=S.defaultProps,me)re[K]===void 0&&(re[K]=me[K]);return ae(S,he,void 0,void 0,null,re)},pe.createRef=function(){return{current:null}},pe.forwardRef=function(S){return{$$typeof:f,render:S}},pe.isValidElement=ee,pe.lazy=function(S){return{$$typeof:y,_payload:{_status:-1,_result:S},_init:G}},pe.memo=function(S,k){return{$$typeof:g,type:S,compare:k===void 0?null:k}},pe.startTransition=function(S){var k=W.T,Z={};W.T=Z;try{var K=S(),re=W.S;re!==null&&re(Z,K),typeof K=="object"&&K!==null&&typeof K.then=="function"&&K.then(I,Q)}catch(he){Q(he)}finally{W.T=k}},pe.unstable_useCacheRefresh=function(){return W.H.useCacheRefresh()},pe.use=function(S){return W.H.use(S)},pe.useActionState=function(S,k,Z){return W.H.useActionState(S,k,Z)},pe.useCallback=function(S,k){return W.H.useCallback(S,k)},pe.useContext=function(S){return W.H.useContext(S)},pe.useDebugValue=function(){},pe.useDeferredValue=function(S,k){return W.H.useDeferredValue(S,k)},pe.useEffect=function(S,k,Z){var K=W.H;if(typeof Z=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return K.useEffect(S,k)},pe.useId=function(){return W.H.useId()},pe.useImperativeHandle=function(S,k,Z){return W.H.useImperativeHandle(S,k,Z)},pe.useInsertionEffect=function(S,k){return W.H.useInsertionEffect(S,k)},pe.useLayoutEffect=function(S,k){return W.H.useLayoutEffect(S,k)},pe.useMemo=function(S,k){return W.H.useMemo(S,k)},pe.useOptimistic=function(S,k){return W.H.useOptimistic(S,k)},pe.useReducer=function(S,k,Z){return W.H.useReducer(S,k,Z)},pe.useRef=function(S){return W.H.useRef(S)},pe.useState=function(S){return W.H.useState(S)},pe.useSyncExternalStore=function(S,k,Z){return W.H.useSyncExternalStore(S,k,Z)},pe.useTransition=function(){return W.H.useTransition()},pe.version="19.1.1",pe}var sf;function io(){return sf||(sf=1,Vc.exports=dg()),Vc.exports}var se=io();const ke=lo(se);var $c={exports:{}},al={},Yc={exports:{}},Qc={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lf;function mg(){return lf||(lf=1,function(o){function l(N,G){var Q=N.length;N.push(G);e:for(;0<Q;){var I=Q-1>>>1,S=N[I];if(0<u(S,G))N[I]=G,N[Q]=S,Q=I;else break e}}function s(N){return N.length===0?null:N[0]}function i(N){if(N.length===0)return null;var G=N[0],Q=N.pop();if(Q!==G){N[0]=Q;e:for(var I=0,S=N.length,k=S>>>1;I<k;){var Z=2*(I+1)-1,K=N[Z],re=Z+1,he=N[re];if(0>u(K,Q))re<S&&0>u(he,K)?(N[I]=he,N[re]=Q,I=re):(N[I]=K,N[Z]=Q,I=Z);else if(re<S&&0>u(he,Q))N[I]=he,N[re]=Q,I=re;else break e}}return G}function u(N,G){var Q=N.sortIndex-G.sortIndex;return Q!==0?Q:N.id-G.id}if(o.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var m=performance;o.unstable_now=function(){return m.now()}}else{var p=Date,f=p.now();o.unstable_now=function(){return p.now()-f}}var v=[],g=[],y=1,b=null,E=3,C=!1,_=!1,A=!1,D=!1,j=typeof setTimeout=="function"?setTimeout:null,q=typeof clearTimeout=="function"?clearTimeout:null,B=typeof setImmediate<"u"?setImmediate:null;function F(N){for(var G=s(g);G!==null;){if(G.callback===null)i(g);else if(G.startTime<=N)i(g),G.sortIndex=G.expirationTime,l(v,G);else break;G=s(g)}}function W(N){if(A=!1,F(N),!_)if(s(v)!==null)_=!0,le||(le=!0,Me());else{var G=s(g);G!==null&&P(W,G.startTime-N)}}var le=!1,ae=-1,J=5,ee=-1;function ie(){return D?!0:!(o.unstable_now()-ee<J)}function Ne(){if(D=!1,le){var N=o.unstable_now();ee=N;var G=!0;try{e:{_=!1,A&&(A=!1,q(ae),ae=-1),C=!0;var Q=E;try{t:{for(F(N),b=s(v);b!==null&&!(b.expirationTime>N&&ie());){var I=b.callback;if(typeof I=="function"){b.callback=null,E=b.priorityLevel;var S=I(b.expirationTime<=N);if(N=o.unstable_now(),typeof S=="function"){b.callback=S,F(N),G=!0;break t}b===s(v)&&i(v),F(N)}else i(v);b=s(v)}if(b!==null)G=!0;else{var k=s(g);k!==null&&P(W,k.startTime-N),G=!1}}break e}finally{b=null,E=Q,C=!1}G=void 0}}finally{G?Me():le=!1}}}var Me;if(typeof B=="function")Me=function(){B(Ne)};else if(typeof MessageChannel<"u"){var X=new MessageChannel,Y=X.port2;X.port1.onmessage=Ne,Me=function(){Y.postMessage(null)}}else Me=function(){j(Ne,0)};function P(N,G){ae=j(function(){N(o.unstable_now())},G)}o.unstable_IdlePriority=5,o.unstable_ImmediatePriority=1,o.unstable_LowPriority=4,o.unstable_NormalPriority=3,o.unstable_Profiling=null,o.unstable_UserBlockingPriority=2,o.unstable_cancelCallback=function(N){N.callback=null},o.unstable_forceFrameRate=function(N){0>N||125<N?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):J=0<N?Math.floor(1e3/N):5},o.unstable_getCurrentPriorityLevel=function(){return E},o.unstable_next=function(N){switch(E){case 1:case 2:case 3:var G=3;break;default:G=E}var Q=E;E=G;try{return N()}finally{E=Q}},o.unstable_requestPaint=function(){D=!0},o.unstable_runWithPriority=function(N,G){switch(N){case 1:case 2:case 3:case 4:case 5:break;default:N=3}var Q=E;E=N;try{return G()}finally{E=Q}},o.unstable_scheduleCallback=function(N,G,Q){var I=o.unstable_now();switch(typeof Q=="object"&&Q!==null?(Q=Q.delay,Q=typeof Q=="number"&&0<Q?I+Q:I):Q=I,N){case 1:var S=-1;break;case 2:S=250;break;case 5:S=1073741823;break;case 4:S=1e4;break;default:S=5e3}return S=Q+S,N={id:y++,callback:G,priorityLevel:N,startTime:Q,expirationTime:S,sortIndex:-1},Q>I?(N.sortIndex=Q,l(g,N),s(v)===null&&N===s(g)&&(A?(q(ae),ae=-1):A=!0,P(W,Q-I))):(N.sortIndex=S,l(v,N),_||C||(_=!0,le||(le=!0,Me()))),N},o.unstable_shouldYield=ie,o.unstable_wrapCallback=function(N){var G=E;return function(){var Q=E;E=G;try{return N.apply(this,arguments)}finally{E=Q}}}}(Qc)),Qc}var rf;function fg(){return rf||(rf=1,Yc.exports=mg()),Yc.exports}var Zc={exports:{}},mt={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cf;function pg(){if(cf)return mt;cf=1;var o=io();function l(v){var g="https://react.dev/errors/"+v;if(1<arguments.length){g+="?args[]="+encodeURIComponent(arguments[1]);for(var y=2;y<arguments.length;y++)g+="&args[]="+encodeURIComponent(arguments[y])}return"Minified React error #"+v+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(){}var i={d:{f:s,r:function(){throw Error(l(522))},D:s,C:s,L:s,m:s,X:s,S:s,M:s},p:0,findDOMNode:null},u=Symbol.for("react.portal");function m(v,g,y){var b=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:u,key:b==null?null:""+b,children:v,containerInfo:g,implementation:y}}var p=o.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function f(v,g){if(v==="font")return"";if(typeof g=="string")return g==="use-credentials"?g:""}return mt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,mt.createPortal=function(v,g){var y=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!g||g.nodeType!==1&&g.nodeType!==9&&g.nodeType!==11)throw Error(l(299));return m(v,g,null,y)},mt.flushSync=function(v){var g=p.T,y=i.p;try{if(p.T=null,i.p=2,v)return v()}finally{p.T=g,i.p=y,i.d.f()}},mt.preconnect=function(v,g){typeof v=="string"&&(g?(g=g.crossOrigin,g=typeof g=="string"?g==="use-credentials"?g:"":void 0):g=null,i.d.C(v,g))},mt.prefetchDNS=function(v){typeof v=="string"&&i.d.D(v)},mt.preinit=function(v,g){if(typeof v=="string"&&g&&typeof g.as=="string"){var y=g.as,b=f(y,g.crossOrigin),E=typeof g.integrity=="string"?g.integrity:void 0,C=typeof g.fetchPriority=="string"?g.fetchPriority:void 0;y==="style"?i.d.S(v,typeof g.precedence=="string"?g.precedence:void 0,{crossOrigin:b,integrity:E,fetchPriority:C}):y==="script"&&i.d.X(v,{crossOrigin:b,integrity:E,fetchPriority:C,nonce:typeof g.nonce=="string"?g.nonce:void 0})}},mt.preinitModule=function(v,g){if(typeof v=="string")if(typeof g=="object"&&g!==null){if(g.as==null||g.as==="script"){var y=f(g.as,g.crossOrigin);i.d.M(v,{crossOrigin:y,integrity:typeof g.integrity=="string"?g.integrity:void 0,nonce:typeof g.nonce=="string"?g.nonce:void 0})}}else g==null&&i.d.M(v)},mt.preload=function(v,g){if(typeof v=="string"&&typeof g=="object"&&g!==null&&typeof g.as=="string"){var y=g.as,b=f(y,g.crossOrigin);i.d.L(v,y,{crossOrigin:b,integrity:typeof g.integrity=="string"?g.integrity:void 0,nonce:typeof g.nonce=="string"?g.nonce:void 0,type:typeof g.type=="string"?g.type:void 0,fetchPriority:typeof g.fetchPriority=="string"?g.fetchPriority:void 0,referrerPolicy:typeof g.referrerPolicy=="string"?g.referrerPolicy:void 0,imageSrcSet:typeof g.imageSrcSet=="string"?g.imageSrcSet:void 0,imageSizes:typeof g.imageSizes=="string"?g.imageSizes:void 0,media:typeof g.media=="string"?g.media:void 0})}},mt.preloadModule=function(v,g){if(typeof v=="string")if(g){var y=f(g.as,g.crossOrigin);i.d.m(v,{as:typeof g.as=="string"&&g.as!=="script"?g.as:void 0,crossOrigin:y,integrity:typeof g.integrity=="string"?g.integrity:void 0})}else i.d.m(v)},mt.requestFormReset=function(v){i.d.r(v)},mt.unstable_batchedUpdates=function(v,g){return v(g)},mt.useFormState=function(v,g,y){return p.H.useFormState(v,g,y)},mt.useFormStatus=function(){return p.H.useHostTransitionStatus()},mt.version="19.1.1",mt}var of;function Af(){if(of)return Zc.exports;of=1;function o(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o)}catch(l){console.error(l)}}return o(),Zc.exports=pg(),Zc.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var uf;function hg(){if(uf)return al;uf=1;var o=fg(),l=io(),s=Af();function i(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var a=2;a<arguments.length;a++)t+="&args[]="+encodeURIComponent(arguments[a])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function u(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function m(e){var t=e,a=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,(t.flags&4098)!==0&&(a=t.return),e=t.return;while(e)}return t.tag===3?a:null}function p(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function f(e){if(m(e)!==e)throw Error(i(188))}function v(e){var t=e.alternate;if(!t){if(t=m(e),t===null)throw Error(i(188));return t!==e?null:e}for(var a=e,n=t;;){var r=a.return;if(r===null)break;var d=r.alternate;if(d===null){if(n=r.return,n!==null){a=n;continue}break}if(r.child===d.child){for(d=r.child;d;){if(d===a)return f(r),e;if(d===n)return f(r),t;d=d.sibling}throw Error(i(188))}if(a.return!==n.return)a=r,n=d;else{for(var h=!1,x=r.child;x;){if(x===a){h=!0,a=r,n=d;break}if(x===n){h=!0,n=r,a=d;break}x=x.sibling}if(!h){for(x=d.child;x;){if(x===a){h=!0,a=d,n=r;break}if(x===n){h=!0,n=d,a=r;break}x=x.sibling}if(!h)throw Error(i(189))}}if(a.alternate!==n)throw Error(i(190))}if(a.tag!==3)throw Error(i(188));return a.stateNode.current===a?e:t}function g(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e;for(e=e.child;e!==null;){if(t=g(e),t!==null)return t;e=e.sibling}return null}var y=Object.assign,b=Symbol.for("react.element"),E=Symbol.for("react.transitional.element"),C=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),A=Symbol.for("react.strict_mode"),D=Symbol.for("react.profiler"),j=Symbol.for("react.provider"),q=Symbol.for("react.consumer"),B=Symbol.for("react.context"),F=Symbol.for("react.forward_ref"),W=Symbol.for("react.suspense"),le=Symbol.for("react.suspense_list"),ae=Symbol.for("react.memo"),J=Symbol.for("react.lazy"),ee=Symbol.for("react.activity"),ie=Symbol.for("react.memo_cache_sentinel"),Ne=Symbol.iterator;function Me(e){return e===null||typeof e!="object"?null:(e=Ne&&e[Ne]||e["@@iterator"],typeof e=="function"?e:null)}var X=Symbol.for("react.client.reference");function Y(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===X?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case _:return"Fragment";case D:return"Profiler";case A:return"StrictMode";case W:return"Suspense";case le:return"SuspenseList";case ee:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case C:return"Portal";case B:return(e.displayName||"Context")+".Provider";case q:return(e._context.displayName||"Context")+".Consumer";case F:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case ae:return t=e.displayName||null,t!==null?t:Y(e.type)||"Memo";case J:t=e._payload,e=e._init;try{return Y(e(t))}catch{}}return null}var P=Array.isArray,N=l.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,G=s.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Q={pending:!1,data:null,method:null,action:null},I=[],S=-1;function k(e){return{current:e}}function Z(e){0>S||(e.current=I[S],I[S]=null,S--)}function K(e,t){S++,I[S]=e.current,e.current=t}var re=k(null),he=k(null),me=k(null),lt=k(null);function Oe(e,t){switch(K(me,t),K(he,e),K(re,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?Mm(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)t=Mm(t),e=Dm(t,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}Z(re),K(re,e)}function ea(){Z(re),Z(he),Z(me)}function te(e){e.memoizedState!==null&&K(lt,e);var t=re.current,a=Dm(t,e.type);t!==a&&(K(he,e),K(re,a))}function De(e){he.current===e&&(Z(re),Z(he)),lt.current===e&&(Z(lt),Js._currentValue=Q)}var _e=Object.prototype.hasOwnProperty,Xe=o.unstable_scheduleCallback,Zt=o.unstable_cancelCallback,oa=o.unstable_shouldYield,ta=o.unstable_requestPaint,vt=o.unstable_now,qi=o.unstable_getCurrentPriorityLevel,co=o.unstable_ImmediatePriority,oo=o.unstable_UserBlockingPriority,rl=o.unstable_NormalPriority,Vf=o.unstable_LowPriority,uo=o.unstable_IdlePriority,$f=o.log,Yf=o.unstable_setDisableYieldValue,ss=null,Ct=null;function Na(e){if(typeof $f=="function"&&Yf(e),Ct&&typeof Ct.setStrictMode=="function")try{Ct.setStrictMode(ss,e)}catch{}}var Nt=Math.clz32?Math.clz32:Kf,Qf=Math.log,Zf=Math.LN2;function Kf(e){return e>>>=0,e===0?32:31-(Qf(e)/Zf|0)|0}var cl=256,ol=4194304;function Fa(e){var t=e&42;if(t!==0)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function ul(e,t,a){var n=e.pendingLanes;if(n===0)return 0;var r=0,d=e.suspendedLanes,h=e.pingedLanes;e=e.warmLanes;var x=n&134217727;return x!==0?(n=x&~d,n!==0?r=Fa(n):(h&=x,h!==0?r=Fa(h):a||(a=x&~e,a!==0&&(r=Fa(a))))):(x=n&~d,x!==0?r=Fa(x):h!==0?r=Fa(h):a||(a=n&~e,a!==0&&(r=Fa(a)))),r===0?0:t!==0&&t!==r&&(t&d)===0&&(d=r&-r,a=t&-t,d>=a||d===32&&(a&4194048)!==0)?t:r}function ls(e,t){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)===0}function Jf(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function mo(){var e=cl;return cl<<=1,(cl&4194048)===0&&(cl=256),e}function fo(){var e=ol;return ol<<=1,(ol&62914560)===0&&(ol=4194304),e}function Ri(e){for(var t=[],a=0;31>a;a++)t.push(e);return t}function is(e,t){e.pendingLanes|=t,t!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function If(e,t,a,n,r,d){var h=e.pendingLanes;e.pendingLanes=a,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=a,e.entangledLanes&=a,e.errorRecoveryDisabledLanes&=a,e.shellSuspendCounter=0;var x=e.entanglements,T=e.expirationTimes,H=e.hiddenUpdates;for(a=h&~a;0<a;){var U=31-Nt(a),$=1<<U;x[U]=0,T[U]=-1;var O=H[U];if(O!==null)for(H[U]=null,U=0;U<O.length;U++){var L=O[U];L!==null&&(L.lane&=-536870913)}a&=~$}n!==0&&po(e,n,0),d!==0&&r===0&&e.tag!==0&&(e.suspendedLanes|=d&~(h&~t))}function po(e,t,a){e.pendingLanes|=t,e.suspendedLanes&=~t;var n=31-Nt(t);e.entangledLanes|=t,e.entanglements[n]=e.entanglements[n]|1073741824|a&4194090}function ho(e,t){var a=e.entangledLanes|=t;for(e=e.entanglements;a;){var n=31-Nt(a),r=1<<n;r&t|e[n]&t&&(e[n]|=t),a&=~r}}function zi(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function Hi(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function go(){var e=G.p;return e!==0?e:(e=window.event,e===void 0?32:Km(e.type))}function Ff(e,t){var a=G.p;try{return G.p=e,t()}finally{G.p=a}}var Ma=Math.random().toString(36).slice(2),ut="__reactFiber$"+Ma,yt="__reactProps$"+Ma,yn="__reactContainer$"+Ma,Oi="__reactEvents$"+Ma,Wf="__reactListeners$"+Ma,ep="__reactHandles$"+Ma,vo="__reactResources$"+Ma,rs="__reactMarker$"+Ma;function wi(e){delete e[ut],delete e[yt],delete e[Oi],delete e[Wf],delete e[ep]}function xn(e){var t=e[ut];if(t)return t;for(var a=e.parentNode;a;){if(t=a[yn]||a[ut]){if(a=t.alternate,t.child!==null||a!==null&&a.child!==null)for(e=Hm(e);e!==null;){if(a=e[ut])return a;e=Hm(e)}return t}e=a,a=e.parentNode}return null}function bn(e){if(e=e[ut]||e[yn]){var t=e.tag;if(t===5||t===6||t===13||t===26||t===27||t===3)return e}return null}function cs(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e.stateNode;throw Error(i(33))}function _n(e){var t=e[vo];return t||(t=e[vo]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function We(e){e[rs]=!0}var yo=new Set,xo={};function Wa(e,t){Sn(e,t),Sn(e+"Capture",t)}function Sn(e,t){for(xo[e]=t,e=0;e<t.length;e++)yo.add(t[e])}var tp=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),bo={},_o={};function ap(e){return _e.call(_o,e)?!0:_e.call(bo,e)?!1:tp.test(e)?_o[e]=!0:(bo[e]=!0,!1)}function dl(e,t,a){if(ap(t))if(a===null)e.removeAttribute(t);else{switch(typeof a){case"undefined":case"function":case"symbol":e.removeAttribute(t);return;case"boolean":var n=t.toLowerCase().slice(0,5);if(n!=="data-"&&n!=="aria-"){e.removeAttribute(t);return}}e.setAttribute(t,""+a)}}function ml(e,t,a){if(a===null)e.removeAttribute(t);else{switch(typeof a){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(t);return}e.setAttribute(t,""+a)}}function ua(e,t,a,n){if(n===null)e.removeAttribute(a);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(a);return}e.setAttributeNS(t,a,""+n)}}var Li,So;function jn(e){if(Li===void 0)try{throw Error()}catch(a){var t=a.stack.trim().match(/\n( *(at )?)/);Li=t&&t[1]||"",So=-1<a.stack.indexOf(`
    at`)?" (<anonymous>)":-1<a.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Li+e+So}var Bi=!1;function ki(e,t){if(!e||Bi)return"";Bi=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var n={DetermineComponentFrameRoot:function(){try{if(t){var $=function(){throw Error()};if(Object.defineProperty($.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct($,[])}catch(L){var O=L}Reflect.construct(e,[],$)}else{try{$.call()}catch(L){O=L}e.call($.prototype)}}else{try{throw Error()}catch(L){O=L}($=e())&&typeof $.catch=="function"&&$.catch(function(){})}}catch(L){if(L&&O&&typeof L.stack=="string")return[L.stack,O.stack]}return[null,null]}};n.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var r=Object.getOwnPropertyDescriptor(n.DetermineComponentFrameRoot,"name");r&&r.configurable&&Object.defineProperty(n.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var d=n.DetermineComponentFrameRoot(),h=d[0],x=d[1];if(h&&x){var T=h.split(`
`),H=x.split(`
`);for(r=n=0;n<T.length&&!T[n].includes("DetermineComponentFrameRoot");)n++;for(;r<H.length&&!H[r].includes("DetermineComponentFrameRoot");)r++;if(n===T.length||r===H.length)for(n=T.length-1,r=H.length-1;1<=n&&0<=r&&T[n]!==H[r];)r--;for(;1<=n&&0<=r;n--,r--)if(T[n]!==H[r]){if(n!==1||r!==1)do if(n--,r--,0>r||T[n]!==H[r]){var U=`
`+T[n].replace(" at new "," at ");return e.displayName&&U.includes("<anonymous>")&&(U=U.replace("<anonymous>",e.displayName)),U}while(1<=n&&0<=r);break}}}finally{Bi=!1,Error.prepareStackTrace=a}return(a=e?e.displayName||e.name:"")?jn(a):""}function np(e){switch(e.tag){case 26:case 27:case 5:return jn(e.type);case 16:return jn("Lazy");case 13:return jn("Suspense");case 19:return jn("SuspenseList");case 0:case 15:return ki(e.type,!1);case 11:return ki(e.type.render,!1);case 1:return ki(e.type,!0);case 31:return jn("Activity");default:return""}}function jo(e){try{var t="";do t+=np(e),e=e.return;while(e);return t}catch(a){return`
Error generating stack: `+a.message+`
`+a.stack}}function wt(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function To(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function sp(e){var t=To(e)?"checked":"value",a=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&typeof a<"u"&&typeof a.get=="function"&&typeof a.set=="function"){var r=a.get,d=a.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(h){n=""+h,d.call(this,h)}}),Object.defineProperty(e,t,{enumerable:a.enumerable}),{getValue:function(){return n},setValue:function(h){n=""+h},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function fl(e){e._valueTracker||(e._valueTracker=sp(e))}function Eo(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var a=t.getValue(),n="";return e&&(n=To(e)?e.checked?"true":"false":e.value),e=n,e!==a?(t.setValue(e),!0):!1}function pl(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var lp=/[\n"\\]/g;function Lt(e){return e.replace(lp,function(t){return"\\"+t.charCodeAt(0).toString(16)+" "})}function Pi(e,t,a,n,r,d,h,x){e.name="",h!=null&&typeof h!="function"&&typeof h!="symbol"&&typeof h!="boolean"?e.type=h:e.removeAttribute("type"),t!=null?h==="number"?(t===0&&e.value===""||e.value!=t)&&(e.value=""+wt(t)):e.value!==""+wt(t)&&(e.value=""+wt(t)):h!=="submit"&&h!=="reset"||e.removeAttribute("value"),t!=null?Ui(e,h,wt(t)):a!=null?Ui(e,h,wt(a)):n!=null&&e.removeAttribute("value"),r==null&&d!=null&&(e.defaultChecked=!!d),r!=null&&(e.checked=r&&typeof r!="function"&&typeof r!="symbol"),x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"?e.name=""+wt(x):e.removeAttribute("name")}function Ao(e,t,a,n,r,d,h,x){if(d!=null&&typeof d!="function"&&typeof d!="symbol"&&typeof d!="boolean"&&(e.type=d),t!=null||a!=null){if(!(d!=="submit"&&d!=="reset"||t!=null))return;a=a!=null?""+wt(a):"",t=t!=null?""+wt(t):a,x||t===e.value||(e.value=t),e.defaultValue=t}n=n??r,n=typeof n!="function"&&typeof n!="symbol"&&!!n,e.checked=x?e.checked:!!n,e.defaultChecked=!!n,h!=null&&typeof h!="function"&&typeof h!="symbol"&&typeof h!="boolean"&&(e.name=h)}function Ui(e,t,a){t==="number"&&pl(e.ownerDocument)===e||e.defaultValue===""+a||(e.defaultValue=""+a)}function Tn(e,t,a,n){if(e=e.options,t){t={};for(var r=0;r<a.length;r++)t["$"+a[r]]=!0;for(a=0;a<e.length;a++)r=t.hasOwnProperty("$"+e[a].value),e[a].selected!==r&&(e[a].selected=r),r&&n&&(e[a].defaultSelected=!0)}else{for(a=""+wt(a),t=null,r=0;r<e.length;r++){if(e[r].value===a){e[r].selected=!0,n&&(e[r].defaultSelected=!0);return}t!==null||e[r].disabled||(t=e[r])}t!==null&&(t.selected=!0)}}function Co(e,t,a){if(t!=null&&(t=""+wt(t),t!==e.value&&(e.value=t),a==null)){e.defaultValue!==t&&(e.defaultValue=t);return}e.defaultValue=a!=null?""+wt(a):""}function No(e,t,a,n){if(t==null){if(n!=null){if(a!=null)throw Error(i(92));if(P(n)){if(1<n.length)throw Error(i(93));n=n[0]}a=n}a==null&&(a=""),t=a}a=wt(t),e.defaultValue=a,n=e.textContent,n===a&&n!==""&&n!==null&&(e.value=n)}function En(e,t){if(t){var a=e.firstChild;if(a&&a===e.lastChild&&a.nodeType===3){a.nodeValue=t;return}}e.textContent=t}var ip=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Mo(e,t,a){var n=t.indexOf("--")===0;a==null||typeof a=="boolean"||a===""?n?e.setProperty(t,""):t==="float"?e.cssFloat="":e[t]="":n?e.setProperty(t,a):typeof a!="number"||a===0||ip.has(t)?t==="float"?e.cssFloat=a:e[t]=(""+a).trim():e[t]=a+"px"}function Do(e,t,a){if(t!=null&&typeof t!="object")throw Error(i(62));if(e=e.style,a!=null){for(var n in a)!a.hasOwnProperty(n)||t!=null&&t.hasOwnProperty(n)||(n.indexOf("--")===0?e.setProperty(n,""):n==="float"?e.cssFloat="":e[n]="");for(var r in t)n=t[r],t.hasOwnProperty(r)&&a[r]!==n&&Mo(e,r,n)}else for(var d in t)t.hasOwnProperty(d)&&Mo(e,d,t[d])}function Gi(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var rp=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),cp=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function hl(e){return cp.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var Xi=null;function Vi(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var An=null,Cn=null;function qo(e){var t=bn(e);if(t&&(e=t.stateNode)){var a=e[yt]||null;e:switch(e=t.stateNode,t.type){case"input":if(Pi(e,a.value,a.defaultValue,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name),t=a.name,a.type==="radio"&&t!=null){for(a=e;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll('input[name="'+Lt(""+t)+'"][type="radio"]'),t=0;t<a.length;t++){var n=a[t];if(n!==e&&n.form===e.form){var r=n[yt]||null;if(!r)throw Error(i(90));Pi(n,r.value,r.defaultValue,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name)}}for(t=0;t<a.length;t++)n=a[t],n.form===e.form&&Eo(n)}break e;case"textarea":Co(e,a.value,a.defaultValue);break e;case"select":t=a.value,t!=null&&Tn(e,!!a.multiple,t,!1)}}}var $i=!1;function Ro(e,t,a){if($i)return e(t,a);$i=!0;try{var n=e(t);return n}finally{if($i=!1,(An!==null||Cn!==null)&&(ei(),An&&(t=An,e=Cn,Cn=An=null,qo(t),e)))for(t=0;t<e.length;t++)qo(e[t])}}function os(e,t){var a=e.stateNode;if(a===null)return null;var n=a[yt]||null;if(n===null)return null;a=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(a&&typeof a!="function")throw Error(i(231,t,typeof a));return a}var da=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Yi=!1;if(da)try{var us={};Object.defineProperty(us,"passive",{get:function(){Yi=!0}}),window.addEventListener("test",us,us),window.removeEventListener("test",us,us)}catch{Yi=!1}var Da=null,Qi=null,gl=null;function zo(){if(gl)return gl;var e,t=Qi,a=t.length,n,r="value"in Da?Da.value:Da.textContent,d=r.length;for(e=0;e<a&&t[e]===r[e];e++);var h=a-e;for(n=1;n<=h&&t[a-n]===r[d-n];n++);return gl=r.slice(e,1<n?1-n:void 0)}function vl(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function yl(){return!0}function Ho(){return!1}function xt(e){function t(a,n,r,d,h){this._reactName=a,this._targetInst=r,this.type=n,this.nativeEvent=d,this.target=h,this.currentTarget=null;for(var x in e)e.hasOwnProperty(x)&&(a=e[x],this[x]=a?a(d):d[x]);return this.isDefaultPrevented=(d.defaultPrevented!=null?d.defaultPrevented:d.returnValue===!1)?yl:Ho,this.isPropagationStopped=Ho,this}return y(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=yl)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=yl)},persist:function(){},isPersistent:yl}),t}var en={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},xl=xt(en),ds=y({},en,{view:0,detail:0}),op=xt(ds),Zi,Ki,ms,bl=y({},ds,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ii,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ms&&(ms&&e.type==="mousemove"?(Zi=e.screenX-ms.screenX,Ki=e.screenY-ms.screenY):Ki=Zi=0,ms=e),Zi)},movementY:function(e){return"movementY"in e?e.movementY:Ki}}),Oo=xt(bl),up=y({},bl,{dataTransfer:0}),dp=xt(up),mp=y({},ds,{relatedTarget:0}),Ji=xt(mp),fp=y({},en,{animationName:0,elapsedTime:0,pseudoElement:0}),pp=xt(fp),hp=y({},en,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),gp=xt(hp),vp=y({},en,{data:0}),wo=xt(vp),yp={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},xp={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},bp={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function _p(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=bp[e])?!!t[e]:!1}function Ii(){return _p}var Sp=y({},ds,{key:function(e){if(e.key){var t=yp[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=vl(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?xp[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ii,charCode:function(e){return e.type==="keypress"?vl(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?vl(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),jp=xt(Sp),Tp=y({},bl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Lo=xt(Tp),Ep=y({},ds,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ii}),Ap=xt(Ep),Cp=y({},en,{propertyName:0,elapsedTime:0,pseudoElement:0}),Np=xt(Cp),Mp=y({},bl,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Dp=xt(Mp),qp=y({},en,{newState:0,oldState:0}),Rp=xt(qp),zp=[9,13,27,32],Fi=da&&"CompositionEvent"in window,fs=null;da&&"documentMode"in document&&(fs=document.documentMode);var Hp=da&&"TextEvent"in window&&!fs,Bo=da&&(!Fi||fs&&8<fs&&11>=fs),ko=" ",Po=!1;function Uo(e,t){switch(e){case"keyup":return zp.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Go(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Nn=!1;function Op(e,t){switch(e){case"compositionend":return Go(t);case"keypress":return t.which!==32?null:(Po=!0,ko);case"textInput":return e=t.data,e===ko&&Po?null:e;default:return null}}function wp(e,t){if(Nn)return e==="compositionend"||!Fi&&Uo(e,t)?(e=zo(),gl=Qi=Da=null,Nn=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Bo&&t.locale!=="ko"?null:t.data;default:return null}}var Lp={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Xo(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Lp[e.type]:t==="textarea"}function Vo(e,t,a,n){An?Cn?Cn.push(n):Cn=[n]:An=n,t=ii(t,"onChange"),0<t.length&&(a=new xl("onChange","change",null,a,n),e.push({event:a,listeners:t}))}var ps=null,hs=null;function Bp(e){Tm(e,0)}function _l(e){var t=cs(e);if(Eo(t))return e}function $o(e,t){if(e==="change")return t}var Yo=!1;if(da){var Wi;if(da){var er="oninput"in document;if(!er){var Qo=document.createElement("div");Qo.setAttribute("oninput","return;"),er=typeof Qo.oninput=="function"}Wi=er}else Wi=!1;Yo=Wi&&(!document.documentMode||9<document.documentMode)}function Zo(){ps&&(ps.detachEvent("onpropertychange",Ko),hs=ps=null)}function Ko(e){if(e.propertyName==="value"&&_l(hs)){var t=[];Vo(t,hs,e,Vi(e)),Ro(Bp,t)}}function kp(e,t,a){e==="focusin"?(Zo(),ps=t,hs=a,ps.attachEvent("onpropertychange",Ko)):e==="focusout"&&Zo()}function Pp(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return _l(hs)}function Up(e,t){if(e==="click")return _l(t)}function Gp(e,t){if(e==="input"||e==="change")return _l(t)}function Xp(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Mt=typeof Object.is=="function"?Object.is:Xp;function gs(e,t){if(Mt(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var a=Object.keys(e),n=Object.keys(t);if(a.length!==n.length)return!1;for(n=0;n<a.length;n++){var r=a[n];if(!_e.call(t,r)||!Mt(e[r],t[r]))return!1}return!0}function Jo(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Io(e,t){var a=Jo(e);e=0;for(var n;a;){if(a.nodeType===3){if(n=e+a.textContent.length,e<=t&&n>=t)return{node:a,offset:t-e};e=n}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=Jo(a)}}function Fo(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Fo(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Wo(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var t=pl(e.document);t instanceof e.HTMLIFrameElement;){try{var a=typeof t.contentWindow.location.href=="string"}catch{a=!1}if(a)e=t.contentWindow;else break;t=pl(e.document)}return t}function tr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}var Vp=da&&"documentMode"in document&&11>=document.documentMode,Mn=null,ar=null,vs=null,nr=!1;function eu(e,t,a){var n=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;nr||Mn==null||Mn!==pl(n)||(n=Mn,"selectionStart"in n&&tr(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),vs&&gs(vs,n)||(vs=n,n=ii(ar,"onSelect"),0<n.length&&(t=new xl("onSelect","select",null,t,a),e.push({event:t,listeners:n}),t.target=Mn)))}function tn(e,t){var a={};return a[e.toLowerCase()]=t.toLowerCase(),a["Webkit"+e]="webkit"+t,a["Moz"+e]="moz"+t,a}var Dn={animationend:tn("Animation","AnimationEnd"),animationiteration:tn("Animation","AnimationIteration"),animationstart:tn("Animation","AnimationStart"),transitionrun:tn("Transition","TransitionRun"),transitionstart:tn("Transition","TransitionStart"),transitioncancel:tn("Transition","TransitionCancel"),transitionend:tn("Transition","TransitionEnd")},sr={},tu={};da&&(tu=document.createElement("div").style,"AnimationEvent"in window||(delete Dn.animationend.animation,delete Dn.animationiteration.animation,delete Dn.animationstart.animation),"TransitionEvent"in window||delete Dn.transitionend.transition);function an(e){if(sr[e])return sr[e];if(!Dn[e])return e;var t=Dn[e],a;for(a in t)if(t.hasOwnProperty(a)&&a in tu)return sr[e]=t[a];return e}var au=an("animationend"),nu=an("animationiteration"),su=an("animationstart"),$p=an("transitionrun"),Yp=an("transitionstart"),Qp=an("transitioncancel"),lu=an("transitionend"),iu=new Map,lr="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");lr.push("scrollEnd");function Kt(e,t){iu.set(e,t),Wa(t,[e])}var ru=new WeakMap;function Bt(e,t){if(typeof e=="object"&&e!==null){var a=ru.get(e);return a!==void 0?a:(t={value:e,source:t,stack:jo(t)},ru.set(e,t),t)}return{value:e,source:t,stack:jo(t)}}var kt=[],qn=0,ir=0;function Sl(){for(var e=qn,t=ir=qn=0;t<e;){var a=kt[t];kt[t++]=null;var n=kt[t];kt[t++]=null;var r=kt[t];kt[t++]=null;var d=kt[t];if(kt[t++]=null,n!==null&&r!==null){var h=n.pending;h===null?r.next=r:(r.next=h.next,h.next=r),n.pending=r}d!==0&&cu(a,r,d)}}function jl(e,t,a,n){kt[qn++]=e,kt[qn++]=t,kt[qn++]=a,kt[qn++]=n,ir|=n,e.lanes|=n,e=e.alternate,e!==null&&(e.lanes|=n)}function rr(e,t,a,n){return jl(e,t,a,n),Tl(e)}function Rn(e,t){return jl(e,null,null,t),Tl(e)}function cu(e,t,a){e.lanes|=a;var n=e.alternate;n!==null&&(n.lanes|=a);for(var r=!1,d=e.return;d!==null;)d.childLanes|=a,n=d.alternate,n!==null&&(n.childLanes|=a),d.tag===22&&(e=d.stateNode,e===null||e._visibility&1||(r=!0)),e=d,d=d.return;return e.tag===3?(d=e.stateNode,r&&t!==null&&(r=31-Nt(a),e=d.hiddenUpdates,n=e[r],n===null?e[r]=[t]:n.push(t),t.lane=a|536870912),d):null}function Tl(e){if(50<Gs)throw Gs=0,fc=null,Error(i(185));for(var t=e.return;t!==null;)e=t,t=e.return;return e.tag===3?e.stateNode:null}var zn={};function Zp(e,t,a,n){this.tag=e,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Dt(e,t,a,n){return new Zp(e,t,a,n)}function cr(e){return e=e.prototype,!(!e||!e.isReactComponent)}function ma(e,t){var a=e.alternate;return a===null?(a=Dt(e.tag,t,e.key,e.mode),a.elementType=e.elementType,a.type=e.type,a.stateNode=e.stateNode,a.alternate=e,e.alternate=a):(a.pendingProps=t,a.type=e.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=e.flags&65011712,a.childLanes=e.childLanes,a.lanes=e.lanes,a.child=e.child,a.memoizedProps=e.memoizedProps,a.memoizedState=e.memoizedState,a.updateQueue=e.updateQueue,t=e.dependencies,a.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},a.sibling=e.sibling,a.index=e.index,a.ref=e.ref,a.refCleanup=e.refCleanup,a}function ou(e,t){e.flags&=65011714;var a=e.alternate;return a===null?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=a.childLanes,e.lanes=a.lanes,e.child=a.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=a.memoizedProps,e.memoizedState=a.memoizedState,e.updateQueue=a.updateQueue,e.type=a.type,t=a.dependencies,e.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function El(e,t,a,n,r,d){var h=0;if(n=e,typeof e=="function")cr(e)&&(h=1);else if(typeof e=="string")h=Jh(e,a,re.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case ee:return e=Dt(31,a,t,r),e.elementType=ee,e.lanes=d,e;case _:return nn(a.children,r,d,t);case A:h=8,r|=24;break;case D:return e=Dt(12,a,t,r|2),e.elementType=D,e.lanes=d,e;case W:return e=Dt(13,a,t,r),e.elementType=W,e.lanes=d,e;case le:return e=Dt(19,a,t,r),e.elementType=le,e.lanes=d,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case j:case B:h=10;break e;case q:h=9;break e;case F:h=11;break e;case ae:h=14;break e;case J:h=16,n=null;break e}h=29,a=Error(i(130,e===null?"null":typeof e,"")),n=null}return t=Dt(h,a,t,r),t.elementType=e,t.type=n,t.lanes=d,t}function nn(e,t,a,n){return e=Dt(7,e,n,t),e.lanes=a,e}function or(e,t,a){return e=Dt(6,e,null,t),e.lanes=a,e}function ur(e,t,a){return t=Dt(4,e.children!==null?e.children:[],e.key,t),t.lanes=a,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var Hn=[],On=0,Al=null,Cl=0,Pt=[],Ut=0,sn=null,fa=1,pa="";function ln(e,t){Hn[On++]=Cl,Hn[On++]=Al,Al=e,Cl=t}function uu(e,t,a){Pt[Ut++]=fa,Pt[Ut++]=pa,Pt[Ut++]=sn,sn=e;var n=fa;e=pa;var r=32-Nt(n)-1;n&=~(1<<r),a+=1;var d=32-Nt(t)+r;if(30<d){var h=r-r%5;d=(n&(1<<h)-1).toString(32),n>>=h,r-=h,fa=1<<32-Nt(t)+r|a<<r|n,pa=d+e}else fa=1<<d|a<<r|n,pa=e}function dr(e){e.return!==null&&(ln(e,1),uu(e,1,0))}function mr(e){for(;e===Al;)Al=Hn[--On],Hn[On]=null,Cl=Hn[--On],Hn[On]=null;for(;e===sn;)sn=Pt[--Ut],Pt[Ut]=null,pa=Pt[--Ut],Pt[Ut]=null,fa=Pt[--Ut],Pt[Ut]=null}var ft=null,Ue=null,Te=!1,rn=null,aa=!1,fr=Error(i(519));function cn(e){var t=Error(i(418,""));throw bs(Bt(t,e)),fr}function du(e){var t=e.stateNode,a=e.type,n=e.memoizedProps;switch(t[ut]=e,t[yt]=n,a){case"dialog":xe("cancel",t),xe("close",t);break;case"iframe":case"object":case"embed":xe("load",t);break;case"video":case"audio":for(a=0;a<Vs.length;a++)xe(Vs[a],t);break;case"source":xe("error",t);break;case"img":case"image":case"link":xe("error",t),xe("load",t);break;case"details":xe("toggle",t);break;case"input":xe("invalid",t),Ao(t,n.value,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name,!0),fl(t);break;case"select":xe("invalid",t);break;case"textarea":xe("invalid",t),No(t,n.value,n.defaultValue,n.children),fl(t)}a=n.children,typeof a!="string"&&typeof a!="number"&&typeof a!="bigint"||t.textContent===""+a||n.suppressHydrationWarning===!0||Nm(t.textContent,a)?(n.popover!=null&&(xe("beforetoggle",t),xe("toggle",t)),n.onScroll!=null&&xe("scroll",t),n.onScrollEnd!=null&&xe("scrollend",t),n.onClick!=null&&(t.onclick=ri),t=!0):t=!1,t||cn(e)}function mu(e){for(ft=e.return;ft;)switch(ft.tag){case 5:case 13:aa=!1;return;case 27:case 3:aa=!0;return;default:ft=ft.return}}function ys(e){if(e!==ft)return!1;if(!Te)return mu(e),Te=!0,!1;var t=e.tag,a;if((a=t!==3&&t!==27)&&((a=t===5)&&(a=e.type,a=!(a!=="form"&&a!=="button")||Mc(e.type,e.memoizedProps)),a=!a),a&&Ue&&cn(e),mu(e),t===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(i(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8)if(a=e.data,a==="/$"){if(t===0){Ue=It(e.nextSibling);break e}t--}else a!=="$"&&a!=="$!"&&a!=="$?"||t++;e=e.nextSibling}Ue=null}}else t===27?(t=Ue,Ya(e.type)?(e=zc,zc=null,Ue=e):Ue=t):Ue=ft?It(e.stateNode.nextSibling):null;return!0}function xs(){Ue=ft=null,Te=!1}function fu(){var e=rn;return e!==null&&(St===null?St=e:St.push.apply(St,e),rn=null),e}function bs(e){rn===null?rn=[e]:rn.push(e)}var pr=k(null),on=null,ha=null;function qa(e,t,a){K(pr,t._currentValue),t._currentValue=a}function ga(e){e._currentValue=pr.current,Z(pr)}function hr(e,t,a){for(;e!==null;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,n!==null&&(n.childLanes|=t)):n!==null&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===a)break;e=e.return}}function gr(e,t,a,n){var r=e.child;for(r!==null&&(r.return=e);r!==null;){var d=r.dependencies;if(d!==null){var h=r.child;d=d.firstContext;e:for(;d!==null;){var x=d;d=r;for(var T=0;T<t.length;T++)if(x.context===t[T]){d.lanes|=a,x=d.alternate,x!==null&&(x.lanes|=a),hr(d.return,a,e),n||(h=null);break e}d=x.next}}else if(r.tag===18){if(h=r.return,h===null)throw Error(i(341));h.lanes|=a,d=h.alternate,d!==null&&(d.lanes|=a),hr(h,a,e),h=null}else h=r.child;if(h!==null)h.return=r;else for(h=r;h!==null;){if(h===e){h=null;break}if(r=h.sibling,r!==null){r.return=h.return,h=r;break}h=h.return}r=h}}function _s(e,t,a,n){e=null;for(var r=t,d=!1;r!==null;){if(!d){if((r.flags&524288)!==0)d=!0;else if((r.flags&262144)!==0)break}if(r.tag===10){var h=r.alternate;if(h===null)throw Error(i(387));if(h=h.memoizedProps,h!==null){var x=r.type;Mt(r.pendingProps.value,h.value)||(e!==null?e.push(x):e=[x])}}else if(r===lt.current){if(h=r.alternate,h===null)throw Error(i(387));h.memoizedState.memoizedState!==r.memoizedState.memoizedState&&(e!==null?e.push(Js):e=[Js])}r=r.return}e!==null&&gr(t,e,a,n),t.flags|=262144}function Nl(e){for(e=e.firstContext;e!==null;){if(!Mt(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function un(e){on=e,ha=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function dt(e){return pu(on,e)}function Ml(e,t){return on===null&&un(e),pu(e,t)}function pu(e,t){var a=t._currentValue;if(t={context:t,memoizedValue:a,next:null},ha===null){if(e===null)throw Error(i(308));ha=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else ha=ha.next=t;return a}var Kp=typeof AbortController<"u"?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(a,n){e.push(n)}};this.abort=function(){t.aborted=!0,e.forEach(function(a){return a()})}},Jp=o.unstable_scheduleCallback,Ip=o.unstable_NormalPriority,Ke={$$typeof:B,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function vr(){return{controller:new Kp,data:new Map,refCount:0}}function Ss(e){e.refCount--,e.refCount===0&&Jp(Ip,function(){e.controller.abort()})}var js=null,yr=0,wn=0,Ln=null;function Fp(e,t){if(js===null){var a=js=[];yr=0,wn=bc(),Ln={status:"pending",value:void 0,then:function(n){a.push(n)}}}return yr++,t.then(hu,hu),t}function hu(){if(--yr===0&&js!==null){Ln!==null&&(Ln.status="fulfilled");var e=js;js=null,wn=0,Ln=null;for(var t=0;t<e.length;t++)(0,e[t])()}}function Wp(e,t){var a=[],n={status:"pending",value:null,reason:null,then:function(r){a.push(r)}};return e.then(function(){n.status="fulfilled",n.value=t;for(var r=0;r<a.length;r++)(0,a[r])(t)},function(r){for(n.status="rejected",n.reason=r,r=0;r<a.length;r++)(0,a[r])(void 0)}),n}var gu=N.S;N.S=function(e,t){typeof t=="object"&&t!==null&&typeof t.then=="function"&&Fp(e,t),gu!==null&&gu(e,t)};var dn=k(null);function xr(){var e=dn.current;return e!==null?e:we.pooledCache}function Dl(e,t){t===null?K(dn,dn.current):K(dn,t.pool)}function vu(){var e=xr();return e===null?null:{parent:Ke._currentValue,pool:e}}var Ts=Error(i(460)),yu=Error(i(474)),ql=Error(i(542)),br={then:function(){}};function xu(e){return e=e.status,e==="fulfilled"||e==="rejected"}function Rl(){}function bu(e,t,a){switch(a=e[a],a===void 0?e.push(t):a!==t&&(t.then(Rl,Rl),t=a),t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,Su(e),e;default:if(typeof t.status=="string")t.then(Rl,Rl);else{if(e=we,e!==null&&100<e.shellSuspendCounter)throw Error(i(482));e=t,e.status="pending",e.then(function(n){if(t.status==="pending"){var r=t;r.status="fulfilled",r.value=n}},function(n){if(t.status==="pending"){var r=t;r.status="rejected",r.reason=n}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,Su(e),e}throw Es=t,Ts}}var Es=null;function _u(){if(Es===null)throw Error(i(459));var e=Es;return Es=null,e}function Su(e){if(e===Ts||e===ql)throw Error(i(483))}var Ra=!1;function _r(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Sr(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function za(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function Ha(e,t,a){var n=e.updateQueue;if(n===null)return null;if(n=n.shared,(Ee&2)!==0){var r=n.pending;return r===null?t.next=t:(t.next=r.next,r.next=t),n.pending=t,t=Tl(e),cu(e,null,a),t}return jl(e,n,t,a),Tl(e)}function As(e,t,a){if(t=t.updateQueue,t!==null&&(t=t.shared,(a&4194048)!==0)){var n=t.lanes;n&=e.pendingLanes,a|=n,t.lanes=a,ho(e,a)}}function jr(e,t){var a=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,a===n)){var r=null,d=null;if(a=a.firstBaseUpdate,a!==null){do{var h={lane:a.lane,tag:a.tag,payload:a.payload,callback:null,next:null};d===null?r=d=h:d=d.next=h,a=a.next}while(a!==null);d===null?r=d=t:d=d.next=t}else r=d=t;a={baseState:n.baseState,firstBaseUpdate:r,lastBaseUpdate:d,shared:n.shared,callbacks:n.callbacks},e.updateQueue=a;return}e=a.lastBaseUpdate,e===null?a.firstBaseUpdate=t:e.next=t,a.lastBaseUpdate=t}var Tr=!1;function Cs(){if(Tr){var e=Ln;if(e!==null)throw e}}function Ns(e,t,a,n){Tr=!1;var r=e.updateQueue;Ra=!1;var d=r.firstBaseUpdate,h=r.lastBaseUpdate,x=r.shared.pending;if(x!==null){r.shared.pending=null;var T=x,H=T.next;T.next=null,h===null?d=H:h.next=H,h=T;var U=e.alternate;U!==null&&(U=U.updateQueue,x=U.lastBaseUpdate,x!==h&&(x===null?U.firstBaseUpdate=H:x.next=H,U.lastBaseUpdate=T))}if(d!==null){var $=r.baseState;h=0,U=H=T=null,x=d;do{var O=x.lane&-536870913,L=O!==x.lane;if(L?(be&O)===O:(n&O)===O){O!==0&&O===wn&&(Tr=!0),U!==null&&(U=U.next={lane:0,tag:x.tag,payload:x.payload,callback:null,next:null});e:{var fe=e,ue=x;O=t;var ze=a;switch(ue.tag){case 1:if(fe=ue.payload,typeof fe=="function"){$=fe.call(ze,$,O);break e}$=fe;break e;case 3:fe.flags=fe.flags&-65537|128;case 0:if(fe=ue.payload,O=typeof fe=="function"?fe.call(ze,$,O):fe,O==null)break e;$=y({},$,O);break e;case 2:Ra=!0}}O=x.callback,O!==null&&(e.flags|=64,L&&(e.flags|=8192),L=r.callbacks,L===null?r.callbacks=[O]:L.push(O))}else L={lane:O,tag:x.tag,payload:x.payload,callback:x.callback,next:null},U===null?(H=U=L,T=$):U=U.next=L,h|=O;if(x=x.next,x===null){if(x=r.shared.pending,x===null)break;L=x,x=L.next,L.next=null,r.lastBaseUpdate=L,r.shared.pending=null}}while(!0);U===null&&(T=$),r.baseState=T,r.firstBaseUpdate=H,r.lastBaseUpdate=U,d===null&&(r.shared.lanes=0),Ga|=h,e.lanes=h,e.memoizedState=$}}function ju(e,t){if(typeof e!="function")throw Error(i(191,e));e.call(t)}function Tu(e,t){var a=e.callbacks;if(a!==null)for(e.callbacks=null,e=0;e<a.length;e++)ju(a[e],t)}var Bn=k(null),zl=k(0);function Eu(e,t){e=ja,K(zl,e),K(Bn,t),ja=e|t.baseLanes}function Er(){K(zl,ja),K(Bn,Bn.current)}function Ar(){ja=zl.current,Z(Bn),Z(zl)}var Oa=0,ge=null,qe=null,Ye=null,Hl=!1,kn=!1,mn=!1,Ol=0,Ms=0,Pn=null,eh=0;function Ve(){throw Error(i(321))}function Cr(e,t){if(t===null)return!1;for(var a=0;a<t.length&&a<e.length;a++)if(!Mt(e[a],t[a]))return!1;return!0}function Nr(e,t,a,n,r,d){return Oa=d,ge=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,N.H=e===null||e.memoizedState===null?cd:od,mn=!1,d=a(n,r),mn=!1,kn&&(d=Cu(t,a,n,r)),Au(e),d}function Au(e){N.H=Ul;var t=qe!==null&&qe.next!==null;if(Oa=0,Ye=qe=ge=null,Hl=!1,Ms=0,Pn=null,t)throw Error(i(300));e===null||et||(e=e.dependencies,e!==null&&Nl(e)&&(et=!0))}function Cu(e,t,a,n){ge=e;var r=0;do{if(kn&&(Pn=null),Ms=0,kn=!1,25<=r)throw Error(i(301));if(r+=1,Ye=qe=null,e.updateQueue!=null){var d=e.updateQueue;d.lastEffect=null,d.events=null,d.stores=null,d.memoCache!=null&&(d.memoCache.index=0)}N.H=rh,d=t(a,n)}while(kn);return d}function th(){var e=N.H,t=e.useState()[0];return t=typeof t.then=="function"?Ds(t):t,e=e.useState()[0],(qe!==null?qe.memoizedState:null)!==e&&(ge.flags|=1024),t}function Mr(){var e=Ol!==0;return Ol=0,e}function Dr(e,t,a){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a}function qr(e){if(Hl){for(e=e.memoizedState;e!==null;){var t=e.queue;t!==null&&(t.pending=null),e=e.next}Hl=!1}Oa=0,Ye=qe=ge=null,kn=!1,Ms=Ol=0,Pn=null}function bt(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ye===null?ge.memoizedState=Ye=e:Ye=Ye.next=e,Ye}function Qe(){if(qe===null){var e=ge.alternate;e=e!==null?e.memoizedState:null}else e=qe.next;var t=Ye===null?ge.memoizedState:Ye.next;if(t!==null)Ye=t,qe=e;else{if(e===null)throw ge.alternate===null?Error(i(467)):Error(i(310));qe=e,e={memoizedState:qe.memoizedState,baseState:qe.baseState,baseQueue:qe.baseQueue,queue:qe.queue,next:null},Ye===null?ge.memoizedState=Ye=e:Ye=Ye.next=e}return Ye}function Rr(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Ds(e){var t=Ms;return Ms+=1,Pn===null&&(Pn=[]),e=bu(Pn,e,t),t=ge,(Ye===null?t.memoizedState:Ye.next)===null&&(t=t.alternate,N.H=t===null||t.memoizedState===null?cd:od),e}function wl(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return Ds(e);if(e.$$typeof===B)return dt(e)}throw Error(i(438,String(e)))}function zr(e){var t=null,a=ge.updateQueue;if(a!==null&&(t=a.memoCache),t==null){var n=ge.alternate;n!==null&&(n=n.updateQueue,n!==null&&(n=n.memoCache,n!=null&&(t={data:n.data.map(function(r){return r.slice()}),index:0})))}if(t==null&&(t={data:[],index:0}),a===null&&(a=Rr(),ge.updateQueue=a),a.memoCache=t,a=t.data[t.index],a===void 0)for(a=t.data[t.index]=Array(e),n=0;n<e;n++)a[n]=ie;return t.index++,a}function va(e,t){return typeof t=="function"?t(e):t}function Ll(e){var t=Qe();return Hr(t,qe,e)}function Hr(e,t,a){var n=e.queue;if(n===null)throw Error(i(311));n.lastRenderedReducer=a;var r=e.baseQueue,d=n.pending;if(d!==null){if(r!==null){var h=r.next;r.next=d.next,d.next=h}t.baseQueue=r=d,n.pending=null}if(d=e.baseState,r===null)e.memoizedState=d;else{t=r.next;var x=h=null,T=null,H=t,U=!1;do{var $=H.lane&-536870913;if($!==H.lane?(be&$)===$:(Oa&$)===$){var O=H.revertLane;if(O===0)T!==null&&(T=T.next={lane:0,revertLane:0,action:H.action,hasEagerState:H.hasEagerState,eagerState:H.eagerState,next:null}),$===wn&&(U=!0);else if((Oa&O)===O){H=H.next,O===wn&&(U=!0);continue}else $={lane:0,revertLane:H.revertLane,action:H.action,hasEagerState:H.hasEagerState,eagerState:H.eagerState,next:null},T===null?(x=T=$,h=d):T=T.next=$,ge.lanes|=O,Ga|=O;$=H.action,mn&&a(d,$),d=H.hasEagerState?H.eagerState:a(d,$)}else O={lane:$,revertLane:H.revertLane,action:H.action,hasEagerState:H.hasEagerState,eagerState:H.eagerState,next:null},T===null?(x=T=O,h=d):T=T.next=O,ge.lanes|=$,Ga|=$;H=H.next}while(H!==null&&H!==t);if(T===null?h=d:T.next=x,!Mt(d,e.memoizedState)&&(et=!0,U&&(a=Ln,a!==null)))throw a;e.memoizedState=d,e.baseState=h,e.baseQueue=T,n.lastRenderedState=d}return r===null&&(n.lanes=0),[e.memoizedState,n.dispatch]}function Or(e){var t=Qe(),a=t.queue;if(a===null)throw Error(i(311));a.lastRenderedReducer=e;var n=a.dispatch,r=a.pending,d=t.memoizedState;if(r!==null){a.pending=null;var h=r=r.next;do d=e(d,h.action),h=h.next;while(h!==r);Mt(d,t.memoizedState)||(et=!0),t.memoizedState=d,t.baseQueue===null&&(t.baseState=d),a.lastRenderedState=d}return[d,n]}function Nu(e,t,a){var n=ge,r=Qe(),d=Te;if(d){if(a===void 0)throw Error(i(407));a=a()}else a=t();var h=!Mt((qe||r).memoizedState,a);h&&(r.memoizedState=a,et=!0),r=r.queue;var x=qu.bind(null,n,r,e);if(qs(2048,8,x,[e]),r.getSnapshot!==t||h||Ye!==null&&Ye.memoizedState.tag&1){if(n.flags|=2048,Un(9,Bl(),Du.bind(null,n,r,a,t),null),we===null)throw Error(i(349));d||(Oa&124)!==0||Mu(n,t,a)}return a}function Mu(e,t,a){e.flags|=16384,e={getSnapshot:t,value:a},t=ge.updateQueue,t===null?(t=Rr(),ge.updateQueue=t,t.stores=[e]):(a=t.stores,a===null?t.stores=[e]:a.push(e))}function Du(e,t,a,n){t.value=a,t.getSnapshot=n,Ru(t)&&zu(e)}function qu(e,t,a){return a(function(){Ru(t)&&zu(e)})}function Ru(e){var t=e.getSnapshot;e=e.value;try{var a=t();return!Mt(e,a)}catch{return!0}}function zu(e){var t=Rn(e,2);t!==null&&Ot(t,e,2)}function wr(e){var t=bt();if(typeof e=="function"){var a=e;if(e=a(),mn){Na(!0);try{a()}finally{Na(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:va,lastRenderedState:e},t}function Hu(e,t,a,n){return e.baseState=a,Hr(e,qe,typeof n=="function"?n:va)}function ah(e,t,a,n,r){if(Pl(e))throw Error(i(485));if(e=t.action,e!==null){var d={payload:r,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(h){d.listeners.push(h)}};N.T!==null?a(!0):d.isTransition=!1,n(d),a=t.pending,a===null?(d.next=t.pending=d,Ou(t,d)):(d.next=a.next,t.pending=a.next=d)}}function Ou(e,t){var a=t.action,n=t.payload,r=e.state;if(t.isTransition){var d=N.T,h={};N.T=h;try{var x=a(r,n),T=N.S;T!==null&&T(h,x),wu(e,t,x)}catch(H){Lr(e,t,H)}finally{N.T=d}}else try{d=a(r,n),wu(e,t,d)}catch(H){Lr(e,t,H)}}function wu(e,t,a){a!==null&&typeof a=="object"&&typeof a.then=="function"?a.then(function(n){Lu(e,t,n)},function(n){return Lr(e,t,n)}):Lu(e,t,a)}function Lu(e,t,a){t.status="fulfilled",t.value=a,Bu(t),e.state=a,t=e.pending,t!==null&&(a=t.next,a===t?e.pending=null:(a=a.next,t.next=a,Ou(e,a)))}function Lr(e,t,a){var n=e.pending;if(e.pending=null,n!==null){n=n.next;do t.status="rejected",t.reason=a,Bu(t),t=t.next;while(t!==n)}e.action=null}function Bu(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function ku(e,t){return t}function Pu(e,t){if(Te){var a=we.formState;if(a!==null){e:{var n=ge;if(Te){if(Ue){t:{for(var r=Ue,d=aa;r.nodeType!==8;){if(!d){r=null;break t}if(r=It(r.nextSibling),r===null){r=null;break t}}d=r.data,r=d==="F!"||d==="F"?r:null}if(r){Ue=It(r.nextSibling),n=r.data==="F!";break e}}cn(n)}n=!1}n&&(t=a[0])}}return a=bt(),a.memoizedState=a.baseState=t,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ku,lastRenderedState:t},a.queue=n,a=ld.bind(null,ge,n),n.dispatch=a,n=wr(!1),d=Gr.bind(null,ge,!1,n.queue),n=bt(),r={state:t,dispatch:null,action:e,pending:null},n.queue=r,a=ah.bind(null,ge,r,d,a),r.dispatch=a,n.memoizedState=e,[t,a,!1]}function Uu(e){var t=Qe();return Gu(t,qe,e)}function Gu(e,t,a){if(t=Hr(e,t,ku)[0],e=Ll(va)[0],typeof t=="object"&&t!==null&&typeof t.then=="function")try{var n=Ds(t)}catch(h){throw h===Ts?ql:h}else n=t;t=Qe();var r=t.queue,d=r.dispatch;return a!==t.memoizedState&&(ge.flags|=2048,Un(9,Bl(),nh.bind(null,r,a),null)),[n,d,e]}function nh(e,t){e.action=t}function Xu(e){var t=Qe(),a=qe;if(a!==null)return Gu(t,a,e);Qe(),t=t.memoizedState,a=Qe();var n=a.queue.dispatch;return a.memoizedState=e,[t,n,!1]}function Un(e,t,a,n){return e={tag:e,create:a,deps:n,inst:t,next:null},t=ge.updateQueue,t===null&&(t=Rr(),ge.updateQueue=t),a=t.lastEffect,a===null?t.lastEffect=e.next=e:(n=a.next,a.next=e,e.next=n,t.lastEffect=e),e}function Bl(){return{destroy:void 0,resource:void 0}}function Vu(){return Qe().memoizedState}function kl(e,t,a,n){var r=bt();n=n===void 0?null:n,ge.flags|=e,r.memoizedState=Un(1|t,Bl(),a,n)}function qs(e,t,a,n){var r=Qe();n=n===void 0?null:n;var d=r.memoizedState.inst;qe!==null&&n!==null&&Cr(n,qe.memoizedState.deps)?r.memoizedState=Un(t,d,a,n):(ge.flags|=e,r.memoizedState=Un(1|t,d,a,n))}function $u(e,t){kl(8390656,8,e,t)}function Yu(e,t){qs(2048,8,e,t)}function Qu(e,t){return qs(4,2,e,t)}function Zu(e,t){return qs(4,4,e,t)}function Ku(e,t){if(typeof t=="function"){e=e();var a=t(e);return function(){typeof a=="function"?a():t(null)}}if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Ju(e,t,a){a=a!=null?a.concat([e]):null,qs(4,4,Ku.bind(null,t,e),a)}function Br(){}function Iu(e,t){var a=Qe();t=t===void 0?null:t;var n=a.memoizedState;return t!==null&&Cr(t,n[1])?n[0]:(a.memoizedState=[e,t],e)}function Fu(e,t){var a=Qe();t=t===void 0?null:t;var n=a.memoizedState;if(t!==null&&Cr(t,n[1]))return n[0];if(n=e(),mn){Na(!0);try{e()}finally{Na(!1)}}return a.memoizedState=[n,t],n}function kr(e,t,a){return a===void 0||(Oa&1073741824)!==0?e.memoizedState=t:(e.memoizedState=a,e=tm(),ge.lanes|=e,Ga|=e,a)}function Wu(e,t,a,n){return Mt(a,t)?a:Bn.current!==null?(e=kr(e,a,n),Mt(e,t)||(et=!0),e):(Oa&42)===0?(et=!0,e.memoizedState=a):(e=tm(),ge.lanes|=e,Ga|=e,t)}function ed(e,t,a,n,r){var d=G.p;G.p=d!==0&&8>d?d:8;var h=N.T,x={};N.T=x,Gr(e,!1,t,a);try{var T=r(),H=N.S;if(H!==null&&H(x,T),T!==null&&typeof T=="object"&&typeof T.then=="function"){var U=Wp(T,n);Rs(e,t,U,Ht(e))}else Rs(e,t,n,Ht(e))}catch($){Rs(e,t,{then:function(){},status:"rejected",reason:$},Ht())}finally{G.p=d,N.T=h}}function sh(){}function Pr(e,t,a,n){if(e.tag!==5)throw Error(i(476));var r=td(e).queue;ed(e,r,t,Q,a===null?sh:function(){return ad(e),a(n)})}function td(e){var t=e.memoizedState;if(t!==null)return t;t={memoizedState:Q,baseState:Q,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:va,lastRenderedState:Q},next:null};var a={};return t.next={memoizedState:a,baseState:a,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:va,lastRenderedState:a},next:null},e.memoizedState=t,e=e.alternate,e!==null&&(e.memoizedState=t),t}function ad(e){var t=td(e).next.queue;Rs(e,t,{},Ht())}function Ur(){return dt(Js)}function nd(){return Qe().memoizedState}function sd(){return Qe().memoizedState}function lh(e){for(var t=e.return;t!==null;){switch(t.tag){case 24:case 3:var a=Ht();e=za(a);var n=Ha(t,e,a);n!==null&&(Ot(n,t,a),As(n,t,a)),t={cache:vr()},e.payload=t;return}t=t.return}}function ih(e,t,a){var n=Ht();a={lane:n,revertLane:0,action:a,hasEagerState:!1,eagerState:null,next:null},Pl(e)?id(t,a):(a=rr(e,t,a,n),a!==null&&(Ot(a,e,n),rd(a,t,n)))}function ld(e,t,a){var n=Ht();Rs(e,t,a,n)}function Rs(e,t,a,n){var r={lane:n,revertLane:0,action:a,hasEagerState:!1,eagerState:null,next:null};if(Pl(e))id(t,r);else{var d=e.alternate;if(e.lanes===0&&(d===null||d.lanes===0)&&(d=t.lastRenderedReducer,d!==null))try{var h=t.lastRenderedState,x=d(h,a);if(r.hasEagerState=!0,r.eagerState=x,Mt(x,h))return jl(e,t,r,0),we===null&&Sl(),!1}catch{}finally{}if(a=rr(e,t,r,n),a!==null)return Ot(a,e,n),rd(a,t,n),!0}return!1}function Gr(e,t,a,n){if(n={lane:2,revertLane:bc(),action:n,hasEagerState:!1,eagerState:null,next:null},Pl(e)){if(t)throw Error(i(479))}else t=rr(e,a,n,2),t!==null&&Ot(t,e,2)}function Pl(e){var t=e.alternate;return e===ge||t!==null&&t===ge}function id(e,t){kn=Hl=!0;var a=e.pending;a===null?t.next=t:(t.next=a.next,a.next=t),e.pending=t}function rd(e,t,a){if((a&4194048)!==0){var n=t.lanes;n&=e.pendingLanes,a|=n,t.lanes=a,ho(e,a)}}var Ul={readContext:dt,use:wl,useCallback:Ve,useContext:Ve,useEffect:Ve,useImperativeHandle:Ve,useLayoutEffect:Ve,useInsertionEffect:Ve,useMemo:Ve,useReducer:Ve,useRef:Ve,useState:Ve,useDebugValue:Ve,useDeferredValue:Ve,useTransition:Ve,useSyncExternalStore:Ve,useId:Ve,useHostTransitionStatus:Ve,useFormState:Ve,useActionState:Ve,useOptimistic:Ve,useMemoCache:Ve,useCacheRefresh:Ve},cd={readContext:dt,use:wl,useCallback:function(e,t){return bt().memoizedState=[e,t===void 0?null:t],e},useContext:dt,useEffect:$u,useImperativeHandle:function(e,t,a){a=a!=null?a.concat([e]):null,kl(4194308,4,Ku.bind(null,t,e),a)},useLayoutEffect:function(e,t){return kl(4194308,4,e,t)},useInsertionEffect:function(e,t){kl(4,2,e,t)},useMemo:function(e,t){var a=bt();t=t===void 0?null:t;var n=e();if(mn){Na(!0);try{e()}finally{Na(!1)}}return a.memoizedState=[n,t],n},useReducer:function(e,t,a){var n=bt();if(a!==void 0){var r=a(t);if(mn){Na(!0);try{a(t)}finally{Na(!1)}}}else r=t;return n.memoizedState=n.baseState=r,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:r},n.queue=e,e=e.dispatch=ih.bind(null,ge,e),[n.memoizedState,e]},useRef:function(e){var t=bt();return e={current:e},t.memoizedState=e},useState:function(e){e=wr(e);var t=e.queue,a=ld.bind(null,ge,t);return t.dispatch=a,[e.memoizedState,a]},useDebugValue:Br,useDeferredValue:function(e,t){var a=bt();return kr(a,e,t)},useTransition:function(){var e=wr(!1);return e=ed.bind(null,ge,e.queue,!0,!1),bt().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,a){var n=ge,r=bt();if(Te){if(a===void 0)throw Error(i(407));a=a()}else{if(a=t(),we===null)throw Error(i(349));(be&124)!==0||Mu(n,t,a)}r.memoizedState=a;var d={value:a,getSnapshot:t};return r.queue=d,$u(qu.bind(null,n,d,e),[e]),n.flags|=2048,Un(9,Bl(),Du.bind(null,n,d,a,t),null),a},useId:function(){var e=bt(),t=we.identifierPrefix;if(Te){var a=pa,n=fa;a=(n&~(1<<32-Nt(n)-1)).toString(32)+a,t="«"+t+"R"+a,a=Ol++,0<a&&(t+="H"+a.toString(32)),t+="»"}else a=eh++,t="«"+t+"r"+a.toString(32)+"»";return e.memoizedState=t},useHostTransitionStatus:Ur,useFormState:Pu,useActionState:Pu,useOptimistic:function(e){var t=bt();t.memoizedState=t.baseState=e;var a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=a,t=Gr.bind(null,ge,!0,a),a.dispatch=t,[e,t]},useMemoCache:zr,useCacheRefresh:function(){return bt().memoizedState=lh.bind(null,ge)}},od={readContext:dt,use:wl,useCallback:Iu,useContext:dt,useEffect:Yu,useImperativeHandle:Ju,useInsertionEffect:Qu,useLayoutEffect:Zu,useMemo:Fu,useReducer:Ll,useRef:Vu,useState:function(){return Ll(va)},useDebugValue:Br,useDeferredValue:function(e,t){var a=Qe();return Wu(a,qe.memoizedState,e,t)},useTransition:function(){var e=Ll(va)[0],t=Qe().memoizedState;return[typeof e=="boolean"?e:Ds(e),t]},useSyncExternalStore:Nu,useId:nd,useHostTransitionStatus:Ur,useFormState:Uu,useActionState:Uu,useOptimistic:function(e,t){var a=Qe();return Hu(a,qe,e,t)},useMemoCache:zr,useCacheRefresh:sd},rh={readContext:dt,use:wl,useCallback:Iu,useContext:dt,useEffect:Yu,useImperativeHandle:Ju,useInsertionEffect:Qu,useLayoutEffect:Zu,useMemo:Fu,useReducer:Or,useRef:Vu,useState:function(){return Or(va)},useDebugValue:Br,useDeferredValue:function(e,t){var a=Qe();return qe===null?kr(a,e,t):Wu(a,qe.memoizedState,e,t)},useTransition:function(){var e=Or(va)[0],t=Qe().memoizedState;return[typeof e=="boolean"?e:Ds(e),t]},useSyncExternalStore:Nu,useId:nd,useHostTransitionStatus:Ur,useFormState:Xu,useActionState:Xu,useOptimistic:function(e,t){var a=Qe();return qe!==null?Hu(a,qe,e,t):(a.baseState=e,[e,a.queue.dispatch])},useMemoCache:zr,useCacheRefresh:sd},Gn=null,zs=0;function Gl(e){var t=zs;return zs+=1,Gn===null&&(Gn=[]),bu(Gn,e,t)}function Hs(e,t){t=t.props.ref,e.ref=t!==void 0?t:null}function Xl(e,t){throw t.$$typeof===b?Error(i(525)):(e=Object.prototype.toString.call(t),Error(i(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)))}function ud(e){var t=e._init;return t(e._payload)}function dd(e){function t(R,M){if(e){var z=R.deletions;z===null?(R.deletions=[M],R.flags|=16):z.push(M)}}function a(R,M){if(!e)return null;for(;M!==null;)t(R,M),M=M.sibling;return null}function n(R){for(var M=new Map;R!==null;)R.key!==null?M.set(R.key,R):M.set(R.index,R),R=R.sibling;return M}function r(R,M){return R=ma(R,M),R.index=0,R.sibling=null,R}function d(R,M,z){return R.index=z,e?(z=R.alternate,z!==null?(z=z.index,z<M?(R.flags|=67108866,M):z):(R.flags|=67108866,M)):(R.flags|=1048576,M)}function h(R){return e&&R.alternate===null&&(R.flags|=67108866),R}function x(R,M,z,V){return M===null||M.tag!==6?(M=or(z,R.mode,V),M.return=R,M):(M=r(M,z),M.return=R,M)}function T(R,M,z,V){var ne=z.type;return ne===_?U(R,M,z.props.children,V,z.key):M!==null&&(M.elementType===ne||typeof ne=="object"&&ne!==null&&ne.$$typeof===J&&ud(ne)===M.type)?(M=r(M,z.props),Hs(M,z),M.return=R,M):(M=El(z.type,z.key,z.props,null,R.mode,V),Hs(M,z),M.return=R,M)}function H(R,M,z,V){return M===null||M.tag!==4||M.stateNode.containerInfo!==z.containerInfo||M.stateNode.implementation!==z.implementation?(M=ur(z,R.mode,V),M.return=R,M):(M=r(M,z.children||[]),M.return=R,M)}function U(R,M,z,V,ne){return M===null||M.tag!==7?(M=nn(z,R.mode,V,ne),M.return=R,M):(M=r(M,z),M.return=R,M)}function $(R,M,z){if(typeof M=="string"&&M!==""||typeof M=="number"||typeof M=="bigint")return M=or(""+M,R.mode,z),M.return=R,M;if(typeof M=="object"&&M!==null){switch(M.$$typeof){case E:return z=El(M.type,M.key,M.props,null,R.mode,z),Hs(z,M),z.return=R,z;case C:return M=ur(M,R.mode,z),M.return=R,M;case J:var V=M._init;return M=V(M._payload),$(R,M,z)}if(P(M)||Me(M))return M=nn(M,R.mode,z,null),M.return=R,M;if(typeof M.then=="function")return $(R,Gl(M),z);if(M.$$typeof===B)return $(R,Ml(R,M),z);Xl(R,M)}return null}function O(R,M,z,V){var ne=M!==null?M.key:null;if(typeof z=="string"&&z!==""||typeof z=="number"||typeof z=="bigint")return ne!==null?null:x(R,M,""+z,V);if(typeof z=="object"&&z!==null){switch(z.$$typeof){case E:return z.key===ne?T(R,M,z,V):null;case C:return z.key===ne?H(R,M,z,V):null;case J:return ne=z._init,z=ne(z._payload),O(R,M,z,V)}if(P(z)||Me(z))return ne!==null?null:U(R,M,z,V,null);if(typeof z.then=="function")return O(R,M,Gl(z),V);if(z.$$typeof===B)return O(R,M,Ml(R,z),V);Xl(R,z)}return null}function L(R,M,z,V,ne){if(typeof V=="string"&&V!==""||typeof V=="number"||typeof V=="bigint")return R=R.get(z)||null,x(M,R,""+V,ne);if(typeof V=="object"&&V!==null){switch(V.$$typeof){case E:return R=R.get(V.key===null?z:V.key)||null,T(M,R,V,ne);case C:return R=R.get(V.key===null?z:V.key)||null,H(M,R,V,ne);case J:var ve=V._init;return V=ve(V._payload),L(R,M,z,V,ne)}if(P(V)||Me(V))return R=R.get(z)||null,U(M,R,V,ne,null);if(typeof V.then=="function")return L(R,M,z,Gl(V),ne);if(V.$$typeof===B)return L(R,M,z,Ml(M,V),ne);Xl(M,V)}return null}function fe(R,M,z,V){for(var ne=null,ve=null,ce=M,de=M=0,at=null;ce!==null&&de<z.length;de++){ce.index>de?(at=ce,ce=null):at=ce.sibling;var Se=O(R,ce,z[de],V);if(Se===null){ce===null&&(ce=at);break}e&&ce&&Se.alternate===null&&t(R,ce),M=d(Se,M,de),ve===null?ne=Se:ve.sibling=Se,ve=Se,ce=at}if(de===z.length)return a(R,ce),Te&&ln(R,de),ne;if(ce===null){for(;de<z.length;de++)ce=$(R,z[de],V),ce!==null&&(M=d(ce,M,de),ve===null?ne=ce:ve.sibling=ce,ve=ce);return Te&&ln(R,de),ne}for(ce=n(ce);de<z.length;de++)at=L(ce,R,de,z[de],V),at!==null&&(e&&at.alternate!==null&&ce.delete(at.key===null?de:at.key),M=d(at,M,de),ve===null?ne=at:ve.sibling=at,ve=at);return e&&ce.forEach(function(Ia){return t(R,Ia)}),Te&&ln(R,de),ne}function ue(R,M,z,V){if(z==null)throw Error(i(151));for(var ne=null,ve=null,ce=M,de=M=0,at=null,Se=z.next();ce!==null&&!Se.done;de++,Se=z.next()){ce.index>de?(at=ce,ce=null):at=ce.sibling;var Ia=O(R,ce,Se.value,V);if(Ia===null){ce===null&&(ce=at);break}e&&ce&&Ia.alternate===null&&t(R,ce),M=d(Ia,M,de),ve===null?ne=Ia:ve.sibling=Ia,ve=Ia,ce=at}if(Se.done)return a(R,ce),Te&&ln(R,de),ne;if(ce===null){for(;!Se.done;de++,Se=z.next())Se=$(R,Se.value,V),Se!==null&&(M=d(Se,M,de),ve===null?ne=Se:ve.sibling=Se,ve=Se);return Te&&ln(R,de),ne}for(ce=n(ce);!Se.done;de++,Se=z.next())Se=L(ce,R,de,Se.value,V),Se!==null&&(e&&Se.alternate!==null&&ce.delete(Se.key===null?de:Se.key),M=d(Se,M,de),ve===null?ne=Se:ve.sibling=Se,ve=Se);return e&&ce.forEach(function(cg){return t(R,cg)}),Te&&ln(R,de),ne}function ze(R,M,z,V){if(typeof z=="object"&&z!==null&&z.type===_&&z.key===null&&(z=z.props.children),typeof z=="object"&&z!==null){switch(z.$$typeof){case E:e:{for(var ne=z.key;M!==null;){if(M.key===ne){if(ne=z.type,ne===_){if(M.tag===7){a(R,M.sibling),V=r(M,z.props.children),V.return=R,R=V;break e}}else if(M.elementType===ne||typeof ne=="object"&&ne!==null&&ne.$$typeof===J&&ud(ne)===M.type){a(R,M.sibling),V=r(M,z.props),Hs(V,z),V.return=R,R=V;break e}a(R,M);break}else t(R,M);M=M.sibling}z.type===_?(V=nn(z.props.children,R.mode,V,z.key),V.return=R,R=V):(V=El(z.type,z.key,z.props,null,R.mode,V),Hs(V,z),V.return=R,R=V)}return h(R);case C:e:{for(ne=z.key;M!==null;){if(M.key===ne)if(M.tag===4&&M.stateNode.containerInfo===z.containerInfo&&M.stateNode.implementation===z.implementation){a(R,M.sibling),V=r(M,z.children||[]),V.return=R,R=V;break e}else{a(R,M);break}else t(R,M);M=M.sibling}V=ur(z,R.mode,V),V.return=R,R=V}return h(R);case J:return ne=z._init,z=ne(z._payload),ze(R,M,z,V)}if(P(z))return fe(R,M,z,V);if(Me(z)){if(ne=Me(z),typeof ne!="function")throw Error(i(150));return z=ne.call(z),ue(R,M,z,V)}if(typeof z.then=="function")return ze(R,M,Gl(z),V);if(z.$$typeof===B)return ze(R,M,Ml(R,z),V);Xl(R,z)}return typeof z=="string"&&z!==""||typeof z=="number"||typeof z=="bigint"?(z=""+z,M!==null&&M.tag===6?(a(R,M.sibling),V=r(M,z),V.return=R,R=V):(a(R,M),V=or(z,R.mode,V),V.return=R,R=V),h(R)):a(R,M)}return function(R,M,z,V){try{zs=0;var ne=ze(R,M,z,V);return Gn=null,ne}catch(ce){if(ce===Ts||ce===ql)throw ce;var ve=Dt(29,ce,null,R.mode);return ve.lanes=V,ve.return=R,ve}finally{}}}var Xn=dd(!0),md=dd(!1),Gt=k(null),na=null;function wa(e){var t=e.alternate;K(Je,Je.current&1),K(Gt,e),na===null&&(t===null||Bn.current!==null||t.memoizedState!==null)&&(na=e)}function fd(e){if(e.tag===22){if(K(Je,Je.current),K(Gt,e),na===null){var t=e.alternate;t!==null&&t.memoizedState!==null&&(na=e)}}else La()}function La(){K(Je,Je.current),K(Gt,Gt.current)}function ya(e){Z(Gt),na===e&&(na=null),Z(Je)}var Je=k(0);function Vl(e){for(var t=e;t!==null;){if(t.tag===13){var a=t.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||a.data==="$?"||Rc(a)))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if((t.flags&128)!==0)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function Xr(e,t,a,n){t=e.memoizedState,a=a(n,t),a=a==null?t:y({},t,a),e.memoizedState=a,e.lanes===0&&(e.updateQueue.baseState=a)}var Vr={enqueueSetState:function(e,t,a){e=e._reactInternals;var n=Ht(),r=za(n);r.payload=t,a!=null&&(r.callback=a),t=Ha(e,r,n),t!==null&&(Ot(t,e,n),As(t,e,n))},enqueueReplaceState:function(e,t,a){e=e._reactInternals;var n=Ht(),r=za(n);r.tag=1,r.payload=t,a!=null&&(r.callback=a),t=Ha(e,r,n),t!==null&&(Ot(t,e,n),As(t,e,n))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var a=Ht(),n=za(a);n.tag=2,t!=null&&(n.callback=t),t=Ha(e,n,a),t!==null&&(Ot(t,e,a),As(t,e,a))}};function pd(e,t,a,n,r,d,h){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,d,h):t.prototype&&t.prototype.isPureReactComponent?!gs(a,n)||!gs(r,d):!0}function hd(e,t,a,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(a,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(a,n),t.state!==e&&Vr.enqueueReplaceState(t,t.state,null)}function fn(e,t){var a=t;if("ref"in t){a={};for(var n in t)n!=="ref"&&(a[n]=t[n])}if(e=e.defaultProps){a===t&&(a=y({},a));for(var r in e)a[r]===void 0&&(a[r]=e[r])}return a}var $l=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)};function gd(e){$l(e)}function vd(e){console.error(e)}function yd(e){$l(e)}function Yl(e,t){try{var a=e.onUncaughtError;a(t.value,{componentStack:t.stack})}catch(n){setTimeout(function(){throw n})}}function xd(e,t,a){try{var n=e.onCaughtError;n(a.value,{componentStack:a.stack,errorBoundary:t.tag===1?t.stateNode:null})}catch(r){setTimeout(function(){throw r})}}function $r(e,t,a){return a=za(a),a.tag=3,a.payload={element:null},a.callback=function(){Yl(e,t)},a}function bd(e){return e=za(e),e.tag=3,e}function _d(e,t,a,n){var r=a.type.getDerivedStateFromError;if(typeof r=="function"){var d=n.value;e.payload=function(){return r(d)},e.callback=function(){xd(t,a,n)}}var h=a.stateNode;h!==null&&typeof h.componentDidCatch=="function"&&(e.callback=function(){xd(t,a,n),typeof r!="function"&&(Xa===null?Xa=new Set([this]):Xa.add(this));var x=n.stack;this.componentDidCatch(n.value,{componentStack:x!==null?x:""})})}function ch(e,t,a,n,r){if(a.flags|=32768,n!==null&&typeof n=="object"&&typeof n.then=="function"){if(t=a.alternate,t!==null&&_s(t,a,r,!0),a=Gt.current,a!==null){switch(a.tag){case 13:return na===null?hc():a.alternate===null&&Ge===0&&(Ge=3),a.flags&=-257,a.flags|=65536,a.lanes=r,n===br?a.flags|=16384:(t=a.updateQueue,t===null?a.updateQueue=new Set([n]):t.add(n),vc(e,n,r)),!1;case 22:return a.flags|=65536,n===br?a.flags|=16384:(t=a.updateQueue,t===null?(t={transitions:null,markerInstances:null,retryQueue:new Set([n])},a.updateQueue=t):(a=t.retryQueue,a===null?t.retryQueue=new Set([n]):a.add(n)),vc(e,n,r)),!1}throw Error(i(435,a.tag))}return vc(e,n,r),hc(),!1}if(Te)return t=Gt.current,t!==null?((t.flags&65536)===0&&(t.flags|=256),t.flags|=65536,t.lanes=r,n!==fr&&(e=Error(i(422),{cause:n}),bs(Bt(e,a)))):(n!==fr&&(t=Error(i(423),{cause:n}),bs(Bt(t,a))),e=e.current.alternate,e.flags|=65536,r&=-r,e.lanes|=r,n=Bt(n,a),r=$r(e.stateNode,n,r),jr(e,r),Ge!==4&&(Ge=2)),!1;var d=Error(i(520),{cause:n});if(d=Bt(d,a),Us===null?Us=[d]:Us.push(d),Ge!==4&&(Ge=2),t===null)return!0;n=Bt(n,a),a=t;do{switch(a.tag){case 3:return a.flags|=65536,e=r&-r,a.lanes|=e,e=$r(a.stateNode,n,e),jr(a,e),!1;case 1:if(t=a.type,d=a.stateNode,(a.flags&128)===0&&(typeof t.getDerivedStateFromError=="function"||d!==null&&typeof d.componentDidCatch=="function"&&(Xa===null||!Xa.has(d))))return a.flags|=65536,r&=-r,a.lanes|=r,r=bd(r),_d(r,e,a,n),jr(a,r),!1}a=a.return}while(a!==null);return!1}var Sd=Error(i(461)),et=!1;function it(e,t,a,n){t.child=e===null?md(t,null,a,n):Xn(t,e.child,a,n)}function jd(e,t,a,n,r){a=a.render;var d=t.ref;if("ref"in n){var h={};for(var x in n)x!=="ref"&&(h[x]=n[x])}else h=n;return un(t),n=Nr(e,t,a,h,d,r),x=Mr(),e!==null&&!et?(Dr(e,t,r),xa(e,t,r)):(Te&&x&&dr(t),t.flags|=1,it(e,t,n,r),t.child)}function Td(e,t,a,n,r){if(e===null){var d=a.type;return typeof d=="function"&&!cr(d)&&d.defaultProps===void 0&&a.compare===null?(t.tag=15,t.type=d,Ed(e,t,d,n,r)):(e=El(a.type,null,n,t,t.mode,r),e.ref=t.ref,e.return=t,t.child=e)}if(d=e.child,!Wr(e,r)){var h=d.memoizedProps;if(a=a.compare,a=a!==null?a:gs,a(h,n)&&e.ref===t.ref)return xa(e,t,r)}return t.flags|=1,e=ma(d,n),e.ref=t.ref,e.return=t,t.child=e}function Ed(e,t,a,n,r){if(e!==null){var d=e.memoizedProps;if(gs(d,n)&&e.ref===t.ref)if(et=!1,t.pendingProps=n=d,Wr(e,r))(e.flags&131072)!==0&&(et=!0);else return t.lanes=e.lanes,xa(e,t,r)}return Yr(e,t,a,n,r)}function Ad(e,t,a){var n=t.pendingProps,r=n.children,d=e!==null?e.memoizedState:null;if(n.mode==="hidden"){if((t.flags&128)!==0){if(n=d!==null?d.baseLanes|a:a,e!==null){for(r=t.child=e.child,d=0;r!==null;)d=d|r.lanes|r.childLanes,r=r.sibling;t.childLanes=d&~n}else t.childLanes=0,t.child=null;return Cd(e,t,n,a)}if((a&536870912)!==0)t.memoizedState={baseLanes:0,cachePool:null},e!==null&&Dl(t,d!==null?d.cachePool:null),d!==null?Eu(t,d):Er(),fd(t);else return t.lanes=t.childLanes=536870912,Cd(e,t,d!==null?d.baseLanes|a:a,a)}else d!==null?(Dl(t,d.cachePool),Eu(t,d),La(),t.memoizedState=null):(e!==null&&Dl(t,null),Er(),La());return it(e,t,r,a),t.child}function Cd(e,t,a,n){var r=xr();return r=r===null?null:{parent:Ke._currentValue,pool:r},t.memoizedState={baseLanes:a,cachePool:r},e!==null&&Dl(t,null),Er(),fd(t),e!==null&&_s(e,t,n,!0),null}function Ql(e,t){var a=t.ref;if(a===null)e!==null&&e.ref!==null&&(t.flags|=4194816);else{if(typeof a!="function"&&typeof a!="object")throw Error(i(284));(e===null||e.ref!==a)&&(t.flags|=4194816)}}function Yr(e,t,a,n,r){return un(t),a=Nr(e,t,a,n,void 0,r),n=Mr(),e!==null&&!et?(Dr(e,t,r),xa(e,t,r)):(Te&&n&&dr(t),t.flags|=1,it(e,t,a,r),t.child)}function Nd(e,t,a,n,r,d){return un(t),t.updateQueue=null,a=Cu(t,n,a,r),Au(e),n=Mr(),e!==null&&!et?(Dr(e,t,d),xa(e,t,d)):(Te&&n&&dr(t),t.flags|=1,it(e,t,a,d),t.child)}function Md(e,t,a,n,r){if(un(t),t.stateNode===null){var d=zn,h=a.contextType;typeof h=="object"&&h!==null&&(d=dt(h)),d=new a(n,d),t.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,d.updater=Vr,t.stateNode=d,d._reactInternals=t,d=t.stateNode,d.props=n,d.state=t.memoizedState,d.refs={},_r(t),h=a.contextType,d.context=typeof h=="object"&&h!==null?dt(h):zn,d.state=t.memoizedState,h=a.getDerivedStateFromProps,typeof h=="function"&&(Xr(t,a,h,n),d.state=t.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof d.getSnapshotBeforeUpdate=="function"||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(h=d.state,typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount(),h!==d.state&&Vr.enqueueReplaceState(d,d.state,null),Ns(t,n,d,r),Cs(),d.state=t.memoizedState),typeof d.componentDidMount=="function"&&(t.flags|=4194308),n=!0}else if(e===null){d=t.stateNode;var x=t.memoizedProps,T=fn(a,x);d.props=T;var H=d.context,U=a.contextType;h=zn,typeof U=="object"&&U!==null&&(h=dt(U));var $=a.getDerivedStateFromProps;U=typeof $=="function"||typeof d.getSnapshotBeforeUpdate=="function",x=t.pendingProps!==x,U||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(x||H!==h)&&hd(t,d,n,h),Ra=!1;var O=t.memoizedState;d.state=O,Ns(t,n,d,r),Cs(),H=t.memoizedState,x||O!==H||Ra?(typeof $=="function"&&(Xr(t,a,$,n),H=t.memoizedState),(T=Ra||pd(t,a,T,n,O,H,h))?(U||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount()),typeof d.componentDidMount=="function"&&(t.flags|=4194308)):(typeof d.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=H),d.props=n,d.state=H,d.context=h,n=T):(typeof d.componentDidMount=="function"&&(t.flags|=4194308),n=!1)}else{d=t.stateNode,Sr(e,t),h=t.memoizedProps,U=fn(a,h),d.props=U,$=t.pendingProps,O=d.context,H=a.contextType,T=zn,typeof H=="object"&&H!==null&&(T=dt(H)),x=a.getDerivedStateFromProps,(H=typeof x=="function"||typeof d.getSnapshotBeforeUpdate=="function")||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(h!==$||O!==T)&&hd(t,d,n,T),Ra=!1,O=t.memoizedState,d.state=O,Ns(t,n,d,r),Cs();var L=t.memoizedState;h!==$||O!==L||Ra||e!==null&&e.dependencies!==null&&Nl(e.dependencies)?(typeof x=="function"&&(Xr(t,a,x,n),L=t.memoizedState),(U=Ra||pd(t,a,U,n,O,L,T)||e!==null&&e.dependencies!==null&&Nl(e.dependencies))?(H||typeof d.UNSAFE_componentWillUpdate!="function"&&typeof d.componentWillUpdate!="function"||(typeof d.componentWillUpdate=="function"&&d.componentWillUpdate(n,L,T),typeof d.UNSAFE_componentWillUpdate=="function"&&d.UNSAFE_componentWillUpdate(n,L,T)),typeof d.componentDidUpdate=="function"&&(t.flags|=4),typeof d.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof d.componentDidUpdate!="function"||h===e.memoizedProps&&O===e.memoizedState||(t.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||h===e.memoizedProps&&O===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=L),d.props=n,d.state=L,d.context=T,n=U):(typeof d.componentDidUpdate!="function"||h===e.memoizedProps&&O===e.memoizedState||(t.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||h===e.memoizedProps&&O===e.memoizedState||(t.flags|=1024),n=!1)}return d=n,Ql(e,t),n=(t.flags&128)!==0,d||n?(d=t.stateNode,a=n&&typeof a.getDerivedStateFromError!="function"?null:d.render(),t.flags|=1,e!==null&&n?(t.child=Xn(t,e.child,null,r),t.child=Xn(t,null,a,r)):it(e,t,a,r),t.memoizedState=d.state,e=t.child):e=xa(e,t,r),e}function Dd(e,t,a,n){return xs(),t.flags|=256,it(e,t,a,n),t.child}var Qr={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Zr(e){return{baseLanes:e,cachePool:vu()}}function Kr(e,t,a){return e=e!==null?e.childLanes&~a:0,t&&(e|=Xt),e}function qd(e,t,a){var n=t.pendingProps,r=!1,d=(t.flags&128)!==0,h;if((h=d)||(h=e!==null&&e.memoizedState===null?!1:(Je.current&2)!==0),h&&(r=!0,t.flags&=-129),h=(t.flags&32)!==0,t.flags&=-33,e===null){if(Te){if(r?wa(t):La(),Te){var x=Ue,T;if(T=x){e:{for(T=x,x=aa;T.nodeType!==8;){if(!x){x=null;break e}if(T=It(T.nextSibling),T===null){x=null;break e}}x=T}x!==null?(t.memoizedState={dehydrated:x,treeContext:sn!==null?{id:fa,overflow:pa}:null,retryLane:536870912,hydrationErrors:null},T=Dt(18,null,null,0),T.stateNode=x,T.return=t,t.child=T,ft=t,Ue=null,T=!0):T=!1}T||cn(t)}if(x=t.memoizedState,x!==null&&(x=x.dehydrated,x!==null))return Rc(x)?t.lanes=32:t.lanes=536870912,null;ya(t)}return x=n.children,n=n.fallback,r?(La(),r=t.mode,x=Zl({mode:"hidden",children:x},r),n=nn(n,r,a,null),x.return=t,n.return=t,x.sibling=n,t.child=x,r=t.child,r.memoizedState=Zr(a),r.childLanes=Kr(e,h,a),t.memoizedState=Qr,n):(wa(t),Jr(t,x))}if(T=e.memoizedState,T!==null&&(x=T.dehydrated,x!==null)){if(d)t.flags&256?(wa(t),t.flags&=-257,t=Ir(e,t,a)):t.memoizedState!==null?(La(),t.child=e.child,t.flags|=128,t=null):(La(),r=n.fallback,x=t.mode,n=Zl({mode:"visible",children:n.children},x),r=nn(r,x,a,null),r.flags|=2,n.return=t,r.return=t,n.sibling=r,t.child=n,Xn(t,e.child,null,a),n=t.child,n.memoizedState=Zr(a),n.childLanes=Kr(e,h,a),t.memoizedState=Qr,t=r);else if(wa(t),Rc(x)){if(h=x.nextSibling&&x.nextSibling.dataset,h)var H=h.dgst;h=H,n=Error(i(419)),n.stack="",n.digest=h,bs({value:n,source:null,stack:null}),t=Ir(e,t,a)}else if(et||_s(e,t,a,!1),h=(a&e.childLanes)!==0,et||h){if(h=we,h!==null&&(n=a&-a,n=(n&42)!==0?1:zi(n),n=(n&(h.suspendedLanes|a))!==0?0:n,n!==0&&n!==T.retryLane))throw T.retryLane=n,Rn(e,n),Ot(h,e,n),Sd;x.data==="$?"||hc(),t=Ir(e,t,a)}else x.data==="$?"?(t.flags|=192,t.child=e.child,t=null):(e=T.treeContext,Ue=It(x.nextSibling),ft=t,Te=!0,rn=null,aa=!1,e!==null&&(Pt[Ut++]=fa,Pt[Ut++]=pa,Pt[Ut++]=sn,fa=e.id,pa=e.overflow,sn=t),t=Jr(t,n.children),t.flags|=4096);return t}return r?(La(),r=n.fallback,x=t.mode,T=e.child,H=T.sibling,n=ma(T,{mode:"hidden",children:n.children}),n.subtreeFlags=T.subtreeFlags&65011712,H!==null?r=ma(H,r):(r=nn(r,x,a,null),r.flags|=2),r.return=t,n.return=t,n.sibling=r,t.child=n,n=r,r=t.child,x=e.child.memoizedState,x===null?x=Zr(a):(T=x.cachePool,T!==null?(H=Ke._currentValue,T=T.parent!==H?{parent:H,pool:H}:T):T=vu(),x={baseLanes:x.baseLanes|a,cachePool:T}),r.memoizedState=x,r.childLanes=Kr(e,h,a),t.memoizedState=Qr,n):(wa(t),a=e.child,e=a.sibling,a=ma(a,{mode:"visible",children:n.children}),a.return=t,a.sibling=null,e!==null&&(h=t.deletions,h===null?(t.deletions=[e],t.flags|=16):h.push(e)),t.child=a,t.memoizedState=null,a)}function Jr(e,t){return t=Zl({mode:"visible",children:t},e.mode),t.return=e,e.child=t}function Zl(e,t){return e=Dt(22,e,null,t),e.lanes=0,e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},e}function Ir(e,t,a){return Xn(t,e.child,null,a),e=Jr(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Rd(e,t,a){e.lanes|=t;var n=e.alternate;n!==null&&(n.lanes|=t),hr(e.return,t,a)}function Fr(e,t,a,n,r){var d=e.memoizedState;d===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:a,tailMode:r}:(d.isBackwards=t,d.rendering=null,d.renderingStartTime=0,d.last=n,d.tail=a,d.tailMode=r)}function zd(e,t,a){var n=t.pendingProps,r=n.revealOrder,d=n.tail;if(it(e,t,n.children,a),n=Je.current,(n&2)!==0)n=n&1|2,t.flags|=128;else{if(e!==null&&(e.flags&128)!==0)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Rd(e,a,t);else if(e.tag===19)Rd(e,a,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}switch(K(Je,n),r){case"forwards":for(a=t.child,r=null;a!==null;)e=a.alternate,e!==null&&Vl(e)===null&&(r=a),a=a.sibling;a=r,a===null?(r=t.child,t.child=null):(r=a.sibling,a.sibling=null),Fr(t,!1,r,a,d);break;case"backwards":for(a=null,r=t.child,t.child=null;r!==null;){if(e=r.alternate,e!==null&&Vl(e)===null){t.child=r;break}e=r.sibling,r.sibling=a,a=r,r=e}Fr(t,!0,a,null,d);break;case"together":Fr(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function xa(e,t,a){if(e!==null&&(t.dependencies=e.dependencies),Ga|=t.lanes,(a&t.childLanes)===0)if(e!==null){if(_s(e,t,a,!1),(a&t.childLanes)===0)return null}else return null;if(e!==null&&t.child!==e.child)throw Error(i(153));if(t.child!==null){for(e=t.child,a=ma(e,e.pendingProps),t.child=a,a.return=t;e.sibling!==null;)e=e.sibling,a=a.sibling=ma(e,e.pendingProps),a.return=t;a.sibling=null}return t.child}function Wr(e,t){return(e.lanes&t)!==0?!0:(e=e.dependencies,!!(e!==null&&Nl(e)))}function oh(e,t,a){switch(t.tag){case 3:Oe(t,t.stateNode.containerInfo),qa(t,Ke,e.memoizedState.cache),xs();break;case 27:case 5:te(t);break;case 4:Oe(t,t.stateNode.containerInfo);break;case 10:qa(t,t.type,t.memoizedProps.value);break;case 13:var n=t.memoizedState;if(n!==null)return n.dehydrated!==null?(wa(t),t.flags|=128,null):(a&t.child.childLanes)!==0?qd(e,t,a):(wa(t),e=xa(e,t,a),e!==null?e.sibling:null);wa(t);break;case 19:var r=(e.flags&128)!==0;if(n=(a&t.childLanes)!==0,n||(_s(e,t,a,!1),n=(a&t.childLanes)!==0),r){if(n)return zd(e,t,a);t.flags|=128}if(r=t.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),K(Je,Je.current),n)break;return null;case 22:case 23:return t.lanes=0,Ad(e,t,a);case 24:qa(t,Ke,e.memoizedState.cache)}return xa(e,t,a)}function Hd(e,t,a){if(e!==null)if(e.memoizedProps!==t.pendingProps)et=!0;else{if(!Wr(e,a)&&(t.flags&128)===0)return et=!1,oh(e,t,a);et=(e.flags&131072)!==0}else et=!1,Te&&(t.flags&1048576)!==0&&uu(t,Cl,t.index);switch(t.lanes=0,t.tag){case 16:e:{e=t.pendingProps;var n=t.elementType,r=n._init;if(n=r(n._payload),t.type=n,typeof n=="function")cr(n)?(e=fn(n,e),t.tag=1,t=Md(null,t,n,e,a)):(t.tag=0,t=Yr(null,t,n,e,a));else{if(n!=null){if(r=n.$$typeof,r===F){t.tag=11,t=jd(null,t,n,e,a);break e}else if(r===ae){t.tag=14,t=Td(null,t,n,e,a);break e}}throw t=Y(n)||n,Error(i(306,t,""))}}return t;case 0:return Yr(e,t,t.type,t.pendingProps,a);case 1:return n=t.type,r=fn(n,t.pendingProps),Md(e,t,n,r,a);case 3:e:{if(Oe(t,t.stateNode.containerInfo),e===null)throw Error(i(387));n=t.pendingProps;var d=t.memoizedState;r=d.element,Sr(e,t),Ns(t,n,null,a);var h=t.memoizedState;if(n=h.cache,qa(t,Ke,n),n!==d.cache&&gr(t,[Ke],a,!0),Cs(),n=h.element,d.isDehydrated)if(d={element:n,isDehydrated:!1,cache:h.cache},t.updateQueue.baseState=d,t.memoizedState=d,t.flags&256){t=Dd(e,t,n,a);break e}else if(n!==r){r=Bt(Error(i(424)),t),bs(r),t=Dd(e,t,n,a);break e}else{switch(e=t.stateNode.containerInfo,e.nodeType){case 9:e=e.body;break;default:e=e.nodeName==="HTML"?e.ownerDocument.body:e}for(Ue=It(e.firstChild),ft=t,Te=!0,rn=null,aa=!0,a=md(t,null,n,a),t.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling}else{if(xs(),n===r){t=xa(e,t,a);break e}it(e,t,n,a)}t=t.child}return t;case 26:return Ql(e,t),e===null?(a=Bm(t.type,null,t.pendingProps,null))?t.memoizedState=a:Te||(a=t.type,e=t.pendingProps,n=ci(me.current).createElement(a),n[ut]=t,n[yt]=e,ct(n,a,e),We(n),t.stateNode=n):t.memoizedState=Bm(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return te(t),e===null&&Te&&(n=t.stateNode=Om(t.type,t.pendingProps,me.current),ft=t,aa=!0,r=Ue,Ya(t.type)?(zc=r,Ue=It(n.firstChild)):Ue=r),it(e,t,t.pendingProps.children,a),Ql(e,t),e===null&&(t.flags|=4194304),t.child;case 5:return e===null&&Te&&((r=n=Ue)&&(n=Lh(n,t.type,t.pendingProps,aa),n!==null?(t.stateNode=n,ft=t,Ue=It(n.firstChild),aa=!1,r=!0):r=!1),r||cn(t)),te(t),r=t.type,d=t.pendingProps,h=e!==null?e.memoizedProps:null,n=d.children,Mc(r,d)?n=null:h!==null&&Mc(r,h)&&(t.flags|=32),t.memoizedState!==null&&(r=Nr(e,t,th,null,null,a),Js._currentValue=r),Ql(e,t),it(e,t,n,a),t.child;case 6:return e===null&&Te&&((e=a=Ue)&&(a=Bh(a,t.pendingProps,aa),a!==null?(t.stateNode=a,ft=t,Ue=null,e=!0):e=!1),e||cn(t)),null;case 13:return qd(e,t,a);case 4:return Oe(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=Xn(t,null,n,a):it(e,t,n,a),t.child;case 11:return jd(e,t,t.type,t.pendingProps,a);case 7:return it(e,t,t.pendingProps,a),t.child;case 8:return it(e,t,t.pendingProps.children,a),t.child;case 12:return it(e,t,t.pendingProps.children,a),t.child;case 10:return n=t.pendingProps,qa(t,t.type,n.value),it(e,t,n.children,a),t.child;case 9:return r=t.type._context,n=t.pendingProps.children,un(t),r=dt(r),n=n(r),t.flags|=1,it(e,t,n,a),t.child;case 14:return Td(e,t,t.type,t.pendingProps,a);case 15:return Ed(e,t,t.type,t.pendingProps,a);case 19:return zd(e,t,a);case 31:return n=t.pendingProps,a=t.mode,n={mode:n.mode,children:n.children},e===null?(a=Zl(n,a),a.ref=t.ref,t.child=a,a.return=t,t=a):(a=ma(e.child,n),a.ref=t.ref,t.child=a,a.return=t,t=a),t;case 22:return Ad(e,t,a);case 24:return un(t),n=dt(Ke),e===null?(r=xr(),r===null&&(r=we,d=vr(),r.pooledCache=d,d.refCount++,d!==null&&(r.pooledCacheLanes|=a),r=d),t.memoizedState={parent:n,cache:r},_r(t),qa(t,Ke,r)):((e.lanes&a)!==0&&(Sr(e,t),Ns(t,null,null,a),Cs()),r=e.memoizedState,d=t.memoizedState,r.parent!==n?(r={parent:n,cache:n},t.memoizedState=r,t.lanes===0&&(t.memoizedState=t.updateQueue.baseState=r),qa(t,Ke,n)):(n=d.cache,qa(t,Ke,n),n!==r.cache&&gr(t,[Ke],a,!0))),it(e,t,t.pendingProps.children,a),t.child;case 29:throw t.pendingProps}throw Error(i(156,t.tag))}function ba(e){e.flags|=4}function Od(e,t){if(t.type!=="stylesheet"||(t.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!Xm(t)){if(t=Gt.current,t!==null&&((be&4194048)===be?na!==null:(be&62914560)!==be&&(be&536870912)===0||t!==na))throw Es=br,yu;e.flags|=8192}}function Kl(e,t){t!==null&&(e.flags|=4),e.flags&16384&&(t=e.tag!==22?fo():536870912,e.lanes|=t,Qn|=t)}function Os(e,t){if(!Te)switch(e.tailMode){case"hidden":t=e.tail;for(var a=null;t!==null;)t.alternate!==null&&(a=t),t=t.sibling;a===null?e.tail=null:a.sibling=null;break;case"collapsed":a=e.tail;for(var n=null;a!==null;)a.alternate!==null&&(n=a),a=a.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function Pe(e){var t=e.alternate!==null&&e.alternate.child===e.child,a=0,n=0;if(t)for(var r=e.child;r!==null;)a|=r.lanes|r.childLanes,n|=r.subtreeFlags&65011712,n|=r.flags&65011712,r.return=e,r=r.sibling;else for(r=e.child;r!==null;)a|=r.lanes|r.childLanes,n|=r.subtreeFlags,n|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=n,e.childLanes=a,t}function uh(e,t,a){var n=t.pendingProps;switch(mr(t),t.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Pe(t),null;case 1:return Pe(t),null;case 3:return a=t.stateNode,n=null,e!==null&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),ga(Ke),ea(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(e===null||e.child===null)&&(ys(t)?ba(t):e===null||e.memoizedState.isDehydrated&&(t.flags&256)===0||(t.flags|=1024,fu())),Pe(t),null;case 26:return a=t.memoizedState,e===null?(ba(t),a!==null?(Pe(t),Od(t,a)):(Pe(t),t.flags&=-16777217)):a?a!==e.memoizedState?(ba(t),Pe(t),Od(t,a)):(Pe(t),t.flags&=-16777217):(e.memoizedProps!==n&&ba(t),Pe(t),t.flags&=-16777217),null;case 27:De(t),a=me.current;var r=t.type;if(e!==null&&t.stateNode!=null)e.memoizedProps!==n&&ba(t);else{if(!n){if(t.stateNode===null)throw Error(i(166));return Pe(t),null}e=re.current,ys(t)?du(t):(e=Om(r,n,a),t.stateNode=e,ba(t))}return Pe(t),null;case 5:if(De(t),a=t.type,e!==null&&t.stateNode!=null)e.memoizedProps!==n&&ba(t);else{if(!n){if(t.stateNode===null)throw Error(i(166));return Pe(t),null}if(e=re.current,ys(t))du(t);else{switch(r=ci(me.current),e){case 1:e=r.createElementNS("http://www.w3.org/2000/svg",a);break;case 2:e=r.createElementNS("http://www.w3.org/1998/Math/MathML",a);break;default:switch(a){case"svg":e=r.createElementNS("http://www.w3.org/2000/svg",a);break;case"math":e=r.createElementNS("http://www.w3.org/1998/Math/MathML",a);break;case"script":e=r.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild);break;case"select":e=typeof n.is=="string"?r.createElement("select",{is:n.is}):r.createElement("select"),n.multiple?e.multiple=!0:n.size&&(e.size=n.size);break;default:e=typeof n.is=="string"?r.createElement(a,{is:n.is}):r.createElement(a)}}e[ut]=t,e[yt]=n;e:for(r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.tag!==27&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break e;for(;r.sibling===null;){if(r.return===null||r.return===t)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}t.stateNode=e;e:switch(ct(e,a,n),a){case"button":case"input":case"select":case"textarea":e=!!n.autoFocus;break e;case"img":e=!0;break e;default:e=!1}e&&ba(t)}}return Pe(t),t.flags&=-16777217,null;case 6:if(e&&t.stateNode!=null)e.memoizedProps!==n&&ba(t);else{if(typeof n!="string"&&t.stateNode===null)throw Error(i(166));if(e=me.current,ys(t)){if(e=t.stateNode,a=t.memoizedProps,n=null,r=ft,r!==null)switch(r.tag){case 27:case 5:n=r.memoizedProps}e[ut]=t,e=!!(e.nodeValue===a||n!==null&&n.suppressHydrationWarning===!0||Nm(e.nodeValue,a)),e||cn(t)}else e=ci(e).createTextNode(n),e[ut]=t,t.stateNode=e}return Pe(t),null;case 13:if(n=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(r=ys(t),n!==null&&n.dehydrated!==null){if(e===null){if(!r)throw Error(i(318));if(r=t.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(i(317));r[ut]=t}else xs(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;Pe(t),r=!1}else r=fu(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=r),r=!0;if(!r)return t.flags&256?(ya(t),t):(ya(t),null)}if(ya(t),(t.flags&128)!==0)return t.lanes=a,t;if(a=n!==null,e=e!==null&&e.memoizedState!==null,a){n=t.child,r=null,n.alternate!==null&&n.alternate.memoizedState!==null&&n.alternate.memoizedState.cachePool!==null&&(r=n.alternate.memoizedState.cachePool.pool);var d=null;n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(d=n.memoizedState.cachePool.pool),d!==r&&(n.flags|=2048)}return a!==e&&a&&(t.child.flags|=8192),Kl(t,t.updateQueue),Pe(t),null;case 4:return ea(),e===null&&Tc(t.stateNode.containerInfo),Pe(t),null;case 10:return ga(t.type),Pe(t),null;case 19:if(Z(Je),r=t.memoizedState,r===null)return Pe(t),null;if(n=(t.flags&128)!==0,d=r.rendering,d===null)if(n)Os(r,!1);else{if(Ge!==0||e!==null&&(e.flags&128)!==0)for(e=t.child;e!==null;){if(d=Vl(e),d!==null){for(t.flags|=128,Os(r,!1),e=d.updateQueue,t.updateQueue=e,Kl(t,e),t.subtreeFlags=0,e=a,a=t.child;a!==null;)ou(a,e),a=a.sibling;return K(Je,Je.current&1|2),t.child}e=e.sibling}r.tail!==null&&vt()>Fl&&(t.flags|=128,n=!0,Os(r,!1),t.lanes=4194304)}else{if(!n)if(e=Vl(d),e!==null){if(t.flags|=128,n=!0,e=e.updateQueue,t.updateQueue=e,Kl(t,e),Os(r,!0),r.tail===null&&r.tailMode==="hidden"&&!d.alternate&&!Te)return Pe(t),null}else 2*vt()-r.renderingStartTime>Fl&&a!==536870912&&(t.flags|=128,n=!0,Os(r,!1),t.lanes=4194304);r.isBackwards?(d.sibling=t.child,t.child=d):(e=r.last,e!==null?e.sibling=d:t.child=d,r.last=d)}return r.tail!==null?(t=r.tail,r.rendering=t,r.tail=t.sibling,r.renderingStartTime=vt(),t.sibling=null,e=Je.current,K(Je,n?e&1|2:e&1),t):(Pe(t),null);case 22:case 23:return ya(t),Ar(),n=t.memoizedState!==null,e!==null?e.memoizedState!==null!==n&&(t.flags|=8192):n&&(t.flags|=8192),n?(a&536870912)!==0&&(t.flags&128)===0&&(Pe(t),t.subtreeFlags&6&&(t.flags|=8192)):Pe(t),a=t.updateQueue,a!==null&&Kl(t,a.retryQueue),a=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(a=e.memoizedState.cachePool.pool),n=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(n=t.memoizedState.cachePool.pool),n!==a&&(t.flags|=2048),e!==null&&Z(dn),null;case 24:return a=null,e!==null&&(a=e.memoizedState.cache),t.memoizedState.cache!==a&&(t.flags|=2048),ga(Ke),Pe(t),null;case 25:return null;case 30:return null}throw Error(i(156,t.tag))}function dh(e,t){switch(mr(t),t.tag){case 1:return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return ga(Ke),ea(),e=t.flags,(e&65536)!==0&&(e&128)===0?(t.flags=e&-65537|128,t):null;case 26:case 27:case 5:return De(t),null;case 13:if(ya(t),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(i(340));xs()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Z(Je),null;case 4:return ea(),null;case 10:return ga(t.type),null;case 22:case 23:return ya(t),Ar(),e!==null&&Z(dn),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 24:return ga(Ke),null;case 25:return null;default:return null}}function wd(e,t){switch(mr(t),t.tag){case 3:ga(Ke),ea();break;case 26:case 27:case 5:De(t);break;case 4:ea();break;case 13:ya(t);break;case 19:Z(Je);break;case 10:ga(t.type);break;case 22:case 23:ya(t),Ar(),e!==null&&Z(dn);break;case 24:ga(Ke)}}function ws(e,t){try{var a=t.updateQueue,n=a!==null?a.lastEffect:null;if(n!==null){var r=n.next;a=r;do{if((a.tag&e)===e){n=void 0;var d=a.create,h=a.inst;n=d(),h.destroy=n}a=a.next}while(a!==r)}}catch(x){He(t,t.return,x)}}function Ba(e,t,a){try{var n=t.updateQueue,r=n!==null?n.lastEffect:null;if(r!==null){var d=r.next;n=d;do{if((n.tag&e)===e){var h=n.inst,x=h.destroy;if(x!==void 0){h.destroy=void 0,r=t;var T=a,H=x;try{H()}catch(U){He(r,T,U)}}}n=n.next}while(n!==d)}}catch(U){He(t,t.return,U)}}function Ld(e){var t=e.updateQueue;if(t!==null){var a=e.stateNode;try{Tu(t,a)}catch(n){He(e,e.return,n)}}}function Bd(e,t,a){a.props=fn(e.type,e.memoizedProps),a.state=e.memoizedState;try{a.componentWillUnmount()}catch(n){He(e,t,n)}}function Ls(e,t){try{var a=e.ref;if(a!==null){switch(e.tag){case 26:case 27:case 5:var n=e.stateNode;break;case 30:n=e.stateNode;break;default:n=e.stateNode}typeof a=="function"?e.refCleanup=a(n):a.current=n}}catch(r){He(e,t,r)}}function sa(e,t){var a=e.ref,n=e.refCleanup;if(a!==null)if(typeof n=="function")try{n()}catch(r){He(e,t,r)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof a=="function")try{a(null)}catch(r){He(e,t,r)}else a.current=null}function kd(e){var t=e.type,a=e.memoizedProps,n=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":a.autoFocus&&n.focus();break e;case"img":a.src?n.src=a.src:a.srcSet&&(n.srcset=a.srcSet)}}catch(r){He(e,e.return,r)}}function ec(e,t,a){try{var n=e.stateNode;Rh(n,e.type,a,t),n[yt]=t}catch(r){He(e,e.return,r)}}function Pd(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&Ya(e.type)||e.tag===4}function tc(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Pd(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&Ya(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function ac(e,t,a){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a).insertBefore(e,t):(t=a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,t.appendChild(e),a=a._reactRootContainer,a!=null||t.onclick!==null||(t.onclick=ri));else if(n!==4&&(n===27&&Ya(e.type)&&(a=e.stateNode,t=null),e=e.child,e!==null))for(ac(e,t,a),e=e.sibling;e!==null;)ac(e,t,a),e=e.sibling}function Jl(e,t,a){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?a.insertBefore(e,t):a.appendChild(e);else if(n!==4&&(n===27&&Ya(e.type)&&(a=e.stateNode),e=e.child,e!==null))for(Jl(e,t,a),e=e.sibling;e!==null;)Jl(e,t,a),e=e.sibling}function Ud(e){var t=e.stateNode,a=e.memoizedProps;try{for(var n=e.type,r=t.attributes;r.length;)t.removeAttributeNode(r[0]);ct(t,n,a),t[ut]=e,t[yt]=a}catch(d){He(e,e.return,d)}}var _a=!1,$e=!1,nc=!1,Gd=typeof WeakSet=="function"?WeakSet:Set,tt=null;function mh(e,t){if(e=e.containerInfo,Cc=pi,e=Wo(e),tr(e)){if("selectionStart"in e)var a={start:e.selectionStart,end:e.selectionEnd};else e:{a=(a=e.ownerDocument)&&a.defaultView||window;var n=a.getSelection&&a.getSelection();if(n&&n.rangeCount!==0){a=n.anchorNode;var r=n.anchorOffset,d=n.focusNode;n=n.focusOffset;try{a.nodeType,d.nodeType}catch{a=null;break e}var h=0,x=-1,T=-1,H=0,U=0,$=e,O=null;t:for(;;){for(var L;$!==a||r!==0&&$.nodeType!==3||(x=h+r),$!==d||n!==0&&$.nodeType!==3||(T=h+n),$.nodeType===3&&(h+=$.nodeValue.length),(L=$.firstChild)!==null;)O=$,$=L;for(;;){if($===e)break t;if(O===a&&++H===r&&(x=h),O===d&&++U===n&&(T=h),(L=$.nextSibling)!==null)break;$=O,O=$.parentNode}$=L}a=x===-1||T===-1?null:{start:x,end:T}}else a=null}a=a||{start:0,end:0}}else a=null;for(Nc={focusedElem:e,selectionRange:a},pi=!1,tt=t;tt!==null;)if(t=tt,e=t.child,(t.subtreeFlags&1024)!==0&&e!==null)e.return=t,tt=e;else for(;tt!==null;){switch(t=tt,d=t.alternate,e=t.flags,t.tag){case 0:break;case 11:case 15:break;case 1:if((e&1024)!==0&&d!==null){e=void 0,a=t,r=d.memoizedProps,d=d.memoizedState,n=a.stateNode;try{var fe=fn(a.type,r,a.elementType===a.type);e=n.getSnapshotBeforeUpdate(fe,d),n.__reactInternalSnapshotBeforeUpdate=e}catch(ue){He(a,a.return,ue)}}break;case 3:if((e&1024)!==0){if(e=t.stateNode.containerInfo,a=e.nodeType,a===9)qc(e);else if(a===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":qc(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(i(163))}if(e=t.sibling,e!==null){e.return=t.return,tt=e;break}tt=t.return}}function Xd(e,t,a){var n=a.flags;switch(a.tag){case 0:case 11:case 15:ka(e,a),n&4&&ws(5,a);break;case 1:if(ka(e,a),n&4)if(e=a.stateNode,t===null)try{e.componentDidMount()}catch(h){He(a,a.return,h)}else{var r=fn(a.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(r,t,e.__reactInternalSnapshotBeforeUpdate)}catch(h){He(a,a.return,h)}}n&64&&Ld(a),n&512&&Ls(a,a.return);break;case 3:if(ka(e,a),n&64&&(e=a.updateQueue,e!==null)){if(t=null,a.child!==null)switch(a.child.tag){case 27:case 5:t=a.child.stateNode;break;case 1:t=a.child.stateNode}try{Tu(e,t)}catch(h){He(a,a.return,h)}}break;case 27:t===null&&n&4&&Ud(a);case 26:case 5:ka(e,a),t===null&&n&4&&kd(a),n&512&&Ls(a,a.return);break;case 12:ka(e,a);break;case 13:ka(e,a),n&4&&Yd(e,a),n&64&&(e=a.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(a=_h.bind(null,a),kh(e,a))));break;case 22:if(n=a.memoizedState!==null||_a,!n){t=t!==null&&t.memoizedState!==null||$e,r=_a;var d=$e;_a=n,($e=t)&&!d?Pa(e,a,(a.subtreeFlags&8772)!==0):ka(e,a),_a=r,$e=d}break;case 30:break;default:ka(e,a)}}function Vd(e){var t=e.alternate;t!==null&&(e.alternate=null,Vd(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&wi(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Le=null,_t=!1;function Sa(e,t,a){for(a=a.child;a!==null;)$d(e,t,a),a=a.sibling}function $d(e,t,a){if(Ct&&typeof Ct.onCommitFiberUnmount=="function")try{Ct.onCommitFiberUnmount(ss,a)}catch{}switch(a.tag){case 26:$e||sa(a,t),Sa(e,t,a),a.memoizedState?a.memoizedState.count--:a.stateNode&&(a=a.stateNode,a.parentNode.removeChild(a));break;case 27:$e||sa(a,t);var n=Le,r=_t;Ya(a.type)&&(Le=a.stateNode,_t=!1),Sa(e,t,a),Ys(a.stateNode),Le=n,_t=r;break;case 5:$e||sa(a,t);case 6:if(n=Le,r=_t,Le=null,Sa(e,t,a),Le=n,_t=r,Le!==null)if(_t)try{(Le.nodeType===9?Le.body:Le.nodeName==="HTML"?Le.ownerDocument.body:Le).removeChild(a.stateNode)}catch(d){He(a,t,d)}else try{Le.removeChild(a.stateNode)}catch(d){He(a,t,d)}break;case 18:Le!==null&&(_t?(e=Le,zm(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,a.stateNode),el(e)):zm(Le,a.stateNode));break;case 4:n=Le,r=_t,Le=a.stateNode.containerInfo,_t=!0,Sa(e,t,a),Le=n,_t=r;break;case 0:case 11:case 14:case 15:$e||Ba(2,a,t),$e||Ba(4,a,t),Sa(e,t,a);break;case 1:$e||(sa(a,t),n=a.stateNode,typeof n.componentWillUnmount=="function"&&Bd(a,t,n)),Sa(e,t,a);break;case 21:Sa(e,t,a);break;case 22:$e=(n=$e)||a.memoizedState!==null,Sa(e,t,a),$e=n;break;default:Sa(e,t,a)}}function Yd(e,t){if(t.memoizedState===null&&(e=t.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{el(e)}catch(a){He(t,t.return,a)}}function fh(e){switch(e.tag){case 13:case 19:var t=e.stateNode;return t===null&&(t=e.stateNode=new Gd),t;case 22:return e=e.stateNode,t=e._retryCache,t===null&&(t=e._retryCache=new Gd),t;default:throw Error(i(435,e.tag))}}function sc(e,t){var a=fh(e);t.forEach(function(n){var r=Sh.bind(null,e,n);a.has(n)||(a.add(n),n.then(r,r))})}function qt(e,t){var a=t.deletions;if(a!==null)for(var n=0;n<a.length;n++){var r=a[n],d=e,h=t,x=h;e:for(;x!==null;){switch(x.tag){case 27:if(Ya(x.type)){Le=x.stateNode,_t=!1;break e}break;case 5:Le=x.stateNode,_t=!1;break e;case 3:case 4:Le=x.stateNode.containerInfo,_t=!0;break e}x=x.return}if(Le===null)throw Error(i(160));$d(d,h,r),Le=null,_t=!1,d=r.alternate,d!==null&&(d.return=null),r.return=null}if(t.subtreeFlags&13878)for(t=t.child;t!==null;)Qd(t,e),t=t.sibling}var Jt=null;function Qd(e,t){var a=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:qt(t,e),Rt(e),n&4&&(Ba(3,e,e.return),ws(3,e),Ba(5,e,e.return));break;case 1:qt(t,e),Rt(e),n&512&&($e||a===null||sa(a,a.return)),n&64&&_a&&(e=e.updateQueue,e!==null&&(n=e.callbacks,n!==null&&(a=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=a===null?n:a.concat(n))));break;case 26:var r=Jt;if(qt(t,e),Rt(e),n&512&&($e||a===null||sa(a,a.return)),n&4){var d=a!==null?a.memoizedState:null;if(n=e.memoizedState,a===null)if(n===null)if(e.stateNode===null){e:{n=e.type,a=e.memoizedProps,r=r.ownerDocument||r;t:switch(n){case"title":d=r.getElementsByTagName("title")[0],(!d||d[rs]||d[ut]||d.namespaceURI==="http://www.w3.org/2000/svg"||d.hasAttribute("itemprop"))&&(d=r.createElement(n),r.head.insertBefore(d,r.querySelector("head > title"))),ct(d,n,a),d[ut]=e,We(d),n=d;break e;case"link":var h=Um("link","href",r).get(n+(a.href||""));if(h){for(var x=0;x<h.length;x++)if(d=h[x],d.getAttribute("href")===(a.href==null||a.href===""?null:a.href)&&d.getAttribute("rel")===(a.rel==null?null:a.rel)&&d.getAttribute("title")===(a.title==null?null:a.title)&&d.getAttribute("crossorigin")===(a.crossOrigin==null?null:a.crossOrigin)){h.splice(x,1);break t}}d=r.createElement(n),ct(d,n,a),r.head.appendChild(d);break;case"meta":if(h=Um("meta","content",r).get(n+(a.content||""))){for(x=0;x<h.length;x++)if(d=h[x],d.getAttribute("content")===(a.content==null?null:""+a.content)&&d.getAttribute("name")===(a.name==null?null:a.name)&&d.getAttribute("property")===(a.property==null?null:a.property)&&d.getAttribute("http-equiv")===(a.httpEquiv==null?null:a.httpEquiv)&&d.getAttribute("charset")===(a.charSet==null?null:a.charSet)){h.splice(x,1);break t}}d=r.createElement(n),ct(d,n,a),r.head.appendChild(d);break;default:throw Error(i(468,n))}d[ut]=e,We(d),n=d}e.stateNode=n}else Gm(r,e.type,e.stateNode);else e.stateNode=Pm(r,n,e.memoizedProps);else d!==n?(d===null?a.stateNode!==null&&(a=a.stateNode,a.parentNode.removeChild(a)):d.count--,n===null?Gm(r,e.type,e.stateNode):Pm(r,n,e.memoizedProps)):n===null&&e.stateNode!==null&&ec(e,e.memoizedProps,a.memoizedProps)}break;case 27:qt(t,e),Rt(e),n&512&&($e||a===null||sa(a,a.return)),a!==null&&n&4&&ec(e,e.memoizedProps,a.memoizedProps);break;case 5:if(qt(t,e),Rt(e),n&512&&($e||a===null||sa(a,a.return)),e.flags&32){r=e.stateNode;try{En(r,"")}catch(L){He(e,e.return,L)}}n&4&&e.stateNode!=null&&(r=e.memoizedProps,ec(e,r,a!==null?a.memoizedProps:r)),n&1024&&(nc=!0);break;case 6:if(qt(t,e),Rt(e),n&4){if(e.stateNode===null)throw Error(i(162));n=e.memoizedProps,a=e.stateNode;try{a.nodeValue=n}catch(L){He(e,e.return,L)}}break;case 3:if(di=null,r=Jt,Jt=oi(t.containerInfo),qt(t,e),Jt=r,Rt(e),n&4&&a!==null&&a.memoizedState.isDehydrated)try{el(t.containerInfo)}catch(L){He(e,e.return,L)}nc&&(nc=!1,Zd(e));break;case 4:n=Jt,Jt=oi(e.stateNode.containerInfo),qt(t,e),Rt(e),Jt=n;break;case 12:qt(t,e),Rt(e);break;case 13:qt(t,e),Rt(e),e.child.flags&8192&&e.memoizedState!==null!=(a!==null&&a.memoizedState!==null)&&(uc=vt()),n&4&&(n=e.updateQueue,n!==null&&(e.updateQueue=null,sc(e,n)));break;case 22:r=e.memoizedState!==null;var T=a!==null&&a.memoizedState!==null,H=_a,U=$e;if(_a=H||r,$e=U||T,qt(t,e),$e=U,_a=H,Rt(e),n&8192)e:for(t=e.stateNode,t._visibility=r?t._visibility&-2:t._visibility|1,r&&(a===null||T||_a||$e||pn(e)),a=null,t=e;;){if(t.tag===5||t.tag===26){if(a===null){T=a=t;try{if(d=T.stateNode,r)h=d.style,typeof h.setProperty=="function"?h.setProperty("display","none","important"):h.display="none";else{x=T.stateNode;var $=T.memoizedProps.style,O=$!=null&&$.hasOwnProperty("display")?$.display:null;x.style.display=O==null||typeof O=="boolean"?"":(""+O).trim()}}catch(L){He(T,T.return,L)}}}else if(t.tag===6){if(a===null){T=t;try{T.stateNode.nodeValue=r?"":T.memoizedProps}catch(L){He(T,T.return,L)}}}else if((t.tag!==22&&t.tag!==23||t.memoizedState===null||t===e)&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;a===t&&(a=null),t=t.return}a===t&&(a=null),t.sibling.return=t.return,t=t.sibling}n&4&&(n=e.updateQueue,n!==null&&(a=n.retryQueue,a!==null&&(n.retryQueue=null,sc(e,a))));break;case 19:qt(t,e),Rt(e),n&4&&(n=e.updateQueue,n!==null&&(e.updateQueue=null,sc(e,n)));break;case 30:break;case 21:break;default:qt(t,e),Rt(e)}}function Rt(e){var t=e.flags;if(t&2){try{for(var a,n=e.return;n!==null;){if(Pd(n)){a=n;break}n=n.return}if(a==null)throw Error(i(160));switch(a.tag){case 27:var r=a.stateNode,d=tc(e);Jl(e,d,r);break;case 5:var h=a.stateNode;a.flags&32&&(En(h,""),a.flags&=-33);var x=tc(e);Jl(e,x,h);break;case 3:case 4:var T=a.stateNode.containerInfo,H=tc(e);ac(e,H,T);break;default:throw Error(i(161))}}catch(U){He(e,e.return,U)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Zd(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var t=e;Zd(t),t.tag===5&&t.flags&1024&&t.stateNode.reset(),e=e.sibling}}function ka(e,t){if(t.subtreeFlags&8772)for(t=t.child;t!==null;)Xd(e,t.alternate,t),t=t.sibling}function pn(e){for(e=e.child;e!==null;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:Ba(4,t,t.return),pn(t);break;case 1:sa(t,t.return);var a=t.stateNode;typeof a.componentWillUnmount=="function"&&Bd(t,t.return,a),pn(t);break;case 27:Ys(t.stateNode);case 26:case 5:sa(t,t.return),pn(t);break;case 22:t.memoizedState===null&&pn(t);break;case 30:pn(t);break;default:pn(t)}e=e.sibling}}function Pa(e,t,a){for(a=a&&(t.subtreeFlags&8772)!==0,t=t.child;t!==null;){var n=t.alternate,r=e,d=t,h=d.flags;switch(d.tag){case 0:case 11:case 15:Pa(r,d,a),ws(4,d);break;case 1:if(Pa(r,d,a),n=d,r=n.stateNode,typeof r.componentDidMount=="function")try{r.componentDidMount()}catch(H){He(n,n.return,H)}if(n=d,r=n.updateQueue,r!==null){var x=n.stateNode;try{var T=r.shared.hiddenCallbacks;if(T!==null)for(r.shared.hiddenCallbacks=null,r=0;r<T.length;r++)ju(T[r],x)}catch(H){He(n,n.return,H)}}a&&h&64&&Ld(d),Ls(d,d.return);break;case 27:Ud(d);case 26:case 5:Pa(r,d,a),a&&n===null&&h&4&&kd(d),Ls(d,d.return);break;case 12:Pa(r,d,a);break;case 13:Pa(r,d,a),a&&h&4&&Yd(r,d);break;case 22:d.memoizedState===null&&Pa(r,d,a),Ls(d,d.return);break;case 30:break;default:Pa(r,d,a)}t=t.sibling}}function lc(e,t){var a=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(a=e.memoizedState.cachePool.pool),e=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(e=t.memoizedState.cachePool.pool),e!==a&&(e!=null&&e.refCount++,a!=null&&Ss(a))}function ic(e,t){e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&Ss(e))}function la(e,t,a,n){if(t.subtreeFlags&10256)for(t=t.child;t!==null;)Kd(e,t,a,n),t=t.sibling}function Kd(e,t,a,n){var r=t.flags;switch(t.tag){case 0:case 11:case 15:la(e,t,a,n),r&2048&&ws(9,t);break;case 1:la(e,t,a,n);break;case 3:la(e,t,a,n),r&2048&&(e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&Ss(e)));break;case 12:if(r&2048){la(e,t,a,n),e=t.stateNode;try{var d=t.memoizedProps,h=d.id,x=d.onPostCommit;typeof x=="function"&&x(h,t.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(T){He(t,t.return,T)}}else la(e,t,a,n);break;case 13:la(e,t,a,n);break;case 23:break;case 22:d=t.stateNode,h=t.alternate,t.memoizedState!==null?d._visibility&2?la(e,t,a,n):Bs(e,t):d._visibility&2?la(e,t,a,n):(d._visibility|=2,Vn(e,t,a,n,(t.subtreeFlags&10256)!==0)),r&2048&&lc(h,t);break;case 24:la(e,t,a,n),r&2048&&ic(t.alternate,t);break;default:la(e,t,a,n)}}function Vn(e,t,a,n,r){for(r=r&&(t.subtreeFlags&10256)!==0,t=t.child;t!==null;){var d=e,h=t,x=a,T=n,H=h.flags;switch(h.tag){case 0:case 11:case 15:Vn(d,h,x,T,r),ws(8,h);break;case 23:break;case 22:var U=h.stateNode;h.memoizedState!==null?U._visibility&2?Vn(d,h,x,T,r):Bs(d,h):(U._visibility|=2,Vn(d,h,x,T,r)),r&&H&2048&&lc(h.alternate,h);break;case 24:Vn(d,h,x,T,r),r&&H&2048&&ic(h.alternate,h);break;default:Vn(d,h,x,T,r)}t=t.sibling}}function Bs(e,t){if(t.subtreeFlags&10256)for(t=t.child;t!==null;){var a=e,n=t,r=n.flags;switch(n.tag){case 22:Bs(a,n),r&2048&&lc(n.alternate,n);break;case 24:Bs(a,n),r&2048&&ic(n.alternate,n);break;default:Bs(a,n)}t=t.sibling}}var ks=8192;function $n(e){if(e.subtreeFlags&ks)for(e=e.child;e!==null;)Jd(e),e=e.sibling}function Jd(e){switch(e.tag){case 26:$n(e),e.flags&ks&&e.memoizedState!==null&&Fh(Jt,e.memoizedState,e.memoizedProps);break;case 5:$n(e);break;case 3:case 4:var t=Jt;Jt=oi(e.stateNode.containerInfo),$n(e),Jt=t;break;case 22:e.memoizedState===null&&(t=e.alternate,t!==null&&t.memoizedState!==null?(t=ks,ks=16777216,$n(e),ks=t):$n(e));break;default:$n(e)}}function Id(e){var t=e.alternate;if(t!==null&&(e=t.child,e!==null)){t.child=null;do t=e.sibling,e.sibling=null,e=t;while(e!==null)}}function Ps(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var a=0;a<t.length;a++){var n=t[a];tt=n,Wd(n,e)}Id(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)Fd(e),e=e.sibling}function Fd(e){switch(e.tag){case 0:case 11:case 15:Ps(e),e.flags&2048&&Ba(9,e,e.return);break;case 3:Ps(e);break;case 12:Ps(e);break;case 22:var t=e.stateNode;e.memoizedState!==null&&t._visibility&2&&(e.return===null||e.return.tag!==13)?(t._visibility&=-3,Il(e)):Ps(e);break;default:Ps(e)}}function Il(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var a=0;a<t.length;a++){var n=t[a];tt=n,Wd(n,e)}Id(e)}for(e=e.child;e!==null;){switch(t=e,t.tag){case 0:case 11:case 15:Ba(8,t,t.return),Il(t);break;case 22:a=t.stateNode,a._visibility&2&&(a._visibility&=-3,Il(t));break;default:Il(t)}e=e.sibling}}function Wd(e,t){for(;tt!==null;){var a=tt;switch(a.tag){case 0:case 11:case 15:Ba(8,a,t);break;case 23:case 22:if(a.memoizedState!==null&&a.memoizedState.cachePool!==null){var n=a.memoizedState.cachePool.pool;n!=null&&n.refCount++}break;case 24:Ss(a.memoizedState.cache)}if(n=a.child,n!==null)n.return=a,tt=n;else e:for(a=e;tt!==null;){n=tt;var r=n.sibling,d=n.return;if(Vd(n),n===a){tt=null;break e}if(r!==null){r.return=d,tt=r;break e}tt=d}}}var ph={getCacheForType:function(e){var t=dt(Ke),a=t.data.get(e);return a===void 0&&(a=e(),t.data.set(e,a)),a}},hh=typeof WeakMap=="function"?WeakMap:Map,Ee=0,we=null,ye=null,be=0,Ae=0,zt=null,Ua=!1,Yn=!1,rc=!1,ja=0,Ge=0,Ga=0,hn=0,cc=0,Xt=0,Qn=0,Us=null,St=null,oc=!1,uc=0,Fl=1/0,Wl=null,Xa=null,rt=0,Va=null,Zn=null,Kn=0,dc=0,mc=null,em=null,Gs=0,fc=null;function Ht(){if((Ee&2)!==0&&be!==0)return be&-be;if(N.T!==null){var e=wn;return e!==0?e:bc()}return go()}function tm(){Xt===0&&(Xt=(be&536870912)===0||Te?mo():536870912);var e=Gt.current;return e!==null&&(e.flags|=32),Xt}function Ot(e,t,a){(e===we&&(Ae===2||Ae===9)||e.cancelPendingCommit!==null)&&(Jn(e,0),$a(e,be,Xt,!1)),is(e,a),((Ee&2)===0||e!==we)&&(e===we&&((Ee&2)===0&&(hn|=a),Ge===4&&$a(e,be,Xt,!1)),ia(e))}function am(e,t,a){if((Ee&6)!==0)throw Error(i(327));var n=!a&&(t&124)===0&&(t&e.expiredLanes)===0||ls(e,t),r=n?yh(e,t):gc(e,t,!0),d=n;do{if(r===0){Yn&&!n&&$a(e,t,0,!1);break}else{if(a=e.current.alternate,d&&!gh(a)){r=gc(e,t,!1),d=!1;continue}if(r===2){if(d=t,e.errorRecoveryDisabledLanes&d)var h=0;else h=e.pendingLanes&-536870913,h=h!==0?h:h&536870912?536870912:0;if(h!==0){t=h;e:{var x=e;r=Us;var T=x.current.memoizedState.isDehydrated;if(T&&(Jn(x,h).flags|=256),h=gc(x,h,!1),h!==2){if(rc&&!T){x.errorRecoveryDisabledLanes|=d,hn|=d,r=4;break e}d=St,St=r,d!==null&&(St===null?St=d:St.push.apply(St,d))}r=h}if(d=!1,r!==2)continue}}if(r===1){Jn(e,0),$a(e,t,0,!0);break}e:{switch(n=e,d=r,d){case 0:case 1:throw Error(i(345));case 4:if((t&4194048)!==t)break;case 6:$a(n,t,Xt,!Ua);break e;case 2:St=null;break;case 3:case 5:break;default:throw Error(i(329))}if((t&62914560)===t&&(r=uc+300-vt(),10<r)){if($a(n,t,Xt,!Ua),ul(n,0,!0)!==0)break e;n.timeoutHandle=qm(nm.bind(null,n,a,St,Wl,oc,t,Xt,hn,Qn,Ua,d,2,-0,0),r);break e}nm(n,a,St,Wl,oc,t,Xt,hn,Qn,Ua,d,0,-0,0)}}break}while(!0);ia(e)}function nm(e,t,a,n,r,d,h,x,T,H,U,$,O,L){if(e.timeoutHandle=-1,$=t.subtreeFlags,($&8192||($&16785408)===16785408)&&(Ks={stylesheets:null,count:0,unsuspend:Ih},Jd(t),$=Wh(),$!==null)){e.cancelPendingCommit=$(um.bind(null,e,t,d,a,n,r,h,x,T,U,1,O,L)),$a(e,d,h,!H);return}um(e,t,d,a,n,r,h,x,T)}function gh(e){for(var t=e;;){var a=t.tag;if((a===0||a===11||a===15)&&t.flags&16384&&(a=t.updateQueue,a!==null&&(a=a.stores,a!==null)))for(var n=0;n<a.length;n++){var r=a[n],d=r.getSnapshot;r=r.value;try{if(!Mt(d(),r))return!1}catch{return!1}}if(a=t.child,t.subtreeFlags&16384&&a!==null)a.return=t,t=a;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function $a(e,t,a,n){t&=~cc,t&=~hn,e.suspendedLanes|=t,e.pingedLanes&=~t,n&&(e.warmLanes|=t),n=e.expirationTimes;for(var r=t;0<r;){var d=31-Nt(r),h=1<<d;n[d]=-1,r&=~h}a!==0&&po(e,a,t)}function ei(){return(Ee&6)===0?(Xs(0),!1):!0}function pc(){if(ye!==null){if(Ae===0)var e=ye.return;else e=ye,ha=on=null,qr(e),Gn=null,zs=0,e=ye;for(;e!==null;)wd(e.alternate,e),e=e.return;ye=null}}function Jn(e,t){var a=e.timeoutHandle;a!==-1&&(e.timeoutHandle=-1,Hh(a)),a=e.cancelPendingCommit,a!==null&&(e.cancelPendingCommit=null,a()),pc(),we=e,ye=a=ma(e.current,null),be=t,Ae=0,zt=null,Ua=!1,Yn=ls(e,t),rc=!1,Qn=Xt=cc=hn=Ga=Ge=0,St=Us=null,oc=!1,(t&8)!==0&&(t|=t&32);var n=e.entangledLanes;if(n!==0)for(e=e.entanglements,n&=t;0<n;){var r=31-Nt(n),d=1<<r;t|=e[r],n&=~d}return ja=t,Sl(),a}function sm(e,t){ge=null,N.H=Ul,t===Ts||t===ql?(t=_u(),Ae=3):t===yu?(t=_u(),Ae=4):Ae=t===Sd?8:t!==null&&typeof t=="object"&&typeof t.then=="function"?6:1,zt=t,ye===null&&(Ge=1,Yl(e,Bt(t,e.current)))}function lm(){var e=N.H;return N.H=Ul,e===null?Ul:e}function im(){var e=N.A;return N.A=ph,e}function hc(){Ge=4,Ua||(be&4194048)!==be&&Gt.current!==null||(Yn=!0),(Ga&134217727)===0&&(hn&134217727)===0||we===null||$a(we,be,Xt,!1)}function gc(e,t,a){var n=Ee;Ee|=2;var r=lm(),d=im();(we!==e||be!==t)&&(Wl=null,Jn(e,t)),t=!1;var h=Ge;e:do try{if(Ae!==0&&ye!==null){var x=ye,T=zt;switch(Ae){case 8:pc(),h=6;break e;case 3:case 2:case 9:case 6:Gt.current===null&&(t=!0);var H=Ae;if(Ae=0,zt=null,In(e,x,T,H),a&&Yn){h=0;break e}break;default:H=Ae,Ae=0,zt=null,In(e,x,T,H)}}vh(),h=Ge;break}catch(U){sm(e,U)}while(!0);return t&&e.shellSuspendCounter++,ha=on=null,Ee=n,N.H=r,N.A=d,ye===null&&(we=null,be=0,Sl()),h}function vh(){for(;ye!==null;)rm(ye)}function yh(e,t){var a=Ee;Ee|=2;var n=lm(),r=im();we!==e||be!==t?(Wl=null,Fl=vt()+500,Jn(e,t)):Yn=ls(e,t);e:do try{if(Ae!==0&&ye!==null){t=ye;var d=zt;t:switch(Ae){case 1:Ae=0,zt=null,In(e,t,d,1);break;case 2:case 9:if(xu(d)){Ae=0,zt=null,cm(t);break}t=function(){Ae!==2&&Ae!==9||we!==e||(Ae=7),ia(e)},d.then(t,t);break e;case 3:Ae=7;break e;case 4:Ae=5;break e;case 7:xu(d)?(Ae=0,zt=null,cm(t)):(Ae=0,zt=null,In(e,t,d,7));break;case 5:var h=null;switch(ye.tag){case 26:h=ye.memoizedState;case 5:case 27:var x=ye;if(!h||Xm(h)){Ae=0,zt=null;var T=x.sibling;if(T!==null)ye=T;else{var H=x.return;H!==null?(ye=H,ti(H)):ye=null}break t}}Ae=0,zt=null,In(e,t,d,5);break;case 6:Ae=0,zt=null,In(e,t,d,6);break;case 8:pc(),Ge=6;break e;default:throw Error(i(462))}}xh();break}catch(U){sm(e,U)}while(!0);return ha=on=null,N.H=n,N.A=r,Ee=a,ye!==null?0:(we=null,be=0,Sl(),Ge)}function xh(){for(;ye!==null&&!oa();)rm(ye)}function rm(e){var t=Hd(e.alternate,e,ja);e.memoizedProps=e.pendingProps,t===null?ti(e):ye=t}function cm(e){var t=e,a=t.alternate;switch(t.tag){case 15:case 0:t=Nd(a,t,t.pendingProps,t.type,void 0,be);break;case 11:t=Nd(a,t,t.pendingProps,t.type.render,t.ref,be);break;case 5:qr(t);default:wd(a,t),t=ye=ou(t,ja),t=Hd(a,t,ja)}e.memoizedProps=e.pendingProps,t===null?ti(e):ye=t}function In(e,t,a,n){ha=on=null,qr(t),Gn=null,zs=0;var r=t.return;try{if(ch(e,r,t,a,be)){Ge=1,Yl(e,Bt(a,e.current)),ye=null;return}}catch(d){if(r!==null)throw ye=r,d;Ge=1,Yl(e,Bt(a,e.current)),ye=null;return}t.flags&32768?(Te||n===1?e=!0:Yn||(be&536870912)!==0?e=!1:(Ua=e=!0,(n===2||n===9||n===3||n===6)&&(n=Gt.current,n!==null&&n.tag===13&&(n.flags|=16384))),om(t,e)):ti(t)}function ti(e){var t=e;do{if((t.flags&32768)!==0){om(t,Ua);return}e=t.return;var a=uh(t.alternate,t,ja);if(a!==null){ye=a;return}if(t=t.sibling,t!==null){ye=t;return}ye=t=e}while(t!==null);Ge===0&&(Ge=5)}function om(e,t){do{var a=dh(e.alternate,e);if(a!==null){a.flags&=32767,ye=a;return}if(a=e.return,a!==null&&(a.flags|=32768,a.subtreeFlags=0,a.deletions=null),!t&&(e=e.sibling,e!==null)){ye=e;return}ye=e=a}while(e!==null);Ge=6,ye=null}function um(e,t,a,n,r,d,h,x,T){e.cancelPendingCommit=null;do ai();while(rt!==0);if((Ee&6)!==0)throw Error(i(327));if(t!==null){if(t===e.current)throw Error(i(177));if(d=t.lanes|t.childLanes,d|=ir,If(e,a,d,h,x,T),e===we&&(ye=we=null,be=0),Zn=t,Va=e,Kn=a,dc=d,mc=r,em=n,(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,jh(rl,function(){return hm(),null})):(e.callbackNode=null,e.callbackPriority=0),n=(t.flags&13878)!==0,(t.subtreeFlags&13878)!==0||n){n=N.T,N.T=null,r=G.p,G.p=2,h=Ee,Ee|=4;try{mh(e,t,a)}finally{Ee=h,G.p=r,N.T=n}}rt=1,dm(),mm(),fm()}}function dm(){if(rt===1){rt=0;var e=Va,t=Zn,a=(t.flags&13878)!==0;if((t.subtreeFlags&13878)!==0||a){a=N.T,N.T=null;var n=G.p;G.p=2;var r=Ee;Ee|=4;try{Qd(t,e);var d=Nc,h=Wo(e.containerInfo),x=d.focusedElem,T=d.selectionRange;if(h!==x&&x&&x.ownerDocument&&Fo(x.ownerDocument.documentElement,x)){if(T!==null&&tr(x)){var H=T.start,U=T.end;if(U===void 0&&(U=H),"selectionStart"in x)x.selectionStart=H,x.selectionEnd=Math.min(U,x.value.length);else{var $=x.ownerDocument||document,O=$&&$.defaultView||window;if(O.getSelection){var L=O.getSelection(),fe=x.textContent.length,ue=Math.min(T.start,fe),ze=T.end===void 0?ue:Math.min(T.end,fe);!L.extend&&ue>ze&&(h=ze,ze=ue,ue=h);var R=Io(x,ue),M=Io(x,ze);if(R&&M&&(L.rangeCount!==1||L.anchorNode!==R.node||L.anchorOffset!==R.offset||L.focusNode!==M.node||L.focusOffset!==M.offset)){var z=$.createRange();z.setStart(R.node,R.offset),L.removeAllRanges(),ue>ze?(L.addRange(z),L.extend(M.node,M.offset)):(z.setEnd(M.node,M.offset),L.addRange(z))}}}}for($=[],L=x;L=L.parentNode;)L.nodeType===1&&$.push({element:L,left:L.scrollLeft,top:L.scrollTop});for(typeof x.focus=="function"&&x.focus(),x=0;x<$.length;x++){var V=$[x];V.element.scrollLeft=V.left,V.element.scrollTop=V.top}}pi=!!Cc,Nc=Cc=null}finally{Ee=r,G.p=n,N.T=a}}e.current=t,rt=2}}function mm(){if(rt===2){rt=0;var e=Va,t=Zn,a=(t.flags&8772)!==0;if((t.subtreeFlags&8772)!==0||a){a=N.T,N.T=null;var n=G.p;G.p=2;var r=Ee;Ee|=4;try{Xd(e,t.alternate,t)}finally{Ee=r,G.p=n,N.T=a}}rt=3}}function fm(){if(rt===4||rt===3){rt=0,ta();var e=Va,t=Zn,a=Kn,n=em;(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?rt=5:(rt=0,Zn=Va=null,pm(e,e.pendingLanes));var r=e.pendingLanes;if(r===0&&(Xa=null),Hi(a),t=t.stateNode,Ct&&typeof Ct.onCommitFiberRoot=="function")try{Ct.onCommitFiberRoot(ss,t,void 0,(t.current.flags&128)===128)}catch{}if(n!==null){t=N.T,r=G.p,G.p=2,N.T=null;try{for(var d=e.onRecoverableError,h=0;h<n.length;h++){var x=n[h];d(x.value,{componentStack:x.stack})}}finally{N.T=t,G.p=r}}(Kn&3)!==0&&ai(),ia(e),r=e.pendingLanes,(a&4194090)!==0&&(r&42)!==0?e===fc?Gs++:(Gs=0,fc=e):Gs=0,Xs(0)}}function pm(e,t){(e.pooledCacheLanes&=t)===0&&(t=e.pooledCache,t!=null&&(e.pooledCache=null,Ss(t)))}function ai(e){return dm(),mm(),fm(),hm()}function hm(){if(rt!==5)return!1;var e=Va,t=dc;dc=0;var a=Hi(Kn),n=N.T,r=G.p;try{G.p=32>a?32:a,N.T=null,a=mc,mc=null;var d=Va,h=Kn;if(rt=0,Zn=Va=null,Kn=0,(Ee&6)!==0)throw Error(i(331));var x=Ee;if(Ee|=4,Fd(d.current),Kd(d,d.current,h,a),Ee=x,Xs(0,!1),Ct&&typeof Ct.onPostCommitFiberRoot=="function")try{Ct.onPostCommitFiberRoot(ss,d)}catch{}return!0}finally{G.p=r,N.T=n,pm(e,t)}}function gm(e,t,a){t=Bt(a,t),t=$r(e.stateNode,t,2),e=Ha(e,t,2),e!==null&&(is(e,2),ia(e))}function He(e,t,a){if(e.tag===3)gm(e,e,a);else for(;t!==null;){if(t.tag===3){gm(t,e,a);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Xa===null||!Xa.has(n))){e=Bt(a,e),a=bd(2),n=Ha(t,a,2),n!==null&&(_d(a,n,t,e),is(n,2),ia(n));break}}t=t.return}}function vc(e,t,a){var n=e.pingCache;if(n===null){n=e.pingCache=new hh;var r=new Set;n.set(t,r)}else r=n.get(t),r===void 0&&(r=new Set,n.set(t,r));r.has(a)||(rc=!0,r.add(a),e=bh.bind(null,e,t,a),t.then(e,e))}function bh(e,t,a){var n=e.pingCache;n!==null&&n.delete(t),e.pingedLanes|=e.suspendedLanes&a,e.warmLanes&=~a,we===e&&(be&a)===a&&(Ge===4||Ge===3&&(be&62914560)===be&&300>vt()-uc?(Ee&2)===0&&Jn(e,0):cc|=a,Qn===be&&(Qn=0)),ia(e)}function vm(e,t){t===0&&(t=fo()),e=Rn(e,t),e!==null&&(is(e,t),ia(e))}function _h(e){var t=e.memoizedState,a=0;t!==null&&(a=t.retryLane),vm(e,a)}function Sh(e,t){var a=0;switch(e.tag){case 13:var n=e.stateNode,r=e.memoizedState;r!==null&&(a=r.retryLane);break;case 19:n=e.stateNode;break;case 22:n=e.stateNode._retryCache;break;default:throw Error(i(314))}n!==null&&n.delete(t),vm(e,a)}function jh(e,t){return Xe(e,t)}var ni=null,Fn=null,yc=!1,si=!1,xc=!1,gn=0;function ia(e){e!==Fn&&e.next===null&&(Fn===null?ni=Fn=e:Fn=Fn.next=e),si=!0,yc||(yc=!0,Eh())}function Xs(e,t){if(!xc&&si){xc=!0;do for(var a=!1,n=ni;n!==null;){if(e!==0){var r=n.pendingLanes;if(r===0)var d=0;else{var h=n.suspendedLanes,x=n.pingedLanes;d=(1<<31-Nt(42|e)+1)-1,d&=r&~(h&~x),d=d&201326741?d&201326741|1:d?d|2:0}d!==0&&(a=!0,_m(n,d))}else d=be,d=ul(n,n===we?d:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),(d&3)===0||ls(n,d)||(a=!0,_m(n,d));n=n.next}while(a);xc=!1}}function Th(){ym()}function ym(){si=yc=!1;var e=0;gn!==0&&(zh()&&(e=gn),gn=0);for(var t=vt(),a=null,n=ni;n!==null;){var r=n.next,d=xm(n,t);d===0?(n.next=null,a===null?ni=r:a.next=r,r===null&&(Fn=a)):(a=n,(e!==0||(d&3)!==0)&&(si=!0)),n=r}Xs(e)}function xm(e,t){for(var a=e.suspendedLanes,n=e.pingedLanes,r=e.expirationTimes,d=e.pendingLanes&-62914561;0<d;){var h=31-Nt(d),x=1<<h,T=r[h];T===-1?((x&a)===0||(x&n)!==0)&&(r[h]=Jf(x,t)):T<=t&&(e.expiredLanes|=x),d&=~x}if(t=we,a=be,a=ul(e,e===t?a:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),n=e.callbackNode,a===0||e===t&&(Ae===2||Ae===9)||e.cancelPendingCommit!==null)return n!==null&&n!==null&&Zt(n),e.callbackNode=null,e.callbackPriority=0;if((a&3)===0||ls(e,a)){if(t=a&-a,t===e.callbackPriority)return t;switch(n!==null&&Zt(n),Hi(a)){case 2:case 8:a=oo;break;case 32:a=rl;break;case 268435456:a=uo;break;default:a=rl}return n=bm.bind(null,e),a=Xe(a,n),e.callbackPriority=t,e.callbackNode=a,t}return n!==null&&n!==null&&Zt(n),e.callbackPriority=2,e.callbackNode=null,2}function bm(e,t){if(rt!==0&&rt!==5)return e.callbackNode=null,e.callbackPriority=0,null;var a=e.callbackNode;if(ai()&&e.callbackNode!==a)return null;var n=be;return n=ul(e,e===we?n:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),n===0?null:(am(e,n,t),xm(e,vt()),e.callbackNode!=null&&e.callbackNode===a?bm.bind(null,e):null)}function _m(e,t){if(ai())return null;am(e,t,!0)}function Eh(){Oh(function(){(Ee&6)!==0?Xe(co,Th):ym()})}function bc(){return gn===0&&(gn=mo()),gn}function Sm(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:hl(""+e)}function jm(e,t){var a=t.ownerDocument.createElement("input");return a.name=t.name,a.value=t.value,e.id&&a.setAttribute("form",e.id),t.parentNode.insertBefore(a,t),e=new FormData(e),a.parentNode.removeChild(a),e}function Ah(e,t,a,n,r){if(t==="submit"&&a&&a.stateNode===r){var d=Sm((r[yt]||null).action),h=n.submitter;h&&(t=(t=h[yt]||null)?Sm(t.formAction):h.getAttribute("formAction"),t!==null&&(d=t,h=null));var x=new xl("action","action",null,n,r);e.push({event:x,listeners:[{instance:null,listener:function(){if(n.defaultPrevented){if(gn!==0){var T=h?jm(r,h):new FormData(r);Pr(a,{pending:!0,data:T,method:r.method,action:d},null,T)}}else typeof d=="function"&&(x.preventDefault(),T=h?jm(r,h):new FormData(r),Pr(a,{pending:!0,data:T,method:r.method,action:d},d,T))},currentTarget:r}]})}}for(var _c=0;_c<lr.length;_c++){var Sc=lr[_c],Ch=Sc.toLowerCase(),Nh=Sc[0].toUpperCase()+Sc.slice(1);Kt(Ch,"on"+Nh)}Kt(au,"onAnimationEnd"),Kt(nu,"onAnimationIteration"),Kt(su,"onAnimationStart"),Kt("dblclick","onDoubleClick"),Kt("focusin","onFocus"),Kt("focusout","onBlur"),Kt($p,"onTransitionRun"),Kt(Yp,"onTransitionStart"),Kt(Qp,"onTransitionCancel"),Kt(lu,"onTransitionEnd"),Sn("onMouseEnter",["mouseout","mouseover"]),Sn("onMouseLeave",["mouseout","mouseover"]),Sn("onPointerEnter",["pointerout","pointerover"]),Sn("onPointerLeave",["pointerout","pointerover"]),Wa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Wa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Wa("onBeforeInput",["compositionend","keypress","textInput","paste"]),Wa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Wa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Wa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Vs="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Mh=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Vs));function Tm(e,t){t=(t&4)!==0;for(var a=0;a<e.length;a++){var n=e[a],r=n.event;n=n.listeners;e:{var d=void 0;if(t)for(var h=n.length-1;0<=h;h--){var x=n[h],T=x.instance,H=x.currentTarget;if(x=x.listener,T!==d&&r.isPropagationStopped())break e;d=x,r.currentTarget=H;try{d(r)}catch(U){$l(U)}r.currentTarget=null,d=T}else for(h=0;h<n.length;h++){if(x=n[h],T=x.instance,H=x.currentTarget,x=x.listener,T!==d&&r.isPropagationStopped())break e;d=x,r.currentTarget=H;try{d(r)}catch(U){$l(U)}r.currentTarget=null,d=T}}}}function xe(e,t){var a=t[Oi];a===void 0&&(a=t[Oi]=new Set);var n=e+"__bubble";a.has(n)||(Em(t,e,2,!1),a.add(n))}function jc(e,t,a){var n=0;t&&(n|=4),Em(a,e,n,t)}var li="_reactListening"+Math.random().toString(36).slice(2);function Tc(e){if(!e[li]){e[li]=!0,yo.forEach(function(a){a!=="selectionchange"&&(Mh.has(a)||jc(a,!1,e),jc(a,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[li]||(t[li]=!0,jc("selectionchange",!1,t))}}function Em(e,t,a,n){switch(Km(t)){case 2:var r=ag;break;case 8:r=ng;break;default:r=Bc}a=r.bind(null,t,a,e),r=void 0,!Yi||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(r=!0),n?r!==void 0?e.addEventListener(t,a,{capture:!0,passive:r}):e.addEventListener(t,a,!0):r!==void 0?e.addEventListener(t,a,{passive:r}):e.addEventListener(t,a,!1)}function Ec(e,t,a,n,r){var d=n;if((t&1)===0&&(t&2)===0&&n!==null)e:for(;;){if(n===null)return;var h=n.tag;if(h===3||h===4){var x=n.stateNode.containerInfo;if(x===r)break;if(h===4)for(h=n.return;h!==null;){var T=h.tag;if((T===3||T===4)&&h.stateNode.containerInfo===r)return;h=h.return}for(;x!==null;){if(h=xn(x),h===null)return;if(T=h.tag,T===5||T===6||T===26||T===27){n=d=h;continue e}x=x.parentNode}}n=n.return}Ro(function(){var H=d,U=Vi(a),$=[];e:{var O=iu.get(e);if(O!==void 0){var L=xl,fe=e;switch(e){case"keypress":if(vl(a)===0)break e;case"keydown":case"keyup":L=jp;break;case"focusin":fe="focus",L=Ji;break;case"focusout":fe="blur",L=Ji;break;case"beforeblur":case"afterblur":L=Ji;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":L=Oo;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":L=dp;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":L=Ap;break;case au:case nu:case su:L=pp;break;case lu:L=Np;break;case"scroll":case"scrollend":L=op;break;case"wheel":L=Dp;break;case"copy":case"cut":case"paste":L=gp;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":L=Lo;break;case"toggle":case"beforetoggle":L=Rp}var ue=(t&4)!==0,ze=!ue&&(e==="scroll"||e==="scrollend"),R=ue?O!==null?O+"Capture":null:O;ue=[];for(var M=H,z;M!==null;){var V=M;if(z=V.stateNode,V=V.tag,V!==5&&V!==26&&V!==27||z===null||R===null||(V=os(M,R),V!=null&&ue.push($s(M,V,z))),ze)break;M=M.return}0<ue.length&&(O=new L(O,fe,null,a,U),$.push({event:O,listeners:ue}))}}if((t&7)===0){e:{if(O=e==="mouseover"||e==="pointerover",L=e==="mouseout"||e==="pointerout",O&&a!==Xi&&(fe=a.relatedTarget||a.fromElement)&&(xn(fe)||fe[yn]))break e;if((L||O)&&(O=U.window===U?U:(O=U.ownerDocument)?O.defaultView||O.parentWindow:window,L?(fe=a.relatedTarget||a.toElement,L=H,fe=fe?xn(fe):null,fe!==null&&(ze=m(fe),ue=fe.tag,fe!==ze||ue!==5&&ue!==27&&ue!==6)&&(fe=null)):(L=null,fe=H),L!==fe)){if(ue=Oo,V="onMouseLeave",R="onMouseEnter",M="mouse",(e==="pointerout"||e==="pointerover")&&(ue=Lo,V="onPointerLeave",R="onPointerEnter",M="pointer"),ze=L==null?O:cs(L),z=fe==null?O:cs(fe),O=new ue(V,M+"leave",L,a,U),O.target=ze,O.relatedTarget=z,V=null,xn(U)===H&&(ue=new ue(R,M+"enter",fe,a,U),ue.target=z,ue.relatedTarget=ze,V=ue),ze=V,L&&fe)t:{for(ue=L,R=fe,M=0,z=ue;z;z=Wn(z))M++;for(z=0,V=R;V;V=Wn(V))z++;for(;0<M-z;)ue=Wn(ue),M--;for(;0<z-M;)R=Wn(R),z--;for(;M--;){if(ue===R||R!==null&&ue===R.alternate)break t;ue=Wn(ue),R=Wn(R)}ue=null}else ue=null;L!==null&&Am($,O,L,ue,!1),fe!==null&&ze!==null&&Am($,ze,fe,ue,!0)}}e:{if(O=H?cs(H):window,L=O.nodeName&&O.nodeName.toLowerCase(),L==="select"||L==="input"&&O.type==="file")var ne=$o;else if(Xo(O))if(Yo)ne=Gp;else{ne=Pp;var ve=kp}else L=O.nodeName,!L||L.toLowerCase()!=="input"||O.type!=="checkbox"&&O.type!=="radio"?H&&Gi(H.elementType)&&(ne=$o):ne=Up;if(ne&&(ne=ne(e,H))){Vo($,ne,a,U);break e}ve&&ve(e,O,H),e==="focusout"&&H&&O.type==="number"&&H.memoizedProps.value!=null&&Ui(O,"number",O.value)}switch(ve=H?cs(H):window,e){case"focusin":(Xo(ve)||ve.contentEditable==="true")&&(Mn=ve,ar=H,vs=null);break;case"focusout":vs=ar=Mn=null;break;case"mousedown":nr=!0;break;case"contextmenu":case"mouseup":case"dragend":nr=!1,eu($,a,U);break;case"selectionchange":if(Vp)break;case"keydown":case"keyup":eu($,a,U)}var ce;if(Fi)e:{switch(e){case"compositionstart":var de="onCompositionStart";break e;case"compositionend":de="onCompositionEnd";break e;case"compositionupdate":de="onCompositionUpdate";break e}de=void 0}else Nn?Uo(e,a)&&(de="onCompositionEnd"):e==="keydown"&&a.keyCode===229&&(de="onCompositionStart");de&&(Bo&&a.locale!=="ko"&&(Nn||de!=="onCompositionStart"?de==="onCompositionEnd"&&Nn&&(ce=zo()):(Da=U,Qi="value"in Da?Da.value:Da.textContent,Nn=!0)),ve=ii(H,de),0<ve.length&&(de=new wo(de,e,null,a,U),$.push({event:de,listeners:ve}),ce?de.data=ce:(ce=Go(a),ce!==null&&(de.data=ce)))),(ce=Hp?Op(e,a):wp(e,a))&&(de=ii(H,"onBeforeInput"),0<de.length&&(ve=new wo("onBeforeInput","beforeinput",null,a,U),$.push({event:ve,listeners:de}),ve.data=ce)),Ah($,e,H,a,U)}Tm($,t)})}function $s(e,t,a){return{instance:e,listener:t,currentTarget:a}}function ii(e,t){for(var a=t+"Capture",n=[];e!==null;){var r=e,d=r.stateNode;if(r=r.tag,r!==5&&r!==26&&r!==27||d===null||(r=os(e,a),r!=null&&n.unshift($s(e,r,d)),r=os(e,t),r!=null&&n.push($s(e,r,d))),e.tag===3)return n;e=e.return}return[]}function Wn(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function Am(e,t,a,n,r){for(var d=t._reactName,h=[];a!==null&&a!==n;){var x=a,T=x.alternate,H=x.stateNode;if(x=x.tag,T!==null&&T===n)break;x!==5&&x!==26&&x!==27||H===null||(T=H,r?(H=os(a,d),H!=null&&h.unshift($s(a,H,T))):r||(H=os(a,d),H!=null&&h.push($s(a,H,T)))),a=a.return}h.length!==0&&e.push({event:t,listeners:h})}var Dh=/\r\n?/g,qh=/\u0000|\uFFFD/g;function Cm(e){return(typeof e=="string"?e:""+e).replace(Dh,`
`).replace(qh,"")}function Nm(e,t){return t=Cm(t),Cm(e)===t}function ri(){}function Re(e,t,a,n,r,d){switch(a){case"children":typeof n=="string"?t==="body"||t==="textarea"&&n===""||En(e,n):(typeof n=="number"||typeof n=="bigint")&&t!=="body"&&En(e,""+n);break;case"className":ml(e,"class",n);break;case"tabIndex":ml(e,"tabindex",n);break;case"dir":case"role":case"viewBox":case"width":case"height":ml(e,a,n);break;case"style":Do(e,n,d);break;case"data":if(t!=="object"){ml(e,"data",n);break}case"src":case"href":if(n===""&&(t!=="a"||a!=="href")){e.removeAttribute(a);break}if(n==null||typeof n=="function"||typeof n=="symbol"||typeof n=="boolean"){e.removeAttribute(a);break}n=hl(""+n),e.setAttribute(a,n);break;case"action":case"formAction":if(typeof n=="function"){e.setAttribute(a,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof d=="function"&&(a==="formAction"?(t!=="input"&&Re(e,t,"name",r.name,r,null),Re(e,t,"formEncType",r.formEncType,r,null),Re(e,t,"formMethod",r.formMethod,r,null),Re(e,t,"formTarget",r.formTarget,r,null)):(Re(e,t,"encType",r.encType,r,null),Re(e,t,"method",r.method,r,null),Re(e,t,"target",r.target,r,null)));if(n==null||typeof n=="symbol"||typeof n=="boolean"){e.removeAttribute(a);break}n=hl(""+n),e.setAttribute(a,n);break;case"onClick":n!=null&&(e.onclick=ri);break;case"onScroll":n!=null&&xe("scroll",e);break;case"onScrollEnd":n!=null&&xe("scrollend",e);break;case"dangerouslySetInnerHTML":if(n!=null){if(typeof n!="object"||!("__html"in n))throw Error(i(61));if(a=n.__html,a!=null){if(r.children!=null)throw Error(i(60));e.innerHTML=a}}break;case"multiple":e.multiple=n&&typeof n!="function"&&typeof n!="symbol";break;case"muted":e.muted=n&&typeof n!="function"&&typeof n!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(n==null||typeof n=="function"||typeof n=="boolean"||typeof n=="symbol"){e.removeAttribute("xlink:href");break}a=hl(""+n),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",a);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":n!=null&&typeof n!="function"&&typeof n!="symbol"?e.setAttribute(a,""+n):e.removeAttribute(a);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":n&&typeof n!="function"&&typeof n!="symbol"?e.setAttribute(a,""):e.removeAttribute(a);break;case"capture":case"download":n===!0?e.setAttribute(a,""):n!==!1&&n!=null&&typeof n!="function"&&typeof n!="symbol"?e.setAttribute(a,n):e.removeAttribute(a);break;case"cols":case"rows":case"size":case"span":n!=null&&typeof n!="function"&&typeof n!="symbol"&&!isNaN(n)&&1<=n?e.setAttribute(a,n):e.removeAttribute(a);break;case"rowSpan":case"start":n==null||typeof n=="function"||typeof n=="symbol"||isNaN(n)?e.removeAttribute(a):e.setAttribute(a,n);break;case"popover":xe("beforetoggle",e),xe("toggle",e),dl(e,"popover",n);break;case"xlinkActuate":ua(e,"http://www.w3.org/1999/xlink","xlink:actuate",n);break;case"xlinkArcrole":ua(e,"http://www.w3.org/1999/xlink","xlink:arcrole",n);break;case"xlinkRole":ua(e,"http://www.w3.org/1999/xlink","xlink:role",n);break;case"xlinkShow":ua(e,"http://www.w3.org/1999/xlink","xlink:show",n);break;case"xlinkTitle":ua(e,"http://www.w3.org/1999/xlink","xlink:title",n);break;case"xlinkType":ua(e,"http://www.w3.org/1999/xlink","xlink:type",n);break;case"xmlBase":ua(e,"http://www.w3.org/XML/1998/namespace","xml:base",n);break;case"xmlLang":ua(e,"http://www.w3.org/XML/1998/namespace","xml:lang",n);break;case"xmlSpace":ua(e,"http://www.w3.org/XML/1998/namespace","xml:space",n);break;case"is":dl(e,"is",n);break;case"innerText":case"textContent":break;default:(!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N")&&(a=rp.get(a)||a,dl(e,a,n))}}function Ac(e,t,a,n,r,d){switch(a){case"style":Do(e,n,d);break;case"dangerouslySetInnerHTML":if(n!=null){if(typeof n!="object"||!("__html"in n))throw Error(i(61));if(a=n.__html,a!=null){if(r.children!=null)throw Error(i(60));e.innerHTML=a}}break;case"children":typeof n=="string"?En(e,n):(typeof n=="number"||typeof n=="bigint")&&En(e,""+n);break;case"onScroll":n!=null&&xe("scroll",e);break;case"onScrollEnd":n!=null&&xe("scrollend",e);break;case"onClick":n!=null&&(e.onclick=ri);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!xo.hasOwnProperty(a))e:{if(a[0]==="o"&&a[1]==="n"&&(r=a.endsWith("Capture"),t=a.slice(2,r?a.length-7:void 0),d=e[yt]||null,d=d!=null?d[a]:null,typeof d=="function"&&e.removeEventListener(t,d,r),typeof n=="function")){typeof d!="function"&&d!==null&&(a in e?e[a]=null:e.hasAttribute(a)&&e.removeAttribute(a)),e.addEventListener(t,n,r);break e}a in e?e[a]=n:n===!0?e.setAttribute(a,""):dl(e,a,n)}}}function ct(e,t,a){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":xe("error",e),xe("load",e);var n=!1,r=!1,d;for(d in a)if(a.hasOwnProperty(d)){var h=a[d];if(h!=null)switch(d){case"src":n=!0;break;case"srcSet":r=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,t));default:Re(e,t,d,h,a,null)}}r&&Re(e,t,"srcSet",a.srcSet,a,null),n&&Re(e,t,"src",a.src,a,null);return;case"input":xe("invalid",e);var x=d=h=r=null,T=null,H=null;for(n in a)if(a.hasOwnProperty(n)){var U=a[n];if(U!=null)switch(n){case"name":r=U;break;case"type":h=U;break;case"checked":T=U;break;case"defaultChecked":H=U;break;case"value":d=U;break;case"defaultValue":x=U;break;case"children":case"dangerouslySetInnerHTML":if(U!=null)throw Error(i(137,t));break;default:Re(e,t,n,U,a,null)}}Ao(e,d,x,T,H,h,r,!1),fl(e);return;case"select":xe("invalid",e),n=h=d=null;for(r in a)if(a.hasOwnProperty(r)&&(x=a[r],x!=null))switch(r){case"value":d=x;break;case"defaultValue":h=x;break;case"multiple":n=x;default:Re(e,t,r,x,a,null)}t=d,a=h,e.multiple=!!n,t!=null?Tn(e,!!n,t,!1):a!=null&&Tn(e,!!n,a,!0);return;case"textarea":xe("invalid",e),d=r=n=null;for(h in a)if(a.hasOwnProperty(h)&&(x=a[h],x!=null))switch(h){case"value":n=x;break;case"defaultValue":r=x;break;case"children":d=x;break;case"dangerouslySetInnerHTML":if(x!=null)throw Error(i(91));break;default:Re(e,t,h,x,a,null)}No(e,n,r,d),fl(e);return;case"option":for(T in a)if(a.hasOwnProperty(T)&&(n=a[T],n!=null))switch(T){case"selected":e.selected=n&&typeof n!="function"&&typeof n!="symbol";break;default:Re(e,t,T,n,a,null)}return;case"dialog":xe("beforetoggle",e),xe("toggle",e),xe("cancel",e),xe("close",e);break;case"iframe":case"object":xe("load",e);break;case"video":case"audio":for(n=0;n<Vs.length;n++)xe(Vs[n],e);break;case"image":xe("error",e),xe("load",e);break;case"details":xe("toggle",e);break;case"embed":case"source":case"link":xe("error",e),xe("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(H in a)if(a.hasOwnProperty(H)&&(n=a[H],n!=null))switch(H){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,t));default:Re(e,t,H,n,a,null)}return;default:if(Gi(t)){for(U in a)a.hasOwnProperty(U)&&(n=a[U],n!==void 0&&Ac(e,t,U,n,a,void 0));return}}for(x in a)a.hasOwnProperty(x)&&(n=a[x],n!=null&&Re(e,t,x,n,a,null))}function Rh(e,t,a,n){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var r=null,d=null,h=null,x=null,T=null,H=null,U=null;for(L in a){var $=a[L];if(a.hasOwnProperty(L)&&$!=null)switch(L){case"checked":break;case"value":break;case"defaultValue":T=$;default:n.hasOwnProperty(L)||Re(e,t,L,null,n,$)}}for(var O in n){var L=n[O];if($=a[O],n.hasOwnProperty(O)&&(L!=null||$!=null))switch(O){case"type":d=L;break;case"name":r=L;break;case"checked":H=L;break;case"defaultChecked":U=L;break;case"value":h=L;break;case"defaultValue":x=L;break;case"children":case"dangerouslySetInnerHTML":if(L!=null)throw Error(i(137,t));break;default:L!==$&&Re(e,t,O,L,n,$)}}Pi(e,h,x,T,H,U,d,r);return;case"select":L=h=x=O=null;for(d in a)if(T=a[d],a.hasOwnProperty(d)&&T!=null)switch(d){case"value":break;case"multiple":L=T;default:n.hasOwnProperty(d)||Re(e,t,d,null,n,T)}for(r in n)if(d=n[r],T=a[r],n.hasOwnProperty(r)&&(d!=null||T!=null))switch(r){case"value":O=d;break;case"defaultValue":x=d;break;case"multiple":h=d;default:d!==T&&Re(e,t,r,d,n,T)}t=x,a=h,n=L,O!=null?Tn(e,!!a,O,!1):!!n!=!!a&&(t!=null?Tn(e,!!a,t,!0):Tn(e,!!a,a?[]:"",!1));return;case"textarea":L=O=null;for(x in a)if(r=a[x],a.hasOwnProperty(x)&&r!=null&&!n.hasOwnProperty(x))switch(x){case"value":break;case"children":break;default:Re(e,t,x,null,n,r)}for(h in n)if(r=n[h],d=a[h],n.hasOwnProperty(h)&&(r!=null||d!=null))switch(h){case"value":O=r;break;case"defaultValue":L=r;break;case"children":break;case"dangerouslySetInnerHTML":if(r!=null)throw Error(i(91));break;default:r!==d&&Re(e,t,h,r,n,d)}Co(e,O,L);return;case"option":for(var fe in a)if(O=a[fe],a.hasOwnProperty(fe)&&O!=null&&!n.hasOwnProperty(fe))switch(fe){case"selected":e.selected=!1;break;default:Re(e,t,fe,null,n,O)}for(T in n)if(O=n[T],L=a[T],n.hasOwnProperty(T)&&O!==L&&(O!=null||L!=null))switch(T){case"selected":e.selected=O&&typeof O!="function"&&typeof O!="symbol";break;default:Re(e,t,T,O,n,L)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ue in a)O=a[ue],a.hasOwnProperty(ue)&&O!=null&&!n.hasOwnProperty(ue)&&Re(e,t,ue,null,n,O);for(H in n)if(O=n[H],L=a[H],n.hasOwnProperty(H)&&O!==L&&(O!=null||L!=null))switch(H){case"children":case"dangerouslySetInnerHTML":if(O!=null)throw Error(i(137,t));break;default:Re(e,t,H,O,n,L)}return;default:if(Gi(t)){for(var ze in a)O=a[ze],a.hasOwnProperty(ze)&&O!==void 0&&!n.hasOwnProperty(ze)&&Ac(e,t,ze,void 0,n,O);for(U in n)O=n[U],L=a[U],!n.hasOwnProperty(U)||O===L||O===void 0&&L===void 0||Ac(e,t,U,O,n,L);return}}for(var R in a)O=a[R],a.hasOwnProperty(R)&&O!=null&&!n.hasOwnProperty(R)&&Re(e,t,R,null,n,O);for($ in n)O=n[$],L=a[$],!n.hasOwnProperty($)||O===L||O==null&&L==null||Re(e,t,$,O,n,L)}var Cc=null,Nc=null;function ci(e){return e.nodeType===9?e:e.ownerDocument}function Mm(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Dm(e,t){if(e===0)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&t==="foreignObject"?0:e}function Mc(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.children=="bigint"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Dc=null;function zh(){var e=window.event;return e&&e.type==="popstate"?e===Dc?!1:(Dc=e,!0):(Dc=null,!1)}var qm=typeof setTimeout=="function"?setTimeout:void 0,Hh=typeof clearTimeout=="function"?clearTimeout:void 0,Rm=typeof Promise=="function"?Promise:void 0,Oh=typeof queueMicrotask=="function"?queueMicrotask:typeof Rm<"u"?function(e){return Rm.resolve(null).then(e).catch(wh)}:qm;function wh(e){setTimeout(function(){throw e})}function Ya(e){return e==="head"}function zm(e,t){var a=t,n=0,r=0;do{var d=a.nextSibling;if(e.removeChild(a),d&&d.nodeType===8)if(a=d.data,a==="/$"){if(0<n&&8>n){a=n;var h=e.ownerDocument;if(a&1&&Ys(h.documentElement),a&2&&Ys(h.body),a&4)for(a=h.head,Ys(a),h=a.firstChild;h;){var x=h.nextSibling,T=h.nodeName;h[rs]||T==="SCRIPT"||T==="STYLE"||T==="LINK"&&h.rel.toLowerCase()==="stylesheet"||a.removeChild(h),h=x}}if(r===0){e.removeChild(d),el(t);return}r--}else a==="$"||a==="$?"||a==="$!"?r++:n=a.charCodeAt(0)-48;else n=0;a=d}while(a);el(t)}function qc(e){var t=e.firstChild;for(t&&t.nodeType===10&&(t=t.nextSibling);t;){var a=t;switch(t=t.nextSibling,a.nodeName){case"HTML":case"HEAD":case"BODY":qc(a),wi(a);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(a.rel.toLowerCase()==="stylesheet")continue}e.removeChild(a)}}function Lh(e,t,a,n){for(;e.nodeType===1;){var r=a;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!n&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(n){if(!e[rs])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(d=e.getAttribute("rel"),d==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(d!==r.rel||e.getAttribute("href")!==(r.href==null||r.href===""?null:r.href)||e.getAttribute("crossorigin")!==(r.crossOrigin==null?null:r.crossOrigin)||e.getAttribute("title")!==(r.title==null?null:r.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(d=e.getAttribute("src"),(d!==(r.src==null?null:r.src)||e.getAttribute("type")!==(r.type==null?null:r.type)||e.getAttribute("crossorigin")!==(r.crossOrigin==null?null:r.crossOrigin))&&d&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(t==="input"&&e.type==="hidden"){var d=r.name==null?null:""+r.name;if(r.type==="hidden"&&e.getAttribute("name")===d)return e}else return e;if(e=It(e.nextSibling),e===null)break}return null}function Bh(e,t,a){if(t==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!a||(e=It(e.nextSibling),e===null))return null;return e}function Rc(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState==="complete"}function kh(e,t){var a=e.ownerDocument;if(e.data!=="$?"||a.readyState==="complete")t();else{var n=function(){t(),a.removeEventListener("DOMContentLoaded",n)};a.addEventListener("DOMContentLoaded",n),e._reactRetry=n}}function It(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?"||t==="F!"||t==="F")break;if(t==="/$")return null}}return e}var zc=null;function Hm(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var a=e.data;if(a==="$"||a==="$!"||a==="$?"){if(t===0)return e;t--}else a==="/$"&&t++}e=e.previousSibling}return null}function Om(e,t,a){switch(t=ci(a),e){case"html":if(e=t.documentElement,!e)throw Error(i(452));return e;case"head":if(e=t.head,!e)throw Error(i(453));return e;case"body":if(e=t.body,!e)throw Error(i(454));return e;default:throw Error(i(451))}}function Ys(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);wi(e)}var Vt=new Map,wm=new Set;function oi(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var Ta=G.d;G.d={f:Ph,r:Uh,D:Gh,C:Xh,L:Vh,m:$h,X:Qh,S:Yh,M:Zh};function Ph(){var e=Ta.f(),t=ei();return e||t}function Uh(e){var t=bn(e);t!==null&&t.tag===5&&t.type==="form"?ad(t):Ta.r(e)}var es=typeof document>"u"?null:document;function Lm(e,t,a){var n=es;if(n&&typeof t=="string"&&t){var r=Lt(t);r='link[rel="'+e+'"][href="'+r+'"]',typeof a=="string"&&(r+='[crossorigin="'+a+'"]'),wm.has(r)||(wm.add(r),e={rel:e,crossOrigin:a,href:t},n.querySelector(r)===null&&(t=n.createElement("link"),ct(t,"link",e),We(t),n.head.appendChild(t)))}}function Gh(e){Ta.D(e),Lm("dns-prefetch",e,null)}function Xh(e,t){Ta.C(e,t),Lm("preconnect",e,t)}function Vh(e,t,a){Ta.L(e,t,a);var n=es;if(n&&e&&t){var r='link[rel="preload"][as="'+Lt(t)+'"]';t==="image"&&a&&a.imageSrcSet?(r+='[imagesrcset="'+Lt(a.imageSrcSet)+'"]',typeof a.imageSizes=="string"&&(r+='[imagesizes="'+Lt(a.imageSizes)+'"]')):r+='[href="'+Lt(e)+'"]';var d=r;switch(t){case"style":d=ts(e);break;case"script":d=as(e)}Vt.has(d)||(e=y({rel:"preload",href:t==="image"&&a&&a.imageSrcSet?void 0:e,as:t},a),Vt.set(d,e),n.querySelector(r)!==null||t==="style"&&n.querySelector(Qs(d))||t==="script"&&n.querySelector(Zs(d))||(t=n.createElement("link"),ct(t,"link",e),We(t),n.head.appendChild(t)))}}function $h(e,t){Ta.m(e,t);var a=es;if(a&&e){var n=t&&typeof t.as=="string"?t.as:"script",r='link[rel="modulepreload"][as="'+Lt(n)+'"][href="'+Lt(e)+'"]',d=r;switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":d=as(e)}if(!Vt.has(d)&&(e=y({rel:"modulepreload",href:e},t),Vt.set(d,e),a.querySelector(r)===null)){switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(a.querySelector(Zs(d)))return}n=a.createElement("link"),ct(n,"link",e),We(n),a.head.appendChild(n)}}}function Yh(e,t,a){Ta.S(e,t,a);var n=es;if(n&&e){var r=_n(n).hoistableStyles,d=ts(e);t=t||"default";var h=r.get(d);if(!h){var x={loading:0,preload:null};if(h=n.querySelector(Qs(d)))x.loading=5;else{e=y({rel:"stylesheet",href:e,"data-precedence":t},a),(a=Vt.get(d))&&Hc(e,a);var T=h=n.createElement("link");We(T),ct(T,"link",e),T._p=new Promise(function(H,U){T.onload=H,T.onerror=U}),T.addEventListener("load",function(){x.loading|=1}),T.addEventListener("error",function(){x.loading|=2}),x.loading|=4,ui(h,t,n)}h={type:"stylesheet",instance:h,count:1,state:x},r.set(d,h)}}}function Qh(e,t){Ta.X(e,t);var a=es;if(a&&e){var n=_n(a).hoistableScripts,r=as(e),d=n.get(r);d||(d=a.querySelector(Zs(r)),d||(e=y({src:e,async:!0},t),(t=Vt.get(r))&&Oc(e,t),d=a.createElement("script"),We(d),ct(d,"link",e),a.head.appendChild(d)),d={type:"script",instance:d,count:1,state:null},n.set(r,d))}}function Zh(e,t){Ta.M(e,t);var a=es;if(a&&e){var n=_n(a).hoistableScripts,r=as(e),d=n.get(r);d||(d=a.querySelector(Zs(r)),d||(e=y({src:e,async:!0,type:"module"},t),(t=Vt.get(r))&&Oc(e,t),d=a.createElement("script"),We(d),ct(d,"link",e),a.head.appendChild(d)),d={type:"script",instance:d,count:1,state:null},n.set(r,d))}}function Bm(e,t,a,n){var r=(r=me.current)?oi(r):null;if(!r)throw Error(i(446));switch(e){case"meta":case"title":return null;case"style":return typeof a.precedence=="string"&&typeof a.href=="string"?(t=ts(a.href),a=_n(r).hoistableStyles,n=a.get(t),n||(n={type:"style",instance:null,count:0,state:null},a.set(t,n)),n):{type:"void",instance:null,count:0,state:null};case"link":if(a.rel==="stylesheet"&&typeof a.href=="string"&&typeof a.precedence=="string"){e=ts(a.href);var d=_n(r).hoistableStyles,h=d.get(e);if(h||(r=r.ownerDocument||r,h={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},d.set(e,h),(d=r.querySelector(Qs(e)))&&!d._p&&(h.instance=d,h.state.loading=5),Vt.has(e)||(a={rel:"preload",as:"style",href:a.href,crossOrigin:a.crossOrigin,integrity:a.integrity,media:a.media,hrefLang:a.hrefLang,referrerPolicy:a.referrerPolicy},Vt.set(e,a),d||Kh(r,e,a,h.state))),t&&n===null)throw Error(i(528,""));return h}if(t&&n!==null)throw Error(i(529,""));return null;case"script":return t=a.async,a=a.src,typeof a=="string"&&t&&typeof t!="function"&&typeof t!="symbol"?(t=as(a),a=_n(r).hoistableScripts,n=a.get(t),n||(n={type:"script",instance:null,count:0,state:null},a.set(t,n)),n):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,e))}}function ts(e){return'href="'+Lt(e)+'"'}function Qs(e){return'link[rel="stylesheet"]['+e+"]"}function km(e){return y({},e,{"data-precedence":e.precedence,precedence:null})}function Kh(e,t,a,n){e.querySelector('link[rel="preload"][as="style"]['+t+"]")?n.loading=1:(t=e.createElement("link"),n.preload=t,t.addEventListener("load",function(){return n.loading|=1}),t.addEventListener("error",function(){return n.loading|=2}),ct(t,"link",a),We(t),e.head.appendChild(t))}function as(e){return'[src="'+Lt(e)+'"]'}function Zs(e){return"script[async]"+e}function Pm(e,t,a){if(t.count++,t.instance===null)switch(t.type){case"style":var n=e.querySelector('style[data-href~="'+Lt(a.href)+'"]');if(n)return t.instance=n,We(n),n;var r=y({},a,{"data-href":a.href,"data-precedence":a.precedence,href:null,precedence:null});return n=(e.ownerDocument||e).createElement("style"),We(n),ct(n,"style",r),ui(n,a.precedence,e),t.instance=n;case"stylesheet":r=ts(a.href);var d=e.querySelector(Qs(r));if(d)return t.state.loading|=4,t.instance=d,We(d),d;n=km(a),(r=Vt.get(r))&&Hc(n,r),d=(e.ownerDocument||e).createElement("link"),We(d);var h=d;return h._p=new Promise(function(x,T){h.onload=x,h.onerror=T}),ct(d,"link",n),t.state.loading|=4,ui(d,a.precedence,e),t.instance=d;case"script":return d=as(a.src),(r=e.querySelector(Zs(d)))?(t.instance=r,We(r),r):(n=a,(r=Vt.get(d))&&(n=y({},a),Oc(n,r)),e=e.ownerDocument||e,r=e.createElement("script"),We(r),ct(r,"link",n),e.head.appendChild(r),t.instance=r);case"void":return null;default:throw Error(i(443,t.type))}else t.type==="stylesheet"&&(t.state.loading&4)===0&&(n=t.instance,t.state.loading|=4,ui(n,a.precedence,e));return t.instance}function ui(e,t,a){for(var n=a.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),r=n.length?n[n.length-1]:null,d=r,h=0;h<n.length;h++){var x=n[h];if(x.dataset.precedence===t)d=x;else if(d!==r)break}d?d.parentNode.insertBefore(e,d.nextSibling):(t=a.nodeType===9?a.head:a,t.insertBefore(e,t.firstChild))}function Hc(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.title==null&&(e.title=t.title)}function Oc(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.integrity==null&&(e.integrity=t.integrity)}var di=null;function Um(e,t,a){if(di===null){var n=new Map,r=di=new Map;r.set(a,n)}else r=di,n=r.get(a),n||(n=new Map,r.set(a,n));if(n.has(e))return n;for(n.set(e,null),a=a.getElementsByTagName(e),r=0;r<a.length;r++){var d=a[r];if(!(d[rs]||d[ut]||e==="link"&&d.getAttribute("rel")==="stylesheet")&&d.namespaceURI!=="http://www.w3.org/2000/svg"){var h=d.getAttribute(t)||"";h=e+h;var x=n.get(h);x?x.push(d):n.set(h,[d])}}return n}function Gm(e,t,a){e=e.ownerDocument||e,e.head.insertBefore(a,t==="title"?e.querySelector("head > title"):null)}function Jh(e,t,a){if(a===1||t.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof t.precedence!="string"||typeof t.href!="string"||t.href==="")break;return!0;case"link":if(typeof t.rel!="string"||typeof t.href!="string"||t.href===""||t.onLoad||t.onError)break;switch(t.rel){case"stylesheet":return e=t.disabled,typeof t.precedence=="string"&&e==null;default:return!0}case"script":if(t.async&&typeof t.async!="function"&&typeof t.async!="symbol"&&!t.onLoad&&!t.onError&&t.src&&typeof t.src=="string")return!0}return!1}function Xm(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}var Ks=null;function Ih(){}function Fh(e,t,a){if(Ks===null)throw Error(i(475));var n=Ks;if(t.type==="stylesheet"&&(typeof a.media!="string"||matchMedia(a.media).matches!==!1)&&(t.state.loading&4)===0){if(t.instance===null){var r=ts(a.href),d=e.querySelector(Qs(r));if(d){e=d._p,e!==null&&typeof e=="object"&&typeof e.then=="function"&&(n.count++,n=mi.bind(n),e.then(n,n)),t.state.loading|=4,t.instance=d,We(d);return}d=e.ownerDocument||e,a=km(a),(r=Vt.get(r))&&Hc(a,r),d=d.createElement("link"),We(d);var h=d;h._p=new Promise(function(x,T){h.onload=x,h.onerror=T}),ct(d,"link",a),t.instance=d}n.stylesheets===null&&(n.stylesheets=new Map),n.stylesheets.set(t,e),(e=t.state.preload)&&(t.state.loading&3)===0&&(n.count++,t=mi.bind(n),e.addEventListener("load",t),e.addEventListener("error",t))}}function Wh(){if(Ks===null)throw Error(i(475));var e=Ks;return e.stylesheets&&e.count===0&&wc(e,e.stylesheets),0<e.count?function(t){var a=setTimeout(function(){if(e.stylesheets&&wc(e,e.stylesheets),e.unsuspend){var n=e.unsuspend;e.unsuspend=null,n()}},6e4);return e.unsuspend=t,function(){e.unsuspend=null,clearTimeout(a)}}:null}function mi(){if(this.count--,this.count===0){if(this.stylesheets)wc(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var fi=null;function wc(e,t){e.stylesheets=null,e.unsuspend!==null&&(e.count++,fi=new Map,t.forEach(eg,e),fi=null,mi.call(e))}function eg(e,t){if(!(t.state.loading&4)){var a=fi.get(e);if(a)var n=a.get(null);else{a=new Map,fi.set(e,a);for(var r=e.querySelectorAll("link[data-precedence],style[data-precedence]"),d=0;d<r.length;d++){var h=r[d];(h.nodeName==="LINK"||h.getAttribute("media")!=="not all")&&(a.set(h.dataset.precedence,h),n=h)}n&&a.set(null,n)}r=t.instance,h=r.getAttribute("data-precedence"),d=a.get(h)||n,d===n&&a.set(null,r),a.set(h,r),this.count++,n=mi.bind(this),r.addEventListener("load",n),r.addEventListener("error",n),d?d.parentNode.insertBefore(r,d.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(r,e.firstChild)),t.state.loading|=4}}var Js={$$typeof:B,Provider:null,Consumer:null,_currentValue:Q,_currentValue2:Q,_threadCount:0};function tg(e,t,a,n,r,d,h,x){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ri(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ri(0),this.hiddenUpdates=Ri(null),this.identifierPrefix=n,this.onUncaughtError=r,this.onCaughtError=d,this.onRecoverableError=h,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=x,this.incompleteTransitions=new Map}function Vm(e,t,a,n,r,d,h,x,T,H,U,$){return e=new tg(e,t,a,h,x,T,H,$),t=1,d===!0&&(t|=24),d=Dt(3,null,null,t),e.current=d,d.stateNode=e,t=vr(),t.refCount++,e.pooledCache=t,t.refCount++,d.memoizedState={element:n,isDehydrated:a,cache:t},_r(d),e}function $m(e){return e?(e=zn,e):zn}function Ym(e,t,a,n,r,d){r=$m(r),n.context===null?n.context=r:n.pendingContext=r,n=za(t),n.payload={element:a},d=d===void 0?null:d,d!==null&&(n.callback=d),a=Ha(e,n,t),a!==null&&(Ot(a,e,t),As(a,e,t))}function Qm(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var a=e.retryLane;e.retryLane=a!==0&&a<t?a:t}}function Lc(e,t){Qm(e,t),(e=e.alternate)&&Qm(e,t)}function Zm(e){if(e.tag===13){var t=Rn(e,67108864);t!==null&&Ot(t,e,67108864),Lc(e,67108864)}}var pi=!0;function ag(e,t,a,n){var r=N.T;N.T=null;var d=G.p;try{G.p=2,Bc(e,t,a,n)}finally{G.p=d,N.T=r}}function ng(e,t,a,n){var r=N.T;N.T=null;var d=G.p;try{G.p=8,Bc(e,t,a,n)}finally{G.p=d,N.T=r}}function Bc(e,t,a,n){if(pi){var r=kc(n);if(r===null)Ec(e,t,n,hi,a),Jm(e,n);else if(lg(r,e,t,a,n))n.stopPropagation();else if(Jm(e,n),t&4&&-1<sg.indexOf(e)){for(;r!==null;){var d=bn(r);if(d!==null)switch(d.tag){case 3:if(d=d.stateNode,d.current.memoizedState.isDehydrated){var h=Fa(d.pendingLanes);if(h!==0){var x=d;for(x.pendingLanes|=2,x.entangledLanes|=2;h;){var T=1<<31-Nt(h);x.entanglements[1]|=T,h&=~T}ia(d),(Ee&6)===0&&(Fl=vt()+500,Xs(0))}}break;case 13:x=Rn(d,2),x!==null&&Ot(x,d,2),ei(),Lc(d,2)}if(d=kc(n),d===null&&Ec(e,t,n,hi,a),d===r)break;r=d}r!==null&&n.stopPropagation()}else Ec(e,t,n,null,a)}}function kc(e){return e=Vi(e),Pc(e)}var hi=null;function Pc(e){if(hi=null,e=xn(e),e!==null){var t=m(e);if(t===null)e=null;else{var a=t.tag;if(a===13){if(e=p(t),e!==null)return e;e=null}else if(a===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return hi=e,null}function Km(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(qi()){case co:return 2;case oo:return 8;case rl:case Vf:return 32;case uo:return 268435456;default:return 32}default:return 32}}var Uc=!1,Qa=null,Za=null,Ka=null,Is=new Map,Fs=new Map,Ja=[],sg="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Jm(e,t){switch(e){case"focusin":case"focusout":Qa=null;break;case"dragenter":case"dragleave":Za=null;break;case"mouseover":case"mouseout":Ka=null;break;case"pointerover":case"pointerout":Is.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Fs.delete(t.pointerId)}}function Ws(e,t,a,n,r,d){return e===null||e.nativeEvent!==d?(e={blockedOn:t,domEventName:a,eventSystemFlags:n,nativeEvent:d,targetContainers:[r]},t!==null&&(t=bn(t),t!==null&&Zm(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,r!==null&&t.indexOf(r)===-1&&t.push(r),e)}function lg(e,t,a,n,r){switch(t){case"focusin":return Qa=Ws(Qa,e,t,a,n,r),!0;case"dragenter":return Za=Ws(Za,e,t,a,n,r),!0;case"mouseover":return Ka=Ws(Ka,e,t,a,n,r),!0;case"pointerover":var d=r.pointerId;return Is.set(d,Ws(Is.get(d)||null,e,t,a,n,r)),!0;case"gotpointercapture":return d=r.pointerId,Fs.set(d,Ws(Fs.get(d)||null,e,t,a,n,r)),!0}return!1}function Im(e){var t=xn(e.target);if(t!==null){var a=m(t);if(a!==null){if(t=a.tag,t===13){if(t=p(a),t!==null){e.blockedOn=t,Ff(e.priority,function(){if(a.tag===13){var n=Ht();n=zi(n);var r=Rn(a,n);r!==null&&Ot(r,a,n),Lc(a,n)}});return}}else if(t===3&&a.stateNode.current.memoizedState.isDehydrated){e.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}e.blockedOn=null}function gi(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var a=kc(e.nativeEvent);if(a===null){a=e.nativeEvent;var n=new a.constructor(a.type,a);Xi=n,a.target.dispatchEvent(n),Xi=null}else return t=bn(a),t!==null&&Zm(t),e.blockedOn=a,!1;t.shift()}return!0}function Fm(e,t,a){gi(e)&&a.delete(t)}function ig(){Uc=!1,Qa!==null&&gi(Qa)&&(Qa=null),Za!==null&&gi(Za)&&(Za=null),Ka!==null&&gi(Ka)&&(Ka=null),Is.forEach(Fm),Fs.forEach(Fm)}function vi(e,t){e.blockedOn===t&&(e.blockedOn=null,Uc||(Uc=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,ig)))}var yi=null;function Wm(e){yi!==e&&(yi=e,o.unstable_scheduleCallback(o.unstable_NormalPriority,function(){yi===e&&(yi=null);for(var t=0;t<e.length;t+=3){var a=e[t],n=e[t+1],r=e[t+2];if(typeof n!="function"){if(Pc(n||a)===null)continue;break}var d=bn(a);d!==null&&(e.splice(t,3),t-=3,Pr(d,{pending:!0,data:r,method:a.method,action:n},n,r))}}))}function el(e){function t(T){return vi(T,e)}Qa!==null&&vi(Qa,e),Za!==null&&vi(Za,e),Ka!==null&&vi(Ka,e),Is.forEach(t),Fs.forEach(t);for(var a=0;a<Ja.length;a++){var n=Ja[a];n.blockedOn===e&&(n.blockedOn=null)}for(;0<Ja.length&&(a=Ja[0],a.blockedOn===null);)Im(a),a.blockedOn===null&&Ja.shift();if(a=(e.ownerDocument||e).$$reactFormReplay,a!=null)for(n=0;n<a.length;n+=3){var r=a[n],d=a[n+1],h=r[yt]||null;if(typeof d=="function")h||Wm(a);else if(h){var x=null;if(d&&d.hasAttribute("formAction")){if(r=d,h=d[yt]||null)x=h.formAction;else if(Pc(r)!==null)continue}else x=h.action;typeof x=="function"?a[n+1]=x:(a.splice(n,3),n-=3),Wm(a)}}}function Gc(e){this._internalRoot=e}xi.prototype.render=Gc.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(i(409));var a=t.current,n=Ht();Ym(a,n,e,t,null,null)},xi.prototype.unmount=Gc.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Ym(e.current,2,null,e,null,null),ei(),t[yn]=null}};function xi(e){this._internalRoot=e}xi.prototype.unstable_scheduleHydration=function(e){if(e){var t=go();e={blockedOn:null,target:e,priority:t};for(var a=0;a<Ja.length&&t!==0&&t<Ja[a].priority;a++);Ja.splice(a,0,e),a===0&&Im(e)}};var ef=l.version;if(ef!=="19.1.1")throw Error(i(527,ef,"19.1.1"));G.findDOMNode=function(e){var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(i(188)):(e=Object.keys(e).join(","),Error(i(268,e)));return e=v(t),e=e!==null?g(e):null,e=e===null?null:e.stateNode,e};var rg={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:N,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var bi=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!bi.isDisabled&&bi.supportsFiber)try{ss=bi.inject(rg),Ct=bi}catch{}}return al.createRoot=function(e,t){if(!u(e))throw Error(i(299));var a=!1,n="",r=gd,d=vd,h=yd,x=null;return t!=null&&(t.unstable_strictMode===!0&&(a=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onUncaughtError!==void 0&&(r=t.onUncaughtError),t.onCaughtError!==void 0&&(d=t.onCaughtError),t.onRecoverableError!==void 0&&(h=t.onRecoverableError),t.unstable_transitionCallbacks!==void 0&&(x=t.unstable_transitionCallbacks)),t=Vm(e,1,!1,null,null,a,n,r,d,h,x,null),e[yn]=t.current,Tc(e),new Gc(t)},al.hydrateRoot=function(e,t,a){if(!u(e))throw Error(i(299));var n=!1,r="",d=gd,h=vd,x=yd,T=null,H=null;return a!=null&&(a.unstable_strictMode===!0&&(n=!0),a.identifierPrefix!==void 0&&(r=a.identifierPrefix),a.onUncaughtError!==void 0&&(d=a.onUncaughtError),a.onCaughtError!==void 0&&(h=a.onCaughtError),a.onRecoverableError!==void 0&&(x=a.onRecoverableError),a.unstable_transitionCallbacks!==void 0&&(T=a.unstable_transitionCallbacks),a.formState!==void 0&&(H=a.formState)),t=Vm(e,1,!0,t,a??null,n,r,d,h,x,T,H),t.context=$m(null),a=t.current,n=Ht(),n=zi(n),r=za(n),r.callback=null,Ha(a,r,n),a=n,t.current.lanes=a,is(t,a),ia(t),e[yn]=t.current,Tc(e),new xi(t)},al.version="19.1.1",al}var df;function gg(){if(df)return $c.exports;df=1;function o(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o)}catch(l){console.error(l)}}return o(),$c.exports=hg(),$c.exports}var vg=gg();const yg=lo(vg),xg=se.createContext(null),Kc={didCatch:!1,error:null};class mf extends se.Component{constructor(l){super(l),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=Kc}static getDerivedStateFromError(l){return{didCatch:!0,error:l}}resetErrorBoundary(){const{error:l}=this.state;if(l!==null){for(var s,i,u=arguments.length,m=new Array(u),p=0;p<u;p++)m[p]=arguments[p];(s=(i=this.props).onReset)===null||s===void 0||s.call(i,{args:m,reason:"imperative-api"}),this.setState(Kc)}}componentDidCatch(l,s){var i,u;(i=(u=this.props).onError)===null||i===void 0||i.call(u,l,s)}componentDidUpdate(l,s){const{didCatch:i}=this.state,{resetKeys:u}=this.props;if(i&&s.error!==null&&bg(l.resetKeys,u)){var m,p;(m=(p=this.props).onReset)===null||m===void 0||m.call(p,{next:u,prev:l.resetKeys,reason:"keys"}),this.setState(Kc)}}render(){const{children:l,fallbackRender:s,FallbackComponent:i,fallback:u}=this.props,{didCatch:m,error:p}=this.state;let f=l;if(m){const v={error:p,resetErrorBoundary:this.resetErrorBoundary};if(typeof s=="function")f=s(v);else if(i)f=se.createElement(i,v);else if(u!==void 0)f=u;else throw p}return se.createElement(xg.Provider,{value:{didCatch:m,error:p,resetErrorBoundary:this.resetErrorBoundary}},f)}}function bg(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return o.length!==l.length||o.some((s,i)=>!Object.is(s,l[i]))}const w={TEXT:"text",DIALOGUE:"dialogue",INTERACTIVE:"interactive_scene",MERCHANT:"merchant",COMBAT:"combat",REST_LONG:"rest_long",REST_SHORT:"rest_short",REST_CHOICE:"rest_choice"},ji={SCENE_TRANSITION:"scene_transition",COMBAT:"combat",SHORT_REST:"shortRest",LONG_REST:"longRest",ITEM_GAIN:"item",ALLY_JOIN:"ally",SKILL_CHECK:"skillCheck",SHOP_OPEN:"openShop",SHOP_SELL:"openSellInterface",FLAG_SET:"setFlag",REPUTATION_CHANGE:"changeReputation"},Wc={metadata:{type:"string",chapter:"string",tags:"array",title:"string",character:"string",location:"string",background:"string",shop_type:"string"},content:{text:"string",speaker:"string",portrait:"string",description:"string",variations:{}}};({...Wc.metadata});const _g={metadata:{...Wc.metadata,type:"dialogue",character:"string"},content:{...Wc.content}};({..._g.metadata});const Sg={isValidSceneType:o=>Object.values(w).includes(o),isValidActionType:o=>Object.values(ji).includes(o),validateScene:o=>{const l=[];return o.metadata?.type||l.push("Scene must have a type"),o.content?.text||l.push("Scene must have text content"),(!o.choices||!Array.isArray(o.choices))&&l.push("Scene must have choices array"),{isValid:l.length===0,errors:l}}},jg={approche_discrete:{metadata:{type:w.TEXT,chapter:"acte3",tags:["stealth","success"],title:"Approche Silencieuse"},content:{text:"Tu t'approches discrètement des voix. Tes pas silencieux te permettent d'entendre clairement la conversation : une femme semble prisonnière d'un cercle magique et supplie pour de l'aide. Elle mentionne Dame Seraphina et une 'trahison'."},choices:[{text:"Révéler ta présence pour l'aider",next:"rencontre_zara",consequences:{flags:{approachedQuietly:!0}}},{text:"Écouter plus longtemps",next:"ecoute_prolongee_zara"}]},approche_bruyante:{metadata:{type:w.TEXT,chapter:"acte3",tags:["stealth","failure"],title:"Pas Maladroit"},content:{text:"Un bruit de pierre qui roule trahit ta présence. Les voix s'arrêtent immédiatement : 'Qui va là ? Si vous pouvez m'entendre, je vous en prie, aidez-moi ! Je suis prisonnière ici !' Il n'y a plus de surprise possible."},choices:[{text:"Entrer directement dans la salle",next:"rencontre_zara",consequences:{flags:{alertedZara:!0}}}]},liberation_zara:{metadata:{type:w.TEXT,chapter:"acte3",tags:["puzzle","magic"],title:"Cercle de Captivité"},content:{text:"Tu examines le cercle magique qui emprisonne Zara. Les runes sont complexes, mais tu identifies le point faible : un cristal central qui alimente le sort. Briser le cristal devrait libérer la prisonnière."},choices:[{text:"Briser le cristal avec prudence",next:"zara_liberee",action:{type:"skillCheck",skill:"arcane",dc:15,onSuccess:"zara_liberee",onFailure:"liberation_ratee"}},{text:"Chercher une autre méthode",next:"methode_alternative_liberation"}]},liberation_ratee:{metadata:{type:w.TEXT,chapter:"acte3",tags:["failure","backlash"],title:"Magie Instable"},content:{text:"Ton intervention provoque une instabilité magique ! Le cercle pulse violemment et Zara crie de douleur. Heureusement, après quelques secondes terrifiantes, le sort finit par se briser, mais l'expérience a été éprouvante pour vous deux."},choices:[{text:"Vérifier que Zara va bien",next:"zara_liberee",consequences:{flags:{liberationDifficile:!0}}}]},zara_explication:{metadata:{type:w.DIALOGUE,chapter:"acte3",tags:["explanation","caution"],title:"Révélations Prudentes",character:"zara_sorciere"},content:{text:"'Je suis Zara, une érudite en phénomènes planaires. J'étudiais les anomalies de cette région quand j'ai découvert que Dame Seraphina manipulait activement les énergies. Quand j'ai essayé de partir pour alerter les autorités, elle m'a piégée ici.'",speaker:"Zara la Sorcière",mood:"cautious"},choices:[{text:"Lui faire confiance et la libérer",next:"liberation_zara"},{text:"Demander plus de preuves",next:"zara_preuves",action:{type:"skillCheck",skill:"intuition",dc:14,onSuccess:"zara_convaincante",onFailure:"zara_suspicion"}}]},zara_mefiance:{metadata:{type:w.TEXT,chapter:"acte3",tags:["suspicion","careful"],title:"Prudence Justifiée"},content:{text:"Ta méfiance est compréhensible. Dans cette région, les apparences sont souvent trompeuses. Tu décides d'observer Zara plus attentivement : ses vêtements d'érudite semblent authentiques, ses connaissances magiques paraissent réelles, et surtout, elle semble vraiment souffrir dans ce cercle."},choices:[{text:"Décider de lui faire confiance",next:"liberation_zara"},{text:"Partir sans la libérer",next:"abandon_zara",consequences:{flags:{abandonedZara:!0}}}]},zara_alliance:{metadata:{type:w.DIALOGUE,chapter:"acte3",tags:["alliance","team"],title:"Formation de l'Alliance",character:"zara_sorciere"},content:{text:"'Si vous cherchez la Lame Éternelle, nous avons un ennemi commun en Seraphina. Mes connaissances sur les énergies planaires pourraient vous être précieuses. Acceptez-vous que je me joigne à vous ?'",speaker:"Zara la Sorcière",mood:"hopeful"},choices:[{text:"Accepter son aide avec plaisir",next:"team_complete",consequences:{flags:{zaraJoined:!0,teamComplete:!0},companions:["zara"]}},{text:"Accepter mais rester prudent",next:"alliance_prudente",consequences:{flags:{zaraJoined:!0,cautious:!0},companions:["zara"]}}]},gardiens_pacifies:{metadata:{type:w.TEXT,chapter:"acte3",tags:["diplomacy","success"],title:"Voix de la Raison"},content:{text:"Tes paroles atteignent quelque chose de profondément enfoui dans les gardiens corrompus. Leurs yeux rougeoyants vacillent, et lentement, ils baissent leurs armes. 'Maître... descendant...' murmure l'un d'eux avant qu'ils ne s'effondrent, enfin libérés de leur corruption."},choices:[{text:"Honorer leur sacrifice et continuer",next:"decouverte_lame",consequences:{flags:{savedGuardians:!0,peacefulResolution:!0}}}]},tentative_negociation:{metadata:{type:w.TEXT,chapter:"acte3",tags:["diplomacy","attempt"],title:"Appel à l'Humanité"},content:{text:"'Vous étiez les gardiens de ma famille ! Souvenez-vous de votre honneur, de votre serment !' Tu tends la main vers eux, espérant réveiller leur humanité perdue. Les créatures hésitent un instant, comme si tes paroles réveillaient de lointains souvenirs."},choices:[{text:"Continuer à faire appel à leur humanité",next:"gardiens_pacifies",action:{type:"skillCheck",skill:"persuasion",dc:18,onSuccess:"gardiens_pacifies",onFailure:"combat_gardiens_corrompus"}}]},saisie_lame_rapide:{metadata:{type:w.TEXT,chapter:"acte3",tags:["action","blade"],title:"Réflexes Éclairs"},content:{text:"D'un mouvement rapide, tu saisis la Lame Éternelle ! Elle pulse d'une énergie chaude et réconfortante entre tes mains. Mais les applaudissements continuent derrière toi..."},choices:[{text:"Te retourner, lame en main",next:"apparition_seraphina",consequences:{flags:{hasBladeEarly:!0}}}]},lame_saisie:{metadata:{type:w.TEXT,chapter:"acte3",tags:["success","heritage"],title:"L'Héritage Reclamé"},content:{text:"Tes réflexes te permettent de saisir la Lame Éternelle avant que Seraphina ne puisse réagir. L'épée semble reconnaître ton sang - elle pulse d'une lumière dorée et tu sens immédiatement son pouvoir couler en toi. Tu es le véritable héritier."},choices:[{text:"Faire face à Seraphina, lame au poing",next:"confrontation_avec_lame",consequences:{flags:{hasBladeEarly:!0,bladeRecognizedHeir:!0}}}]},preparation_combat_final:{metadata:{type:w.TEXT,chapter:"acte4",tags:["preparation","tactical"],title:"Préparatifs de Bataille"},content:{text:"Sans perdre de temps en discussions, tu prépares tes défenses et positionnes tes compagnons. Cette initiative te donne l'avantage : Seraphina semble surprise par ta rapidité de réaction.",variations:{team_advantage:"Tes compagnons comprennent immédiatement et se positionnent strategiquement autour de la salle."}},conditions:{show_variation:{team_advantage:"gameFlags.kaelJoined || gameFlags.finnJoined || gameFlags.zaraJoined"}},choices:[{text:"Attaquer en premier !",next:"combat_seraphina",consequences:{flags:{preparedForFinalBattle:!0,combatAdvantage:!0}}}]},seraphina_hesitate:{metadata:{type:w.DIALOGUE,chapter:"acte4",tags:["redemption","hesitation"],title:"Moment d'Hésitation",character:"seraphina_enemy"},content:{text:"Tes paroles semblent toucher quelque chose en Seraphina. Ses yeux brillants vacillent un instant : 'Tu... tu ne comprends pas. Des siècles d'humiliation... ma famille déshonorée...' Mais l'énergie sombre autour d'elle pulse plus fort, comme si elle luttait contre elle-même.",speaker:"Dame Seraphina",mood:"conflicted"},choices:[{text:"Insister sur la rédemption",next:"redemption_seraphina",action:{type:"skillCheck",skill:"persuasion",dc:22,onSuccess:"seraphina_redeemed",onFailure:"combat_seraphina"}},{text:"Profiter de son hésitation pour attaquer",next:"combat_seraphina",consequences:{flags:{betrayedHesitation:!0}}}]},tentative_purification:{metadata:{type:w.TEXT,chapter:"acte4",tags:["magic","alternative"],title:"La Troisième Voie"},content:{text:"Au lieu de détruire ou de garder la lame, tu tentes quelque chose d'inédit : utiliser tes connaissances magiques pour purifier la Porte des Murmures elle-même. C'est un défi énorme et dangereux.",variations:{zara_help:"Zara joint ses efforts aux tiens : 'C'est fou... mais cela pourrait marcher ! Essayons !'"}},conditions:{show_variation:{zara_help:"gameFlags.zaraJoined"}},choices:[{text:"Canaliser le pouvoir de purification",next:"fin_purification_reussie",action:{type:"skillCheck",skill:"arcane",dc:18,onSuccess:"fin_purification_reussie",onFailure:"fin_purification_ratee"}}]},fin_purification_ratee:{metadata:{type:w.TEXT,chapter:"epilogue",tags:["ending","failure"],title:"Purification Incomplète"},content:{text:"Malgré tes efforts héroïques, la purification échoue partiellement. La Porte des Murmures est stabilisée mais non purifiée, créant une situation précaire. Tu devras surveiller ce site en permanence, devenant de facto le nouveau Gardien par nécessité plutôt que par choix."},choices:[{text:"Accepter cette responsabilité",next:"epilogue_gardien_force",consequences:{flags:{forcedGuardianship:!0}}}]},epilogue_gardien:{metadata:{type:w.TEXT,chapter:"epilogue",tags:["ending","responsibility"],title:"Le Nouveau Gardien"},content:{text:"Tu t'installes dans l'ancien manoir familial, prenant officiellement le titre de Gardien de la Lame Éternelle. Aldwin devient ton mentor, t'enseignant les secrets ancestraux. Bien que confiné à cette région, tu sens que ton rôle a un sens profond."},choices:[{text:"Embrasser pleinement ton nouveau rôle",next:"epilogue_retour_village"}]},epilogue_chercheur:{metadata:{type:w.TEXT,chapter:"epilogue",tags:["ending","discovery"],title:"Chercheur de Mystères"},content:{text:"Ta découverte de la purification des Portes révolutionne la compréhension des phénomènes planaires. Tu deviens un érudit reconnu, consultant pour d'autres sites mystérieux à travers le continent. Ton innovation ouvre de nouvelles possibilités."},choices:[{text:"Continuer tes recherches",next:"formation_nouvel_ordre"}]},reflexion_finale:{metadata:{type:w.TEXT,chapter:"epilogue",tags:["contemplation","choice"],title:"Temps de Réflexion"},content:{text:"'J'ai besoin de temps pour réfléchir à tout ce qui s'est passé. Cette aventure m'a beaucoup appris sur moi-même et ma famille.' Maître Aldwin hoche la tête avec compréhension : 'Sage décision. Les grandes responsabilités ne doivent pas être acceptées à la légère. Je resterai ici si vous changez d'avis.'"},choices:[{text:"Prendre une année de réflexion",next:"fin_reflexion_prolongee"},{text:"Finalement accepter après mûre réflexion",next:"formation_nouvel_ordre"}]},retraite_heroique:{metadata:{type:w.TEXT,chapter:"epilogue",tags:["ending","retirement"],title:"La Retraite du Héros"},content:{text:"'J'ai fait ma part. D'autres peuvent reprendre le flambeau.' Maître Aldwin semble déçu mais respecte ton choix : 'Tu as sauvé cette région, nul ne peut te reprocher de vouloir une vie paisible. Ton héritage parlera pour toi.'"},choices:[{text:"Retourner à ta vie d'avant",next:"fin_vie_paisible"},{text:"Rester dans la région mais sans responsabilités",next:"fin_resident_local"}]},team_complete:{metadata:{type:w.TEXT,chapter:"acte3",tags:["team","complete"],title:"L'Équipe Réunie"},content:{text:"Avec Zara qui se joint à votre groupe, votre équipe est maintenant complète. Kael apporte son expertise de chasseur, Finn ses inventions ingénieuses, et Zara ses connaissances des énergies planaires. Ensemble, vous formez une alliance redoutable pour affronter les défis à venir.",variations:{without_kael:"Avec Zara, Finn et toi, vous formez une équipe équilibrée entre science et magie.",without_finn:"Avec Zara et Kael, vous combinez expertise martiale et connaissances arcaniques.",solo_plus_zara:"Avec Zara à tes côtés, tu as maintenant une alliée experte en phénomènes planaires."}},conditions:{show_variation:{without_kael:"!gameFlags.kaelJoined && gameFlags.finnJoined",without_finn:"gameFlags.kaelJoined && !gameFlags.finnJoined",solo_plus_zara:"!gameFlags.kaelJoined && !gameFlags.finnJoined"}},choices:[{text:"Partir ensemble vers la chambre secrète",next:"recherche_lame",consequences:{flags:{teamComplete:!0,zaraJoined:!0}}},{text:"Prendre le temps de planifier ensemble",next:"planification_equipe"}]},alliance_prudente:{metadata:{type:w.TEXT,chapter:"acte3",tags:["alliance","caution"],title:"Alliance Prudente"},content:{text:"Tu acceptes l'aide de Zara tout en gardant une certaine réserve. Après tout, dans cette situation, il vaut mieux rester vigilant. Zara semble comprendre ta prudence : 'Sage précaution. La confiance se gagne avec le temps.'"},choices:[{text:"Avancer ensemble vers la lame",next:"recherche_lame",consequences:{flags:{zaraJoined:!0,cautious:!0}}}]}},Tg={acceptation_heritage:{metadata:{type:w.TEXT,chapter:"prologue",tags:["heritage","acceptance"],title:"Acceptation de l'Héritage"},content:{text:"Tu acceptes solennellement de reprendre le flambeau familial. Aldwin sourit avec satisfaction : 'Excellent. Il est temps que tu apprennes tout sur ton héritage. La route sera difficile, mais tu n'es plus seul.'"},choices:[{text:"Demander à apprendre immédiatement",next:"aldwin_histoire_gardiens",consequences:{flags:{acceptedLegacy:!0,readyToLearn:!0}}}]},aldwin_explication_gardien:{metadata:{type:w.DIALOGUE,chapter:"prologue",tags:["explanation","guardian"],title:"Le Rôle du Gardien",character:"maitre_aldwin"},content:{text:"'Un Gardien n'est pas qu'un protecteur de relique. Il maintient l'équilibre entre notre monde et les autres plans d'existence. La Lame Éternelle n'est qu'un outil - le vrai pouvoir réside dans la volonté et la sagesse du porteur.'",speaker:"Maître Aldwin",mood:"wise"},choices:[{text:"Comprendre les responsabilités",next:"responsabilites_gardien"},{text:"Demander des détails sur les plans d'existence",next:"cours_plans_existence"}]},aldwin_histoire_famille:{metadata:{type:w.TEXT,chapter:"prologue",tags:["family","history"],title:"L'Histoire de la Lignée"},content:{text:"Aldwin te raconte l'histoire de ta famille : 'Les tiens gardent ce domaine depuis huit siècles. Chaque génération a produit au moins un Gardien. Ton grand-père Aldric était le dernier d'une longue lignée de héros. Et maintenant, c'est ton tour.'"},choices:[{text:"Apprendre sur les précédents Gardiens",next:"aldwin_histoire_gardiens"},{text:"Se concentrer sur Aldric",next:"histoire_aldric_aldwin"}]},aldwin_histoire_gardiens:{metadata:{type:w.TEXT,chapter:"prologue",tags:["lore","guardians"],title:"L'Ordre des Gardiens"},content:{text:"Aldwin déroule un parchemin ancien montrant l'arbre généalogique de ta famille : 'Chaque Gardien avait ses propres défis. Certains ont affronté des invasions planaires, d'autres ont découvert de nouveaux sites à protéger. Ta destinée sera unique, mais tu portes leur héritage.'"},choices:[{text:"Accepter cet héritage avec fierté",next:"serment_gardien",consequences:{flags:{proudOfHeritage:!0,learnedGuardianHistory:!0}}}]},aldwin_preuves:{metadata:{type:w.TEXT,chapter:"prologue",tags:["proof","verification"],title:"Preuves de Légitimité"},content:{text:"Aldwin sort plusieurs objets personnels de ton grand-père : sa bague avec le sceau familial, des lettres écrites de sa main, et même un portrait de lui tenant la Lame Éternelle. 'Ces preuves suffisent-elles à dissiper tes doutes ?'"},choices:[{text:"Être convaincu par les preuves",next:"aldwin_confiance"},{text:"Garder une réserve prudente",next:"aldwin_resistance"}]},aldwin_confiance:{metadata:{type:w.TEXT,chapter:"prologue",tags:["trust","alliance"],title:"Confiance Établie"},content:{text:"Les preuves sont irréfutables et l'attitude d'Aldwin inspire confiance. Tu décides de lui faire confiance et d'accepter son aide pour comprendre ton héritage familial."},choices:[{text:"Apprendre l'histoire complète",next:"aldwin_histoire_gardiens",consequences:{flags:{trustsAldwin:!0}}}]},aldwin_resistance:{metadata:{type:w.TEXT,chapter:"prologue",tags:["resistance","caution"],title:"Réserve Maintenue"},content:{text:"Malgré les preuves, tu maintiens une certaine réserve. Aldwin semble comprendre : 'Ta prudence t'honore. Un bon Gardien ne fait jamais confiance aveuglément. Prends le temps dont tu as besoin.'"},choices:[{text:"Demander à repartir pour réfléchir",next:"retour_village_reflexion"},{text:"Rester mais garder ses distances",next:"cohabitation_prudente"}]},dialogue_seraphina_suspicion:{metadata:{type:w.DIALOGUE,chapter:"acte2",tags:["suspicion","confrontation"],title:"Soupçons Exprimés",character:"dame_seraphina"},content:{text:"'J'ai remarqué certains détails troublants... votre pendentif, vos cartes...' Dame Seraphina ne semble pas surprise : 'Vous êtes très observateur. Oui, j'ai un intérêt personnel dans cette affaire. Ma famille a aussi une histoire avec la Lame Éternelle.'",speaker:"Dame Seraphina",mood:"defensive"},choices:[{text:"Demander des explications",next:"seraphina_verite_partielle"},{text:"Rester sur ses gardes",next:"seraphina_mefiance_mutuelle"}]},seraphina_motivations:{metadata:{type:w.DIALOGUE,chapter:"acte2",tags:["motivation","hidden"],title:"Motivations Cachées",character:"dame_seraphina"},content:{text:"'Pourquoi cette fascination pour la Lame Éternelle ?' Seraphina hésite un moment : 'Disons que ma famille a... des comptes à régler avec l'histoire. Certaines injustices doivent être réparées.'",speaker:"Dame Seraphina",mood:"evasive"},choices:[{text:"Insister pour plus de détails",next:"seraphina_verite_partielle"},{text:"Accepter son aide malgré les mystères",next:"seraphina_aide"}]},seraphina_rejoint:{metadata:{type:w.TEXT,chapter:"acte2",tags:["companion","hidden"],title:"Une Alliée Mystérieuse"},content:{text:"Dame Seraphina se joint à votre groupe avec ses propres préparatifs mystérieux. Elle semble connaître parfaitement la route vers les marais et possède des équipements inhabituels pour une simple noble. Ses véritables intentions restent énigmatiques."},choices:[{text:"Partir vers les marais avec elle",next:"marais_exploration",consequences:{flags:{seraphinaJoined:!0,seraphinaHidden:!0}}}]},refus_seraphina:{metadata:{type:w.TEXT,chapter:"acte2",tags:["refusal","independence"],title:"Refus Diplomatique"},content:{text:"Tu déclines poliment l'offre de Dame Seraphina. Ses yeux brillent d'une lueur étrange un instant, mais elle maintient son sourire courtois : 'Comme vous voudrez. J'espère que vous trouverez ce que vous cherchez.' Il y a quelque chose d'inquiétant dans son ton."},choices:[{text:"Partir vers les marais sans elle",next:"marais_exploration",consequences:{flags:{seraphinaRefused:!0,seraphinaHostile:!0}}}]},visions_aldric:{metadata:{type:w.TEXT,chapter:"acte2",tags:["visions","mystery"],title:"Les Visions d'Aldric"},content:{text:"'Il parlait de murmures dans les murs, d'ombres qui bougeaient toutes seules, de voix l'appelant depuis l'au-delà. Vers la fin, il ne dormait plus, hanté par des cauchemars qu'il ne pouvait décrire.' Les derniers jours de ton grand-père semblent avoir été terrifiants."},choices:[{text:"Demander plus de détails",next:"details_visions_aldric"},{text:"Changer de sujet - c'est troublant",next:"localisation_forteresse"}]},disparition_aldric:{metadata:{type:w.TEXT,chapter:"acte2",tags:["disappearance","mystery"],title:"La Nuit de la Disparition"},content:{text:"'Il est parti une nuit d'orage, emportant seulement la Lame Éternelle. On a retrouvé ses traces qui menaient vers les marais, puis plus rien. Certains disent qu'il s'est sacrifié pour fermer une brèche planaire. D'autres pensent qu'il a été consumé par sa propre quête.'"},choices:[{text:"Demander où ont été vues ses dernières traces",next:"localisation_forteresse"}]},informations_forteresse:{metadata:{type:w.TEXT,chapter:"acte2",tags:["information","fortress"],title:"Détails sur Sombremont"},content:{text:"'La forteresse de Sombremont était le cœur du pouvoir de votre famille. Construite sur un nexus planaire naturel, elle amplifiait les capacités des Gardiens. Mais depuis sa chute, l'endroit est devenu instable et dangereux.'"},choices:[{text:"Partir maintenant avec ces informations",next:"marais_exploration",consequences:{flags:{knowsForteressHistory:!0}}}]},arrivee_forteresse_sure:{metadata:{type:w.TEXT,chapter:"acte3",tags:["arrival","safe"],title:"Arrivée Sécurisée"},content:{text:"Votre route prudente à travers les marais vous mène sains et saufs à la forteresse. Vous arrivez bien reposés et prêts à affronter les défis qui vous attendent dans les ruines de Sombremont."},choices:[{text:"Approcher de la forteresse",next:"forteresse_ruines"}]},caves_forteresse:{metadata:{type:w.TEXT,chapter:"acte3",tags:["underground","secret"],title:"Caves Secrètes"},content:{text:"Le passage secret vous mène dans les anciennes caves de la forteresse. L'air est stagnant et chargé d'énergie magique. Des runes de protection anciennes brillent faiblement sur les murs, mais certaines semblent défaillantes."},choices:[{text:"Explorer les caves prudemment",next:"exploration_caves"},{text:"Monter directement vers les étages supérieurs",next:"entree_forteresse"}]},decouverte_cartes:{metadata:{type:w.TEXT,chapter:"acte3",tags:["discovery","intelligence"],title:"Cartes Révélatrices"},content:{text:"Les cartes sont annotées en plusieurs langues et montrent des points d'intérêt dans toute la région. Plus troublant encore, elles marquent l'emplacement exact de sites planaires à travers le continent. Quelqu'un planifie quelque chose de grande envergure."},choices:[{text:"Emporter les cartes comme preuves",next:"rencontre_zara",consequences:{flags:{foundMaps:!0,evidenceGathered:!0}}}]},observation_salon:{metadata:{type:w.TEXT,chapter:"acte2",tags:["observation","inn"],title:"Écoute au Salon"},content:{text:"Au salon de l'auberge, tu écoutes les conversations des autres clients. Les marchands parlent de routes dangereuses, les voyageurs mentionnent des phénomènes étranges dans les marais. Ces informations pourraient être utiles."},choices:[{text:"Retourner te coucher avec ces informations",next:"reveil_millhaven",action:{type:"longRest"},consequences:{flags:{gatheredIntelligence:!0}}}]},reveil_millhaven:{metadata:{type:w.TEXT,chapter:"acte2",tags:["morning","preparation"],title:"Réveil à Millhaven"},content:{text:"Tu te réveilles reposé dans ta chambre d'auberge. La lumière du matin filtre par la fenêtre et l'activité de Millhaven commence déjà. Il est temps de continuer ton aventure."},choices:[{text:"Descendre rejoindre tes compagnons",next:"reunion_equipe_millhaven"},{text:"Aller parler à Dame Seraphina",next:"dialogue_seraphina_intro"}]},kael_preuve_heritage:{metadata:{type:w.TEXT,chapter:"prologue",tags:["proof","heritage"],title:"Lettre d'Héritage"},content:{text:"Tu montres à Kael la lettre officielle qui t'a amené ici. Il l'examine attentivement, vérifie le sceau et hoche la tête : 'Cette lettre semble authentique. Soit tu es vraiment l'héritier, soit tu es un faussaire très doué.'"},choices:[{text:"Insister sur ton authenticité",next:"kael_convaincu",action:{type:"skillCheck",skill:"persuasion",dc:13,onSuccess:"kael_convaincu",onFailure:"kael_reste_mefiant"}}]},kael_convaincu:{metadata:{type:w.TEXT,chapter:"prologue",tags:["trust","acceptance"],title:"Confiance Accordée"},content:{text:"Kael semble convaincu par tes arguments et tes preuves : 'Très bien, je vous fais confiance. Si vous êtes vraiment de la lignée des Gardiens, alors nous avons peut-être une chance de résoudre ce problème.'"},choices:[{text:"Accepter son aide avec gratitude",next:"kael_rejoint",consequences:{flags:{kaelJoined:!0,provedHeritage:!0}}}]},kael_reste_mefiant:{metadata:{type:w.TEXT,chapter:"prologue",tags:["suspicion","doubt"],title:"Doutes Persistants"},content:{text:"Malgré tes efforts, Kael garde ses réserves : 'Les preuves peuvent être falsifiées, et j'ai vu trop de mensonges dans cette région. Prouvez-moi votre valeur par des actes, pas par des paroles.'"},choices:[{text:"Accepter de prouver ta valeur",next:"kael_test"},{text:"Partir sans insister davantage",next:"depart_sans_kael"}]},kael_preuve_alternative:{metadata:{type:w.TEXT,chapter:"prologue",tags:["alternative","proof"],title:"Autre Forme de Preuve"},content:{text:"'Je propose autre chose que le combat. Laissez-moi vous montrer mes connaissances sur les créatures d'ombre ou mes compétences magiques.' Kael réfléchit : 'Intéressant. Montrez-moi ce que vous savez sur ces créatures.'"},choices:[{text:"Démontrer tes connaissances",next:"demonstration_connaissances",action:{type:"skillCheck",skill:"arcane",dc:14,onSuccess:"kael_impressionne",onFailure:"kael_decu"}}]},finn_applications_combat:{metadata:{type:w.TEXT,chapter:"acte2",tags:["gnome","combat"],title:"Inventions de Combat"},content:{text:"Finn te montre ses créations orientées combat : 'J'ai des projectiles à énergie concentrée, des boucliers temporaires, et même un disrupteur planaire expérimental ! Bien sûr, ils ne sont pas tous... complètement testés.'"},choices:[{text:"Être impressionné par son arsenal",next:"finn_rejoint",consequences:{flags:{finnJoined:!0,sawCombatGear:!0}}},{text:"S'inquiéter des équipements non testés",next:"finn_prudence"}]},etude_symbole_approfondie:{metadata:{type:w.TEXT,chapter:"acte1",tags:["study","magic"],title:"Étude Arcanique Approfondie"},content:{text:"Ton étude approfondie du symbole révèle des détails fascinants : il s'agit d'un verrou planaire à plusieurs niveaux, conçu pour se renforcer au fil du temps. Mais il montre des signes d'affaiblissement récent."},choices:[{text:"Continuer l'exploration avec ces connaissances",next:"chambre_scellee",consequences:{flags:{understoodPlanarRunes:!0,expertKnowledge:!0}}}]}},Eg={test_recruit_companions:{id:"test_recruit_companions",type:"TEXT",title:"Test - Recrutement des Compagnons",content:`
# Test du Système de Compagnons

Vous vous trouvez dans une taverne mystérieuse où deux aventuriers extraordinaires vous attendent...

**Finn**, un gnome inventeur aux yeux pétillants, bricolait un étrange dispositif énergétique dans un coin. Ses mains expertes manipulaient des composants mécaniques avec une précision remarquable.

**Zara**, une sorcière humaine aux cheveux argentés, étudiait un grimoire planaire en murmurant des incantations. Des étincelles magiques dansaient autour de ses doigts.

"Nous avons entendu parler de votre quête," dit Finn en levant les yeux de son invention. "Nos compétences pourraient vous être utiles."

"En effet," ajoute Zara, "mes sorts et l'ingéniosité de Finn forment une combinaison redoutable."

Vous sentez que ces deux compagnons pourraient grandement vous aider dans les combats à venir.`,metadata:{location:"Taverne du Test",mood:"expectant",difficulty:"none"},choices:[{text:"Recruter Finn comme compagnon",next:"test_recruit_zara",action:{type:"ally",ally:"finn"}},{text:"[DEBUG] Retour au menu principal",next:"introduction"}]},test_recruit_zara:{id:"test_recruit_zara",type:"TEXT",title:"Test - Recrutement de Zara",content:`
# Finn rejoint l'équipe !

Finn range ses outils et ajuste son projectile énergétique. "Parfait ! Je vais pouvoir tester mes dernières inventions sur le terrain."

Zara lève les yeux de son grimoire. "Et moi ? Mes sorts de feu et de contrôle pourraient vous être très utiles. Surtout si vous rencontrez plusieurs ennemis à la fois..."

Elle ferme son livre d'un geste théâtral, des étincelles magiques dansant autour de ses doigts.`,metadata:{location:"Taverne du Test",mood:"expectant",difficulty:"none"},choices:[{text:"Recruter Zara également",next:"test_combat_goblins",action:{type:"ally",ally:"zara"}},{text:"Partir au combat avec Finn seulement",next:"test_combat_goblins"}]},test_combat_goblins:{metadata:{type:"combat",chapter:"acte1",tags:["combat","ombres"],title:"Attaque des Ombres Affamées",nextScene:"apres_premier_combat"},content:{text:"En sortant des tunnels vers les marais, vous êtes immédiatement attaqués par trois créatures d'ombre qui semblaient vous attendre. Leurs formes vaporeuses ondulent dans la brume nocturne, et leurs yeux rougeoyants fixent vos âmes avec une faim dévorante."},enemies:[{type:"gobelin",count:2}],enemyPositions:[{x:7,y:0},{x:7,y:1}],choices:[{text:"Engager le combat !",action:{type:"combat"}}]},test_combat_results:{id:"test_combat_results",type:"TEXT",title:"Test Réussi !",content:`
# Victoire ! Test du Système Réussi

Les gobelins gisent au sol, vaincus par votre équipe coordonnée !

## Résultats observés :

**Finn** a probablement :
- ✅ Utilisé "Détection de la magie" en priorité (support_skill)
- ✅ Effectué des attaques à distance avec son projectile énergétique  
- ✅ Soigné un allié blessé avec ses inventions si nécessaire

**Zara** a probablement :
- ✅ Lancé "Trait de feu" sur l'ennemi le plus faible (ranged_spell)
- ✅ Utilisé "Toile d'araignée" si les gobelins étaient groupés (area_damage)
- ✅ Les ennemis entravés n'ont pas pu bouger pendant 3 tours

**Système d'effets testé :**
- Les gobelins sous l'effet "restrained" ont eu leur mouvement bloqué
- Les effets se sont dissipés automatiquement après 3 tours
- L'IA ennemie a respecté les restrictions de mouvement

Excellente démonstration du nouveau système d'IA et d'effets de combat !`,metadata:{location:"Extérieur de la taverne",mood:"victorious",difficulty:"none"},choices:[{text:"Retourner au menu principal pour d'autres tests",next:"start"},{text:"Refaire le test de combat",next:"test_combat_goblins"}]},test_combat_defeat:{id:"test_combat_defeat",type:"TEXT",title:"Défaite - Test à Revoir",content:`
# Défaite...

Les gobelins vous ont vaincus ! Mais ne vous inquiétez pas, c'est juste un test.

Cela pourrait indiquer :
- Les compagnons n'utilisent pas encore optimalement leurs capacités
- Le système d'IA a besoin d'ajustements
- Les effets de combat ne fonctionnent pas comme prévu

Vous reprenez conscience dans la taverne, prêts à analyser ce qui s'est passé.`,metadata:{location:"Taverne du Test",mood:"contemplative",difficulty:"none"},choices:[{text:"Réessayer le combat",next:"test_combat_goblins"},{text:"Retourner au menu principal",next:"start"}]}},Ag=""+new URL("tom-aubergiste-CPKmkEtp.jpg",import.meta.url).href,Cf=""+new URL("kael-eycW0aOW.png",import.meta.url).href,Cg=""+new URL("dame_seraphina-Cn8sDIVn.jpg",import.meta.url).href,Nf=""+new URL("finn-D3Ehn8y8.png",import.meta.url).href,Mf=""+new URL("zara-1aq3ZEXb.png",import.meta.url).href,Ng=""+new URL("seraphina_corrupted-BYHZT4-e.png",import.meta.url).href,ff=""+new URL("maitre_aldwin-Brc802y2.png",import.meta.url).href,Mg=""+new URL("ruined_fortress-DgbLHuob.jpg",import.meta.url).href,Dg=""+new URL("underground_tunnels-DUFDfgmS.jpg",import.meta.url).href,qg=""+new URL("marchand-D6wpbJ7x.jpg",import.meta.url).href,pf={simpleShopScene:{metadata:{type:"merchant",character:"merchant_1",shop_type:"general_store"},content:{text:"Bienvenue dans ma boutique !",speaker:"Tom le Marchand",portrait:qg},shop:{currency:"or",inventory:[{id:"arccheat",price:50,stock:1},{id:"potionOfHealing",price:10,stock:-1}]},choices:[{text:"Voir les marchandises",action:{type:"openShop"}},{text:"Vendre des objets",action:{type:"openSellInterface"}},{text:"Au revoir",next:"town_square"}]},introduction:{metadata:{type:w.TEXT,chapter:"prologue",tags:["intro","heritage","mystery"],title:"L'Héritage Inattendu",location:"Route vers Ravenscroft"},content:{text:`Après des jours de voyage sur des routes poussiéreuses, tu arrives enfin aux Terres de Vethkar. Tu tiens dans ta main une lettre jaunie qui t'informe de ton héritage : un domaine familial dans le village isolé de Ravenscroft. Étrangement, tu n'avais jamais entendu parler de cette branche de ta famille.
Le paysage devient plus sombre à mesure que tu approches du village. Les arbres semblent tordus, et une brume persistante flotte au-dessus des marais environnants. Au loin, tu aperçois les toits de chaume de Ravenscroft et la lueur vacillante d'une enseigne de taverne.`,variations:{experienced:"Ton expérience d'aventurier te fait immédiatement remarquer que quelque chose cloche dans cette région. L'atmosphère est chargée d'une énergie mystérieuse.",mage:"Tes sens magiques détectent une perturbation dans les énergies planaires. Cette région cache quelque chose d'important."}},conditions:{show_variation:{experienced:"character.level >= 3",mage:"character.class === 'Magicien'"}},choices:[{text:"Se rendre directement à la taverne du village",next:"taverne_lanterne",consequences:{flags:{arrivedAtVillage:!0},companions:["kael"]}},{text:"Explorer les environs avant d'entrer au village",next:"exploration_perimetres",consequences:{flags:{exploredPerimeter:!0}}}]},exploration_perimetres:{metadata:{type:w.TEXT,chapter:"prologue",tags:["exploration","discovery"],title:"Signes Inquiétants"},content:{text:`En explorant les alentours du village, tu découvres des traces troublantes : des empruntes étranges dans la boue qui semblent disparaître d'un seul coup, des arbres aux écorces noircies par une force inconnue, et surtout, un silence anormal - pas un oiseau ne chante.
Sur une pierre tombale abandonnée, tu lis un nom familier gravé dans la pierre : 'Gardien Aldric {character.familyName} - Protecteur de la Lame Éternelle'. Le nom te donne des frissons. Qui était cet Aldric ? Et qu'est-ce que la Lame Éternelle ?`},choices:[{text:"Se rendre à la taverne avec ces questions en tête",next:"taverne_lanterne",consequences:{flags:{discoveredTombstone:!0,arrivedAtVillage:!0}}}]},taverne_lanterne:{metadata:{type:w.DIALOGUE,chapter:"prologue",tags:["taverne","social","information"],title:"La Lanterne Vacillante",character:"aubergiste_tom",location:"Ravenscroft - Taverne"},content:{text:"Tu pousses la porte de la taverne 'La Lanterne Vacillante'. L'atmosphère y est lourde et les rares clients parlent à voix basse. L'aubergiste, un homme robuste aux cranes dégarni et à la barbe fournie, lève les yeux vers toi.",speaker:"Tom l'Aubergiste",portrait:Ag,mood:"wary",variations:{tombstone:"Ses yeux s'agrandissent légèrement quand tu mentionnes la pierre tombale que tu as trouvée.",direct:"Il semble surpris de voir un étranger dans son établissement."}},conditions:{show_variation:{tombstone:"gameFlags.discoveredTombstone",direct:"!gameFlags.discoveredTombstone"}},choices:[{text:"Demander des informations sur ton héritage familial",next:"dialogue_heritage",action:{type:"scene_transition"}},{text:"Poser des questions sur les événements étranges",next:"dialogue_creatures",condition:"gameFlags.discoveredTombstone"},{text:"Commander une chambre pour la nuit",next:"chambre_repos",action:{type:"scene_transition"}}]},dialogue_heritage:{metadata:{type:w.DIALOGUE,chapter:"prologue",tags:["lore","family"],title:"L'Histoire Familiale",character:"aubergiste_tom"},content:{text:"Tom se penche vers toi en baissant la voix : 'Alors tu es de la lignée des Gardiens... Je me demandais si quelqu'un finirait par revenir. Ton grand-père Aldric était respecté ici, mais il a disparu il y a vingt ans, la même nuit où...' Il s'interrompt brusquement.",speaker:"Tom l'Aubergiste",mood:"secretive"},choices:[{text:"Insister pour connaître la suite",next:"dialogue_disparition",action:{type:"skillCheck",skill:"persuasion",dc:12,onSuccess:"dialogue_disparition",onFailure:"dialogue_resistance"}},{text:"Demander des détails sur le domaine familial",next:"dialogue_domaine"}]},dialogue_creatures:{metadata:{type:w.DIALOGUE,chapter:"prologue",tags:["history"],title:"Des choses bizarres..",character:"aubergiste_tom",location:"Ravenscroft - Taverne"},content:{text:"Tom se met a parler tout bas : ' On sait pas trop ce qu'il de passe en ce moment, mais une chose est sûr ce n'est pas normal'",speaker:"Tom l'Aubergiste",mood:"secretive"},choices:[{text:"Insister pour connaître la suite",next:"dialogue_disparition"},{text:"Demander des détails sur le domaine familial",next:"dialogue_domaine"}]},dialogue_domaine:{metadata:{type:w.TEXT,chapter:"prologue",tags:["failure","alternate"],title:"l'ancien manoir"},content:{text:"Le Domaine {character.familyName} ?! tu peux pas le louper, il se trouve à l'ancien manoir, au bout du sentier nord. Mais méfie-toi... la nuit tombe bientôt.'"},choices:[{text:"Accepter et partir vers le domaine",next:"route_domaine",consequences:{flags:{rejectedByVillagers:!0}}},{text:"Prendre une chambre et attendre le matin",next:"chambre_repos"}]},chambre_repos:{metadata:{type:w.TEXT,chapter:"prologue",tags:["repos"],title:"Réveil l'esprit embrumé"},content:{text:"Tu n'as pas très bien dormis cette nuit. a completer"},choices:[{text:"Partir vers le domaine",next:"route_domaine"},{text:"Aller parler a l'Aubergiste",next:"taverne_lanterne"},{text:"Retourner parler a Tom",next:"dialogue_ombre",condition:"gameFlags.rejectedByVillager"}]},dialogue_disparition:{metadata:{type:w.DIALOGUE,chapter:"prologue",tags:["revelation","mystery"],title:"La Nuit de la Disparition",character:"aubergiste_tom"},content:{text:"Tom jette un coup d'œil nerveux autour de lui avant de continuer : 'La nuit où la Lame Éternelle a disparu. Depuis, les ombres bougent toutes seules, les fermes isolées sont attaquées par... des choses qui ne devraient pas exister. Aldric nous protégeait, mais maintenant...' Sa voix se brise.",speaker:"Tom l'Aubergiste",mood:"fearful"},choices:[{text:"Proposer ton aide pour résoudre ce problème",next:"rencontre_kael",consequences:{flags:{knowsAboutBlade:!0,offeredHelp:!0,earnedTrust:!0}}},{text:"Demander où se trouve ton domaine",next:"dialogue_domaine",consequences:{flags:{knowsAboutBlade:!0}}}]},dialogue_resistance:{metadata:{type:w.TEXT,chapter:"prologue",tags:["failure","alternate"],title:"Méfiance"},content:{text:"Tom secoue la tête fermement : 'Non, j'en ai déjà trop dit. Si tu veux vraiment savoir, va voir ton domaine. Il se trouve à l'ancien manoir, au bout du sentier nord. Mais méfie-toi... la nuit tombe bientôt.'"},choices:[{text:"Accepter et partir vers le domaine",next:"route_domaine",consequences:{flags:{rejectedByVillagers:!0}}},{text:"Prendre une chambre et attendre le matin",next:"chambre_repos"}]},route_domaine:{metadata:{type:w.TEXT,chapter:"prologue",tags:["exploration","mystery","heritage"],title:"Le Sentier vers le Domaine",location:"Sentier du Manoir Abandonné"},content:{text:`Tu quittes la taverne sous les regards inquiets des villageois. Le sentier nord serpente à travers une forêt de plus en plus dense, et la brume nocturne commence à s'élever du sol humide.
Après une marche de trente minutes, tu aperçois au loin les silhouettes imposantes d'un ancien manoir. Ses tours se dressent contre le ciel crépusculaire, et une faible lueur vacille à l'une des fenêtres. Étrangement, le domaine semble en bien meilleur état que les histoires du village ne le laissaient entendre.`,variations:{mage:"Tes sens magiques détectent une puissante aura protectrice autour du manoir. Des runes de protection, bien qu'anciennes, semblent encore actives.",experienced:"Ton expérience t'alerte : ce manoir est trop bien préservé pour être vraiment abandonné. Quelqu'un - ou quelque chose - l'entretient."}},conditions:{show_variation:{mage:"character.class === 'Magicien'",experienced:"character.level >= 3"}},choices:[{text:"Approcher directement du manoir",next:"entree_manoir_direct"},{text:"Faire le tour pour observer depuis les bois",next:"observation_manoir"},{text:"Retourner au village, c'est trop risqué la nuit",next:"retour_village_nuit"}]},entree_manoir_direct:{metadata:{type:w.TEXT,chapter:"prologue",tags:["bold","heritage","meeting"],title:"L'Approche Directe",location:"Devant le Manoir {character.familyName}"},content:{text:`Tu marches droit vers l'entrée principale. À mesure que tu t'approches, tu remarques que les jardins, bien qu'envahis, montrent des signes d'entretien récent. Quelqu'un a taillé certaines haies et désherbé les allées.

Arrivé devant la porte massive en chêne, tu découvres une plaque de bronze gravée : 'Domaine {character.familyName} - Gardiens de la Lame Éternelle depuis 847'. Avant même que tu ne frappes, la porte s'ouvre sur un vieil homme à la longue barbe blanche.`},choices:[{text:"Se présenter poliment",next:"rencontre_aldwin_poli"},{text:"Demander qui il est avec méfiance",next:"rencontre_aldwin_mefiant"}]},observation_manoir:{metadata:{type:w.TEXT,chapter:"prologue",tags:["stealth","observation","discovery"],title:"Observation Prudente",location:"Lisière de la Forêt"},content:{text:`Tu contournes le manoir en restant dans l'ombre des arbres. Tes observations révèlent plusieurs détails troublants : des traces de pas récentes dans la terre meuble, des fenêtres qui brillent d'une lumière douce mais constante, et surtout, une silhouette qui passe devant l'une des fenêtres - celle d'un vieil homme en robe.

Tu remarques aussi d'étranges symboles gravés dans l'écorce de certains arbres entourant la propriété. Ils ressemblent aux motifs que tu as vus sur ta lettre d'héritage.`},choices:[{text:"Approcher maintenant que tu en sais plus",next:"entree_manoir_informe"},{text:"Attendre et observer plus longtemps",next:"observation_prolongee"},{text:"Retourner au village avec ces informations",next:"retour_village_infos"}]},retour_village_nuit:{metadata:{type:w.TEXT,chapter:"prologue",tags:["caution","retreat"],title:"Retraite Prudente",location:"Retour vers Ravenscroft"},content:{text:`La prudence l'emporte sur la curiosité. Tu rebrousses chemin vers le village, mais le trajet de retour te semble différent. Les bruits de la forêt ont changé, et tu as l'impression d'être observé.

En arrivant à Ravenscroft, tu constates que la plupart des maisons ont leurs volets fermés et que seule la taverne montre encore de la lumière. Un villageois t'aperçoit et secoue la tête d'un air désapprobateur.`},choices:[{text:"Retourner à la taverne pour la nuit",next:"chambre_repos"},{text:"Repartir vers le manoir immédiatement",next:"route_domaine_nuit"}]},entree_manoir_informe:{metadata:{type:w.TEXT,chapter:"prologue",tags:["informed","heritage","meeting"],title:"Approche Éclairée",location:"Devant le Manoir {character.familyName}"},content:{text:`Fort de tes observations, tu t'approches du manoir avec plus d'assurance. Tu remarques maintenant des détails qui t'avaient échappé : les runes de protection gravées dans le linteau, la propreté inhabituelle des vitres, et surtout, l'absence totale de toiles d'araignées ou de signes d'abandon.

Avant même d'atteindre la porte, celle-ci s'ouvre et le vieil homme que tu as aperçu apparaît. Il te sourit calmement, comme s'il t'attendait depuis longtemps.`,variations:{mage:"Tes sens magiques confirment ce que tu soupçonnais : cet homme rayonne d'une puissante aura arcanique. C'est un mage accompli."}},conditions:{show_variation:{mage:"character.class === 'Magicien'"}},choices:[{text:"Mentionner tes observations",next:"rencontre_aldwin_observateur"},{text:"Se présenter simplement",next:"rencontre_aldwin_poli"}]},observation_prolongee:{metadata:{type:w.TEXT,chapter:"prologue",tags:["patience","discovery","revelation"],title:"Vigile Nocturne",location:"Lisière de la Forêt"},content:{text:`Tu t'installes confortablement contre un gros chêne et observes patiemment. Ta patience est récompensée : au bout d'une heure, tu vois le vieil homme sortir du manoir avec une lanterne. Il fait le tour de la propriété en murmurant ce qui semble être des incantations.

Tu remarques qu'à chaque point qu'il visite, les runes gravées dans les arbres s'illuminent brièvement d'une lumière dorée. Il entretient des protections magiques ! Quand il rentre, il jette un regard direct vers ta cachette et hoche la tête, comme s'il savait que tu étais là.`,variations:{mage:"Tu reconnais les incantations : il s'agit de sorts de protection et de purification de très haut niveau. Cet homme est un mage extrêmement puissant."}},conditions:{show_variation:{mage:"character.class === 'Magicien'"}},choices:[{text:"Sortir de ta cachette et t'approcher",next:"rencontre_aldwin_respectueux"},{text:"Attendre qu'il vienne te chercher",next:"aldwin_vient_chercher"},{text:"Partir discrètement, c'est trop dangereux",next:"retour_village_trouble"}]},rencontre_kael:{metadata:{type:w.DIALOGUE,chapter:"prologue",tags:["companion","recruitment"],title:"L'Étranger Encapuchonné",character:"kael_ranger"},content:{text:"Alors que Tom termine son récit, un homme encapuchonné assis dans un coin sombre se lève et s'approche. Ses mouvements sont fluides et silencieux. En repoussant sa capuche, il révèle les traits fins d'un elfe sombre aux yeux verts perçants.",speaker:"Kael le Rôdeur",portrait:Cf,mood:"serious"},choices:[{text:"Écouter ce qu'il a à dire",next:"dialogue_kael_proposition"},{text:"Rester méfiant et demander qui il est",next:"dialogue_kael_mefiance"}]},dialogue_kael_proposition:{metadata:{type:w.DIALOGUE,chapter:"prologue",tags:["companion","alliance"],title:"Une Alliance Nécessaire",character:"kael_ranger"},content:{text:"'Je m'appelle Kael. Je traque ces créatures d'ombre depuis des mois. Elles ne se contentent plus d'attaquer les fermes isolées - elles se rassemblent, s'organisent. Si tu es vraiment de la lignée des Gardiens, j'ai besoin de ton aide. Et toi du mien.'",speaker:"Kael le Rôdeur",mood:"determined"},choices:[{text:"Accepter son aide",next:"kael_rejoint",consequences:{flags:{kaelJoined:!0},companions:["kael"]}},{text:"Refuser poliment",next:"kael_refuse",consequences:{flags:{kaelRefused:!0}}},{text:"Demander des preuves de ses compétences",next:"kael_test",action:{type:"skillCheck",skill:"intuition",dc:10,onSuccess:"kael_trustworthy",onFailure:"kael_uncertain"}}]},kael_rejoint:{metadata:{type:w.TEXT,chapter:"prologue",tags:["companion","success"],title:"Alliance Formée"},content:{text:"Kael hoche la tête avec satisfaction. 'Bien. J'ai repéré des tunnels sous le village qui mènent vers les anciennes fondations. C'est probablement là que se trouvent les réponses que tu cherches. Mais d'abord, nous devons nous préparer.'"},choices:[{text:"Explorer les tunnels immédiatement",next:"tunnels_entree",consequences:{flags:{exploringWithKael:!0}}},{text:"Prendre du repos avant l'exploration",next:"repos_court_avec_kael"}]},tunnels_entree:{metadata:{type:w.INTERACTIVE,chapter:"acte1",tags:["exploration","underground"],title:"Les Tunnels Oubliés",background:Dg},content:{text:"Kael t'emmène vers une cave secrète derrière la taverne. Un passage étroit descend dans les profondeurs rocheuses sous le village. L'air y est frais et humide, et des gravures anciennes ornent les murs de pierre."},hotspots:[{id:"ancient_carvings",coordinates:{x:585,y:0,width:286,height:500},text:"Examiner les gravures anciennes",action:{type:"scene_transition",next:"decouverte_gravures"}},{id:"deeper_passage",coordinates:{x:336,y:220,width:100,height:180},text:"Continuer vers les profondeurs",action:{type:"scene_transition",next:"chambre_scellee"}},{id:"strange_symbol",coordinates:{x:106,y:115,width:100,height:250},text:"Étudier ce symbole étrange",condition:"character.class === 'Magicien'",action:{type:"scene_transition",next:"symbole_magique"}}],choices:[{text:"Remonter à la surface",next:"taverne_lanterne"}]},decouverte_gravures:{metadata:{type:w.TEXT,chapter:"acte1",tags:["lore","discovery"],title:"Les Fresques du Passé"},content:{text:"Les gravures racontent une histoire ancienne : des guerriers tenant une épée lumineuse face à une faille sombre d'où sortent des créatures d'ombre. La légende sous la fresque mentionne 'la Lame Éternelle, Verrou des Mondes, Gardienne de la Porte des Murmures'.",variations:{with_kael:"Kael examine les gravures avec attention. 'Alors c'est vrai... Cette épée n'était pas juste une arme, c'était un verrou dimensionnel.'"}},conditions:{show_variation:{with_kael:"gameFlags.kaelJoined"}},choices:[{text:"Continuer l'exploration des tunnels",next:"chambre_scellee",consequences:{flags:{understoodHistory:!0}}}]},chambre_scellee:{metadata:{type:w.TEXT,chapter:"acte1",tags:["discovery","mystery"],title:"La Chambre Secrète"},content:{text:"Au bout du tunnel, vous découvrez une large chambre circulaire. Au centre, un piédestal vide où brillent encore des runes magiques. Sur les murs, des inscriptions en langue ancienne. Un passage secret mène vers les marais.",variations:{mage_bonus:"Tes connaissances magiques te permettent de déchiffrer partiellement les runes : 'Là où la lumière ne peut atteindre, dans le cœur des terres englouties.'"}},conditions:{show_variation:{mage_bonus:"character.class === 'Magicien'"}},choices:[{text:"Suivre le passage vers les marais",next:"premier_combat_ombres",consequences:{flags:{foundSecretPassage:!0}}},{text:"Retourner au village pour se préparer",next:"preparation_millhaven"}]},premier_combat_ombres:{metadata:{type:w.COMBAT,chapter:"acte1",tags:["combat","ombres"],title:"Attaque des Ombres Affamées",next:"apres_premier_combat"},content:{text:"En sortant des tunnels vers les marais, vous êtes immédiatement attaqués par trois créatures d'ombre qui semblaient vous attendre. Leurs formes vaporeuses ondulent dans la brume nocturne, et leurs yeux rougeoyants fixent vos âmes avec une faim dévorante."},enemies:[{type:"ombre",count:1}],enemyPositions:[{x:7,y:0},{x:7,y:1}],choices:[{text:"Engager le combat !"}]},apres_premier_combat:{metadata:{type:w.TEXT,chapter:"acte1",tags:["aftermath","discovery"],title:"Premières Révélations"},content:{text:"Après avoir repoussé les ombres, vous remarquez qu'elles se dissipent en murmurant des mots dans une langue inconnue. Kael examine les restes : 'Ces créatures ne sont pas naturelles. Elles viennent d'ailleurs, et quelque chose les guide.'",variations:{solo:"Tu examines seul les restes des créatures. Elles semblaient chercher quelque chose... ou quelqu'un.",with_kael:"Kael semble préoccupé par la façon dont ces créatures vous ont attendu. 'Elles savaient que nous viendrions. Nous sommes peut-être suivis.'"}},conditions:{show_variation:{solo:"!gameFlags.kaelJoined",with_kael:"gameFlags.kaelJoined"}},choices:[{text:"Se diriger vers la ville de Millhaven",next:"route_millhaven",consequences:{flags:{firstCombatWon:!0}}},{text:"Retourner au village pour se reposer",action:{type:"shortRest",next:"repos_village"}}]},route_millhaven:{metadata:{type:w.TEXT,chapter:"acte2",tags:["voyage","transition"],title:"La Route vers Millhaven"},content:{text:"La route vers Millhaven serpente à travers les marais pendant deux jours. Cette ville plus importante possède des archives historiques qui pourraient contenir des informations sur ta famille et la Lame Éternelle. En chemin, vous croisez des marchands nerveux qui parlent de 'loups étranges' dans la région."},choices:[{text:"Arriver à Millhaven",next:"millhaven_auberge"}]},millhaven_auberge:{metadata:{type:w.DIALOGUE,chapter:"acte2",tags:["auberge","information"],title:"Le Repos du Voyageur",character:"dame_seraphina",location:"Millhaven - Auberge"},content:{text:"L'auberge 'Le Repos du Voyageur' est bien plus raffinée que la taverne de Ravenscroft. Dans le salon principal, une femme noble aux cheveux châtains consulte des parchemins anciens. Elle lève les yeux quand vous entrez.",speaker:"Dame Seraphina",portrait:Cg,mood:"curious"},choices:[{text:"Approcher et vous présenter",next:"dialogue_seraphina_intro"},{text:"Demander une chambre d'abord",next:"chambre_millhaven"},{text:"Observer discrètement",next:"observation_seraphina",action:{type:"skillCheck",skill:"perception",dc:12,onSuccess:"observation_reussie",onFailure:"observation_ratee"}}]},dialogue_seraphina_intro:{metadata:{type:w.DIALOGUE,chapter:"acte2",tags:["noble","information"],title:"Rencontre avec Dame Seraphina",character:"dame_seraphina"},content:{text:"'Comme c'est intéressant... Vous portez le nom des anciens Gardiens, n'est-ce pas ? Je suis Dame Seraphina de Valdris. Je possède dans mes archives des documents historiques sur votre lignée. Peut-être pourrions-nous nous entraider ?'",speaker:"Dame Seraphina",mood:"friendly"},choices:[{text:"Accepter son aide avec reconnaissance",next:"seraphina_aide",consequences:{flags:{metSeraphina:!0,seraphinaFriendly:!0}}},{text:"Demander ce qu'elle veut en échange",next:"seraphina_echange",consequences:{flags:{metSeraphina:!0,seraphinaCautious:!0}}}]},seraphina_aide:{metadata:{type:w.DIALOGUE,chapter:"acte2",tags:["revelation","lore"],title:"Les Archives Secrètes",character:"dame_seraphina"},content:{text:"'Vos ancêtres étaient les gardiens d'un artefact appelé la Lame Éternelle. Selon mes documents, votre grand-père Aldric l'a cachée quelque part avant de disparaître. Il a laissé un indice : 'là où la lumière ne peut atteindre, dans le cœur des terres englouties.''",speaker:"Dame Seraphina",mood:"helpful"},choices:[{text:"Demander plus de détails sur Aldric",next:"histoire_aldric"},{text:"Demander où se trouvent ces 'terres englouties'",next:"localisation_forteresse",consequences:{flags:{knowsForteressLocation:!0}}}]},rencontre_finn:{metadata:{type:w.DIALOGUE,chapter:"acte2",tags:["companion","gnome"],title:"L'Inventeur Excentrique",character:"finn_inventeur"},content:{text:"Dans l'atelier adjacent à l'auberge, vous entendez des bruits métalliques et des étincelles. Un gnome aux cheveux hirsutes sort la tête d'un assemblage d'engrenages complexe. 'Oh ! Des visiteurs ! Parfait, j'ai justement besoin de testeurs pour mon Détecteur d'Énergies Planaires Mark VII !'",speaker:"Finn l'Inventeur",portrait:Nf,mood:"excited"},choices:[{text:"Montrer de l'intérêt pour ses inventions",next:"finn_inventions"},{text:"Lui parler de vos problèmes avec les créatures d'ombre",next:"finn_detecteur",consequences:{flags:{finnIntrigued:!0}}},{text:"Poliment décliner et partir",next:"finn_refuse"}]},finn_detecteur:{metadata:{type:w.DIALOGUE,chapter:"acte2",tags:["gnome","science"],title:"Détection Planaire",character:"finn_inventeur"},content:{text:"'Des créatures d'ombre ? Fascinant ! Mon détecteur indique effectivement des anomalies planaires dans cette région. Si vous me permettez de vous accompagner pour étudier ces phénomènes, je pourrais vous aider avec mes inventions !'",speaker:"Finn l'Inventeur",mood:"scientific"},choices:[{text:"Accepter qu'il se joigne à vous",next:"finn_rejoint",consequences:{flags:{finnJoined:!0},companions:["finn"]}},{text:"Demander une démonstration de ses capacités",next:"finn_demonstration"}]},finn_rejoint:{metadata:{type:w.TEXT,chapter:"acte2",tags:["companion","equipment"],title:"Un Nouvel Allié"},content:{text:"Finn rassemble rapidement son équipement : détecteurs étranges, fioles brillantes et gadgets mécaniques divers. 'Excellent ! Avec mon matériel, nous pourrons localiser les perturbations planaires et peut-être même prédire les apparitions de créatures !'"},choices:[{text:"Partir vers les marais pour chercher la forteresse",next:"marais_exploration",consequences:{flags:{teamFormed:!0}}},{text:"Se reposer avant l'expédition",next:"repos_millhaven",action:{type:"longRest"}}]},marais_exploration:{metadata:{type:w.TEXT,chapter:"acte2",tags:["marais","danger"],title:"Dans les Marais Maudits"},content:{text:"Les marais s'étendent à perte de vue, ponctués d'îlots rocheux et de brumes épaisses. Le détecteur de Finn s'affole de plus en plus à mesure que vous progressez vers le cœur de la région. L'air devient plus froid et des murmures étranges portent dans le vent."},choices:[{text:"Suivre les indications du détecteur",next:"spectres_marais",consequences:{flags:{followedDetector:!0}}},{text:"Chercher un chemin plus sûr",next:"chemin_detourne",action:{type:"skillCheck",skill:"survie",dc:14,onSuccess:"chemin_sur",onFailure:"spectres_marais"}}]},spectres_marais:{metadata:{type:w.COMBAT,chapter:"acte2",tags:["combat","spectres"],title:"Spectres des Marais",next:"apres_spectres"},content:{text:"Des formes translucides émergent de la brume : des spectres de voyageurs perdus dans les marais. Contrairement aux ombres précédentes, ces créatures sont plus organisées et semblent communiquer entre elles dans un langage sifflant."},enemies:[{type:"spectre_marais",count:4}],enemyPositions:[{x:3,y:1},{x:4,y:4},{x:6,y:2},{x:7,y:5}],choices:[{text:"Combattre les spectres !",action:{type:"combat"}}]},apres_spectres:{metadata:{type:w.TEXT,chapter:"acte2",tags:["aftermath","discovery"],title:"Révélations Spectrales"},content:{text:"Avant de se dissiper, l'un des spectres murmure : 'Elle... elle contrôle... la Dame... cherche... la Lame...' Finn examine ses instruments : 'Les perturbations planaires viennent définitivement d'une structure au nord-ouest. Et ces créatures... elles étaient dirigées !'"},choices:[{text:"Se diriger vers la source des perturbations",next:"forteresse_ruines",consequences:{flags:{heardSpectreWarning:!0}}}]},forteresse_ruines:{metadata:{type:w.INTERACTIVE,chapter:"acte3",tags:["forteresse","exploration"],title:"Les Ruines de Sombremont",background:Mg},content:{text:"Devant vous s'élèvent les ruines imposantes de ce qui fut autrefois une forteresse majestueuse. Des tours écroulées percent la brume, et une énergie sombre pulse visiblement entre les pierres anciennes. C'était le siège de votre famille."},hotspots:[{id:"main_entrance",coordinates:{x:446,y:202,width:87,height:138},text:"Entrer par l'entrée principale",action:{type:"scene_transition",next:"entree_forteresse"}},{id:"side_passage",coordinates:{x:60,y:307,width:20,height:60},text:"Chercher un passage latéral",action:{type:"scene_transition",next:"passage_secret"}},{id:"magical_observation",coordinates:{x:821,y:210,width:55,height:55},text:"Analyser les énergies magiques",condition:"character.class === 'Magicien' || gameFlags.finnJoined",action:{type:"scene_transition",next:"analyse_magique"}}],choices:[{text:"Faire le tour pour évaluer la situation",next:"evaluation_forteresse"}]},entree_forteresse:{metadata:{type:w.TEXT,chapter:"acte3",tags:["exploration","tension"],title:"Dans les Ruines"},content:{text:"L'intérieur de la forteresse est dans un état de désolation contrôlée. Certaines parties semblent avoir été récemment habitées. Des symboles étranges sont peints sur les murs, et vous entendez des voix provenant des profondeurs. Quelqu'un d'autre est ici."},choices:[{text:"Avancer discrètement vers les voix",next:"rencontre_zara",action:{type:"skillCheck",skill:"discretion",dc:13,onSuccess:"approche_discrete",onFailure:"approche_bruyante"}},{text:"Explorer les autres salles d'abord",next:"exploration_salles"}]},rencontre_zara:{metadata:{type:w.DIALOGUE,chapter:"acte3",tags:["companion","sorcière"],title:"La Sorcière Prisonnière",character:"zara_sorciere"},content:{text:"Dans une salle circulaire, vous découvrez une femme aux cheveux noirs enfermée dans un cercle de runes brillantes. Elle lève les yeux vers vous avec un mélange de soulagement et de méfiance. 'Enfin quelqu'un ! J'étudie les anomalies planaires ici depuis des mois, mais ce piège magique m'a capturée !'",speaker:"Zara la Sorcière",portrait:Mf,mood:"desperate"},choices:[{text:"Essayer de briser le cercle magique",next:"liberation_zara",action:{type:"skillCheck",skill:"arcane",dc:15,onSuccess:"zara_liberee",onFailure:"liberation_ratee"}},{text:"Demander qui l'a piégée avant d'agir",next:"zara_explication"},{text:"Rester méfiant - cela pourrait être un piège",next:"zara_mefiance"}]},zara_liberee:{metadata:{type:w.DIALOGUE,chapter:"acte3",tags:["liberation","revelation"],title:"Une Nouvelle Alliée",character:"zara_sorciere"},content:{text:"Le cercle se brise dans un flash de lumière. Zara se masse les poignets en souriant : 'Merci ! Je commençais à désespérer. Je dois vous avertir : Dame Seraphina n'est pas celle qu'elle prétend être. Elle contrôle activement l'ouverture de la Porte des Murmures !'",speaker:"Zara la Sorcière",mood:"grateful"},choices:[{text:"Demander des explications sur Seraphina",next:"zara_revelation_seraphina",consequences:{flags:{zaraJoined:!0,knowsSeraphinaTruth:!0},companions:["zara"]}},{text:"Proposer qu'elle se joigne à votre groupe",next:"zara_alliance",consequences:{flags:{zaraJoined:!0},companions:["zara"]}}]},zara_revelation_seraphina:{metadata:{type:w.DIALOGUE,chapter:"acte3",tags:["revelation","betrayal"],title:"La Véritable Nature de Seraphina",character:"zara_sorciere"},content:{text:"'Seraphina n'est pas juste une noble curieuse. Elle descend d'une lignée rivale qui fut dépossédée du titre de Gardien il y a des siècles. Elle ne veut pas détruire la Porte des Murmures - elle veut la contrôler pour invoquer une armée d'ombres et conquérir les royaumes !'",speaker:"Zara la Sorcière",mood:"urgent"},choices:[{text:"Partir immédiatement pour l'arrêter",next:"course_contre_seraphina",consequences:{flags:{rushedToConfrontation:!0}}},{text:"Chercher d'abord la Lame Éternelle",next:"recherche_lame",consequences:{flags:{soughtBladeFirst:!0}}}]},recherche_lame:{metadata:{type:w.TEXT,chapter:"acte3",tags:["exploration","discovery"],title:"La Chambre Secrète"},content:{text:"Zara vous guide vers la chambre secrète au cœur de la forteresse. Mais devant l'entrée, d'anciens gardiens corrompus par l'énergie planaire montent la garde. Leurs armures anciennes brillent d'une lumière malsaine, et leurs yeux ne reflètent plus aucune humanité."},choices:[{text:"Engager le combat contre les gardiens",next:"combat_gardiens_corrompus"},{text:"Essayer de les raisonner",next:"tentative_negociation",action:{type:"skillCheck",skill:"persuasion",dc:18,onSuccess:"gardiens_pacifies",onFailure:"combat_gardiens_corrompus"}}]},combat_gardiens_corrompus:{metadata:{type:w.COMBAT,chapter:"acte3",tags:["combat","gardiens"],title:"Gardiens Corrompus",next:"decouverte_lame"},content:{text:"Les gardiens corrompus attaquent sans merci ! Ces anciens protecteurs de votre lignée ont été transformés en créatures hybrides, mi-humaines mi-ombres. Leur corruption leur donne une force surnaturelle, mais aussi une vulnérabilité à la lumière pure."},enemies:[{type:"gardien_corrompu",count:3}],enemyPositions:[{x:4,y:2},{x:5,y:4},{x:6,y:1}],choices:[{text:"Libérer les gardiens de leur corruption !",action:{type:"combat"}}]},decouverte_lame:{metadata:{type:w.TEXT,chapter:"acte3",tags:["discovery","artifact"],title:"La Lame Éternelle"},content:{text:"Dans la chambre secrète, sur un autel de cristal noir, repose enfin la Lame Éternelle. L'épée pulse d'une lumière argentée qui semble repousser naturellement les ombres. Mais au moment où vous vous en approchez, des applaudissements lents résonnent derrière vous."},choices:[{text:"Se retourner prudemment",next:"apparition_seraphina"},{text:"Saisir rapidement la lame",next:"saisie_lame_rapide",action:{type:"skillCheck",skill:"dexterite",dc:16,onSuccess:"lame_saisie",onFailure:"apparition_seraphina"}}]},apparition_seraphina:{metadata:{type:w.DIALOGUE,chapter:"acte4",tags:["betrayal","revelation"],title:"La Véritable Seraphina",character:"seraphina_enemy"},content:{text:"Dame Seraphina entre dans la chambre, accompagnée de mercenaires en armure noire. Mais quelque chose a changé en elle - ses yeux brillent d'une lueur malsaine et des ombres dansent autour de sa silhouette. 'Merci de m'avoir menée jusqu'ici, descendant des usurpateurs !'",speaker:"Dame Seraphina",portrait:Ng,mood:"hostile"},choices:[{text:"Demander des explications",next:"seraphina_revelation"},{text:"Préparer immédiatement le combat",next:"preparation_combat_final",consequences:{flags:{preparedForFinalBattle:!0}}}]},seraphina_revelation:{metadata:{type:w.DIALOGUE,chapter:"acte4",tags:["villain","motivation"],title:"L'Héritage Volé",character:"seraphina_enemy"},content:{text:"'Ma famille était les vrais Gardiens avant que les vôtres ne nous dépossèdent par la ruse ! Pendant des siècles, nous avons planifié notre retour. Je ne veux pas détruire la Porte des Murmures - je veux l'ouvrir complètement et commander une armée d'ombres pour reprendre ce qui nous revient de droit !'",speaker:"Dame Seraphina",mood:"vengeful"},choices:[{text:"Essayer de la raisonner",next:"tentative_redemption",action:{type:"skillCheck",skill:"persuasion",dc:20,onSuccess:"seraphina_hesitate",onFailure:"combat_seraphina"}},{text:"La défier au combat",next:"combat_seraphina"}]},combat_seraphina:{metadata:{type:w.COMBAT,chapter:"acte4",tags:["boss","final"],title:"Seraphina la Corrompue",next:"apres_combat_final"},content:{text:"Seraphina se transforme sous vos yeux, l'énergie planaire la corrompant en une créature mi-humaine mi-ombre. Ses mercenaires attaquent tandis qu'elle invoque des sorts puissants. C'est le combat le plus difficile que vous ayez jamais affronté !"},enemies:[{type:"seraphina_boss",count:1},{type:"mercenaire_ombre",count:2}],enemyPositions:[{x:4,y:3},{x:2,y:1},{x:6,y:5}],choices:[{text:"Combattre pour sauver le monde !",action:{type:"combat"}}]},apres_combat_final:{metadata:{type:w.TEXT,chapter:"acte4",tags:["aftermath","choice"],title:"Le Dernier Acte de Seraphina"},content:{text:"Seraphina s'effondre, mortellement blessée, mais utilise ses dernières forces pour lancer un sort de destruction sur la Porte des Murmures. La faille planaire commence à se fissurer dangereusement. Vous devez agir vite !",variations:{with_allies:"Vos compagnons vous regardent avec confiance : 'Nous te suivrons, quel que soit ton choix !'",solo:"Seul face à ce choix crucial, tu sens le poids de la responsabilité sur tes épaules."}},conditions:{show_variation:{with_allies:"gameFlags.kaelJoined || gameFlags.finnJoined || gameFlags.zaraJoined",solo:"!gameFlags.kaelJoined && !gameFlags.finnJoined && !gameFlags.zaraJoined"}},choices:[{text:"Détruire la Lame Éternelle pour fermer la porte à jamais",next:"fin_destruction_lame",consequences:{flags:{destroyedBlade:!0,porteClosed:!0}}},{text:"Devenir le nouveau Gardien et garder la lame",next:"fin_nouveau_gardien",consequences:{flags:{becameGuardian:!0,keptBlade:!0}}},{text:"Essayer de purifier la porte au lieu de la fermer",next:"tentative_purification",condition:"character.class === 'Magicien' || gameFlags.zaraJoined",action:{type:"skillCheck",skill:"arcane",dc:18,onSuccess:"fin_purification_reussie",onFailure:"fin_purification_ratee"}}]},fin_destruction_lame:{metadata:{type:w.TEXT,chapter:"epilogue",tags:["ending","sacrifice"],title:"Le Sacrifice Héroïque"},content:{text:"Tu lèves la Lame Éternelle et, d'un geste décisif, la brises contre l'autel de cristal. L'explosion de lumière pure scelle définitivement la Porte des Murmures, mais l'artefact légendaire est perdu à jamais. Les villages environnants sont sauvés, mais tu portes le poids d'avoir détruit un héritage millénaire.",variations:{with_team:"Tes compagnons approuvent ton choix courageux. Ensemble, vous avez sauvé la région au prix d'un sacrifice immense."}},conditions:{show_variation:{with_team:"gameFlags.kaelJoined || gameFlags.finnJoined || gameFlags.zaraJoined"}},choices:[{text:"Retourner à Ravenscroft pour annoncer la nouvelle",next:"epilogue_retour_village"}]},fin_nouveau_gardien:{metadata:{type:w.TEXT,chapter:"epilogue",tags:["ending","responsibility"],title:"L'Héritage Assumé"},content:{text:"Tu saisis fermement la Lame Éternelle et canalises son pouvoir pour stabiliser la Porte des Murmures. Tu deviens le nouveau Gardien, assumant la responsabilité de surveiller cette région à vie. C'est un fardeau lourd, mais tu préserves à la fois la paix et l'héritage de ta famille."},choices:[{text:"Accepter ton nouveau rôle avec honneur",next:"epilogue_gardien"}]},fin_purification_reussie:{metadata:{type:w.TEXT,chapter:"epilogue",tags:["ending","redemption"],title:"La Voie de la Rédemption"},content:{text:"Grâce à tes connaissances magiques ou à l'aide de Zara, tu réussis l'impossible : purifier la Porte des Murmures au lieu de la fermer. La faille devient un passage contrôlé qui pourrait même être bénéfique dans le futur. Tu as trouvé une troisième voie que personne n'avait envisagée."},choices:[{text:"Étudier cette nouvelle découverte",next:"epilogue_chercheur"}]},epilogue_retour_village:{metadata:{type:w.DIALOGUE,chapter:"epilogue",tags:["conclusion","sage"],title:"Le Sage Aldwin",character:"maitre_aldwin",location:"Ravenscroft - Taverne"},content:{text:"De retour à la taverne de Ravenscroft, vous rencontrez un vieil homme aux robes d'érudit qui vous attendait. 'Je suis Maître Aldwin, archiviste royal. J'ai entendu parler de vos exploits. Ce que vous avez accompli ici n'est que le début - il existe d'autres Portes dans le monde, d'autres sites où d'anciens Gardiens ont disparu.'",speaker:"Maître Aldwin",portrait:ff,mood:"wise"},choices:[{text:"Accepter de former un nouvel Ordre des Gardiens",next:"formation_nouvel_ordre",consequences:{flags:{formedNewOrder:!0}}},{text:"Demander du temps pour réfléchir",next:"reflexion_finale"},{text:"Refuser - tu en as assez fait",next:"retraite_heroique"}]},formation_nouvel_ordre:{metadata:{type:w.TEXT,chapter:"epilogue",tags:["new_beginning","hope"],title:"Un Nouvel Espoir"},content:{text:"Maître Aldwin sourit et déroule une carte ancienne marquée d'emplacements mystérieux à travers le continent. 'Parfait. Avec vos compagnons et la sagesse que vous avez acquise, nous pouvons créer un nouvel Ordre des Gardiens. Le monde a besoin de protecteurs comme vous.'",variations:{blade_destroyed:"Même sans la Lame Éternelle, votre expérience et votre détermination seront des atouts précieux.",became_guardian:"En tant que Gardien de la Lame Éternelle, vous serez le pilier de ce nouvel ordre.",purified_gate:"Votre découverte de la purification des portes révolutionne notre approche de ces sites."}},conditions:{show_variation:{blade_destroyed:"gameFlags.destroyedBlade",became_guardian:"gameFlags.becameGuardian",purified_gate:"gameFlags.purifiedGate"}},choices:[{text:"Commencer cette nouvelle aventure",next:"fin_ouverture_monde",consequences:{flags:{readyForSequal:!0}}}]},fin_ouverture_monde:{metadata:{type:w.TEXT,chapter:"epilogue",tags:["ending","future"],title:"De Nouveaux Horizons"},content:{text:`Votre groupe se prépare pour un périple à travers le continent. Selon vos choix et vos compagnons, vous avez différents outils à votre disposition, mais une mission commune : localiser et protéger les autres sites planaires. L'aventure de Vethkar n'était que le premier chapitre d'une épopée bien plus vaste.
*** FIN DU CHAPITRE 1 : LES GARDIENS DE LA LAME ÉTERNELLE ***
Vos choix et vos compagnons façonneront la suite de votre destinée...`},choices:[{text:"Continuer l'aventure... (À suivre)",next:"introduction",consequences:{flags:{completedFirstChapter:!0}}}]},dialogue_ombre:{metadata:{type:w.DIALOGUE,chapter:"prologue",tags:["mystery","warning"],title:"Murmures dans l'Ombre",character:"aubergiste_tom"},content:{text:"Tom se penche vers toi, l'air plus sombre qu'avant : 'Cette nuit, j'ai entendu des choses... Des murmures venant des marais. Les ombres bougent différemment depuis ton arrivée. Je ne dis pas que c'est ta faute, mais...' Il s'interrompt en jetant un regard nerveux vers la fenêtre.",speaker:"Tom l'Aubergiste",mood:"worried"},choices:[{text:"Demander plus de détails sur ces murmures",next:"dialogue_disparition"},{text:"Partir immédiatement vers le domaine",next:"route_domaine",consequences:{flags:{heardOmenWarning:!0}}}]},route_domaine_nuit:{metadata:{type:w.TEXT,chapter:"prologue",tags:["danger","night"],title:"Retour Nocturne Dangereux"},content:{text:"Cette fois, tu prends le sentier vers le manoir dans l'obscurité totale. Les bruits de la forêt sont différents, plus menaçants. Des formes sombres semblent te suivre entre les arbres, et tu entends parfois des murmures dans une langue inconnue. Ton instinct te dit que quelque chose d'hostile rôde dans ces bois."},choices:[{text:"Continuer malgré le danger",next:"entree_manoir_direct",action:{type:"skillCheck",skill:"courage",dc:14,onSuccess:"arrivee_manoir_brave",onFailure:"attaque_ombres_route"}},{text:"Faire demi-tour prudemment",next:"retour_village_trouble"}]},retour_village_trouble:{metadata:{type:w.TEXT,chapter:"prologue",tags:["retreat","omen"],title:"Retraite Troublante"},content:{text:"Tu fais demi-tour, mais même en retournant vers le village, tu sens une présence malveillante dans ton dos. Les ombres semblent te suivre, et tu entends distinctement des rires étouffés. En arrivant à Ravenscroft, tu remarques que plusieurs maisons ont leurs fenêtres barricadées."},choices:[{text:"Retourner à la taverne pour la nuit",next:"chambre_repos",consequences:{flags:{sawDarkOmens:!0}}}]},retour_village_infos:{metadata:{type:w.TEXT,chapter:"prologue",tags:["information","planning"],title:"Retour avec des Renseignements"},content:{text:"Tu retournes au village avec les informations précieuses que tu as récoltées sur le manoir. Il est habité par un vieil homme mystérieux, et des protections magiques sont en place. Les villageois pourraient être rassurés d'apprendre que quelqu'un veille encore sur l'ancien domaine familial."},choices:[{text:"Partager tes découvertes à la taverne",next:"taverne_lanterne",consequences:{flags:{sharedManorInfo:!0}}},{text:"Garder les informations et retourner au manoir",next:"entree_manoir_informe"}]},rencontre_aldwin_poli:{metadata:{type:w.DIALOGUE,chapter:"prologue",tags:["polite","heritage"],title:"Présentation Courtoise",character:"maitre_aldwin"},content:{text:"'Bonsoir, je suis {character.name} {character.familyName}. J'ai hérité de ce domaine et je cherche à comprendre l'histoire de ma famille.' Le vieil homme sourit chaleureusement : 'Enfin ! Je suis Maître Aldwin, gardien temporaire de ce lieu. J'attendais le retour d'un descendant depuis des années.'",speaker:"Maître Aldwin",portrait:ff,mood:"welcoming"},choices:[{text:"Demander pourquoi il gardait le manoir",next:"aldwin_explication_gardien"},{text:"Questionner sur la famille et la Lame Éternelle",next:"aldwin_histoire_famille",condition:"gameFlags.knowsAboutBlade"},{text:"Accepter son invitation à entrer",next:"interieur_manoir_aldwin"}]},rencontre_aldwin_mefiant:{metadata:{type:w.DIALOGUE,chapter:"prologue",tags:["suspicious","caution"],title:"Confrontation Méfiante",character:"maitre_aldwin"},content:{text:"'Qui êtes-vous et que faites-vous dans MON manoir ?' Le vieil homme ne semble pas surpris par ta méfiance. 'Ta méfiance t'honore, jeune {character.familyName}. Oui, je connais ton nom. Je suis Aldwin, et je protège ce lieu depuis la disparition de ton grand-père.'",speaker:"Maître Aldwin",mood:"understanding"},choices:[{text:"Exiger des preuves de ses dires",next:"aldwin_preuves",action:{type:"skillCheck",skill:"intuition",dc:12,onSuccess:"aldwin_confiance",onFailure:"aldwin_resistance"}},{text:"S'excuser et se présenter poliment",next:"rencontre_aldwin_poli"}]},rencontre_aldwin_observateur:{metadata:{type:w.DIALOGUE,chapter:"prologue",tags:["observant","impressed"],title:"Respect Mutuel",character:"maitre_aldwin"},content:{text:"'J'ai remarqué que vous entreteniez des protections magiques autour du domaine. Votre travail est impressionnant.' Aldwin hoche la tête avec respect : 'Peu de gens auraient remarqué ces détails. Tu as l'œil aiguisé de ton grand-père. Entre, nous avons beaucoup à discuter.'",speaker:"Maître Aldwin",mood:"impressed"},choices:[{text:"Suivre Aldwin dans le manoir",next:"interieur_manoir_respect",consequences:{flags:{earnedAldwinRespect:!0}}}]},rencontre_aldwin_respectueux:{metadata:{type:w.DIALOGUE,chapter:"prologue",tags:["patience","wisdom"],title:"La Patience Récompensée",character:"maitre_aldwin"},content:{text:"Tu sors de ta cachette et t'approches calmement. Aldwin te sourit : 'Ta patience et ton respect pour les mystères de ce lieu me plaisent. Tu as observé sans juger, attendu sans imposer. Ces qualités faisaient de ton grand-père un excellent Gardien.'",speaker:"Maître Aldwin",mood:"wise"},choices:[{text:"Exprimer ton honneur de cette comparaison",next:"interieur_manoir_honneur",consequences:{flags:{aldwinHighEsteem:!0}}}]},aldwin_vient_chercher:{metadata:{type:w.TEXT,chapter:"prologue",tags:["patient","mysterious"],title:"L'Invitation Inattendue"},content:{text:"Tu restes immobile, attendant de voir ce qui va se passer. Au bout de quelques minutes, tu entends des pas qui s'approchent de ta position. Aldwin apparaît entre les arbres, une lanterne à la main, et te sourit calmement : 'Je pensais bien que tu préférerais attendre. Viens, il est temps de parler.'"},choices:[{text:"Suivre Aldwin sans résistance",next:"interieur_manoir_confiance",consequences:{flags:{trustedAldwin:!0}}},{text:"Rester prudent mais accepter",next:"interieur_manoir_aldwin"}]},interieur_manoir_aldwin:{metadata:{type:w.TEXT,chapter:"prologue",tags:["manor","discovery"],title:"À l'Intérieur du Manoir"},content:{text:"L'intérieur du manoir est surprenant : bien que l'architecture soit ancienne, tout est impeccablement entretenu. Des livres rares tapissent les murs, et tu remarques plusieurs artefacts magiques disposés avec soin. Aldwin te guide vers un salon confortable où un feu crépite dans la cheminée."},choices:[{text:"Demander des explications sur ton héritage",next:"aldwin_histoire_famille"},{text:"Questionner sur les événements récents",next:"aldwin_explication_gardien",condition:"gameFlags.knowsAboutBlade"}]},interieur_manoir_respect:{metadata:{type:w.TEXT,chapter:"prologue",tags:["respect","heritage"],title:"Un Accueil d'Honneur"},content:{text:"Aldwin te fait visiter le manoir avec fierté, te montrant des portraits de tes ancêtres et des objets ayant appartenu à ta famille. 'Ton grand-père serait fier de voir que tu as hérité de son sens de l'observation. Les Gardiens ont toujours eu cette qualité.'"},choices:[{text:"Apprendre l'histoire des Gardiens",next:"aldwin_histoire_gardiens",consequences:{flags:{learnedGuardianHistory:!0}}}]},interieur_manoir_honneur:{metadata:{type:w.TEXT,chapter:"prologue",tags:["honor","legacy"],title:"L'Héritage d'Honneur"},content:{text:"Aldwin te mène vers un bureau où repose un portrait de ton grand-père tenant la Lame Éternelle. 'Aldric était un homme remarquable. Sa sagesse et sa patience étaient légendaires. Je vois ces mêmes qualités en toi.'"},choices:[{text:"Accepter de reprendre le flambeau familial",next:"acceptation_heritage",consequences:{flags:{acceptedLegacy:!0,aldwinHighEsteem:!0}}}]},interieur_manoir_confiance:{metadata:{type:w.TEXT,chapter:"prologue",tags:["trust","alliance"],title:"Une Alliance Naturelle"},content:{text:"Aldwin apprécie ta confiance immédiate. Dans son bureau, il sort une carte ancienne et des documents scellés : 'Ton grand-père m'a laissé des instructions précises pour le jour où un héritier reviendrait. Je pense que ce moment est arrivé.'"},choices:[{text:"Étudier les documents ensemble",next:"revelation_documents",consequences:{flags:{sawSecretDocuments:!0,trustedAldwin:!0}}}]},dialogue_kael_mefiance:{metadata:{type:w.DIALOGUE,chapter:"prologue",tags:["suspicion","ranger"],title:"Méfiance Justifiée",character:"kael_ranger"},content:{text:"'Qui es-tu vraiment ? Et qu'est-ce qui me prouve que tu n'es pas lié à ces créatures ?' Kael garde sa main près de son épée. 'J'ai vu trop d'innocents se révéler être des suppôts des ombres. Ta soudaine apparition ici n'est peut-être pas une coïncidence.'",speaker:"Kael le Rôdeur",mood:"suspicious"},choices:[{text:"Montrer ta lettre d'héritage comme preuve",next:"kael_preuve_heritage",action:{type:"skillCheck",skill:"persuasion",dc:13,onSuccess:"kael_convaincu",onFailure:"kael_reste_mefiant"}},{text:"Accepter sa méfiance et proposer un test",next:"kael_test"},{text:"Partir sans insister",next:"depart_sans_kael",consequences:{flags:{kaelRejected:!0}}}]},kael_test:{metadata:{type:w.TEXT,chapter:"prologue",tags:["test","proof"],title:"Épreuve de Confiance"},content:{text:"'Très bien, si tu veux prouver tes intentions, accompagne-moi. Il y a un groupe d'ombres mineures près du cimetière. Si tu m'aides à les éliminer sans fuir ou me trahir, j'accepterai de t'aider.' Kael semble sérieux dans sa proposition."},choices:[{text:"Accepter le test de combat",next:"test_combat_kael",consequences:{flags:{acceptedKaelTest:!0}}},{text:"Proposer un autre type de preuve",next:"kael_preuve_alternative"}]},kael_trustworthy:{metadata:{type:w.TEXT,chapter:"prologue",tags:["trust","success"],title:"Instinct Confirmé"},content:{text:"Ton instinct te dit que Kael est sincère. Ses cicatrices, sa façon de scruter les ombres, sa connaissance des créatures - tout indique un véritable chasseur d'ombres. 'Je vois que tu as l'œil pour juger les gens', dit-il en remarquant ton regard approbateur."},choices:[{text:"Faire confiance et accepter son aide",next:"kael_rejoint",consequences:{flags:{kaelJoined:!0,trustInstinct:!0}}}]},kael_uncertain:{metadata:{type:w.TEXT,chapter:"prologue",tags:["uncertainty","doubt"],title:"Doutes Persistants"},content:{text:"Quelque chose dans l'attitude de Kael te met mal à l'aise, sans que tu puisses identifier quoi exactement. Peut-être est-ce juste de la prudence naturelle, mais ton instinct te conseille la méfiance."},choices:[{text:"Accepter son aide malgré tes doutes",next:"kael_rejoint",consequences:{flags:{kaelJoined:!0,hasDoubts:!0},companions:["kael"]}},{text:"Poliment décliner son aide",next:"kael_refuse"}]},kael_refuse:{metadata:{type:w.DIALOGUE,chapter:"prologue",tags:["refusal","solo"],title:"Chemin Solitaire",character:"kael_ranger"},content:{text:"'Je vous remercie pour votre proposition, mais je préfère gérer cette situation seul.' Kael hoche la tête avec compréhension : 'Je respecte ton choix. Mais si tu changes d'avis, je chasse ces créatures dans les marais au nord. Fais attention à toi.'",speaker:"Kael le Rôdeur",mood:"understanding"},choices:[{text:"Partir explorer les tunnels seul",next:"tunnels_entree_solo",consequences:{flags:{kaelRefused:!0,goingSolo:!0}}},{text:"Retourner au manoir plutôt",next:"route_domaine"}]},repos_avec_kael:{metadata:{type:w.TEXT,chapter:"prologue",tags:["rest","preparation"],title:"Préparatifs avec Kael"},content:{text:"Kael et toi prenez le temps de vous reposer et de planifier l'exploration. Il partage ses connaissances sur les créatures d'ombre et vous prépare des provisions. 'Les tunnels peuvent être traîtres. Mieux vaut être préparé que désolé.'"},choices:[{text:"Explorer les tunnels ensemble",next:"tunnels_entree",consequences:{flags:{preparedWithKael:!0}}}]},repos_court_avec_kael:{metadata:{type:w.REST_SHORT,title:"Repos avec Kael"},content:{text:"Kael approuve votre décision. 'Sage choix. Prenons quelques minutes pour nous reposer et planifier notre approche.' Vous vous installez confortablement pendant que Kael partage ses  connaissances sur les tunnels."},next:"tunnels_entree"},chambre_millhaven:{metadata:{type:w.TEXT,chapter:"acte2",tags:["rest","inn"],title:"Chambre au Repos du Voyageur"},content:{text:"Tu prends une chambre à l'auberge pour la nuit. La chambre est confortable et bien plus luxueuse que celle de Ravenscroft. Par la fenêtre, tu peux observer l'activité nocturne de Millhaven - une ville qui ne dort jamais vraiment."},choices:[{text:"Te reposer pour la nuit",next:"reveil_millhaven",action:{type:"longRest"}},{text:"Redescendre au salon pour écouter les conversations",next:"observation_salon"}]},seraphina_echange:{metadata:{type:w.DIALOGUE,chapter:"acte2",tags:["negotiation","information"],title:"Négociation avec Dame Seraphina",character:"dame_seraphina"},content:{text:"'Mes informations ont une valeur, naturellement. En échange de mes archives, j'aimerais que vous m'emmeniez avec vous quand vous irez récupérer la Lame Éternelle. Mon expertise historique pourrait vous être précieuse.' Ses yeux brillent d'un intérêt particulier.",speaker:"Dame Seraphina",mood:"calculating"},choices:[{text:"Accepter qu'elle vous accompagne",next:"seraphina_rejoint",consequences:{flags:{seraphinaJoined:!0,seraphinaHidden:!0}}},{text:"Refuser et chercher les informations ailleurs",next:"refus_seraphina",consequences:{flags:{seraphinaRefused:!0}}},{text:"Demander pourquoi elle s'intéresse tant à la lame",next:"seraphina_motivations"}]},observation_reussie:{metadata:{type:w.TEXT,chapter:"acte2",tags:["observation","discovery"],title:"Détails Révélateurs"},content:{text:"En observant discrètement Dame Seraphina, tu remarques plusieurs détails troublants : elle porte un pendentif avec le même symbole que celui gravé près du manoir, ses parchemins semblent contenir des cartes détaillées de la région, et surtout, elle a une cicatrice étrange sur le poignet qui ressemble à une marque rituelle."},choices:[{text:"L'aborder avec ces observations",next:"dialogue_seraphina_suspicion",consequences:{flags:{noticedSeraphinaDetails:!0}}},{text:"Garder ces informations pour plus tard",next:"dialogue_seraphina_intro",consequences:{flags:{secretObservation:!0}}}]},observation_ratee:{metadata:{type:w.TEXT,chapter:"acte2",tags:["failure","noticed"],title:"Attention Attirée"},content:{text:"Dame Seraphina lève les yeux et te remarque qui l'observes. Elle sourit avec amusement : 'Vous semblez intéressé par mon travail. Approchez-vous donc, ne restez pas là à m'épier depuis l'entrée.' Son ton est amical mais tu sens qu'elle n'a rien raté de ton manège."},choices:[{text:"S'approcher et s'excuser",next:"dialogue_seraphina_intro",consequences:{flags:{caughtObserving:!0}}}]},repos_millhaven:{metadata:{type:w.TEXT,chapter:"acte2",tags:["rest","preparation"],title:"Préparatifs à Millhaven"},content:{text:"Votre groupe prend le temps de se reposer et de se préparer avant l'expédition vers les marais. Finn vérifie ses équipements, ajuste ses détecteurs, et prépare des provisions spéciales. 'Les marais sont imprévisibles, mais avec le bon matériel, nous devrions nous en sortir !'"},choices:[{text:"Partir bien reposés vers les marais",next:"marais_exploration",consequences:{flags:{wellRested:!0}}}]},finn_inventions:{metadata:{type:w.TEXT,chapter:"acte2",tags:["gnome","inventions"],title:"Merveilles Mécaniques"},content:{text:"Finn te fait visiter son atelier avec enthousiasme. Des gadgets étranges tapissent les étagères : détecteurs à cristaux, automates de poche, et même ce qui semble être un 'Répulseur d'Énergies Négatives Portable Mark III'. 'Chaque invention résout un problème spécifique !'"},choices:[{text:"Demander une démonstration de ses détecteurs",next:"finn_detecteur"},{text:"S'intéresser aux applications militaires",next:"finn_applications_combat"}]},finn_demonstration:{metadata:{type:w.TEXT,chapter:"acte2",tags:["proof","science"],title:"Démonstration Scientifique"},content:{text:"Finn active plusieurs de ses appareils. Ses détecteurs se mettent à bourdonner et affichent des lectures inquiétantes : 'Regardez ces mesures ! L'activité planaire dans cette région est 300% au-dessus de la normale. Et voici...' Il pointe vers les marais : 'Un pic d'activité majeur là-bas !'"},choices:[{text:"Impressionné, accepter qu'il vous accompagne",next:"finn_rejoint",consequences:{flags:{finnJoined:!0,sawDemonstration:!0}}}]},finn_refuse:{metadata:{type:w.TEXT,chapter:"acte2",tags:["refusal","disappointment"],title:"Opportunité Manquée"},content:{text:"Finn semble déçu mais comprend : 'Je respecte votre décision, mais c'est dommage. Mes détecteurs montrent des anomalies fascinantes dans cette région !' Il retourne à ses expériences en marmonnant sur les 'occasions scientifiques ratées'."},choices:[{text:"Partir vers les marais sans lui",next:"marais_exploration",consequences:{flags:{finnRefused:!0}}}]},chemin_detourne:{metadata:{type:w.TEXT,chapter:"acte2",tags:["alternate","safe"],title:"Voie de Contournement"},content:{text:"Tu choisis un chemin plus long mais apparemment plus sûr à travers les marais. Cette route vous fait contourner les zones les plus dangereuses, mais vous met à l'abri des rencontres hostiles."},choices:[{text:"Continuer prudemment",next:"arrivee_forteresse_sure"}]},chemin_sur:{metadata:{type:w.TEXT,chapter:"acte2",tags:["success","safe"],title:"Navigation Experte"},content:{text:"Tes compétences de survie te permettent de trouver un passage sûr à travers les marais. Vous évitez les zones dangereuses et arrivez à destination sans incident, conservant vos forces pour les défis à venir."},choices:[{text:"Approcher de la forteresse",next:"forteresse_ruines",consequences:{flags:{navigatedSafely:!0}}}]},analyse_magique:{metadata:{type:w.TEXT,chapter:"acte3",tags:["magic","analysis"],title:"Analyse Arcanique"},content:{text:"L'analyse magique révèle des informations troublantes : la forteresse est saturée d'énergies planaires qui forment des motifs complexes. Au centre, une source d'énergie massive pulse comme un cœur. Ces énergies ne sont pas naturelles - quelqu'un les canalise activement.",variations:{with_finn:"Finn confirme tes observations avec ses instruments : 'Les lectures sont ahurissantes ! Quelqu'un utilise cette forteresse comme amplificateur planaire !'"}},conditions:{show_variation:{with_finn:"gameFlags.finnJoined"}},choices:[{text:"Entrer avec ces informations cruciales",next:"entree_forteresse",consequences:{flags:{analyzedMagic:!0}}}]},passage_secret:{metadata:{type:w.TEXT,chapter:"acte3",tags:["stealth","secret"],title:"Entrée Discrète"},content:{text:"Kael repère une brèche dans le mur d'enceinte, camouflée par des lianes. 'Les anciens châteaux ont toujours des passages secrets. Celui-ci mène directement aux caves.' Cette approche vous permettra d'éviter les gardes mais vous ne savez pas ce qui vous attend à l'intérieur."},choices:[{text:"Utiliser le passage secret",next:"caves_forteresse",consequences:{flags:{usedSecretPassage:!0}}},{text:"Changer d'avis et prendre l'entrée principale",next:"entree_forteresse"}]},evaluation_forteresse:{metadata:{type:w.TEXT,chapter:"acte3",tags:["reconnaissance","planning"],title:"Reconnaissance Tactique"},content:{text:"Vous faites le tour de la forteresse pour évaluer la situation. Plusieurs observations importantes : des lumières bougent dans certaines tours, des traces récentes d'occupation, et surtout, le silence anormal - aucun bruit d'animal ou d'insecte dans un rayon de cent mètres."},choices:[{text:"Entrer par l'entrée principale avec un plan",next:"entree_forteresse",consequences:{flags:{plannedEntry:!0}}},{text:"Chercher une autre entrée",next:"passage_secret",condition:"gameFlags.kaelJoined"}]},exploration_salles:{metadata:{type:w.TEXT,chapter:"acte3",tags:["exploration","discovery"],title:"Salles Abandonnées"},content:{text:"Vous explorez les autres salles de la forteresse avant de vous diriger vers les voix. Vous découvrez des signes d'occupation récente : des lits de fortune, des restes de repas, et surtout, des cartes détaillées de la région avec des annotations en plusieurs langues."},choices:[{text:"Examiner les cartes plus attentivement",next:"decouverte_cartes",consequences:{flags:{foundMaps:!0}}},{text:"Se diriger vers les voix maintenant",next:"rencontre_zara"}]},repos_village:{metadata:{type:w.TEXT,chapter:"acte1",tags:["rest","village"],title:"Repos au Village"},content:{text:"Vous retournez au village pour vous reposer après votre premier combat contre les créatures d'ombre. Les villageois vous regardent avec un mélange de respect et d'inquiétude - vous avez prouvé que les ombres peuvent être combattues."},choices:[{text:"Partir vers Millhaven le lendemain",action:{type:"longRest",next:"route_millhaven"}}]},preparation_millhaven:{metadata:{type:w.TEXT,chapter:"acte1",tags:["preparation","journey"],title:"Préparatifs pour Millhaven"},content:{text:"Avant de partir vers les marais, vous décidez de retourner à Millhaven pour vous équiper et rassembler des informations. La ville possède des ressources que le petit village de Ravenscroft ne peut offrir."},choices:[{text:"Se rendre à Millhaven",next:"millhaven_auberge"}]},symbole_magique:{metadata:{type:w.TEXT,chapter:"acte1",tags:["magic","discovery"],title:"Symbole Ancien"},content:{text:"En tant que magicien, tu reconnais ce symbole : c'est une rune de liaison planaire, utilisée pour maintenir ouverts ou fermés les passages entre les mondes. Sa présence ici confirme que ces tunnels sont liés au mystère de la Lame Éternelle.",variations:{with_finn:"Finn confirme tes observations avec ses détecteurs : 'Ce symbole émet une signature énergétique unique ! Il est encore actif après toutes ces années !'"}},conditions:{show_variation:{with_finn:"gameFlags.finnJoined"}},choices:[{text:"Étudier le symbole plus attentivement",next:"etude_symbole_approfondie",consequences:{flags:{understoodPlanarRunes:!0}}},{text:"Continuer l'exploration",next:"chambre_scellee"}]},histoire_aldric:{metadata:{type:w.DIALOGUE,chapter:"acte2",tags:["lore","family"],title:"L'Histoire d'Aldric",character:"dame_seraphina"},content:{text:"'Votre grand-père Aldric était un homme tourmenté dans ses dernières années. Il parlait de visions, de murmures venant d'au-delà. Certains pensaient qu'il devenait fou, mais moi je crois qu'il percevait quelque chose que les autres ne pouvaient comprendre.'",speaker:"Dame Seraphina",mood:"mysterious"},choices:[{text:"Demander des détails sur ces visions",next:"visions_aldric"},{text:"Questionner sur sa disparition",next:"disparition_aldric"}]},localisation_forteresse:{metadata:{type:w.TEXT,chapter:"acte2",tags:["location","quest"],title:"Les Terres Englouties"},content:{text:"Dame Seraphina déroule une carte ancienne : 'Les 'terres englouties' font référence aux anciens marais de Sombremont, où se dressait autrefois la forteresse principale de votre famille. C'est là que les énergies planaires sont les plus fortes, et donc l'endroit le plus probable pour cacher la Lame.'"},choices:[{text:"Partir immédiatement vers la forteresse",next:"marais_exploration",consequences:{flags:{knowsForteressLocation:!0}}},{text:"Demander plus d'informations sur la forteresse",next:"informations_forteresse"}]},course_contre_seraphina:{metadata:{type:w.TEXT,chapter:"acte3",tags:["urgency","race"],title:"Course Contre la Montre"},content:{text:"Réalisant l'urgence de la situation, vous vous précipitez vers la chambre secrète, espérant atteindre la Lame Éternelle avant Seraphina. Mais en arrivant, vous découvrez qu'elle vous attendait déjà, un sourire cruel aux lèvres."},choices:[{text:"Confronter Seraphina immédiatement",next:"apparition_seraphina",consequences:{flags:{rushedConfrontation:!0}}}]},test_combat_kael:{metadata:{type:w.COMBAT,chapter:"prologue",tags:["test","trust"],title:"Épreuve des Ombres",next:"apres_test_kael"},content:{text:"Kael vous mène vers le cimetière où trois ombres mineures rôdent entre les tombes. 'Montrez-moi que vous pouvez tenir bon face à ces créatures', dit-il en dégainant son épée."},enemies:[{type:"ombre",count:1}],enemyPositions:[{x:4,y:1},{x:5,y:3},{x:6,y:2}],choices:[{text:"Prouver ta valeur !",action:{type:"combat"}}]},apres_test_kael:{metadata:{type:w.TEXT,chapter:"prologue",tags:["trust","earned"],title:"Confiance Gagnée"},content:{text:"Après le combat, Kael hoche la tête avec approbation : 'Vous avez du courage et de la compétence. Je retire mes doutes - vous êtes bien quelqu'un en qui je peux avoir confiance.' Il range son épée et vous tend la main."},choices:[{text:"Accepter son alliance",next:"kael_rejoint",consequences:{flags:{kaelJoined:!0,earnedTrust:!0,provedWorth:!0}}}]},tunnels_entree_solo:{metadata:{type:w.TEXT,chapter:"acte1",tags:["solo","exploration"],title:"Exploration Solitaire"},content:{text:"Sans l'aide de Kael, tu explores seul les tunnels sous le village. L'atmosphère est plus oppressante quand on est seul, et chaque bruit résonne étrangement dans l'obscurité. Tu avances avec prudence, ta seule source de lumière à la main."},choices:[{text:"Continuer malgré l'inquiétude",next:"decouverte_gravures",consequences:{flags:{exploredsolo:!0}}},{text:"Retourner chercher de l'aide",next:"taverne_lanterne"}]},depart_sans_kael:{metadata:{type:w.TEXT,chapter:"prologue",tags:["departure","solo"],title:"Voie Solitaire"},content:{text:"Tu quittes la taverne sans insister auprès de Kael. Parfois, il vaut mieux faire confiance à son instinct. Tu continues ton aventure seul, comptant sur tes propres capacités pour résoudre les mystères de ta famille."},choices:[{text:"Explorer les tunnels en solitaire",next:"tunnels_entree_solo"},{text:"Se diriger vers le manoir familial",next:"route_domaine"}]},...jg,...Tg,...Eg},hf=o=>{let l;const s=new Set,i=(g,y)=>{const b=typeof g=="function"?g(l):g;if(!Object.is(b,l)){const E=l;l=y??(typeof b!="object"||b===null)?b:Object.assign({},l,b),s.forEach(C=>C(l,E))}},u=()=>l,f={setState:i,getState:u,getInitialState:()=>v,subscribe:g=>(s.add(g),()=>s.delete(g))},v=l=o(i,u,f);return f},Rg=o=>o?hf(o):hf,zg=o=>o;function Hg(o,l=zg){const s=ke.useSyncExternalStore(o.subscribe,ke.useCallback(()=>l(o.getState()),[o,l]),ke.useCallback(()=>l(o.getInitialState()),[o,l]));return ke.useDebugValue(s),s}const gf=o=>{const l=Rg(o),s=i=>Hg(l,i);return Object.assign(s,l),s},Ni=o=>o?gf(o):gf,vf={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1},sl=new Map,_i=o=>{const l=sl.get(o);return l?Object.fromEntries(Object.entries(l.stores).map(([s,i])=>[s,i.getState()])):{}},Og=(o,l,s)=>{if(o===void 0)return{type:"untracked",connection:l.connect(s)};const i=sl.get(s.name);if(i)return{type:"tracked",store:o,...i};const u={connection:l.connect(s),stores:{}};return sl.set(s.name,u),{type:"tracked",store:o,...u}},wg=(o,l)=>{if(l===void 0)return;const s=sl.get(o);s&&(delete s.stores[l],Object.keys(s.stores).length===0&&sl.delete(o))},Lg=o=>{var l,s;if(!o)return;const i=o.split(`
`),u=i.findIndex(p=>p.includes("api.setState"));if(u<0)return;const m=((l=i[u+1])==null?void 0:l.trim())||"";return(s=/.+ (.+) .+/.exec(m))==null?void 0:s[1]},Bg=(o,l={})=>(s,i,u)=>{const{enabled:m,anonymousActionType:p,store:f,...v}=l;let g;try{g=(m??(vf?"production":void 0)!=="production")&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!g)return o(s,i,u);const{connection:y,...b}=Og(f,g,v);let E=!0;u.setState=(A,D,j)=>{const q=s(A,D);if(!E)return q;const B=j===void 0?{type:p||Lg(new Error().stack)||"anonymous"}:typeof j=="string"?{type:j}:j;return f===void 0?(y?.send(B,i()),q):(y?.send({...B,type:`${f}/${B.type}`},{..._i(v.name),[f]:u.getState()}),q)},u.devtools={cleanup:()=>{y&&typeof y.unsubscribe=="function"&&y.unsubscribe(),wg(v.name,f)}};const C=(...A)=>{const D=E;E=!1,s(...A),E=D},_=o(u.setState,i,u);if(b.type==="untracked"?y?.init(_):(b.stores[b.store]=u,y?.init(Object.fromEntries(Object.entries(b.stores).map(([A,D])=>[A,A===b.store?_:D.getState()])))),u.dispatchFromDevtools&&typeof u.dispatch=="function"){let A=!1;const D=u.dispatch;u.dispatch=(...j)=>{(vf?"production":void 0)!=="production"&&j[0].type==="__setState"&&!A&&(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),A=!0),D(...j)}}return y.subscribe(A=>{var D;switch(A.type){case"ACTION":if(typeof A.payload!="string"){console.error("[zustand devtools middleware] Unsupported action format");return}return Jc(A.payload,j=>{if(j.type==="__setState"){if(f===void 0){C(j.state);return}Object.keys(j.state).length!==1&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format.
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);const q=j.state[f];if(q==null)return;JSON.stringify(u.getState())!==JSON.stringify(q)&&C(q);return}u.dispatchFromDevtools&&typeof u.dispatch=="function"&&u.dispatch(j)});case"DISPATCH":switch(A.payload.type){case"RESET":return C(_),f===void 0?y?.init(u.getState()):y?.init(_i(v.name));case"COMMIT":if(f===void 0){y?.init(u.getState());return}return y?.init(_i(v.name));case"ROLLBACK":return Jc(A.state,j=>{if(f===void 0){C(j),y?.init(u.getState());return}C(j[f]),y?.init(_i(v.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return Jc(A.state,j=>{if(f===void 0){C(j);return}JSON.stringify(u.getState())!==JSON.stringify(j[f])&&C(j[f])});case"IMPORT_STATE":{const{nextLiftedState:j}=A.payload,q=(D=j.computedStates.slice(-1)[0])==null?void 0:D.state;if(!q)return;C(f===void 0?q:q[f]),y?.send(null,j);return}case"PAUSE_RECORDING":return E=!E}return}}),_},Mi=Bg,Jc=(o,l)=>{let s;try{s=JSON.parse(o)}catch(i){console.error("[zustand devtools middleware] Could not parse the received json",i)}s!==void 0&&l(s)},kg=o=>(l,s,i)=>{const u=i.subscribe;return i.subscribe=(p,f,v)=>{let g=p;if(f){const y=v?.equalityFn||Object.is;let b=p(i.getState());g=E=>{const C=p(E);if(!y(b,C)){const _=b;f(b=C,_)}},v?.fireImmediately&&f(b,b)}return u(g)},o(l,s,i)},Pg=kg;function Ug(o,l){let s;try{s=o()}catch{return}return{getItem:u=>{var m;const p=v=>v===null?null:JSON.parse(v,void 0),f=(m=s.getItem(u))!=null?m:null;return f instanceof Promise?f.then(p):p(f)},setItem:(u,m)=>s.setItem(u,JSON.stringify(m,void 0)),removeItem:u=>s.removeItem(u)}}const eo=o=>l=>{try{const s=o(l);return s instanceof Promise?s:{then(i){return eo(i)(s)},catch(i){return this}}}catch(s){return{then(i){return this},catch(i){return eo(i)(s)}}}},Gg=(o,l)=>(s,i,u)=>{let m={storage:Ug(()=>localStorage),partialize:A=>A,version:0,merge:(A,D)=>({...D,...A}),...l},p=!1;const f=new Set,v=new Set;let g=m.storage;if(!g)return o((...A)=>{console.warn(`[zustand persist middleware] Unable to update item '${m.name}', the given storage is currently unavailable.`),s(...A)},i,u);const y=()=>{const A=m.partialize({...i()});return g.setItem(m.name,{state:A,version:m.version})},b=u.setState;u.setState=(A,D)=>{b(A,D),y()};const E=o((...A)=>{s(...A),y()},i,u);u.getInitialState=()=>E;let C;const _=()=>{var A,D;if(!g)return;p=!1,f.forEach(q=>{var B;return q((B=i())!=null?B:E)});const j=((D=m.onRehydrateStorage)==null?void 0:D.call(m,(A=i())!=null?A:E))||void 0;return eo(g.getItem.bind(g))(m.name).then(q=>{if(q)if(typeof q.version=="number"&&q.version!==m.version){if(m.migrate){const B=m.migrate(q.state,q.version);return B instanceof Promise?B.then(F=>[!0,F]):[!0,B]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,q.state];return[!1,void 0]}).then(q=>{var B;const[F,W]=q;if(C=m.merge(W,(B=i())!=null?B:E),s(C,!0),F)return y()}).then(()=>{j?.(C,void 0),C=i(),p=!0,v.forEach(q=>q(C))}).catch(q=>{j?.(void 0,q)})};return u.persist={setOptions:A=>{m={...m,...A},A.storage&&(g=A.storage)},clearStorage:()=>{g?.removeItem(m.name)},getOptions:()=>m,rehydrate:()=>_(),hasHydrated:()=>p,onHydrate:A=>(f.add(A),()=>{f.delete(A)}),onFinishHydration:A=>(v.add(A),()=>{v.delete(A)})},m.skipHydration||_(),C||E},Xg=Gg,$t={"Projectile Magique":{name:"Projectile Magique",level:0,school:"Évocation",castingTime:"1 action",range:"36 mètres",description:"Vous créez trois fléchettes faites d'énergie magique brillante. Chacune touche une créature de votre choix, située à portée et dans votre champ de vision. Une fléchette inflige 1d4+1 dégâts de force à la cible. Toutes les fléchettes frappent leur cible en même temps, sachant que vous pouvez toutes les diriger contre une seule et même créature ou les répartir entre plusieurs.",damage:{dice:"1d4",bonus:1,type:"force"},projectiles:3,requiresAttackRoll:!1,castableOutOfCombat:!1,class:["Magicien"],aiWeight:80,targetPreference:"finishing",situational:{multipleEnemies:20,lowHPTarget:40,guaranteedHit:30},aiRoles:["dps","support"],combatStage:"any"},"Trait de Feu":{name:"Trait de Feu",level:1,school:"Évocation",castingTime:"1 action",range:"36 mètres",duration:"instantanée",description:"Vous lancez un trait enflammé sur une créature ou un objet à portée. Faites une attaque de sort à distance contre la cible. Si vous touchez, elle subit 1d10 dégâts de feu. Si le sort touche un objet inflammable qui n'est ni porté ni transporté, il s'embrase.",damage:{dice:"1d10",bonus:0,type:"feu"},projectiles:1,requiresAttackRoll:!0,castableOutOfCombat:!1,class:["Magicien"]},"Rayon de givre":{name:"Rayon de givre",level:0,school:"Évocation",castingTime:"1 action",range:"18 mètres",description:"Un rayon de lumière d'un blanc bleuté file vers une créature à portée. Faites une attaque de sort à distance contre la cible. Si vous la touchez, elle subit 1d8 dégâts de froid et sa vitesse est réduite de 3 mètres jusqu'au début de votre prochain tour.",damage:{dice:"1d8",bonus:0,type:"froid"},projectiles:1,requiresAttackRoll:!0,castableOutOfCombat:!1,class:["Magicien"]},"Rayon Ardent":{name:"Rayon Ardent",level:2,school:"Évocation",castingTime:"1 action",range:"36 mètres",description:"Vous créez trois rayons de feu et les projetez sur des cibles à portée. Vous pouvez les diriger contre une même cible ou contre des cibles différentes. Faites une attaque de sort à distance pour chaque rayon. Si vous touchez, la cible reçoit 2d6 dégâts.",damage:{dice:"2d6",bonus:0,type:"feu"},projectiles:3,requiresAttackRoll:!0,castableOutOfCombat:!1,class:["Magicien"]},"Boule de Feu":{name:"Boule de Feu",level:2,school:"Évocation",castingTime:"1 action",range:"45 mètres",description:"Une boule de feu explose dans une sphère de 6 mètres de rayon centrée sur un point à portée. Chaque créature dans la zone doit faire un jet de sauvegarde de Dextérité. En cas d'échec, elle subit 8d6 dégâts de feu, ou la moitié en cas de réussite.",damage:{dice:"8d6",bonus:0,type:"feu"},areaOfEffect:{shape:"sphere",radius:20},savingThrow:{ability:"dexterite",dc:"spell"},isAreaEffect:!0,saveType:"dexterite",saveDC:null,requiresAttackRoll:!1,castableOutOfCombat:!1,projectiles:1,class:["Magicien"]},"Toile d'araignée":{name:"Toile d'araignée",level:2,school:"Invocation",castingTime:"1 action",range:"18 mètres",description:"Vous invoquez une masse de toiles d'araignée épaisses et collantes à un point de votre choix situé à portée. Les toiles remplissent un cube de 6 mètres d'arête à partir de ce point. Les créatures dans la zone sont entravées.",damage:null,areaOfEffect:{shape:"cube",size:20},savingThrow:{ability:"dexterite",dc:"spell"},isAreaEffect:!0,saveType:"dexterite",saveDC:null,effect:"restrained",duration:"1 heure",requiresAttackRoll:!1,castableOutOfCombat:!0,class:["Magicien","Sorcier"]},"Armure du Mage":{name:"Armure du Mage",level:1,school:"Abjuration",castingTime:"1 action",range:"Toucher",description:"Vous touchez une créature consentante et non-vêtue d'une armure. Sa Classe d'Armure devient 13 + son modificateur de Dextérité.",requiresAttackRoll:!1,castableOutOfCombat:!0,class:["Magicien"]},Soins:{name:"Soins",level:1,school:"Évocation",castingTime:"1 action",range:"Toucher",description:"Une créature que vous touchez récupère un nombre de points de vie égal à 1d8 + votre modificateur de caractéristique d'incantation.",healing:{dice:"1d8",bonus:"wisdom"},requiresAttackRoll:!1,targetType:"ally",castableOutOfCombat:!0,class:["barde","clerc","druide","paladin","rodeur"]},Bénédiction:{name:"Bénédiction",level:1,school:"Enchantement",castingTime:"1 action",range:"9 mètres",duration:"Concentration, jusqu'à 1 minute",description:"Vous bénissez jusqu'à trois créatures de votre choix à portée. Chaque fois qu'une cible effectue un jet d'attaque ou de sauvegarde avant la fin du sort, elle peut lancer 1d4 et ajouter le résultat au jet.",buff:{attackBonus:"1d4",saveBonus:"1d4",duration:600},targetType:"ally",maxTargets:3,requiresAttackRoll:!1,castableOutOfCombat:!0,class:["clerc","paladin"]},Sanctuaire:{name:"Sanctuaire",level:1,school:"Abjuration",castingTime:"1 action bonus",range:"9 mètres",duration:"1 minute",description:"Vous protégez une créature à portée contre les attaques. Jusqu'à la fin du sort, toute créature qui cible la créature protégée avec une attaque ou un sort offensif doit d'abord effectuer un jet de sauvegarde de Sagesse.",buff:{protection:"sanctuary",saveDC:"spell",duration:600},targetType:"ally",requiresAttackRoll:!1,castableOutOfCombat:!0,class:["clerc"]},Aide:{name:"Aide",level:2,school:"Abjuration",castingTime:"1 action",range:"9 mètres",duration:"8 heures",description:"Votre sort renforce vos alliés avec endurance et résolution. Choisissez jusqu'à trois créatures à portée. Le maximum de points de vie de chaque cible augmente de 5 pour la durée du sort.",buff:{maxHPBonus:5,duration:28800},maxTargets:3,targetType:"ally",requiresAttackRoll:!1,castableOutOfCombat:!0,class:["clerc","paladin"]},Bouclier:{name:"Bouclier",level:1,school:"Abjuration",castingTime:"1 réaction",range:"Personnel",duration:"1 round",description:"Une barrière invisible de force magique apparaît et vous protège. Jusqu'au début de votre prochain tour, vous avez un bonus de +5 à la CA.",buff:{acBonus:5,duration:1},targetType:"self",requiresAttackRoll:!1,castableOutOfCombat:!1,class:["ensorceleur","Magicien"]}},Si={wizard:{name:"Elarion",familyName:"Thalendor",level:1,currentXP:0,race:"Haut Elfe",class:"Magicien",historic:"Érudit de l'Académie",maxHP:12,currentHP:12,ac:10,initiative:0,speed:"9m",proficiencyBonus:2,hitDice:1,hitDiceType:6,type:"player",gold:1e3,stats:{force:10,dexterite:15,constitution:12,intelligence:16,sagesse:13,charisme:12},proficiencies:{saves:["intelligence","sagesse"],skills:["arcane","histoire","investigation","perspicacite"]},weaponProficiencies:["simple"],spellcasting:{ability:"intelligence",spellSlots:{},knownSpells:[],cantrips:["Projectile Magique","Rayon de givre"],preparedSpells:["Armure du Mage"],activeSpells:{}},weapons:["dagger"],inventory:[]},warrior:{name:"Gareth",familyName:"Stonehaven",level:1,currentXP:0,race:"Humain",class:"Guerrier",historic:"Soldat Vétéran",maxHP:18,currentHP:18,ac:16,initiative:0,speed:"9m",proficiencyBonus:2,hitDice:1,hitDiceType:10,type:"player",stats:{force:16,dexterite:14,constitution:15,intelligence:10,sagesse:12,charisme:13},proficiencies:{saves:["force","constitution"],skills:["athletisme","intimidation","perception","survie"]},weaponProficiencies:["simple","martial"],armorProficiencies:["light","medium","heavy","shields"],weapons:["longsword","shortbow","heavybow","dagger"],armor:"chainmail",shield:!0,inventory:[]},rogue:{name:"Lyra",familyName:"Copperfoot",level:1,currentXP:0,race:"Halfelin",class:"Roublard",historic:"Criminel",maxHP:14,currentHP:14,ac:13,initiative:0,speed:"7.5m",proficiencyBonus:2,hitDice:1,hitDiceType:8,type:"player",stats:{force:15,dexterite:16,constitution:14,intelligence:13,sagesse:12,charisme:8},proficiencies:{saves:["dexterite","intelligence"],skills:["acrobaties","discretion","escamotage","investigation","perception","persuasion","tromperie"]},weaponProficiencies:["simple","longsword","rapier","shortsword","lightCrossbow"],armorProficiencies:["light"],weapons:["rapier","shortbow","dagger"],armor:"leather",specialAbilities:{sneakAttack:{name:"Attaque Sournoise",description:"1d6 dégâts supplémentaires si avantage ou allié adjacent",damage:"1d6",level:1},expertise:{name:"Expertise",description:"Double le bonus de maîtrise pour certaines compétences",skills:["discretion","escamotage"]}},inventory:[]},paladin:{name:"Elara",familyName:"Brightlance",level:1,currentXP:0,race:"Elfe",class:"Paladin",historic:"Templier",maxHP:16,currentHP:16,ac:18,initiative:0,speed:"9m",proficiencyBonus:2,hitDice:1,hitDiceType:10,type:"player",stats:{force:15,dexterite:12,constitution:14,intelligence:10,sagesse:13,charisme:16},proficiencies:{saves:["force","charisme"],skills:["athletisme","intimidation","medecine","persuasion"]},weaponProficiencies:["simple","martial"],armorProficiencies:["light","medium","heavy","shields"],weapons:["longsword","shield"],armor:"chainmail",shield:!0,inventory:[]}},Vg={1:{1:2},2:{1:3},3:{1:4,2:2},4:{1:4,2:3},5:{1:4,2:3,3:2}},Be=o=>Math.floor((o-10)/2),ll=o=>Math.floor(Math.random()*o)+1,$g=()=>ll(20),Ti=(o=0)=>$g()+o,yf=o=>{if(!o||!o.includes("d"))return 0;const[l,s]=o.split("d").map(Number);let i=0;for(let u=0;u<l;u++)i+=ll(s);return i},ot=(o,l)=>!o||!l||o.x===void 0||l.x===void 0?1/0:Math.abs(o.x-l.x)+Math.abs(o.y-l.y),xf=o=>Be(o.stats?.constitution||10),Aa={potionOfHealing:{name:"Potion de Soin",description:"Restaure 2d4 + 2 PV.",type:"consumable",iconType:"heal",weight:.5,use:o=>{const l=Math.floor(Math.random()*4)+1+Math.floor(Math.random()*4)+1+2,s=Math.min(o.maxHP,o.currentHP+l);return{...o,currentHP:s}},message:o=>`Tu as bu une Potion de Soin et récupères ${o} PV.`},potionOfSuperiorHealing:{name:"Potion de Soin Supérieure",description:"Restaure 4d4 + 4 PV.",type:"consumable",iconType:"heal",weight:.5,use:o=>{let l=0;for(let i=0;i<4;i++)l+=Math.floor(Math.random()*4)+1;l+=4;const s=Math.min(o.maxHP,o.currentHP+l);return{...o,currentHP:s}},message:o=>`Tu as bu une Potion de Soin Supérieure et récupères ${o} PV.`},scrollOfStrength:{name:"Parchemin de Force",description:"Augmente ta Force de 2 de manière permanente.",type:"consumable",iconType:"upgrade",weight:.1,use:o=>({...o,stats:{...o.stats,force:o.stats.force+2}}),message:()=>"Tu as lu un Parchemin de Force et te sens plus puissant !"},scrollOfDexterity:{name:"Parchemin d'Agilité",description:"Augmente ta Dextérité de 2 de manière permanente.",type:"consumable",iconType:"upgrade",weight:.1,use:o=>({...o,stats:{...o.stats,dexterite:o.stats.dexterite+2}}),message:()=>"Tu as lu un Parchemin d'Agilité et te sens plus agile !"},scrollOfConstitution:{name:"Parchemin de Vitalité",description:"Augmente ta Constitution de 2 de manière permanente et tes PV maximum de 2.",type:"consumable",iconType:"upgrade",weight:.1,use:o=>({...o,stats:{...o.stats,constitution:o.stats.constitution+2},maxHP:o.maxHP+2,currentHP:o.currentHP+2}),message:()=>"Tu as lu un Parchemin de Vitalité, ton corps se renforce et tu gagnes des PV !"},scrollOfIntelligence:{name:"Parchemin d'Intelligence",description:"Augmente ton Intelligence de 2 de manière permanente.",type:"consumable",iconType:"upgrade",rarity:"légendaire",weight:.1,use:o=>({...o,stats:{...o.stats,intelligence:o.stats.intelligence+2}}),message:()=>"Tu as lu un Parchemin d'Intelligence et tes facultés augmentent !"},scrollOfSagesse:{name:"Parchemin de Sagesse",description:"Augmente ta Sagesse de 2 de manière permanente.",type:"consumable",iconType:"upgrade",weight:.1,use:o=>({...o,stats:{...o.stats,sagesse:o.stats.sagesse+2}}),message:()=>"Tu as lu un Parchemin de Sagesse et te sens plus sae !"},bookArtHeal:{name:"Livre l'art de la prestidigitation",description:"C'est un jolie livre vous devriez le lire",type:"consumable",iconType:"heal",weight:.8,use:o=>{const s=Math.min(o.maxHP,o.currentHP+2);return{...o,currentHP:s}},message:()=>"Tu as lu ce livre pendant une heure et tu t'es un peu reposé, tu as récuperer 2PV"}},Wt={dagger:{name:"Dague",id:"dagger",type:"weapon",category:"melee",damage:{dice:"1d4",bonus:0,type:"force"},damageType:"perforant",properties:["finesse","light","thrown"],range:{melee:1,thrown:"20/60"},stat:"force",description:"Une petite lame facile à manier."},club:{name:"Gourdin",id:"club",type:"weapon",category:"melee",damage:{dice:"1d4",bonus:0,type:"force"},damageType:"contondant",properties:["light"],range:{melee:1},stat:"force",description:"Un simple bâton de bois."},quarterstaff:{name:"Bâton",id:"quarterstaff",type:"weapon",category:"melee",damage:{dice:"1d6",bonus:0,type:"force"},damageType:"contondant",properties:["versatile"],range:{melee:1},stat:"force",description:"Un bâton solide pouvant être manié à une ou deux mains."},longsword:{name:"Épée longue",id:"longsword",type:"weapon",category:"melee",damage:{dice:"1d8",bonus:0,type:"force"},damageType:"tranchant",properties:["versatile"],range:{melee:1},stat:"force",description:"Une épée classique, équilibrée et polyvalente."},shortsword:{name:"Épée courte",id:"shortsword",type:"weapon",category:"melee",damage:{dice:"1d6",bonus:0,type:"force"},damageType:"perforant",properties:["finesse","light"],range:{melee:1},stat:"force",description:"Une lame courte et rapide."},rapier:{name:"Rapière",id:"rapier",type:"weapon",category:"melee",damage:{dice:"1d8",bonus:0,type:"dexterite"},damageType:"perforant",properties:["finesse"],range:{melee:1},stat:"dexterite",description:"Une épée d'estoc élégante et précise."},battleaxe:{name:"Hache de bataille",id:"battleaxe",type:"weapon",category:"melee",damage:{dice:"1d8",bonus:0,type:"force"},damageType:"tranchant",properties:["versatile"],range:{melee:1},stat:"force",description:"Une hache lourde et tranchante."},warhammer:{name:"Marteau de guerre",id:"warhammer",type:"weapon",category:"melee",damage:{dice:"1d8",bonus:0,type:"force"},damageType:"contondant",properties:["versatile"],range:{melee:1},stat:"force",description:"Un marteau lourd conçu pour le combat."},greatsword:{name:"Épée à deux mains",id:"greatsword",type:"weapon",category:"melee",damage:{dice:"2d6",bonus:0,type:"force"},damageType:"tranchant",properties:["heavy","two-handed"],range:{melee:1},stat:"force",description:"Une épée massive nécessitant les deux mains."},lightCrossbow:{name:"Arbalète légère",id:"lightCrossbow",type:"weapon",category:"ranged",damage:{dice:"1d8",bonus:0,type:"dexterite"},damageType:"perforant",properties:["ammunition","loading","two-handed"],range:{ranged:"80/320"},stat:"dexterite",description:"Une arbalète facile à manier."},shortbow:{name:"Arc court",id:"shortbow",type:"weapon",category:"ranged",damage:{dice:"1d6",bonus:0,type:"dexterite"},damageType:"perforant",properties:["ammunition","two-handed"],range:{ranged:"80/320"},stat:"dexterite",description:"Un arc compact et maniable."},longbow:{name:"Arc long",id:"longbow",type:"weapon",category:"ranged",damage:{dice:"1d8",bonus:0,type:"dexterite"},damageType:"perforant",properties:["ammunition","heavy","two-handed"],range:{ranged:"150/600"},stat:"dexterite",description:"Un arc puissant avec une longue portée."},heavybow:{name:"Arc lourd",id:"heavybow",type:"weapon",category:"ranged",damage:{dice:"1d10",bonus:0,type:"dexterite"},damageType:"perforant",properties:["ammunition","heavy","two-handed"],range:{ranged:"200/800"},stat:"dexterite",description:"Un arc de guerre exceptionnellement puissant, difficile à bander."},heavyCrossbow:{name:"Arbalète lourde",id:"heavyCrossbow",type:"weapon",category:"ranged",damage:{dice:"1d10",bonus:0,type:"dexterite"},damageType:"perforant",properties:["ammunition","heavy","loading","two-handed"],range:{ranged:"100/400"},stat:"dexterite",description:"Une arbalète puissante mais lente à recharger."},arccheat:{name:"Arc Du MJ",id:"arccheat",type:"weapon",category:"ranged",damage:{dice:"1d10",bonus:50,type:"intelligence"},damageType:"perforant",properties:["ammunition","heavy","two-handed"],range:{ranged:"150/600"},stat:"intelligence",description:"Un arc d'une grande précision, fabriqué à partir du bois d'un arbre ancien.",rarity:"Légendaire",weight:3}};class Yg{static findItemById(l){let s=Aa[l];return s||(s=Wt[l]),s||null}static findItemsByIds(l){return l.map(s=>this.findItemById(s)).filter(Boolean)}static getAllItems(){return{...Aa,...Wt}}static getConsumableItems(){return Aa}static getWeapons(){return Wt}static itemExists(l){return!!this.findItemById(l)}static getItemsByType(l){const s=this.getAllItems();return Object.values(s).filter(i=>i.type===l)}static processItemRewards(l,s,i){l.forEach(u=>{const m=this.findItemById(u);if(m){const p={...m,id:u};s(p),i(`📦 Objet obtenu : ${m.name||m.nom||u}`)}else console.error(`❌ Item non trouvé dans items.js ou weapons.js : ${u}`)})}}const to=8,ao=6,jt={PLAYER:"player",COMPANION:"companion",ENEMY:"enemy"},ns=(o,l)=>o>=0&&o<to&&l>=0&&l<ao;class Ce{static rollD20(){return Math.floor(Math.random()*20)+1}static rollDamage(l){const s=l.match(/(\d+)d(\d+)(\+(\d+))?/);if(!s)return 0;const[,i,u,,m]=s;let p=0;for(let f=0;f<parseInt(i);f++)p+=Math.floor(Math.random()*parseInt(u))+1;return p+(parseInt(m)||0)}static calculateAttackBonus(l,s){if(s.attackBonus!==void 0)return s.attackBonus;const i=l.level?Math.ceil(l.level/4)+1:2;if(!l.stats)return console.error("❌ Character.stats missing in calculateAttackBonus:",l),0;let u="force";s.stat?u=s.stat:(s.category==="ranged"||s.type==="ranged"||s.range&&s.range>1)&&(u="dexterite");const m=l.stats[u];return m===void 0?(console.error(`❌ Stat ${u} missing for character:`,l),i):Be(m)+i}static calculateSpellAttackBonus(l){const s=l.level?Math.ceil(l.level/4)+1:2;if(!l.spellcasting||!l.spellcasting.ability)return s;const i=l.spellcasting.ability,u=l.stats[i];return Be(u||10)+s}static calculateSaveBonus(l,s){if(!l.stats)return 0;const i=Be(l.stats[s]||10),u=l.level?Math.ceil(l.level/4)+1:0,m=l.saveBonus?.[s]||0;return i+u+m}static isDefeated(l){return l.currentHP<=0}static doesAttackHit(l,s){return l>=s}static getInitiativeBonus(l){return Be(l.stats?.dexterite||10)}static isPositionOccupied(l,s,i,u=[],m=null){if(i.player&&i.player.x===l&&i.player.y===s)return!0;for(const p in i)if(p!=="player"&&p!==m&&!p.endsWith("StartPos")){const f=i[p];if(f&&f.x===l&&f.y===s)return!0}for(const p of u)if(p.name!==m&&p.currentHP>0){const f=i[p.name];if(f&&f.x===l&&f.y===s)return!0}return!1}static isTargetInRange(l,s,i){if(!l||!s)return!1;const u=Math.abs(l.x-s.x)+Math.abs(l.y-s.y),m=this.getActionRange(i);return u<=m}static getActionRange(l){if(l.actionType==="spell"){if(typeof l.range=="string"){if(l.range.includes("mètres")){const s=parseInt(l.range);return Math.floor(s/1.5)}return l.range==="Toucher"?1:12}return l.range||12}if(l.actionType==="weapon"){if(l.category==="melee")return l.range?.melee||1;if(l.category==="ranged"){const s=l.range?.ranged||"80/320",i=parseInt(s.split("/")[0]);return Math.floor(i/5)}return 1}return 1}static rollD6(){return Math.floor(Math.random()*6)+1}static rollD8(){return Math.floor(Math.random()*8)+1}static rollD10(){return Math.floor(Math.random()*10)+1}static calculateDamage(l){let s=yf(l.damageDice)+(l.damageBonus||0),i=`${s} dégâts ${l.damageType}`;if(l.secondaryDamageDice){const u=yf(l.secondaryDamageDice)+(l.secondaryDamageBonus||0);s+=u,i+=` + ${u} dégâts ${l.secondaryDamageType} (${s}dmg)`}return{damage:s,message:i}}static getTargetsInRange(l,s,i,u){const{playerCharacter:m,activeCompanions:p=[],combatEnemies:f,combatPositions:v}=u,g=[];if(!s)return g;const y=this.getActionRange(i);return l.type===jt.ENEMY&&m?.currentHP>0&&v.player&&ot(s,v.player)<=y&&g.push({...m,type:jt.PLAYER,position:v.player}),l.type===jt.ENEMY&&p.length>0&&p.forEach(b=>{if(b?.currentHP>0){const E=v[b.id];E&&ot(s,E)<=y&&g.push({...b,type:jt.COMPANION,position:E})}}),[jt.PLAYER,jt.COMPANION].includes(l.type)&&f.forEach(b=>{if(b.currentHP>0){const E=v[b.name];E&&ot(s,E)<=y&&g.push({...b,type:jt.ENEMY,position:E})}}),g}static calculateOptimalMovement(l,s,i){if(!s||l.currentHP<=0)return null;const u=this.findPotentialTargets(l,i);if(u.length===0)return null;const m=u.reduce((E,C)=>{const _=ot(s,C.position);return!E||_<E.distance?{target:C,distance:_}:E},null);if(!m)return null;const p=this.getIdealDistance(l),f=l.role==="dps"||l.role==="support"||l.role==="healer",v=this.isAdjacentToAnyEnemy(l,s,i);if(f&&v&&p>1)return this.findSafeRetreatPosition(l,s,i,p);if(m.distance<=p)return null;const g=l.movement||6;let y=null,b=-1;for(let E=-g;E<=g;E++)for(let C=-g;C<=g;C++){const _=Math.abs(E)+Math.abs(C);if(_===0||_>g)continue;const A={x:s.x+E,y:s.y+C};if(!ns(A.x,A.y)||this.isPositionOccupied(A.x,A.y,i.combatPositions,i.combatEnemies,l.name))continue;const D=ot(A,m.target.position),q=100-Math.abs(D-p)-_*.1;q>b&&(b=q,y=A)}return y}static findPotentialTargets(l,s){const{playerCharacter:i,combatEnemies:u,combatPositions:m,activeCompanions:p=[]}=s,f=[];return l.type===jt.ENEMY?(i?.currentHP>0&&m.player&&f.push({entity:i,position:m.player}),p&&p.length>0&&p.forEach(v=>{if(v&&v.currentHP>0){const g=v.id||v.name.toLowerCase(),y=m[g];y&&f.push({entity:v,position:y})}})):u.forEach(v=>{v.currentHP>0&&m[v.name]&&f.push({entity:v,position:m[v.name]})}),f}static getIdealDistance(l){if(!l.attacks)return 1;if(l.role)switch(l.role){case"tank":return 1;case"healer":case"support":return 3;case"dps":if(l.attacks.some(m=>m.type==="ranged"||m.range&&m.range>1)){const m=l.attacks.find(p=>p.type==="ranged");return Math.min(5,m?.range||4)}return 1}const s=l.attacks.some(u=>u.type==="ranged"||u.range&&u.range>1),i=l.attacks.some(u=>u.type==="melee"||!u.range||u.range<=1);if(i&&!s)return 1;if(s&&!i){const u=l.attacks.find(m=>m.type==="ranged");return Math.min(4,u?.range||4)}else return 1}static isAdjacentToAnyEnemy(l,s,i){return(l.type==="enemy"?[i.playerCharacter,...i.activeCompanions||[]]:i.combatEnemies||[]).some(m=>{if(!m||m.currentHP<=0)return!1;const p=l.type==="enemy"?m.id?i.combatPositions?.[m.id]:i.combatPositions?.player:i.combatPositions?.[m.name];return p?ot(s,p)<=1:!1})}static findSafeRetreatPosition(l,s,i,u){const m=l.movement||6,p=i.combatEnemies||[];let f=null,v=-1;for(let g=-m;g<=m;g++)for(let y=-m;y<=m;y++){const b=Math.abs(g)+Math.abs(y);if(b===0||b>m)continue;const E={x:s.x+g,y:s.y+y};if(!this.isValidPosition(E,i)||this.wouldTriggerOpportunityAttack(s,E,i))continue;const _=p.reduce((j,q)=>{if(!q||q.currentHP<=0)return j;const B=i.combatPositions?.[q.name];if(!B)return j;const F=ot(E,B);return Math.min(j,F)},1/0),A=Math.abs(_-u),D=_*10-A*5;D>v&&(v=D,f=E)}return f}static wouldTriggerOpportunityAttack(l,s,i){return(i.combatEnemies||[]).some(m=>{if(!m||m.currentHP<=0)return!1;const p=i.combatPositions?.[m.name];if(!p)return!1;const f=ot(l,p)<=1,v=ot(s,p)<=1;return f&&!v})}static calculateAoESquares(l,s){const i=[];if(!l||!s)return i;switch(s.shape){case"sphere":case"circle":const u=s.size||1;for(let f=l.x-u;f<=l.x+u;f++)for(let v=l.y-u;v<=l.y+u;v++)ns(f,v)&&ot(l,{x:f,y:v})<=u&&i.push({x:f,y:v});break;case"cone":const m=s.size||2;for(let f=1;f<=m;f++)for(let v=-f;v<=f;v++){const g=l.x+f,y=l.y+v;ns(g,y)&&i.push({x:g,y})}break;case"line":const p=s.size||3;for(let f=1;f<=p;f++){const v=l.x+f,g=l.y;ns(v,g)&&i.push({x:v,y:g})}break;default:i.push(l)}return i}static findBestTarget(l,s,i){const{playerCharacter:u,combatPositions:m,activeCompanions:p=[]}=i;if(!s)return console.warn(`⚠️ Pas de position pour ${l.name}`),null;const f=[];if(l.type===jt.ENEMY?(u&&u.currentHP>0&&m.player&&f.push({type:jt.PLAYER,name:u.name,character:u,position:m.player}),p&&p.length>0&&p.forEach(y=>{if(y&&y.currentHP>0){const b=y.id||y.name.toLowerCase(),E=m[b];E&&f.push({type:jt.COMPANION,name:y.name,character:y,position:E})}})):(l.type===jt.COMPANION||l.type==="companion")&&i.combatEnemies&&i.combatEnemies.forEach(y=>{y.currentHP>0&&m[y.name]&&f.push({type:jt.ENEMY,name:y.name,character:y,position:m[y.name]})}),f.length===0)return null;let v=null,g=1/0;return f.forEach(y=>{const b=ot(s,y.position);b<g?(g=b,v=y):b===g&&y.type===jt.PLAYER&&(v=y)}),v&&(v.distance=g),v}static validateMovement(l,s,i,u){if(!ns(i.x,i.y))return console.warn(`❌ Position invalide pour ${l.name}: (${i.x}, ${i.y})`),!1;const{combatPositions:m,combatEnemies:p}=u;if(this.isPositionOccupied(i.x,i.y,m,p,l.name))return console.warn(`❌ Position occupée pour ${l.name}: (${i.x}, ${i.y})`),!1;const v=ot(s,i),g=l.movement||6;return v>g?(console.warn(`❌ Mouvement trop loin pour ${l.name}: ${v} > ${g}`),!1):!0}static handleSkillCheck(l,s,i){const m={perception:"sagesse",investigation:"intelligence",athletics:"force",acrobatics:"dexterite",stealth:"dexterite",insight:"sagesse",persuasion:"charisme",intimidation:"charisme",deception:"charisme",history:"intelligence",arcana:"intelligence",nature:"intelligence",religion:"intelligence",medicine:"sagesse",survival:"sagesse","animal-handling":"sagesse"}[l],p=i.stats[m],f=Be(p),g=i.proficiencies?.skills?.includes(l)||!1?i.proficiencyBonus:0,y=f+g,b=Ti(y),E=b>=s;return{roll:b-y,skillBonus:y,total:b,dc:s,success:E,skill:l,statName:m,message:`Test de ${l} (${m}): ${b-y} (+${y} de bonus) = ${b}. DD: ${s}`}}static calculateHitDieHealing(l){if(l.hitDice<=0)return{healing:0,character:l,canHeal:!1,message:"Aucun dé de vie disponible"};if(l.currentHP>=l.maxHP)return{healing:0,character:l,canHeal:!1,message:"PV déjà au maximum"};const s=l.hitDiceType||8,i=Be(l.stats.constitution),u=ll(s),m=Math.max(1,u+i),p=Math.min(l.maxHP,l.currentHP+m),f={...l,currentHP:p,hitDice:l.hitDice-1};return{healing:m,character:f,canHeal:!0,roll:u,constitutionModifier:i,message:`Dé de vie (d${s}): ${u} + ${i} = ${m} PV récupérés`}}}class ra{static generateId(l="id"){return`${l}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}static deepClone(l){if(l===null||typeof l!="object")return l;if(l instanceof Date)return new Date(l.getTime());if(l instanceof Array)return l.map(i=>this.deepClone(i));const s={};for(const i in l)l.hasOwnProperty(i)&&(s[i]=this.deepClone(l[i]));return s}static isChoiceAvailable(l,s){return l.conditions?l.conditions.every(i=>{switch(i.type){case"hasItem":return s.playerCharacter.inventory.some(m=>m.id===i.itemId);case"hasCompanion":return s.playerCompanion!==null;case"minLevel":return s.playerCharacter.level>=i.level;case"hasSpell":return[...s.playerCharacter.spellcasting?.cantrips||[],...s.playerCharacter.spellcasting?.preparedSpells||[]].includes(i.spellName);case"statCheck":return s.playerCharacter.stats[i.stat]>=i.value;default:return!0}}):!0}}const Qg={hasSymbol:!1,manuscriptRead:!1,bridgeSecretFound:!1,tyrionMet:!1,tyrionRejected:!1,tyrionDelayed:!1,rhingannMet:!1,completedGoblinQuest:!1,visitedTavern:!1,coldWeather:!1,questActive:!1,reputation:0,companions:[],completedQuests:[],visitedLocations:[],majorChoices:[],npcRelations:{tyrion:0,aldric:0,rhingann:0},tutorialCompleted:!1,firstCombat:!0,discoveredSecrets:[],learnedSpells:[],lastTavernVisit:null,currentWeather:"clear",pacifistRun:!0,perfectDiplomat:!0,treasureHunter:0,academyReturns:0,tavernRoomKey:!1,aldricTrust:0},nt={getInitialFlags:()=>({...Qg}),hasFlag:(o,l)=>o.hasOwnProperty(l),getFlag:(o,l,s=!1)=>o[l]??s,setFlag:(o,l,s)=>({...o,[l]:s}),setFlags:(o,l)=>({...o,...l}),addToList:(o,l,s)=>{const i=o[l]||[];return i.includes(s)?o:{...o,[l]:[...i,s]}},removeFromList:(o,l,s)=>{const i=o[l]||[];return{...o,[l]:i.filter(u=>u!==s)}},updateNpcRelation:(o,l,s)=>{const i=o.npcRelations?.[l]||0,u=Math.max(-100,Math.min(100,i+s));return{...o,npcRelations:{...o.npcRelations,[l]:u}}},updateReputation:(o,l)=>{const s=Math.max(-100,Math.min(100,(o.reputation||0)+l));return{...o,reputation:s}},addMajorChoice:(o,l,s,i)=>{const u={id:l,description:s,sceneId:i,timestamp:Date.now()};return{...o,majorChoices:[...o.majorChoices||[],u]}},visitLocation:(o,l)=>nt.addToList(o,"visitedLocations",l),completeQuest:(o,l)=>nt.addToList(o,"completedQuests",l),isQuestCompleted:(o,l)=>(o.completedQuests||[]).includes(l),getNpcRelation:(o,l)=>o.npcRelations?.[l]||0,getNpcRelationStatus:(o,l)=>{const s=nt.getNpcRelation(o,l);return s>=75?"Adoré":s>=50?"Ami proche":s>=25?"Ami":s>=10?"Sympathique":s>=-10?"Neutre":s>=-25?"Méfiant":s>=-50?"Hostile":s>=-75?"Ennemi":"Ennemi juré"},debugFlags:o=>{console.group("🏴 Game Flags Debug"),console.log("Reputation:",o.reputation),console.log("Companions:",o.companions),console.log("NPC Relations:",o.npcRelations),console.log("Completed Quests:",o.completedQuests),console.log("Visited Locations:",o.visitedLocations),console.log("Major Choices:",o.majorChoices),console.groupEnd()}},Zg=""+new URL("tyrion-Cl-F8-rO.png",import.meta.url).href,Kg=""+new URL("rhingann-CamkbPql.png",import.meta.url).href,Df={tyrion:{name:"Tyrion",level:1,race:"Humain",class:"Jeune Guerrier",historic:"Chercheur de Reliques",role:"tank",maxHP:12,currentHP:12,ac:18,initiative:0,speed:"9m",proficiencyBonus:2,hitDice:1,hitDiceType:6,type:"companion",stats:{force:18,dexterite:16,constitution:15,intelligence:13,sagesse:10,charisme:12},movement:6,image:Zg,attacks:[{name:"son Épée longue",type:"melee",range:1,description:"Une attaque avec une épée longue",damageDice:"1d8",damageType:"tranchant",stat:"force"}],inventory:[],aiPriority:["protect","taunt","melee_attack"],aiModifiers:{protect:{allyLowHPBonus:60,allyUnderAttackBonus:40,emergencyBonus:100},taunt:{multipleEnemiesBonus:30,strongEnemyBonus:45,allyInMeleeBonus:25},melee_attack:{closestEnemyBonus:20,finishingBonus:35,revengeBonus:30}},spellcasting:null},rhingann:{name:"Rhingann",level:1,race:"Naine",class:"Clerc",historic:"",role:"healer",maxHP:13,currentHP:13,ac:14,initiative:0,speed:"9m",proficiencyBonus:2,hitDice:1,hitDiceType:8,type:"companion",stats:{force:14,dexterite:10,constitution:14,intelligence:10,sagesse:18,charisme:10},movement:6,image:Kg,attacks:[{name:"son Marteau de guerre",type:"melee",range:1,description:"Une attaque avec un marteau de guerre",damageDice:"1d8",damageType:"contondant",stat:"force"}],inventory:[],aiPriority:["heal","buff","ranged_support"],aiModifiers:{heal:{criticalHPBonus:150,tankPriorityBonus:60,selfPreservationBonus:80,multipleWoundedBonus:40},buff:{preCombatBonus:70,tankBuffBonus:50,groupBuffBonus:45},ranged_support:{safeDistanceBonus:30,finishingBonus:40,enemyCasterBonus:35}},spellcasting:{class:"Clerc",spellSlots:{1:{total:2,used:0}},knownSpells:["Soins","Bénédiction"],preparedSpells:["Soins","Bénédiction"],slotsRemaining:{1:2}}},kael:{name:"Kael",level:1,race:"Elfe des bois",class:"Rôdeur",historic:"Chasseur Solitaire",role:"tank",maxHP:13,currentHP:13,ac:15,initiative:0,speed:"9m",proficiencyBonus:2,hitDice:1,hitDiceType:10,type:"companion",stats:{force:12,dexterite:16,constitution:12,intelligence:10,sagesse:14,charisme:8},movement:6,image:Cf,attacks:[{name:"Épée Courte",type:"melee",range:1,description:"Une attaque avec une épée courte.",damageDice:"1d6",damageType:"perforant",stat:"dexterite"}],inventory:[],aiPriority:["ranged_attack","support_skill"],spellcasting:{class:"Rôdeur",spellSlots:null,knownSpells:[],preparedSpells:[]}},finn:{name:"Finn",level:1,race:"Gnome",class:"Inventeur",historic:"Génie Mécanique",role:"support",maxHP:10,currentHP:10,ac:13,initiative:0,speed:"7.5m",proficiencyBonus:2,hitDice:1,hitDiceType:8,type:"companion",stats:{force:8,dexterite:14,constitution:12,intelligence:18,sagesse:13,charisme:11},movement:5,image:Nf,attacks:[{name:"Dague de précision",type:"melee",range:1,description:"Une dague légère et précise",damageDice:"1d4",damageType:"perforant",stat:"dexterite"},{name:"Projectile énergétique",type:"ranged",range:6,description:"Dispositif de tir à énergie concentrée",damageDice:"1d6",damageType:"force",stat:"intelligence"}],inventory:["Détecteur planaire Mark VII","Kit d'inventeur","Composants mécaniques"],aiPriority:["support_skill","ranged_attack","heal"],spellcasting:{class:"Inventeur",spellSlots:{1:{total:1,used:0}},knownSpells:["Détection de la magie","Réparation"],preparedSpells:["Détection de la magie","Réparation"],slotsRemaining:{1:1}}},zara:{name:"Zara",level:2,race:"Humaine",class:"Sorcière",historic:"Érudite Planaire",role:"dps",maxHP:14,currentHP:14,ac:12,initiative:0,speed:"9m",proficiencyBonus:2,hitDice:2,hitDiceType:6,type:"companion",stats:{force:9,dexterite:13,constitution:14,intelligence:16,sagesse:15,charisme:17},movement:6,image:Mf,attacks:[{name:"Bâton mystique",type:"melee",range:1,description:"Un bâton imprégné d'énergie magique",damageDice:"1d6",damageType:"contondant",stat:"force"},{name:"Trait de feu",type:"ranged",range:12,description:"Projectile magique enflammé",damageDice:"1d10",damageType:"feu",stat:"charisme"}],inventory:["Grimoire planaire","Composants de sorts","Cristal de focalisation"],aiPriority:["ranged_spell","area_damage","debuff"],spellcasting:{class:"Sorcière",spellSlots:{1:{total:3,used:0},2:{total:1,used:0}},knownSpells:["Trait de feu","Bouclier","Détection de la magie","Invisibilité","Toile d'araignée"],preparedSpells:["Trait de feu","Bouclier","Détection de la magie","Invisibilité"],slotsRemaining:{1:3,2:1}}}};class Jg{static XP_TABLE=[0,300,900,2700,6500,14e3,23e3,34e3,48e3,64e3,85e3];static getXPForLevel(l){return l<1||l>20?0:this.XP_TABLE[l-1]||0}static getXPToNextLevel(l){return l>=20?1/0:this.getXPForLevel(l+1)}static calculateLevelFromXP(l){if(l<0)return 1;for(let s=20;s>=1;s--)if(l>=this.getXPForLevel(s))return s;return 1}static getXPToNext(l,s){if(s>=20)return 0;const i=this.getXPToNextLevel(s);return Math.max(0,i-l)}static getProgressionPercentage(l,s){if(s>=20)return 100;const i=this.getXPForLevel(s),u=this.getXPToNextLevel(s),m=l-i,p=u-i;return p<=0?100:Math.min(100,Math.max(0,m/p*100))}static shouldLevelUp(l,s){return s>=20?!1:l>=this.getXPToNextLevel(s)}static calculateLevelGains(l,s){const i=this.calculateLevelFromXP(l);return Math.max(0,i-s)}static calculateHPGain(l,s,i=!0){const m={barbarian:12,fighter:10,paladin:10,ranger:10,bard:8,cleric:8,druid:8,monk:8,rogue:8,warlock:8,sorcerer:6,wizard:6}[l?.toLowerCase()]||8,p=i?Math.floor(m/2+1):Math.floor(Math.random()*m)+1;return Math.max(1,p+s)}static getProficiencyBonus(l){return Math.ceil(l/4)+1}static calculateSpellSlotsForLevel(l,s){if(!["wizard","sorcerer","cleric","druid","bard","warlock"].includes(l?.toLowerCase()))return{};const u={};return s>=1&&(u[1]=Math.min(4,Math.floor(s/2)+1)),s>=3&&(u[2]=Math.min(3,Math.floor((s-1)/2))),s>=5&&(u[3]=Math.min(3,Math.floor((s-3)/2))),s>=7&&(u[4]=Math.min(3,Math.floor((s-5)/2))),s>=9&&(u[5]=Math.min(3,Math.floor((s-7)/2))),u}static calculateCombatExperience(l,s=1){const i=l.reduce((u,m)=>u+({0:10,"1/8":25,"1/4":50,"1/2":100,1:200,2:450,3:700,4:1100,5:1800,6:2300,7:2900,8:3900,9:5e3,10:5900}[m.challengeRating]||100),0);return Math.floor(i/s)}}class Ie{static getProficiencyBonus(l){return Math.ceil(l/4)+1}static getSpellSaveDC(l){if(!l.spellcasting)return 8;const s=this.getSpellcastingAbility(l),i=Be(l.stats[s]),u=this.getProficiencyBonus(l.level);return 8+i+u}static getSpellcastingAbility(l){return l.spellcasting?l.spellcasting.ability||(()=>{switch(l.class){case"Magicien":return"intelligence";case"Clerc":return"sagesse";case"Barde":return"charisme";case"Rôdeur":case"Paladin":return"sagesse";case"Sorcier":case"Occultiste":return"charisme";default:return"intelligence"}})():"intelligence"}static getAttackBonus(l,s){const i=this.getProficiencyBonus(l.level);switch(s.actionType){case"spell":return Ce.calculateSpellAttackBonus(l);case"weapon":let u=s.stat||"force";if(s.properties?.includes("finesse")){const f=Be(l.stats.force);u=Be(l.stats.dexterite)>f?"dexterite":"force"}const p=this.isWeaponProficient(l,s)?i:0;return Be(l.stats[u])+p;default:return 0}}static isWeaponProficient(l,s){if(!l.weaponProficiencies)return!1;if(l.weaponProficiencies.includes(s.id))return!0;const i=["dagger","club","quarterstaff","lightCrossbow","shortbow"].includes(s.id);return!!(i&&l.weaponProficiencies.includes("simple")||!i&&l.weaponProficiencies.includes("martial"))}static levelUp(l){const s=l.level+1;if(s>20)return l;const i=this.getHitDie(l.class),u=xf(l),m=Math.max(1,ll(i)+u),p={...l,level:s,maxHP:l.maxHP+m,currentHP:l.currentHP+m,currentXP:l.currentXP||l.experience||0,proficiencyBonus:this.getProficiencyBonus(s)};if(l.spellcasting){const f=this.generateSpellSlotsForLevel(s,l.class);p.spellcasting={...l.spellcasting,spellSlots:f}}return p}static generateSpellSlotsForLevel(l,s){const i={1:{1:{max:2,used:0}},2:{1:{max:3,used:0}},3:{1:{max:4,used:0},2:{max:2,used:0}},4:{1:{max:4,used:0},2:{max:3,used:0}},5:{1:{max:4,used:0},2:{max:3,used:0},3:{max:2,used:0}}};return s==="Magicien"||s==="Clerc"?i[l]||{}:{}}static getHitDie(l){return{Guerrier:10,Magicien:6,Roublard:8,Clerc:8,Rôdeur:10,Paladin:10}[l]||8}static shortRest(l,s=0){if(s<=0)return l;const i=this.getHitDie(l.class),u=xf(l);let m=0;const p=l.hitDice||Math.floor(l.level/2),f=Math.min(s,p);for(let v=0;v<f;v++)m+=Math.max(1,ll(i)+u);return{...l,currentHP:Math.min(l.maxHP,l.currentHP+m),hitDice:p-f}}static longRest(l){const s={...l,currentHP:l.maxHP,hitDice:l.level};return l.spellcasting&&(s.spellcasting={...l.spellcasting,slotsRemaining:{...l.spellcasting.slotsTotal}}),s}static takeDamage(l,s){return{...l,currentHP:Math.max(0,l.currentHP-s)}}static heal(l,s){return{...l,currentHP:Math.min(l.maxHP,l.currentHP+s)}}static consumeSpellSlot(l,s){if(!l.spellcasting||s<=0)return l;const i=l.spellcasting.slotsRemaining[s]||0;return i<=0?l:{...l,spellcasting:{...l.spellcasting,slotsRemaining:{...l.spellcasting.slotsRemaining,[s]:i-1}}}}static addExperience(l,s){const u=(l.currentXP||l.experience||0)+s;return this.processLevelUps({...l,currentXP:u})}static processLevelUps(l){let s={...l},i=0;const u=10,m=20;for(;i<u&&s.level<m;){const p=this.getXPToNextLevel(s.level);if(s.currentXP>=p){const f=s.level;if(s=this.levelUp(s),s.level<=f){console.error(`⚠️ Level up failed to increase level (${f} → ${s.level})`);break}i++}else break}return i>=u&&console.warn("⚠️ Limite de montées de niveau atteinte pour éviter une boucle infinie"),s}static getXPForLevel(l){return[0,300,900,2700,6500,14e3,23e3,34e3,48e3,64e3,85e3][l-1]||0}static getXPToNextLevel(l){return Jg.getXPToNextLevel(l)}}class Ft{getSpellAttackBonus(l){if(!l.spellcasting)return 0;const s=l.spellcasting.ability||"intelligence",i=Be(l.stats[s]),u=this.getProficiencyBonus(l.level);return i+u}getSpellSaveDC(l){if(!l.spellcasting)return 8;const s=l.spellcasting.ability||"intelligence",i=Be(l.stats[s]),u=this.getProficiencyBonus(l.level);return 8+i+u}getProficiencyBonus(l){return Math.ceil(l/4)+1}getKnownSpells(l){return l.spellcasting?.knownSpells?l.spellcasting.knownSpells.map(s=>this.getSpellData(s)).filter(Boolean).filter(s=>s.level>0):[]}getPreparedSpells(l){return l.spellcasting?.preparedSpells?l.spellcasting.preparedSpells.map(s=>{const i=this.getSpellData(s);return i&&this.isSpellAvailableForClass(i,l)?i:null}).filter(Boolean):[]}getCantrips(l){return l.spellcasting?.cantrips?l.spellcasting.cantrips.map(s=>this.getSpellData(s)).filter(Boolean):[]}getMaxPreparedSpells(l){if(!l.spellcasting)return 0;const s=l.spellcasting.ability||"intelligence";return Math.max(1,Be(l.stats[s]))+l.level}getSpellSlots(l){return!l.spellcasting?.spellSlots||Object.keys(l.spellcasting.spellSlots).length===0?this.generateDefaultSpellSlots(l):l.spellcasting.spellSlots}generateDefaultSpellSlots(l){const s={},i=l.level,m={1:{1:2},2:{1:3},3:{1:4,2:2},4:{1:4,2:3},5:{1:4,2:3,3:2},6:{1:4,2:3,3:3},7:{1:4,2:3,3:3,4:1},8:{1:4,2:3,3:3,4:2},9:{1:4,2:3,3:3,4:3,5:1},10:{1:4,2:3,3:3,4:3,5:2},11:{1:4,2:3,3:3,4:3,5:2,6:1},12:{1:4,2:3,3:3,4:3,5:2,6:1},13:{1:4,2:3,3:3,4:3,5:2,6:1,7:1},14:{1:4,2:3,3:3,4:3,5:2,6:1,7:1},15:{1:4,2:3,3:3,4:3,5:2,6:1,7:1,8:1},16:{1:4,2:3,3:3,4:3,5:2,6:1,7:1,8:1},17:{1:4,2:3,3:3,4:3,5:2,6:1,7:1,8:1,9:1},18:{1:4,2:3,3:3,4:3,5:3,6:1,7:1,8:1,9:1},19:{1:4,2:3,3:3,4:3,5:3,6:2,7:1,8:1,9:1},20:{1:4,2:3,3:3,4:3,5:3,6:2,7:2,8:1,9:1}}[Math.min(i,20)]||{};for(const[p,f]of Object.entries(m))s[p]={max:f,used:0,available:f};return s}getSpellData(l){if($t[l])return{id:l,...$t[l]};const s=Object.entries($t).find(([i,u])=>u.name===l||u.name?.toLowerCase()===l?.toLowerCase());return s?{id:s[0],...s[1]}:null}filterSpells(l,s){return l.filter(i=>{if(s.school!=="all"&&i.school!==s.school)return!1;if(s.level!=="all"){const u=parseInt(s.level);if(i.level!==u)return!1}if(s.searchTerm){const u=s.searchTerm.toLowerCase(),m=i.name?.toLowerCase().includes(u),p=i.description?.toLowerCase().includes(u),f=i.school?.toLowerCase().includes(u);if(!m&&!p&&!f)return!1}return s.castableOnly&&i.level===0,!0})}sortSpells(l,s="level"){return[...l].sort((i,u)=>{switch(s){case"name":return(i.name||"").localeCompare(u.name||"");case"level":return i.level!==u.level?i.level-u.level:(i.name||"").localeCompare(u.name||"");case"school":return i.school!==u.school?(i.school||"").localeCompare(u.school||""):(i.name||"").localeCompare(u.name||"");case"range":return this.compareRange(i.range,u.range);default:return 0}})}compareRange(l,s){const i=u=>!u||u==="Personnel"?0:u==="Contact"?1:u.includes("mètres")?parseInt(u.match(/\d+/)?.[0]||"0"):999999;return i(l)-i(s)}canCastSpell(l,s,i=null){if(!l||!s.spellcasting)return!1;if(l.level===0)return!0;const u=this.getSpellSlots(s),m=i||l.level;for(let p=m;p<=9;p++){const f=u[p];if(f&&f.available>0)return!0}return!1}getAvailableCastingLevels(l,s){if(l.level===0)return[0];const i=this.getSpellSlots(s),u=[];for(let m=l.level;m<=9;m++){const p=i[m];p&&p.available>0&&u.push(m)}return u}calculateSpellDamage(l,s){if(!l.damage)return null;const i=l.damage,u=Math.max(0,s-l.level);return l.scalingDamage&&u>0?i+l.scalingDamage*u:i}getSchoolsOfMagic(){return["Abjuration","Invocation","Divination","Enchantement","Évocation","Illusion","Nécromancie","Transmutation"]}getGrimoireSpells(l){if(!l.spellcasting)return[];const s=[];return Object.entries($t).forEach(([i,u])=>{this.isSpellAvailableForClass(u,l)&&s.push({id:i,...u,isPrepared:l.spellcasting.preparedSpells?.includes(i)||!1})}),this.sortSpells(s,"level")}getUnpreparedSpells(l){if(!l.spellcasting)return[];const s=this.getGrimoireSpells(l),i=l.spellcasting.preparedSpells||[];return s.filter(u=>u.level>0&&!i.includes(u.id))}isSpellAvailableForClass(l,s){if(!l.class||!Array.isArray(l.class)||!l.class.includes(s.class))return!1;if(l.level===0)return s.level>=1;const i={1:1,2:3,3:5,4:7,5:9,6:11,7:13,8:15,9:17};return s.level>=(i[l.level]||20)}isSpellActive(l,s){return s.activeEffects?s.activeEffects.some(u=>u.sourceSpellId===l||u.name===l):!1}canPrepareSpell(l,s){if(!s.spellcasting||s.spellcasting.preparedSpells?.includes(l))return!1;const i=s.spellcasting.preparedSpells?.length||0,u=this.getMaxPreparedSpells(s);if(i>=u)return!1;const m=this.getSpellData(l);return!m||m.level===0?!1:this.isSpellAvailableForClass(m,s)}canUnprepareSpell(l,s){return s.spellcasting?.preparedSpells?s.spellcasting.preparedSpells.includes(l):!1}static castSpell(l,s,i=[],u={}){const m={success:!1,character:l,messages:[],effects:[]},p=this.validateSpellcast(l,s);if(!p.success)return m.messages.push(p.message),m;s.level>0&&(m.character=this.consumeSpellSlot(m.character,s.level));const f=this.processSpellEffects(s,i,l,u);return m.effects=f.effects,m.messages=[...m.messages,...f.messages],m.character=this.applySpellEffectsToCharacter(m.character,s,f),m.success=!0,m}static validateSpellcast(l,s){if(!l.spellcasting)return{success:!1,message:"Ce personnage ne peut pas lancer de sorts"};if(![...l.spellcasting.cantrips||[],...l.spellcasting.preparedSpells||[]].includes(s.id))return{success:!1,message:"Sort non préparé"};if(s.level>0){const m=new Ft().getSpellSlots(l);let p=!1;for(let f=s.level;f<=9;f++){const v=m[f];if(v&&v.available>0){p=!0;break}}if(!p)return{success:!1,message:"Aucun emplacement de sort disponible"}}return{success:!0}}static consumeSpellSlot(l,s){if(!l.spellcasting||s<=0)return l;const u=new Ft().getSpellSlots(l);let m=null;for(let f=s;f<=9;f++){const v=u[f];if(v&&v.available>0){m=f;break}}if(!m)return l;const p={...u,[m]:{...u[m],used:u[m].used+1,available:u[m].available-1}};return{...l,spellcasting:{...l.spellcasting,spellSlots:p}}}static getPreparedSpells(l){return l.spellcasting?[...l.spellcasting.cantrips||[],...l.spellcasting.preparedSpells||[]]:[]}static getMaxPreparedSpells(l){if(!l.spellcasting)return 0;const s=Ie.getSpellcastingAbility(l),i=Math.max(1,Be(l.stats[s]));return l.level+i}static prepareSpell(l,s){if(!l.spellcasting)return null;const i=l.spellcasting.preparedSpells||[],u=this.getMaxPreparedSpells(l);return i.includes(s)?l:i.length>=u?null:{...l,spellcasting:{...l.spellcasting,preparedSpells:[...i,s]}}}static unprepareSpell(l,s){if(!l.spellcasting)return l;const i=l.spellcasting.preparedSpells||[];return{...l,spellcasting:{...l.spellcasting,preparedSpells:i.filter(u=>u!==s)}}}static processSpellEffects(l,s,i,u){return{effects:[],messages:[`${i.name} lance ${l.name}`]}}static applySpellEffectsToCharacter(l,s,i){return l}}const pt=o=>(o.playerCharacter&&(o.selectedCharacter=o.playerCharacter),o),ht=Ni(Pg(Mi((o,l)=>({playerCharacter:null,playerCompanions:[],activeCompanions:[],selectedCharacter:null,activeEffects:[],temporaryModifiers:{},experienceGains:[],levelUpPending:!1,levelUpData:null,setPlayerCharacter:s=>o(pt({playerCharacter:s?ra.deepClone(s):null})),addCompanion:s=>o(i=>{if(i.playerCompanions.length>=3)return console.warn("Maximum 3 compagnons autorisés"),i;const u=ra.deepClone(s);return u.id=u.id||u.name||ra.generateId("companion"),{playerCompanions:[...i.playerCompanions,u]}}),removeCompanion:s=>o(i=>({playerCompanions:i.playerCompanions.filter(u=>u.id!==s),activeCompanions:i.activeCompanions.filter(u=>u!==s)})),setActiveCompanions:s=>o(i=>({activeCompanions:s.filter(m=>i.playerCompanions.some(p=>p.id===m))})),getCompanion:s=>{const{playerCompanions:i}=l();return i.find(u=>u.id===s)},getActiveCompanions:()=>{const{playerCompanions:s,activeCompanions:i}=l();return i.map(u=>s.find(m=>m.id===u)).filter(Boolean)},updatePlayerCharacter:s=>o(i=>({playerCharacter:i.playerCharacter?{...i.playerCharacter,...s}:null})),updateCompanion:(s,i)=>o(u=>({playerCompanions:u.playerCompanions.map(m=>m.id===s?{...m,...i}:m)})),takeDamagePlayer:s=>o(i=>{if(!i.playerCharacter)return i;const u=Ie.takeDamage(i.playerCharacter,s);return pt({playerCharacter:u})}),takeDamageCompanionById:(s,i)=>o(u=>{const m=u.playerCompanions.find(f=>f.id===s);if(!m)return u;const p=Ie.takeDamage(m,i);return{playerCompanions:u.playerCompanions.map(f=>f.id===s?p:f)}}),healPlayer:s=>o(i=>{if(!i.playerCharacter)return i;const u=Ie.heal(i.playerCharacter,s);return pt({playerCharacter:u})}),healCompanionById:(s,i)=>o(u=>{const m=u.playerCompanions.find(f=>f.id===s);if(!m)return u;const p=Ie.heal(m,i);return{playerCompanions:u.playerCompanions.map(f=>f.id===s?p:f)}}),shortRestPlayer:(s=0)=>o(i=>{if(!i.playerCharacter)return i;const u=Ie.shortRest(i.playerCharacter,s);return pt({playerCharacter:u})}),longRestPlayer:()=>o(s=>{if(!s.playerCharacter)return s;const i=Ie.longRest(s.playerCharacter);return pt({playerCharacter:i})}),longRestCompanionById:s=>o(i=>{const u=i.playerCompanions.find(p=>p.id===s);if(!u)return i;const m=Ie.longRest(u);return{playerCompanions:i.playerCompanions.map(p=>p.id===s?m:p)}}),longRestAll:()=>{const{longRestPlayer:s,playerCompanions:i}=l();s(),i.forEach(u=>{l().longRestCompanionById(u.id)})},spendHitDie:(s="player")=>o(i=>{const u=i.playerCharacter;if(!u)return i;const m=Ce.calculateHitDieHealing(u);if(!m.canHeal)return i;const p=m.character;return pt({playerCharacter:p})}),addExperience:(s,i="player")=>o(u=>{const m=u.playerCharacter;if(!m)return u;const p=Ie.addExperience(m,s),f={...u};return p.level>m.level&&(f.levelUpPending=!0,f.levelUpData={character:i,oldLevel:m.level,newLevel:p.level,hpGained:p.maxHP-m.maxHP}),f.experienceGains=[...u.experienceGains,{id:ra.generateId("xp"),amount:s,target:i,timestamp:new Date}],f.playerCharacter=p,f.selectedCharacter=p,f}),confirmLevelUp:()=>o(s=>({levelUpPending:!1,levelUpData:null})),castSpellPlayer:(s,i={})=>o(u=>u.playerCharacter?{playerCharacter:Ft.castSpell(u.playerCharacter,s,[],i).character}:u),consumeSpellSlot:(s,i="player")=>o(u=>{const m=u.playerCharacter;if(!m)return u;const p=Ie.consumeSpellSlot(m,s);return pt({playerCharacter:p})}),prepareSpell:(s,i="player")=>{const m=l().playerCharacter;if(!m)return{success:!1,message:`Aucun personnage ${i} trouvé`};const p=Ft.prepareSpell(m,s);if(!p){const f=m.spellcasting?.preparedSpells||[],v=Ft.getMaxPreparedSpells(m);return f.includes(s)?{success:!1,message:`${s} est déjà préparé`}:f.length>=v?{success:!1,message:`Limite de sorts préparés atteinte (${v})`}:{success:!1,message:`Impossible de préparer ${s}`}}return o(pt({playerCharacter:p})),{success:!0,message:`${s} préparé avec succès`}},unprepareSpell:(s,i="player")=>{const m=l().playerCharacter;if(!m)return{success:!1,message:`Aucun personnage ${i} trouvé`};const p=Ft.unprepareSpell(m,s);return p?(o(pt({playerCharacter:p})),{success:!0,message:`${s} retiré des sorts préparés`}):{success:!1,message:`Impossible de retirer ${s}`}},equipItem:(s,i="player")=>o(u=>{const m=u.playerCharacter;if(!m)return u;let p=m.inventory?.find(b=>(b.id||b.name||b.nom)===s);if(!p){const b=Wt[s];b&&(p={...b,id:s})}if(!p)return u;const f=p.type;if(!["weapon","arme","armor","armure","accessory","accessoire"].includes(f))return u;let g={...m.equipment||{}},y=null;if(f==="weapon"||f==="arme"?y="mainHand":f==="armor"||f==="armure"?y="body":(f==="accessory"||f==="accessoire")&&(y="accessory"),!y)return u;if(g[y]){const b=g[y],E=m.inventory?.some(A=>(A.id||A.name||A.nom)===b);let C=[...m.inventory||[]];if(E){const A=Wt[b];A&&C.push({...A,id:b})}return g[y]=s,C=C.filter(A=>(A.id||A.name||A.nom)!==s),pt({playerCharacter:{...m,...{inventory:C,equipment:g}}})}else{g[y]=s;const E={inventory:m.inventory?m.inventory.filter(C=>(C.id||C.name||C.nom)!==s):[],equipment:g};return pt({playerCharacter:{...m,...E}})}}),unequipItem:(s,i="player")=>o(u=>{const m=u.playerCharacter;if(!m||!m.equipment)return u;const p=m.equipment;let f=null;for(const[E,C]of Object.entries(p))if(C===s){f=E;break}if(!f)return u;const v={...p};delete v[f];const g=Wt[s],y=[...m.inventory||[]];return g&&y.push({...g,id:s}),pt({playerCharacter:{...m,...{inventory:y,equipment:v}}})}),addItemToInventory:(s,i="player")=>o(u=>{const m=u.playerCharacter;if(!m)return u;const p=m.inventory||[],f=s.id||s.name||s.nom,v=s.quantity||1,g=p.findIndex(E=>(E.id||E.name||E.nom)===f);let y;return g>=0?(y=[...p],y[g]={...y[g],quantity:(y[g].quantity||1)+v}):y=[...p,{...s,id:s.id||s.name||s.nom||ra.generateId("item"),quantity:v}],pt({playerCharacter:{...m,...{inventory:y}}})}),removeItemFromInventory:(s,i="player",u=1)=>o(m=>{const p=m.playerCharacter;if(!p)return m;const f=p.inventory||[],v=f.findIndex(C=>(C.id||C.name||C.nom)===s);if(v===-1)return m;let g=[...f];const y=g[v],b=y.quantity||1;return b<=u?g.splice(v,1):g[v]={...y,quantity:b-u},pt({playerCharacter:{...p,...{inventory:g}}})}),useItem:(s,i="player")=>{const u=l().playerCharacter;if(!u)return{success:!1,message:"Personnage non trouvé"};const m=u.inventory.find(f=>(f.id||f.name||f.nom)===s);if(!m)return{success:!1,message:"Objet non trouvé dans l'inventaire"};const p=Aa[s]||Aa[m.id]||Aa[m.name]||Aa[m.nom];if(p&&p.use)try{const f=u.currentHP,v=p.use(u),g=v.currentHP-f;return o({playerCharacter:v,selectedCharacter:v}),p.type==="consumable"&&l().removeItemFromInventory(s,i,1),{success:!0,message:typeof p.message=="function"?p.message(g):p.message,item:p}}catch(f){return console.error("Erreur lors de l'utilisation de l'objet:",f),{success:!1,message:`Erreur: ${f.message}`}}else{if(m.effects){let f={...u},v=`${m.name||m.nom} utilisé`;return m.effects.forEach(g=>{switch(g.type){case"heal":const y=g.value;f.currentHP=Math.min(u.maxHP,u.currentHP+y),v=`Vous récupérez ${y} PV`;break;default:console.warn(`Unknown item effect type: ${g.type}`)}}),o({playerCharacter:f,selectedCharacter:f}),(m.consumable||m.type==="consumable")&&l().removeItemFromInventory(s,i,1),{success:!0,message:v}}return{success:!1,message:"Cet objet ne peut pas être utilisé"}}},addEffect:s=>o(i=>({activeEffects:[...i.activeEffects,{...s,id:s.id||ra.generateId("effect"),startTime:new Date}]})),removeEffect:s=>o(i=>({activeEffects:i.activeEffects.filter(u=>u.id!==s)})),clearExpiredEffects:()=>o(s=>{const i=new Date;return{activeEffects:s.activeEffects.filter(u=>u.duration?i-u.startTime<u.duration:!0)}}),consolidateInventory:(s="player")=>o(i=>{const u=i.playerCharacter;if(!u||!u.inventory)return i;const m=[],p=new Map;return u.inventory.forEach(v=>{const g=v.id||v.name||v.nom;if(p.has(g)){const y=p.get(g);y.quantity=(y.quantity||1)+(v.quantity||1)}else p.set(g,{...v,quantity:v.quantity||1})}),p.forEach(v=>m.push(v)),pt({playerCharacter:{...u,...{inventory:m}}})}),resetCharacters:()=>o({playerCharacter:null,playerCompanions:[],activeCompanions:[],activeEffects:[],temporaryModifiers:{},experienceGains:[],levelUpPending:!1,levelUpData:null}),clearExperienceGains:()=>o({experienceGains:[]})}),{name:"character-store"}))),gt=Ni(Mi((o,l)=>({gamePhase:"character-selection",currentScene:"introduction",sceneHistory:[],combatLog:[],isShortResting:!1,isLongResting:!1,nextSceneAfterRest:null,combatKey:0,gameMessages:[],gameFlags:nt.getInitialFlags(),setGamePhase:s=>o({gamePhase:s}),setCurrentScene:s=>o(i=>({currentScene:s,sceneHistory:[...i.sceneHistory,i.currentScene]})),goToPreviousScene:()=>o(s=>s.sceneHistory.length>0?{currentScene:s.sceneHistory[s.sceneHistory.length-1],sceneHistory:s.sceneHistory.slice(0,-1)}:s),addCombatMessage:(s,i="default")=>o(u=>({combatLog:[...u.combatLog,{id:ra.generateId("msg"),message:s,type:i,timestamp:new Date}]})),clearCombatLog:()=>o({combatLog:[]}),addGameMessage:(s,i="info")=>o(u=>({gameMessages:[...u.gameMessages,{id:ra.generateId("game-msg"),message:s,type:i,timestamp:new Date}]})),clearGameMessages:()=>o({gameMessages:[]}),startShortRest:s=>o({isShortResting:!0,nextSceneAfterRest:s}),endShortRest:()=>o(s=>({isShortResting:!1,currentScene:s.nextSceneAfterRest,nextSceneAfterRest:null})),startLongRest:s=>o({isLongResting:!0,nextSceneAfterRest:s}),endLongRest:()=>o(s=>({isLongResting:!1,currentScene:s.nextSceneAfterRest,nextSceneAfterRest:null})),incrementCombatKey:()=>o(s=>({combatKey:s.combatKey+1})),handleSkillCheck:(s,i,u,m,p,f)=>{const{addCombatMessage:v,setCurrentScene:g}=l(),y=Ce.handleSkillCheck(s,i,f);v(y.message,"skill-check");let b=p;y.success?(b=u,v("✅ Réussite !","success")):y.total>=i-5&&m?(b=m,v("⚠️ Réussite partielle","partial")):(b=p,v("❌ Échec","failure")),g(b)},updateSpellSlotsForLevel:s=>{if(!s.spellcasting)return s;const i=l().getSpellSlotsForLevel(s.level,s.class),u=l().getKnownSpells(s.level,s.class);return{...s,spellcasting:{...s.spellcasting,spellSlots:i,knownSpells:u}}},getSpellSlotsForLevel:(s,i)=>{let u=s;switch(i){case"Magicien":break;case"Paladin":case"Rôdeur":u=Math.max(0,Math.floor((s-1)/2));break;case"Guerrier":if(s>=3)u=Math.max(0,Math.floor((s-2)/3));else return{};break;case"Roublard":if(s>=3)u=Math.max(0,Math.floor((s-2)/3));else return{};break;default:return{}}const m=Vg[u];if(!m)return{};const p={};for(const f in m)p[f]={total:m[f],used:0};return p},getKnownSpells:(s,i)=>{const u=l().getSpellSlotsForLevel(s,i),m=u?Math.max(...Object.keys(u).map(Number)):0,p=Object.values($t).filter(g=>{switch(i){case"Magicien":return!0;case"Guerrier":return g.school==="Abjuration"||g.school==="Évocation"||g.level===0;case"Roublard":return g.school==="Enchantement"||g.school==="Illusion"||g.level===0;default:return!1}}),f=p.filter(g=>g.level===0).map(g=>g.name),v=p.filter(g=>g.level>0&&g.level<=m).map(g=>g.name);return[...f,...v]},setFlag:(s,i)=>o(u=>({gameFlags:nt.setFlag(u.gameFlags,s,i)})),setFlags:s=>o(i=>({gameFlags:nt.setFlags(i.gameFlags,s)})),getFlag:(s,i=!1)=>{const u=l();return nt.getFlag(u.gameFlags,s,i)},addToList:(s,i)=>o(u=>({gameFlags:nt.addToList(u.gameFlags,s,i)})),removeFromList:(s,i)=>o(u=>({gameFlags:nt.removeFromList(u.gameFlags,s,i)})),updateNpcRelation:(s,i)=>o(u=>({gameFlags:nt.updateNpcRelation(u.gameFlags,s,i)})),getNpcRelation:s=>{const i=l();return nt.getNpcRelation(i.gameFlags,s)},getNpcRelationStatus:s=>{const i=l();return nt.getNpcRelationStatus(i.gameFlags,s)},updateReputation:s=>o(i=>({gameFlags:nt.updateReputation(i.gameFlags,s)})),addMajorChoice:(s,i,u=null)=>o(m=>{const p=u||m.currentScene;return{gameFlags:nt.addMajorChoice(m.gameFlags,s,i,p)}}),visitLocation:s=>o(i=>({gameFlags:nt.visitLocation(i.gameFlags,s)})),completeQuest:s=>o(i=>({gameFlags:nt.completeQuest(i.gameFlags,s)})),isQuestCompleted:s=>{const i=l();return nt.isQuestCompleted(i.gameFlags,s)},getGameState:()=>{const s=l();return{flags:s.gameFlags,character:null,currentScene:s.currentScene}},applyConsequences:s=>{if(!s)return;const{setFlags:i,updateReputation:u,addToList:m,updateNpcRelation:p,addMajorChoice:f,visitLocation:v}=l();if(s.flags&&i(s.flags),typeof s.reputation=="number"&&u(s.reputation),s.visitLocation&&v(s.visitLocation),s.items&&Array.isArray(s.items))try{const{addItemToInventory:g}=ht.getState(),{addCombatMessage:y}=l();Yg.processItemRewards(s.items,g,y)}catch(g){console.error("Erreur lors de l'ajout d'items:",g)}if(s.companions&&Array.isArray(s.companions))try{const{addCompanion:g,setActiveCompanions:y}=ht.getState(),{addCombatMessage:b}=l();s.companions.forEach(E=>{m("companions",E);const C=Df[E];if(C){const _={...C,id:E.toLowerCase()};g(_);const D=[...ht.getState().activeCompanions||[],_.id];y(D),b(`${C.name} te rejoint dans ton aventure !`,"upgrade")}else console.error(`❌ Compagnon '${E}' introuvable dans companions.js`)})}catch(g){console.error("Erreur lors du recrutement du compagnon:",g)}s.npcRelations&&Object.entries(s.npcRelations).forEach(([g,y])=>{p(g,y)}),s.majorChoice&&f(s.majorChoice.id,s.majorChoice.description,s.majorChoice.sceneId)},debugFlags:()=>{const s=l();nt.debugFlags(s.gameFlags)}}),{name:"game-store"})),qf={ombre:{name:"Ombre",maxHP:16,currentHP:16,ac:12,xp:100,role:"skirmisher",challengeRating:"1/2",stats:{force:6,dexterite:14,constitution:13,intelligence:6,sagesse:10,charisme:8},attacks:[{name:"absorption de force",type:"melee",attackBonus:4,range:1,targets:1,damageDice:"2d6",damageBonus:2,damageType:"necrotique",description:"absorption de force",aiWeight:100,effects:[{type:"debuff",stat:"force",reduction:1,description:"Réduit la Force de 1"}],targetPreference:"weakest",situational:{lowHP:50,isolated:30}}],image:"https://www.aidedd.org/dnd/images/shadow.jpg"},gobelin:{name:"Gobelin",maxHP:7,currentHP:7,ac:15,xp:50,challengeRating:"1/4",role:"skirmisher",aiPriority:["hit_and_run","ranged_attack","melee_attack"],aiModifiers:{hit_and_run:{isolatedTargetBonus:40,lowHPBonus:30,multipleEnemiesBonus:20},ranged_attack:{distanceBonus:25,coverBonus:35,meleeDisadvantageBonus:50},melee_attack:{corneredBonus:40,flankedTargetBonus:30}},stats:{force:8,dexterite:14,constitution:10,intelligence:10,sagesse:8,charisme:8},attacks:[{name:"son Cimeterre",type:"melee",attackBonus:4,range:1,targets:1,damageDice:"1d6",damageBonus:2,damageType:"tranchant",description:"Attaque au corps à corps avec une arme : +4 au toucher, allonge 1,50 m, une cible. Touché : 5 (1d6 + 2) dégâts tranchants.",aiWeight:70,targetPreference:"closest",situational:{flanking:20,desperateBonus:30}},{name:"Arc court",type:"ranged",attackBonus:4,range:6,targets:1,damageDice:"1d6",damageBonus:2,damageType:"perforant",description:"Attaque à distance : +4 au toucher, portée 24/96 m, une cible. Touché : 5 (1d6 + 2) dégâts perforants.",aiWeight:85,targetPreference:"weakest",situational:{safeDistance:35,lowHPTarget:25,outOfMeleeRange:40}}],image:"https://www.aidedd.org/dnd/images/goblin.jpg"},mephiteBoueux:{name:"Méphite boueux",maxHP:27,currentHP:27,ac:11,xp:50,stats:{force:8,dexterite:12,constitution:12,intelligence:9,sagesse:11,charisme:7},attacks:[{name:"Poing",type:"melee",attackBonus:3,range:1,targets:1,damageDice:"1d6",damageBonus:1,damageType:"contondant",description:"Attaque au corps à corps avec une arme : +3 au toucher, allonge 1,50 m, une créature. Touché : 4 (1d6 + 1) dégâts contondants."}],image:"https://www.aidedd.org/dnd/images/mud-mephit.jpg"},kobold:{name:"Kobold",maxHP:5,currentHP:5,ac:12,xp:25,movement:6,stats:{force:8,dexterite:15,constitution:10,intelligence:8,sagesse:8,charisme:8},attacks:[{name:"sa Dague",type:"melee",attackBonus:4,range:1,targets:1,damageDice:"1d4",damageBonus:2,damageType:"perforant",description:"Attaque au corps à corps : +4 au toucher, allonge 1 m, une cible. Touché : 4 (1d4 + 2) dégâts perforants."}],image:"https://www.aidedd.org/dnd/images/kobold.jpg"},goule:{name:"Goule",maxHP:22,currentHP:22,ac:12,xp:200,movement:6,stats:{force:13,dexterite:15,constitution:10,intelligence:7,sagesse:10,charisme:6},attacks:[{name:"Griffes",type:"melee",attackBonus:4,range:1,targets:1,damageDice:"2d4",damageBonus:2,damageType:"tranchant",description:"Attaque au corps à corps avec une arme : +4 au toucher, allonge 1,50 m, une cible. Touché : 7 (2d4 + 2) dégâts tranchants. Si la cible est une créature autre qu'un elfe ou un mort-vivant, celle-ci doit réussir un jet de sauvegarde de Constitution DD 10 pour ne pas être paralysée pendant 1 minute. La cible peut relancer le jet de sauvegarde à la fin de chacun de ses tours, mettant fin à l'effet qui l'affecte en cas de réussite."}],image:"https://www.aidedd.org/dnd/images/ghoul.jpg"},squelette:{name:"Squelette",maxHP:13,currentHP:13,ac:13,xp:50,movement:6,stats:{force:10,dexterite:14,constitution:15,intelligence:6,sagesse:8,charisme:5},attacks:[{name:"son Épée courte",type:"melee",attackBonus:4,range:1,targets:1,damageDice:"1d6",damageBonus:2,damageType:"perforant",description:"Attaque au corps à corps : +4 au toucher, allonge 1 m, une cible. Touché : 4 (1d4 + 2) dégâts perforants."}],image:"https://www.aidedd.org/dnd/images/skeleton.jpg"},diablotin:{name:"Diablotin",maxHP:10,currentHP:10,ac:13,xp:200,movement:6,stats:{force:6,dexterite:17,constitution:13,intelligence:11,sagesse:12,charisme:14},attacks:[{name:"Dard",type:"melee",attackBonus:5,range:1,targets:1,damageDice:"1d4",damageBonus:3,damageType:"perforants",description:"Attaque au corps à corps : +4 au toucher, allonge 1 m, une cible. Touché : 4 (1d4 + 2) dégâts perforants."}],image:"https://www.aidedd.org/dnd/images/imp.jpg"},diable:{name:"Diable épineux",maxHP:22,currentHP:22,ac:13,xp:450,stats:{force:10,dexterite:15,constitution:12,intelligence:11,sagesse:14,charisme:8},movement:8,attackSets:[{name:"Morsure et fourche",attacks:[{name:"Morsure",type:"melee",attackBonus:2,range:1,damageDice:"2d4",damageBonus:0,damageType:"tranchants",description:"Attaque avec ces crocs aceres"},{name:"Fourche",type:"melee",attackBonus:2,range:1,damageDice:"1d6",damageBonus:0,damageType:"perforants",description:"Attaque avec une fourche"}]},{name:"Double épine caudale",attacks:[{name:"Épine caudale",type:"ranged",attackBonus:4,range:6,damageDice:"1d4",damageBonus:2,damageType:"perforants",secondaryDamageDice:"1d6",secondaryDamageBonus:0,secondaryDamageType:"feu",description:"Projette une épine de sa queue"},{name:"Épine caudale",type:"ranged",attackBonus:4,range:6,damageDice:"1d4",damageBonus:2,damageType:"perforants",secondaryDamageDice:"1d6",secondaryDamageBonus:0,secondaryDamageType:"feu",description:"Projette une épine de sa queue"}]}],image:"https://www.aidedd.org/dnd/images/spined-devil.jpg"}};class Rf{static getBestAction(l,s){if(!l||!l.role)return console.warn("Entity has no role, using fallback AI"),this.fallbackAction(l,s);const i=this.getActionsByPriority(l,s);if(i.length===0)return this.fallbackAction(l,s);const u=i.map(p=>({action:p,score:this.calculateHybridScore(p,l,s)}));u.sort((p,f)=>f.score-p.score);const m=u[0];return console.log(`🧠 ${l.name} (${l.role}) chose ${m.action.description||m.action.name} (score: ${m.score})`),m.action}static getActionsByPriority(l,s){const i=[];return l.aiPriority?(l.aiPriority.forEach((u,m)=>{const p=100-m*15;this.getActionsForPriorityType(u,l,s).forEach(v=>{v.priorityScore=p,v.priorityType=u,v.priorityIndex=m,i.push(v)})}),i):(console.warn(`Entity ${l.name} has no aiPriority, using fallback`),this.getFallbackActions(l,s))}static getActionsForPriorityType(l,s,i){const u=[];if(!i.combatPositions?.[s.id||s.name])return u;switch(l){case"protect":const p=this.findMostWoundedAlly(s,i);p&&u.push({type:"protect",target:p,name:"Protection",description:`Protéger ${p.name}`,actionType:"ability"});break;case"heal":this.findWoundedAllies(s,i).forEach(B=>{this.getHealingSpells(s).forEach(W=>{u.push({...W,target:B,actionType:"spell",description:`${W.name} sur ${B.name}`})})});break;case"taunt":const v=this.findTargets(s,i);v.length>0&&u.push({type:"taunt",targets:v,name:"Provocation",description:"Attirer l'attention",actionType:"ability"});break;case"melee_attack":const g=this.getMeleeAttacks(s),y=this.findTargetsInMeleeRange(s,i);g.forEach(B=>{y.forEach(F=>{u.push({...B,target:F,actionType:"attack",description:`${B.name} sur ${F.name}`})})});break;case"ranged_attack":const b=this.getRangedAttacks(s),E=this.findTargetsInRange(s,i);b.forEach(B=>{E.forEach(F=>{u.push({...B,target:F,actionType:"attack",description:`${B.name} sur ${F.name}`})})});break;case"hit_and_run":const C=this.findIsolatedTargets(s,i);this.getQuickAttacks(s).forEach(B=>{C.forEach(F=>{u.push({...B,target:F,actionType:"hit_and_run",description:`Harcèlement: ${B.name} sur ${F.name}`,requiresMovement:!0})})});break;case"buff":const A=this.getBuffSpells(s),D=this.getAllies(s,i);A.forEach(B=>{D.forEach(F=>{u.push({...B,target:F,actionType:"spell",description:`${B.name} sur ${F.name}`})})});break;case"ranged_support":const j=this.getSupportSpells(s),q=this.findTargets(s,i);j.forEach(B=>{q.forEach(F=>{u.push({...B,target:F,actionType:"spell",description:`${B.name} sur ${F.name}`})})});break}return u}static calculateHybridScore(l,s,i){let u=l.priorityScore||50;if(s.aiModifiers&&l.priorityType){const m=s.aiModifiers[l.priorityType];m&&(u+=this.applyAIModifiers(m,l,s,i))}return l.aiWeight&&(u+=l.aiWeight),l.situational&&(u+=this.applySituationalBonuses(l.situational,l,s,i)),u+=this.getHealthAdjustments(l,s,i),u+=this.getPositionalAdjustments(l,s,i),Math.max(0,u)}static applyAIModifiers(l,s,i,u){let m=0;return l.allyLowHPBonus&&s.target&&s.target.currentHP/s.target.maxHP<.3&&(m+=l.allyLowHPBonus),l.criticalHPBonus&&s.target&&s.target.currentHP/s.target.maxHP<.15&&(m+=l.criticalHPBonus),l.multipleEnemiesBonus&&(u.combatEnemies?.length||0)>1&&(m+=l.multipleEnemiesBonus),l.safeDistanceBonus&&s.target&&this.getDistanceToTarget(s,i,u)>2&&(m+=l.safeDistanceBonus),l.lowHPBonus&&s.target&&s.target.currentHP/s.target.maxHP<.4&&(m+=l.lowHPBonus),m}static applySituationalBonuses(l,s,i,u){let m=0;return l.lowHPTarget&&s.target&&s.target.currentHP/s.target.maxHP<.4&&(m+=l.lowHPTarget),l.safeDistance&&this.getDistanceToTarget(s,i,u)>2&&(m+=l.safeDistance),l.desperateBonus&&i.currentHP/i.maxHP<.3&&(m+=l.desperateBonus),m}static getHealthAdjustments(l,s,i){let u=0;const m=s.currentHP/s.maxHP;return m<.3&&(l.actionType==="spell"&&l.name?.toLowerCase().includes("soin")&&(u+=80),(l.type==="protect"||l.actionType==="defensive")&&(u+=60)),m>.8&&l.actionType==="attack"&&(u+=20),u}static getPositionalAdjustments(l,s,i){let u=0;const m=this.getDistanceToTarget(l,s,i),p=this.getActionRange(l);return m<=p?u+=25:u-=50,(s.role==="healer"&&m>2||s.role==="tank"&&m<=1)&&(u+=15),u}static getDistanceToTarget(l,s,i){if(!l.target)return 999;const u=i.combatPositions?.[s.id||s.name],m=i.combatPositions?.[l.target.id||l.target.name];return!u||!m?999:ot(u,m)}static getActionRange(l){return l.range||l.actionType==="spell"&&l.range?l.range:l.type==="melee"?1:l.type==="ranged"?6:1}static findMostWoundedAlly(l,s){return this.getAllies(l,s).reduce((u,m)=>{const p=m.currentHP/m.maxHP,f=u?u.currentHP/u.maxHP:1;return p<f?m:u},null)}static findWoundedAllies(l,s){return this.getAllies(l,s).filter(i=>i.currentHP<i.maxHP)}static getAllies(l,s){const i=[];return l.type==="companion"&&(s.playerCharacter&&i.push(s.playerCharacter),s.activeCompanions&&s.activeCompanions.forEach(u=>{u.id!==l.id&&i.push(u)})),i}static findTargets(l,s){if(l.type==="companion")return s.combatEnemies||[];{const i=[];return s.playerCharacter&&i.push(s.playerCharacter),s.activeCompanions&&i.push(...s.activeCompanions),i}}static getMeleeAttacks(l){return l.attacks?.filter(s=>s.type==="melee")||[]}static getRangedAttacks(l){return l.attacks?.filter(s=>s.type==="ranged")||[]}static getQuickAttacks(l){return l.attacks?.filter(s=>s.type==="melee"||s.type==="ranged")||[]}static getHealingSpells(l){return l.spellcasting?l.spellcasting.knownSpells?.map(s=>$t[s]).filter(s=>s&&s.name?.toLowerCase().includes("soin"))||[]:[]}static getBuffSpells(l){return l.spellcasting?l.spellcasting.knownSpells?.map(s=>$t[s]).filter(s=>s&&(s.name?.toLowerCase().includes("bénédiction")||s.school==="Enchantement"))||[]:[]}static getSupportSpells(l){return l.spellcasting?l.spellcasting.knownSpells?.map(s=>$t[s]).filter(s=>s&&s.level<=2)||[]:[]}static findTargetsInMeleeRange(l,s){return this.findTargets(l,s).filter(i=>this.getDistanceToTarget({target:i},l,s)<=1)}static findTargetsInRange(l,s){return this.findTargets(l,s).filter(i=>this.getDistanceToTarget({target:i},l,s)<=6)}static findIsolatedTargets(l,s){return this.findTargets(l,s)}static getFallbackActions(l,s){const i=[];if(l.attacks&&l.attacks.length>0){const u=this.findTargets(l,s);l.attacks.forEach(m=>{u.forEach(p=>{i.push({...m,target:p,actionType:"attack",priorityScore:50,description:`${m.name} sur ${p.name}`})})})}return i}static fallbackAction(l,s){const i=this.getFallbackActions(l,s);return i.length>0?i[0]:null}}class Et{static EFFECT_TYPES={restrained:{name:"Entravé",icon:"🕸️",description:"Vitesse réduite à 0, désavantage aux attaques et Dextérité",mechanics:{speedMultiplier:0,attackDisadvantage:!0,dexterityDisadvantage:!0,canMove:!1}},poisoned:{name:"Empoisonné",icon:"☠️",description:"Désavantage aux jets d'attaque et de caractéristique",mechanics:{attackDisadvantage:!0,abilityDisadvantage:!0}},stunned:{name:"Étourdi",icon:"😵",description:"Incapacité totale, échec automatique Force/Dextérité",mechanics:{incapacitated:!0,canMove:!1,canAct:!1,autoFailStrDex:!0}},paralyzed:{name:"Paralysé",icon:"🧊",description:"Incapacité, échec auto Force/Dextérité, coups critiques au contact",mechanics:{incapacitated:!0,canMove:!1,canAct:!1,autoFailStrDex:!0,vulnerableToMelee:!0}},blessed:{name:"Béni",icon:"✨",description:"+1d4 aux jets d'attaque et de sauvegarde",mechanics:{attackBonus:"1d4",saveBonus:"1d4"}},haste:{name:"Accéléré",icon:"⚡",description:"Vitesse doublée, +1 action, +2 CA",mechanics:{speedMultiplier:2,extraAction:!0,acBonus:2}},frightened:{name:"Effrayé",icon:"😨",description:"Désavantage si la source est visible, ne peut s'approcher",mechanics:{conditionalDisadvantage:!0,cannotApproachSource:!0}},charmed:{name:"Charmé",icon:"💕",description:"Ne peut attaquer le charmeur, avantage aux interactions sociales",mechanics:{cannotAttackSource:!0,socialAdvantage:!0}}};static applyEffect(l,s,i=1,u=null,m=1){if(!Et.EFFECT_TYPES[s])return console.warn(`Effet inconnu: ${s}`),null;const p={id:Et.generateEffectId(),type:s,source:u,duration:i,intensity:m,turnsRemaining:i,startTurn:Date.now(),...Et.EFFECT_TYPES[s]};l.activeEffects||(l.activeEffects=[]);const f=l.activeEffects.findIndex(v=>v.type===s);return f!==-1?i>l.activeEffects[f].turnsRemaining&&(l.activeEffects[f]=p):l.activeEffects.push(p),p}static removeEffect(l,s){if(!l.activeEffects)return!1;const i=l.activeEffects.findIndex(u=>u.id===s);return i!==-1?(l.activeEffects.splice(i,1),!0):!1}static removeEffectsByType(l,s){if(!l.activeEffects)return 0;const i=l.activeEffects.length;return l.activeEffects=l.activeEffects.filter(u=>u.type!==s),i-l.activeEffects.length}static updateEffectDurations(l){if(!l.activeEffects)return[];const s=[];return l.activeEffects=l.activeEffects.filter(i=>(i.turnsRemaining--,i.turnsRemaining<=0?(s.push(i),!1):!0)),s}static hasEffect(l,s){return l.activeEffects?.some(i=>i.type===s)||!1}static getEffectsByType(l,s){return l.activeEffects?.filter(i=>i.type===s)||[]}static calculateEffectModifiers(l){if(!l.activeEffects)return{};const s={speedMultiplier:1,attackBonus:0,attackDisadvantage:!1,acBonus:0,canMove:!0,canAct:!0,incapacitated:!1};return l.activeEffects.forEach(i=>{const u=i.mechanics||{};u.speedMultiplier!==void 0&&(s.speedMultiplier*=u.speedMultiplier),u.acBonus&&(s.acBonus+=u.acBonus),u.attackDisadvantage&&(s.attackDisadvantage=!0),u.canMove===!1&&(s.canMove=!1),u.canAct===!1&&(s.canAct=!1),u.incapacitated&&(s.incapacitated=!0)}),s}static generateEffectId(){return`effect_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}static getActiveEffectsDescription(l){return!l.activeEffects||l.activeEffects.length===0?[]:l.activeEffects.map(s=>({id:s.id,name:s.name,icon:s.icon,description:s.description,turnsRemaining:s.turnsRemaining,source:s.source}))}static canPerformAction(l,s){const i=Et.calculateEffectModifiers(l);switch(s){case"move":return i.canMove;case"attack":case"spell":case"action":return i.canAct&&!i.incapacitated;default:return!0}}static processStartOfTurnEffects(l){if(!l.activeEffects)return[];const s=[];return l.activeEffects.forEach(u=>{if(u.mechanics?.periodicDamage){const m=Et.rollDamage(u.mechanics.periodicDamage);s.push({text:`${u.icon} ${l.name} subit ${m} dégâts de ${u.type}`,type:"periodic-damage",damage:m})}if(u.mechanics?.periodicHealing){const m=Et.rollDamage(u.mechanics.periodicHealing);s.push({text:`${u.icon} ${l.name} récupère ${m} PV`,type:"periodic-healing",healing:m})}}),Et.updateEffectDurations(l).forEach(u=>{s.push({text:`${u.icon} L'effet ${u.name} sur ${l.name} se dissipe`,type:"effect-expired"})}),s}static rollDamage(l){const s=l.match(/(\d+)d(\d+)(\+(\d+))?/);if(!s)return 0;const[,i,u,,m]=s;let p=0;for(let f=0;f<parseInt(i);f++)p+=Math.floor(Math.random()*parseInt(u))+1;return p+(parseInt(m)||0)}}class il{initializeCombat(l,s,i){const u=this.createEnemiesFromEncounter(i),m=this.rollInitiative(l,s,u),p=this.initializePositions(l,s,u,i.enemyPositions);return{enemies:u,turnOrder:m,positions:p,currentTurn:0}}createEnemiesFromEncounter(l){if(!l?.enemies?.length)throw new Error("Aucun ennemi défini dans la rencontre");return l.enemies.flatMap((s,i)=>{const u=qf[s.type];return u?Array(s.count).fill(null).map((m,p)=>({...u,id:`${s.type}_${i}_${p}`,name:s.count>1?`${u.name} ${p+1}`:u.name,type:"enemy",currentHP:u.currentHP??u.maxHP??10,maxHP:u.maxHP??10,ac:u.ac??10,stats:{...u.stats},attacks:[...u.attacks||[]],image:u.image||"",isAlive:!0})):(console.error(`Template non trouvé pour: ${s.type}`),[])})}rollInitiative(l,s,i){const u=[];if(!l||!l.stats)throw console.error("CombatService: playerCharacter ou playerCharacter.stats manquant"),new Error("Personnage joueur requis pour initialiser le combat");const m=this.rollD20()+Ce.getInitiativeBonus(l);return u.push({...l,id:"player",type:"player",initiative:m,isAlive:!0}),s&&s.length>0&&s.forEach(p=>{const f=this.rollD20()+Ce.getInitiativeBonus(p);u.push({...p,id:p.id||p.name.toLowerCase(),type:"companion",initiative:f,isAlive:!0})}),i.forEach(p=>{const f=this.rollD20()+Ce.getInitiativeBonus(p);u.push({...p,initiative:f})}),u.sort((p,f)=>f.initiative===p.initiative?p.type==="player"?-1:f.type==="player"?1:p.type==="companion"?-1:f.type==="companion"?1:0:f.initiative-p.initiative)}initializePositions(l,s,i,u=null){const m={player:{x:1,y:2},playerHasMoved:!1};return s&&s.length>0&&s.forEach((p,f)=>{const v=p.id||p.name.toLowerCase();m[v]={x:0,y:f+1},m[`${v}HasMoved`]=!1}),u?i.forEach((p,f)=>{const v=u[f];v?m[p.id]={x:v.x,y:v.y}:m[p.id]=this.getDefaultEnemyPosition(f,i.length)}):i.forEach((p,f)=>{m[p.id]=this.getDefaultEnemyPosition(f,i.length)}),m}getDefaultEnemyPosition(l,s){const m=Math.floor(4.8),p=8-m;if(s===1)return{x:m+Math.floor(p/2),y:Math.floor(6/2)};const f=Math.min(p,s),v=Math.floor(l/f),g=l%f;return{x:m+g,y:Math.max(1,Math.min(4,v+1))}}executePlayerAction(l,s,i,u,m){const p=[],f={damage:[],effects:[],messages:p};if(!s||!i.length)return p.push({text:"Aucune action ou cible sélectionnée",type:"error"}),f;switch(s.type){case"attack":return this.executeAttack(l,s,i,f);case"spell":return this.executeSpell(l,s,i,f);default:return p.push({text:`Type d'action inconnu: ${s.type}`,type:"error"}),f}}executeAttack(l,s,i,u){return i.forEach(m=>{const p=this.rollD20(),f=this.getAttackBonus(l,s),v=p+f,g=p===20;if(v>=m.ac||g){let b=this.rollDamage(s.damage);g?(b*=2,u.messages.push({text:`💥 Coup critique ! ${l.name} inflige ${b} dégâts à ${m.name} !`,type:"critical"})):u.messages.push({text:`⚔️ ${l.name} touche ${m.name} et inflige ${b} dégâts`,type:"hit"}),u.damage.push({targetId:m.id,damage:b})}else u.messages.push({text:`❌ ${l.name} manque ${m.name} (${v} vs CA ${m.ac})`,type:"miss"})}),u}executeSpell(l,s,i,u){if(s.isAreaEffect&&i.length>1){u.messages.push({text:`🔮💥 ${l.name} lance ${s.name} (zone d'effet sur ${i.length} cibles)`,type:"spell"});let m=0;s.damage&&(m=this.rollDamage(s.damage.dice)+(s.damage.bonus||0)),i.forEach(p=>{let f=m;if(s.saveType){const v=this.rollD20(),g=this.getSaveBonus(p,s.saveType),y=s.saveDC||8+this.getSpellAttackBonus(l);if(v+g>=y)f=Math.floor(f/2),u.messages.push({text:`🛡️ ${p.name} résiste partiellement (${f} dégâts)`,type:"save-success"});else if(u.messages.push({text:`💥 ${p.name} subit les pleins effets (${f} dégâts)`,type:"save-fail"}),s.effect){const b=Et.applyEffect(p,s.effect,3,l.name);u.effects.push({type:s.effect,targetId:p.id||p.name,source:l.name,duration:3,effectId:b?.id})}}else if(s.effect){const v=Et.applyEffect(p,s.effect,3,l.name);u.effects.push({type:s.effect,targetId:p.id||p.name,source:l.name,duration:3,effectId:v?.id})}f>0&&u.damage.push({targetId:p.id||p.name,damage:f})})}else u.messages.push({text:`🔮 ${l.name} lance ${s.name}`,type:"spell"}),i.forEach(m=>{if(s.requiresAttackRoll){const p=this.rollD20(),f=this.getSpellAttackBonus(l),v=p+f,g=p===20;if(v>=m.ac||g){let b=0;s.damage&&(b=this.rollDamage(s.damage.dice)+(s.damage.bonus||0),g&&(b*=2)),u.messages.push({text:`⚔️ ${s.name} touche ${m.name} et inflige ${b} dégâts`,type:g?"critical":"hit"}),u.damage.push({targetId:m.id||m.name,damage:b})}else u.messages.push({text:`❌ ${s.name} manque ${m.name} (${v} vs CA ${m.ac})`,type:"miss"})}else{let p=0;s.damage&&(p=this.rollDamage(s.damage.dice)+(s.damage.bonus||0)),u.messages.push({text:`💥 ${s.name} touche automatiquement ${m.name} et inflige ${p} dégâts`,type:"spell-hit"}),u.damage.push({targetId:m.id||m.name,damage:p})}});return u}getAttackBonus(l,s){return Ce.calculateAttackBonus(l,s)}getSpellAttackBonus(l){return Ce.calculateSpellAttackBonus(l)}getSaveBonus(l,s){return Ce.calculateSaveBonus(l,s)}rollDamage(l){return Ce.rollDamage(l)}rollD20(){return Ce.rollD20()}isDefeated(l){return Ce.isDefeated(l)}checkCombatEnd(l,s,i){const u=this.isDefeated(l),m=s.length===0||s.every(f=>this.isDefeated(f)),p=i.every(f=>this.isDefeated(f));return u&&m?"defeat":p?"victory":null}executeEntityAttack(l,s,i,u){if(!l||!s||!i)return console.error("❌ Paramètres manquants pour executeEntityAttack"),{success:!1,damage:0};if(i.character&&i.character.currentHP<=0)return console.warn(`⚠️ ${l.name} tente d'attaquer ${i.name} qui est déjà mort`),u(`${l.name} réalise que ${i.name} est déjà tombé au combat.`),{success:!1,damage:0};const m=this.rollD20(),p=this.getAttackBonus(l,s);if(isNaN(p))return console.error("❌ Attack bonus est NaN pour:",l,s),{success:!1,damage:0};const f=m+p,v=m===20,g=i.character?i.character.ac:i.ac||10;if(isNaN(g))return console.error("❌ Target AC est NaN pour:",i),{success:!1,damage:0};if(f>=g||v){let b=0;return s.damageDice?b=this.rollDamage(s.damageDice)+(s.damageBonus||0):s.damage?b=this.rollDamage(s.damage):b=1,v?(b*=2,u(`💥 Coup critique ! ${l.name} utilise ${s.name} et inflige ${b} dégâts à ${i.name} !`,"critical")):u(`⚔️ ${l.name} utilise ${s.name} et inflige ${b} dégâts à ${i.name}`,l.type==="enemy"?"enemy-hit":"companion-hit"),{success:!0,damage:b,critical:v}}else return u(`❌ ${l.name} manque ${i.name} avec ${s.name} (${f} vs CA ${g})`,"miss"),{success:!1,damage:0}}executeEntityMovement(l,s,i,u,m){return Ce.validateMovement(l,s,i,u)?!0:(console.warn(`❌ Mouvement invalide pour ${l.name}`),m(`${l.name} ne peut pas se déplacer à cette position.`),!1)}executeCompanionAction(l,s,i){const u={messages:[],damage:[],healing:[],effects:[],success:!1};try{const m=Rf.getBestAction(s,i);if(!m)return u.messages.push({text:`${s.name} ne trouve aucune action à effectuer`,type:"info"}),u;const p=i.combatPositions[l],f=Ce.calculateOptimalMovement(s,p,i);switch(m.type){case"attack":return this.executeCompanionAttack(s,m,i,u);case"spell":return this.executeCompanionSpell(s,m,i,u);case"heal_support":return this.executeCompanionHeal(s,m,i,u);case"protect":case"taunt":return this.executeCompanionSupport(s,m,i,u);default:return u.messages.push({text:`Action inconnue: ${m.type}`,type:"error"}),u}}catch(m){return console.error("Erreur lors de l'exécution de l'action du compagnon:",m),u.messages.push({text:`Erreur lors de l'action de ${s.name}`,type:"error"}),u}}executeCompanionAttack(l,s,i,u){const m=s.attack||l.attacks[0],p=s.target;if(!m||!p)return u.messages.push({text:`${l.name} ne peut pas attaquer`,type:"error"}),u;const f=this.rollD20(),v=this.getAttackBonus(l,m),g=f+v,y=f===20;if(g>=p.ac||y){let E=Ce.calculateDamage(m).damage;y&&(E*=2);const C=m.type==="ranged"?"🏹":"⚔️",_=y?" (CRITIQUE!)":"";u.messages.push({text:`${C} ${l.name} utilise ${m.name} sur ${p.name} (${E} dégâts)${_}`,type:y?"critical":"success"}),u.damage.push({targetId:p.name,damage:E,source:l.name,attackType:m.type}),u.success=!0}else u.messages.push({text:`💨 ${l.name} rate son attaque sur ${p.name}`,type:"miss"});return u}executeCompanionSpell(l,s,i,u){const m=s.spell,p=s.target;if(!Ft.canCastSpell(l,$t[m]))return u.messages.push({text:`${l.name} ne peut pas lancer ${m}`,type:"error"}),u;switch(m){case"Soins":if(p&&p.id){const f=this.rollD8()+4;u.healing.push({targetId:p.id,amount:f,source:l.name}),u.messages.push({text:`✨ ${l.name} soigne ${p.name} (+${f} PV)`,type:"healing"})}break;case"Trait de feu":if(p){const f=this.rollD10()+Be(l.stats.charisme);u.damage.push({targetId:p.name,damage:f,source:l.name,damageType:"feu"}),u.messages.push({text:`🔥 ${l.name} lance un trait de feu sur ${p.name} (${f} dégâts de feu)`,type:"spell"})}break;case"Boule de Feu":Array.isArray(p)&&(p.forEach(f=>{const v=this.rollD6()*6+Be(l.stats.charisme);u.damage.push({targetId:f.name,damage:v,source:l.name,damageType:"feu"})}),u.messages.push({text:`🔥💥 ${l.name} lance une boule de feu sur ${p.length} ennemis`,type:"spell"}));break;case"Toile d'araignée":Array.isArray(p)&&(p.forEach(f=>{const v=Et.applyEffect(f,"restrained",3,l.name);u.effects.push({type:"restrained",targetId:f.name,source:l.name,duration:3,effectId:v?.id})}),u.messages.push({text:`🕸️ ${l.name} entoile ${p.length} ennemis (entravés pour 3 tours)`,type:"spell"}));break;case"Détection de la magie":u.messages.push({text:`🔍 ${l.name} détecte les auras magiques environnantes`,type:"spell"}),u.effects.push({type:"detection",source:l.name,duration:10});break;default:u.messages.push({text:`✨ ${l.name} lance ${m}`,type:"spell"})}return this.consumeSpellSlot(l,m),u.success=!0,u}executeCompanionHeal(l,s,i,u){const m=s.target;if(!m)return u.messages.push({text:`${l.name} ne trouve personne à soigner`,type:"info"}),u;const p=this.rollD6()+2;return u.healing.push({targetId:m.id,amount:p,source:l.name}),u.messages.push({text:`🔧 ${l.name} soigne ${m.name} avec ses inventions (+${p} PV)`,type:"healing"}),u.success=!0,u}executeCompanionSupport(l,s,i,u){switch(s.type){case"protect":u.messages.push({text:`🛡️ ${l.name} protège ${s.target.name}`,type:"support"}),u.effects.push({type:"protection",targetId:s.target.id,source:l.name,duration:1});break;case"taunt":u.messages.push({text:`💢 ${l.name} attire l'attention des ennemis`,type:"support"}),u.effects.push({type:"taunt",source:l.name,targets:s.targets.map(m=>m.name),duration:1});break}return u.success=!0,u}rollD6(){return Ce.rollD6()}rollD8(){return Ce.rollD8()}rollD10(){return Ce.rollD10()}findBestTarget(l,s,i){return Ce.findBestTarget(l,s,i)}consumeSpellSlot(l,s){console.log(`${l.name} a utilisé un slot pour ${s}`)}}const ca=Ni(Mi((o,l)=>({isActive:!1,isInitialized:!1,combatPhase:"idle",combatKey:0,encounterData:null,combatEnemies:[],turnOrder:[],currentTurnIndex:0,turnCounter:0,combatPositions:{},showMovementFor:null,showTargetingFor:null,hasMovedThisTurn:!1,playerAction:null,actionTargets:[],selectedAoESquares:[],aoeCenter:null,defeated:!1,victory:!1,totalXpGained:0,initializeCombat:(s,i,u=[])=>o(m=>{const p=[];s.enemies.forEach((b,E)=>{const C=qf[b.type];if(!C){console.error("❌ Template ennemi non trouvé:",b.type);return}for(let _=0;_<b.count;_++)p.push({...ra.deepClone(C),name:`${C.name} ${_+1}`,id:ra.generateId("enemy"),type:"enemy"})});const f=[],v=Ti(Be(i.stats.dexterite));f.push({type:"player",name:i.name,initiative:v,character:i}),u&&u.length>0?u.forEach((b,E)=>{if(b&&b.stats&&b.stats.dexterite){const C=Ti(Be(b.stats.dexterite));f.push({type:"companion",name:b.name,id:b.id,initiative:C,character:b})}else console.error("❌ COMBAT INIT: Compagnon invalide:",b)}):console.log("⚠️ COMBAT INIT: Aucun compagnon actif"),p.forEach(b=>{if(!b.stats||!b.stats.dexterite){console.error("❌ Enemy sans stats.dexterite:",b);return}const E=Ti(Be(b.stats.dexterite));f.push({type:"enemy",name:b.name,initiative:E,character:b})});const g=f.sort((b,E)=>E.initiative===b.initiative?b.type==="player"?-1:E.type==="player"?1:0:E.initiative-b.initiative),y=l().calculateInitialPositions(p,u,s.enemyPositions,s.playerPosition,s.companionPositions);return y.playerStartPos={...y.player},u&&u.length>0&&u.forEach(b=>{const E=b.id||b.name.toLowerCase();y[E]&&(y[`${E}StartPos`]={...y[E]})}),{...m,isActive:!0,isInitialized:!0,combatPhase:"initiative-display",encounterData:s,combatEnemies:p,turnOrder:g,currentTurnIndex:0,turnCounter:1,combatPositions:y,hasMovedThisTurn:!1,defeated:!1,victory:!1,totalXpGained:0}}),calculateInitialPositions:(s,i=[],u={},m=null,p=null)=>{const f={player:m||{x:0,y:5}};return i&&i.length>0&&i.forEach((v,g)=>{const y=v.id||v.name.toLowerCase();if(p&&p[y])f[y]=p[y];else if(p&&Array.isArray(p)&&p[g])f[y]=p[g];else{const b=f.player;f[y]={x:b.x+1+g,y:b.y-Math.floor(g/2)}}}),s.forEach((v,g)=>{if(u[v.name])f[v.name]=u[v.name];else{const y=Math.min(6,to-2),b=Math.min(g,ao-1);f[v.name]={x:y+g%2,y:b}}}),f},resetCombat:()=>o({isActive:!1,isInitialized:!1,combatPhase:"idle",encounterData:null,combatEnemies:[],turnOrder:[],currentTurnIndex:0,turnCounter:0,combatPositions:{},showMovementFor:null,showTargetingFor:null,hasMovedThisTurn:!1,playerAction:null,actionTargets:[],selectedAoESquares:[],aoeCenter:null,defeated:!1,victory:!1,totalXpGained:0}),startCombat:()=>o({combatPhase:"turn"}),nextTurn:()=>o(s=>{let i=s.currentTurnIndex+1;i>=s.turnOrder.length&&(i=0,s.turnCounter++);const u=s.turnOrder.length;let m=0;for(;i!==s.currentTurnIndex&&m<u;){const g=s.turnOrder[i];let y=!1;if(g.type==="enemy"){const b=s.combatEnemies.find(E=>E.name===g.name);(!b||b.currentHP<=0)&&(y=!0)}else g.type;if(y){i++,m++,i>=s.turnOrder.length&&(i=0,s.turnCounter++);continue}break}const p=s.turnOrder[i];let f=[];if(p?.type==="enemy"){const g=s.combatEnemies.find(y=>y.name===p.name);g&&(f=Et.processStartOfTurnEffects(g))}const v={...s.combatPositions};if(p?.type==="player")v.playerStartPos={...s.combatPositions.player};else if(p?.type==="companion"){const g=p.id||p.name.toLowerCase(),y=s.combatPositions[g];y&&(v[`${g}StartPos`]={...y})}return f.length>0&&console.log("Effets de début de tour:",f),{currentTurnIndex:i,turnCounter:s.turnCounter,combatPhase:"turn",hasMovedThisTurn:!1,showMovementFor:null,showTargetingFor:null,playerAction:null,actionTargets:[],combatPositions:v}}),setTurnPhase:s=>o({combatPhase:s}),getCurrentTurn:()=>{const{turnOrder:s,currentTurnIndex:i}=l();return s[i]},moveCharacter:(s,i)=>o(u=>{if(!ns(i.x,i.y)||Ce.isPositionOccupied(i.x,i.y,u.combatPositions,u.combatEnemies,s))return u;const p=u.combatPositions[s];return l().checkOpportunityAttacks(s,p,i),{combatPositions:{...u.combatPositions,[s]:i},hasMovedThisTurn:s==="player"?!0:u.hasMovedThisTurn}}),checkOpportunityAttacks:(s,i,u)=>{const{combatPositions:m,combatEnemies:p}=l(),f=[];return p.forEach(v=>{if(v.currentHP<=0)return;const g=m[v.name];if(!g)return;const y=ot(i,g)<=1,b=ot(u,g)<=1;y&&!b&&f.push({attacker:v,target:s,position:g})}),f},updateEnemyPosition:(s,i)=>o(u=>({combatPositions:{...u.combatPositions,[s]:i}})),setPlayerAction:s=>o({playerAction:s}),setActionTargets:s=>o({actionTargets:s}),setShowMovementFor:s=>o({showMovementFor:s}),setShowTargetingFor:s=>o({showTargetingFor:s}),setSelectedAoESquares:s=>o({selectedAoESquares:s}),setAoECenter:s=>o({aoeCenter:s}),executeAction:()=>{const{playerAction:s,actionTargets:i,turnOrder:u,currentTurnIndex:m,combatPositions:p,combatEnemies:f}=l();if(!s||i.length===0)return;const v=u[m];p[v.name.toLowerCase()];const y=new il().executePlayerAction(v.character,s,i,f,p);l().applyActionResults(y)},applyActionResults:s=>o(i=>{const u={...i};return s.damages?.forEach(m=>{if(m.target.type==="enemy"){const p=u.combatEnemies.findIndex(f=>f.name===m.target.name);p!==-1&&(u.combatEnemies[p]={...u.combatEnemies[p],currentHP:Math.max(0,u.combatEnemies[p].currentHP-m.amount)})}}),l().checkCombatEnd(),u}),_onPlayerDamage:null,_onCompanionDamageById:null,setDamageCallbacks:(s,i)=>o({_onPlayerDamage:s,_onCompanionDamageById:i}),dealDamageToPlayer:s=>{const{_onPlayerDamage:i}=l();i?i(s):console.warn("Player damage callback not set")},dealDamageToCompanion:s=>{console.warn("dealDamageToCompanion is deprecated, use dealDamageToCompanionById")},dealDamageToCompanionById:(s,i)=>{const{_onCompanionDamageById:u}=l();u?u(s,i):console.warn("Companion damage by ID callback not set")},dealDamageToEnemy:(s,i)=>o(u=>{const m=u.combatEnemies.findIndex(f=>f.name===s);if(m===-1)return u;const p=[...u.combatEnemies];return p[m]={...p[m],currentHP:Math.max(0,p[m].currentHP-i)},{combatEnemies:p}}),checkCombatEnd:()=>{const{combatEnemies:s}=l();if(s.filter(u=>u.currentHP>0).length===0){l().handleVictory();return}},handleVictory:()=>{const{combatEnemies:s}=l(),i=s.reduce((u,m)=>u+(m.xp||0),0);o(u=>({victory:!0,combatPhase:"end",isActive:!1,totalXpGained:i}))},handleDefeat:()=>o({defeated:!0,combatPhase:"end",isActive:!1}),endCombat:s=>o({[s?"victory":"defeated"]:!0,combatPhase:"end",isActive:!1}),executeEnemyTurn:(s,i,u=[])=>{const{combatEnemies:m,combatPositions:p}=l(),f=m.find(b=>b.name===s);if(!f||f.currentHP<=0)return;const v=p[s];if(!v)return;const g=Et.calculateEffectModifiers(f);if(g.incapacitated){console.log(`${s} est incapacité par des effets et ne peut pas agir`);return}const y={playerCharacter:i,activeCompanions:u,combatEnemies:m,combatPositions:p};if(f.role&&f.aiPriority){const b=Rf.getBestAction(f,y);b?l().executeEnemyAction(f,b,y):console.log(`${s} (${f.role}) ne trouve aucune action`)}else{let b=v;if(g.canMove&&!Et.hasEffect(f,"restrained")){const _=Ce.calculateOptimalMovement({...f,type:"enemy"},v,y);_&&(l().moveCharacter(s,_),b=_)}else console.log(`${s} ne peut pas bouger à cause d'effets (${f.activeEffects?.map(_=>_.name).join(", ")||"aucun effet visible"})`);if(!g.canAct){console.log(`${s} ne peut pas attaquer à cause d'effets`);return}const E=f.attacks?.[0]||{name:"Attaque de base",type:"melee",range:1,damageDice:"1d6",damageBonus:0},C=Ce.getTargetsInRange({...f,type:"enemy"},b,E,y);if(C.length>0){let _=C.find(j=>p.player&&j.position.x===p.player.x&&j.position.y===p.player.y);_||(_=C[0]);let A=Ce.calculateDamage(E);g.attackDisadvantage&&(console.log(`${s} attaque avec désavantage à cause d'effets`),A.damage=Math.floor(A.damage*.75));const D=p.player;if(D&&_.position.x===D.x&&_.position.y===D.y)l().dealDamageToPlayer(A.damage);else{const j=u.find(q=>{const B=p[q.id];return B&&B.x===_.position.x&&B.y===_.position.y});j&&l().dealDamageToCompanionById(j.id,A.damage)}}else console.log(`${s} n'a aucune cible à portée`)}},executeEnemyAction:(s,i,u)=>{switch(console.log(`Executing ${i.type} for ${s.name}:`,i.description),i.type){case"attack":if(i.attack&&i.target){const m=Ce.calculateDamage(i.attack);i.target.id==="player"?l().dealDamageToPlayer(m.damage):i.target.id&&l().dealDamageToCompanionById(i.target.id,m.damage)}break;case"hit_and_run":if(console.log(`${s.name} utilise une tactique de harcèlement`),i.attack&&i.targets.length>0){const m=i.targets[0],p=Ce.calculateDamage(i.attack);m.id==="player"?l().dealDamageToPlayer(p.damage):m.id&&l().dealDamageToCompanionById(m.id,p.damage)}break;case"charge":console.log(`${s.name} charge ${i.target.name}`);break;case"retreat":console.log(`${s.name} se replie tactiquement`);break;default:console.warn(`Type d'action ennemi inconnu: ${i.type}`)}},executeCompanionTurnById:(s,i,u,m)=>{const{combatPositions:p,combatEnemies:f}=l();if(!i||i.currentHP<=0)return;const v=new il,g={playerCharacter:m,activeCompanions:u,combatEnemies:f,combatPositions:p},y=v.executeCompanionAction(s,i,g);y&&y.success&&(y.damage?.forEach(b=>{l().dealDamageToEnemy(b.targetId,b.damage)}),y.healing?.forEach(b=>{b.targetId==="player"?l().dealDamageToPlayer(-b.amount):l().dealDamageToCompanionById(b.targetId,-b.amount)}))},incrementCombatKey:()=>o(s=>({combatKey:s.combatKey+1})),getValidMovementSquares:(s,i=6)=>{const{combatPositions:u,combatEnemies:m}=l(),p=u[s];if(!p)return[];const f=[];for(let v=0;v<to;v++)for(let g=0;g<ao;g++)ot(p,{x:v,y:g})<=i&&!Ce.isPositionOccupied(v,g,u,m,s)&&f.push({x:v,y:g});return f},getValidTargetSquares:(s,i)=>{const{combatPositions:u,combatEnemies:m}=l();return Ce.getTargetsInRange({type:"player"},i,s,{combatPositions:u,combatEnemies:m}).map(p=>u[p.name])}}),{name:"combat-store"})),Ze=Ni(Xg(Mi((o,l)=>({openPanels:new Set(["character-sheet"]),collapsedSections:new Set,activeModal:null,modalData:null,modalHistory:[],notifications:[],notificationCounter:0,isMobile:typeof window<"u"?window.innerWidth<=768:!1,sidebarCollapsed:!1,screenSize:typeof window<"u"?window.innerWidth<=480?"mobile":window.innerWidth<=768?"tablet":"desktop":"desktop",showCombatDetails:!0,showHealthBars:!0,showInitiativeOrder:!0,combatAnimationsEnabled:!0,theme:"default",showTooltips:!0,autoScrollLogs:!0,compactMode:!1,loading:!1,loadingMessage:"",hoveredElement:null,focusedElement:null,openPanel:s=>o(i=>({openPanels:new Set([...i.openPanels,s])})),closePanel:s=>o(i=>{const u=new Set(i.openPanels);return u.delete(s),{openPanels:u}}),togglePanel:s=>o(i=>{const u=new Set(i.openPanels);return u.has(s)?u.delete(s):u.add(s),{openPanels:u}}),closeAllPanels:()=>o({openPanels:new Set}),resetPanels:()=>o({openPanels:new Set(["character-sheet"])}),collapseSection:s=>o(i=>({collapsedSections:new Set([...i.collapsedSections,s])})),expandSection:s=>o(i=>{const u=new Set(i.collapsedSections);return u.delete(s),{collapsedSections:u}}),toggleSection:s=>o(i=>{const u=new Set(i.collapsedSections);return u.has(s)?u.delete(s):u.add(s),{collapsedSections:u}}),openModal:(s,i=null)=>o(u=>({modalHistory:u.activeModal?[...u.modalHistory,{type:u.activeModal,data:u.modalData}]:u.modalHistory,activeModal:s,modalData:i})),closeModal:()=>o(s=>{if(s.modalHistory.length>0){const i=s.modalHistory[s.modalHistory.length-1];return{activeModal:i.type,modalData:i.data,modalHistory:s.modalHistory.slice(0,-1)}}return{activeModal:null,modalData:null,modalHistory:[]}}),closeAllModals:()=>o({activeModal:null,modalData:null,modalHistory:[]}),addNotification:s=>o(i=>({notifications:[...i.notifications,{id:`notif-${i.notificationCounter}`,timestamp:Date.now(),type:"info",duration:5e3,...s}],notificationCounter:i.notificationCounter+1})),removeNotification:s=>o(i=>({notifications:i.notifications.filter(u=>u.id!==s)})),clearNotifications:()=>o({notifications:[]}),showSuccess:(s,i={})=>l().addNotification({type:"success",message:s,...i}),showError:(s,i={})=>l().addNotification({type:"error",message:s,duration:8e3,...i}),showWarning:(s,i={})=>l().addNotification({type:"warning",message:s,duration:6e3,...i}),showInfo:(s,i={})=>l().addNotification({type:"info",message:s,...i}),updateScreenSize:()=>o(s=>{const i=window.innerWidth;let u="desktop",m=!1;return i<=480?(u="mobile",m=!0):i<=768&&(u="tablet"),s.isMobile!==m||s.screenSize!==u?{isMobile:m,screenSize:u}:s}),toggleSidebar:()=>o(s=>({sidebarCollapsed:!s.sidebarCollapsed})),setSidebarCollapsed:s=>o({sidebarCollapsed:s}),toggleCombatDetails:()=>o(s=>({showCombatDetails:!s.showCombatDetails})),toggleHealthBars:()=>o(s=>({showHealthBars:!s.showHealthBars})),toggleInitiativeOrder:()=>o(s=>({showInitiativeOrder:!s.showInitiativeOrder})),toggleCombatAnimations:()=>o(s=>({combatAnimationsEnabled:!s.combatAnimationsEnabled})),setCombatUISettings:s=>o(i=>({showCombatDetails:s.showDetails??i.showCombatDetails,showHealthBars:s.showHealthBars??i.showHealthBars,showInitiativeOrder:s.showInitiativeOrder??i.showInitiativeOrder,combatAnimationsEnabled:s.animationsEnabled??i.combatAnimationsEnabled})),setTheme:s=>o({theme:s}),toggleTooltips:()=>o(s=>({showTooltips:!s.showTooltips})),toggleAutoScrollLogs:()=>o(s=>({autoScrollLogs:!s.autoScrollLogs})),toggleCompactMode:()=>o(s=>({compactMode:!s.compactMode})),updatePreferences:s=>o(i=>({theme:s.theme??i.theme,showTooltips:s.showTooltips??i.showTooltips,autoScrollLogs:s.autoScrollLogs??i.autoScrollLogs,compactMode:s.compactMode??i.compactMode})),setLoading:(s,i="")=>o({loading:s,loadingMessage:s?i:""}),setHoveredElement:s=>o({hoveredElement:s}),setFocusedElement:s=>o({focusedElement:s}),clearHover:()=>o({hoveredElement:null}),clearFocus:()=>o({focusedElement:null}),resetUI:()=>o({openPanels:new Set(["character-sheet"]),collapsedSections:new Set,activeModal:null,modalData:null,modalHistory:[],notifications:[],sidebarCollapsed:!1,showCombatDetails:!0,showHealthBars:!0,showInitiativeOrder:!0,combatAnimationsEnabled:!0,hoveredElement:null,focusedElement:null,loading:!1,loadingMessage:""}),savePreferences:()=>{console.log("Preferences saved automatically")}}),{name:"ui-store"}),{name:"rpg-ui-preferences",partialize:o=>({theme:o.theme,showTooltips:o.showTooltips,autoScrollLogs:o.autoScrollLogs,compactMode:o.compactMode,sidebarCollapsed:o.sidebarCollapsed,showCombatDetails:o.showCombatDetails,showHealthBars:o.showHealthBars,showInitiativeOrder:o.showInitiativeOrder,combatAnimationsEnabled:o.combatAnimationsEnabled,openPanels:Array.from(o.openPanels),collapsedSections:Array.from(o.collapsedSections)}),onRehydrateStorage:()=>o=>{o&&(o.openPanels=new Set(o.openPanels||["character-sheet"]),o.collapsedSections=new Set(o.collapsedSections||[]))}}));if(typeof window<"u"){const o=()=>{Ze.getState().updateScreenSize()};window.addEventListener("resize",o)}const je=({children:o,variant:l="default",size:s="medium",className:i="",onClick:u,disabled:m=!1,...p})=>{const f="card",v=`card--${l}`,g=`card--${s}`,E=[f,v,g,m?"card--disabled":"",u?"card--clickable":"",i].filter(Boolean).join(" ");return c.jsx("div",{className:E,onClick:m?void 0:u,...p,children:o})},Qt=({children:o,className:l=""})=>c.jsx("div",{className:`card__header ${l}`,children:o}),Fe=({children:o,className:l=""})=>c.jsx("div",{className:`card__body ${l}`,children:o}),Di=({children:o,className:l=""})=>c.jsx("div",{className:`card__footer ${l}`,children:o}),oe=({children:o,variant:l="primary",size:s="medium",disabled:i=!1,loading:u=!1,icon:m,iconPosition:p="left",fullWidth:f=!1,className:v="",onClick:g,type:y="button",...b})=>{const E=Ze(le=>le.compactMode),C="btn",_=`btn--${l}`,A=`btn--${s}`,F=[C,_,A,E?"btn--compact":"",i?"btn--disabled":"",u?"btn--loading":"",f?"btn--full-width":"",v].filter(Boolean).join(" "),W=le=>{i||u||g?.(le)};return c.jsxs("button",{type:y,className:F,onClick:W,disabled:i||u,...b,children:[u&&c.jsx("span",{className:"btn__spinner"}),m&&p==="left"&&c.jsx("span",{className:"btn__icon btn__icon--left",children:m}),c.jsx("span",{className:"btn__content",children:o}),m&&p==="right"&&c.jsx("span",{className:"btn__icon btn__icon--right",children:m})]})},Ca=({children:o,variant:l="horizontal",spacing:s="medium",className:i=""})=>{const u=["btn-group",`btn-group--${l}`,`btn-group--spacing-${s}`,i].filter(Boolean).join(" ");return c.jsx("div",{className:u,children:o})},bf=({children:o,variant:l="secondary",size:s="medium",disabled:i=!1,selected:u=!1,cooldown:m=!1,onClick:p,className:f="",...v})=>{const g=["action-button",u&&"action-button--selected",m&&"action-button--cooldown",f].filter(Boolean).join(" ");return c.jsxs(oe,{variant:u?"primary":l,size:s,disabled:i||m,onClick:p,className:g,...v,children:[o,m&&c.jsx("div",{className:"action-button__cooldown-overlay",children:c.jsx("span",{className:"action-button__cooldown-text",children:"⏱️"})})]})};var Ig=Af();const Fg=lo(Ig);var zf={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},_f=ke.createContext&&ke.createContext(zf),Wg=["attr","size","title"];function ev(o,l){if(o==null)return{};var s=tv(o,l),i,u;if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(o);for(u=0;u<m.length;u++)i=m[u],!(l.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(o,i)&&(s[i]=o[i])}return s}function tv(o,l){if(o==null)return{};var s={};for(var i in o)if(Object.prototype.hasOwnProperty.call(o,i)){if(l.indexOf(i)>=0)continue;s[i]=o[i]}return s}function Ei(){return Ei=Object.assign?Object.assign.bind():function(o){for(var l=1;l<arguments.length;l++){var s=arguments[l];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(o[i]=s[i])}return o},Ei.apply(this,arguments)}function Sf(o,l){var s=Object.keys(o);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(o);l&&(i=i.filter(function(u){return Object.getOwnPropertyDescriptor(o,u).enumerable})),s.push.apply(s,i)}return s}function Ai(o){for(var l=1;l<arguments.length;l++){var s=arguments[l]!=null?arguments[l]:{};l%2?Sf(Object(s),!0).forEach(function(i){av(o,i,s[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(s)):Sf(Object(s)).forEach(function(i){Object.defineProperty(o,i,Object.getOwnPropertyDescriptor(s,i))})}return o}function av(o,l,s){return l=nv(l),l in o?Object.defineProperty(o,l,{value:s,enumerable:!0,configurable:!0,writable:!0}):o[l]=s,o}function nv(o){var l=sv(o,"string");return typeof l=="symbol"?l:l+""}function sv(o,l){if(typeof o!="object"||!o)return o;var s=o[Symbol.toPrimitive];if(s!==void 0){var i=s.call(o,l);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(l==="string"?String:Number)(o)}function Hf(o){return o&&o.map((l,s)=>ke.createElement(l.tag,Ai({key:s},l.attr),Hf(l.child)))}function st(o){return l=>ke.createElement(lv,Ei({attr:Ai({},o.attr)},l),Hf(o.child))}function lv(o){var l=s=>{var{attr:i,size:u,title:m}=o,p=ev(o,Wg),f=u||s.size||"1em",v;return s.className&&(v=s.className),o.className&&(v=(v?v+" ":"")+o.className),ke.createElement("svg",Ei({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},s.attr,i,p,{className:v,style:Ai(Ai({color:o.color||s.color},s.style),o.style),height:f,width:f,xmlns:"http://www.w3.org/2000/svg"}),m&&ke.createElement("title",null,m),o.children)};return _f!==void 0?ke.createElement(_f.Consumer,null,s=>l(s)):l(zf)}function iv(o){return st({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"},child:[]}]})(o)}function rv(o){return st({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"},child:[]}]})(o)}function Of(o){return st({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"},child:[]}]})(o)}function wf(o){return st({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"},child:[]}]})(o)}function cv(o){return st({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"m19 9 1.25-2.75L23 5l-2.75-1.25L19 1l-1.25 2.75L15 5l2.75 1.25zM19 15l-1.25 2.75L15 19l2.75 1.25L19 23l1.25-2.75L23 19l-2.75-1.25zM11.5 9.5 9 4 6.5 9.5 1 12l5.5 2.5L9 20l2.5-5.5L17 12l-5.5-2.5zm-1.51 3.49L9 15.17l-.99-2.18L5.83 12l2.18-.99L9 8.83l.99 2.18 2.18.99-2.18.99z"},child:[]}]})(o)}const ro=({type:o,title:l,children:s,size:i="medium",showCloseButton:u=!0,closeOnBackdrop:m=!0,closeOnEscape:p=!0,className:f="",onClose:v})=>{const g=Ze(q=>q.activeModal),y=Ze(q=>q.modalData),b=Ze(q=>q.closeModal),E=Ze(q=>q.isMobile),C=g===o;se.useEffect(()=>{if(!C||!p)return;const q=B=>{B.key==="Escape"&&_()};return document.addEventListener("keydown",q),()=>document.removeEventListener("keydown",q)},[C,p]),se.useEffect(()=>{if(C)return document.body.style.overflow="hidden",()=>{document.body.style.overflow=""}},[C]);const _=()=>{v?.(),b()},A=q=>{q.target===q.currentTarget&&m&&_()};if(!C)return null;const D=["modal",`modal--${i}`,E&&"modal--mobile",f].filter(Boolean).join(" "),j=c.jsx("div",{className:"modal__backdrop",onClick:A,children:c.jsxs("div",{className:D,role:"dialog","aria-modal":"true",children:[(l||u)&&c.jsxs("div",{className:"modal__header",children:[l&&c.jsx("h2",{className:"modal__title",children:l}),u&&c.jsx(oe,{variant:"ghost",size:"small",icon:c.jsx(rv,{}),onClick:_,className:"modal__close-button","aria-label":"Fermer la modal"})]}),c.jsx("div",{className:"modal__content",children:typeof s=="function"?s({data:y,onClose:_}):s})]})});return Fg.createPortal(j,document.body)},ov=()=>{const o=Ze(u=>u.openModal),l=Ze(u=>u.closeModal),s=Ze(u=>u.activeModal),i=Ze(u=>u.modalData);return{openModal:o,closeModal:l,activeModal:s,modalData:i,isOpen:u=>s===u}},Ci=({current:o,max:l,label:s,showNumbers:i=!0,showPercentage:u=!1,size:m="medium",variant:p="health",animated:f=!0,className:v=""})=>{const g=Ze(A=>A.showHealthBars),y=Ze(A=>A.combatAnimationsEnabled);if(!g)return null;const b=l>0?Math.max(0,Math.min(100,o/l*100)):0,E=Math.max(0,o);let C="";b>75?C="health-bar--high":b>50?C="health-bar--medium":b>25?C="health-bar--low":C="health-bar--critical";const _=["health-bar",`health-bar--${m}`,`health-bar--${p}`,"flex flex--column flex--center",C,f&&y&&"health-bar--animated",v].filter(Boolean).join(" ");return c.jsxs("div",{className:_,children:[s&&c.jsxs("div",{className:"health-bar__label",children:[c.jsxs("span",{className:"health-bar__label-text",children:[s," "]}),i&&c.jsxs("span",{className:"health-bar__numbers",children:[E,"/",l,u&&` (${Math.round(b)}%)`]})]}),c.jsxs("div",{className:"health-bar__container",children:[c.jsx("div",{className:"health-bar__background",children:c.jsx("div",{className:"health-bar__fill",style:{width:`${b}%`,transition:f&&y?"width 0.3s ease-out":"none"}})}),!s&&i&&c.jsx("div",{className:"health-bar__overlay",children:c.jsxs("span",{className:"health-bar__overlay-text",children:[E,"/",l,u&&` (${Math.round(b)}%)`]})})]})]})},uv=({character:o})=>{if(!o?.spellcasting)return null;const s=new Ft().getSpellSlots(o);if(!s||Object.keys(s).length===0)return null;const i=Object.values(s).reduce((p,f)=>p+(f?.max||0),0),u=Object.values(s).reduce((p,f)=>p+(f?.used||0),0),m=i-u;return i>0?c.jsx(Ci,{current:m,max:i,label:"✨ Emplacements de sorts",variant:"mana",showNumbers:!0,size:"small"}):null},dv=({character:o,characterStats:l,layout:s="vertical"})=>{if(!o)return null;const i=["resource-bars",`resource-bars--${s}`].join(" ");return c.jsxs("div",{className:i,children:[c.jsx(Ci,{current:o.currentHP,max:o.maxHP,label:"❤️ Points de vie",variant:"health",showNumbers:!0}),o.hitDice&&c.jsx(Ci,{current:o.hitDice,max:o.level,label:"🎲 Dés de vie",variant:"energy",showNumbers:!0,size:"small"}),c.jsx(uv,{character:o})]})},nl=({id:o,title:l,children:s,defaultExpanded:i=!0,persistState:u=!0,showIcon:m=!0,headerLevel:p=4,className:f="",headerClassName:v="",contentClassName:g="",onToggle:y})=>{const b=Ze(le=>u?le.collapsedSections.has(o):!1),E=Ze(le=>le.toggleSection),C=Ze(le=>le.combatAnimationsEnabled),[_,A]=ke.useState(!i),D=u?!b:!_,j=()=>{u&&o?E(o):A(!_),y?.(D)},q=["collapsible-section",D&&"collapsible-section--expanded",C&&"collapsible-section--animated",f].filter(Boolean).join(" "),B=["collapsible-section__header",`collapsible-section__header--h${p}`,v].filter(Boolean).join(" "),F=["collapsible-section__content",g].filter(Boolean).join(" "),W=`h${p}`;return c.jsxs("div",{className:q,children:[c.jsxs(W,{className:B,onClick:j,role:"button",tabIndex:0,onKeyDown:le=>{(le.key==="Enter"||le.key===" ")&&(le.preventDefault(),j())},"aria-expanded":D,"aria-controls":o?`${o}-content`:void 0,children:[c.jsx("span",{className:"collapsible-section__title",children:l}),m&&c.jsx("span",{className:"collapsible-section__icon",children:D?c.jsx(Of,{}):c.jsx(wf,{})})]}),D&&c.jsx("div",{className:F,id:o?`${o}-content`:void 0,children:s})]})};function mv(o){return st({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M500 224h-30.364C455.724 130.325 381.675 56.276 288 42.364V12c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v30.364C130.325 56.276 56.276 130.325 42.364 224H12c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h30.364C56.276 381.675 130.325 455.724 224 469.636V500c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12v-30.364C381.675 455.724 455.724 381.675 469.636 288H500c6.627 0 12-5.373 12-12v-40c0-6.627-5.373-12-12-12zM288 404.634V364c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40.634C165.826 392.232 119.783 346.243 107.366 288H148c6.627 0 12-5.373 12-12v-40c0-6.627-5.373-12-12-12h-40.634C119.768 165.826 165.757 119.783 224 107.366V148c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12v-40.634C346.174 119.768 392.217 165.757 404.634 224H364c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40.634C392.232 346.174 346.243 392.217 288 404.634zM288 256c0 17.673-14.327 32-32 32s-32-14.327-32-32c0-17.673 14.327-32 32-32s32 14.327 32 32z"},child:[]}]})(o)}function fv(o){return st({attr:{viewBox:"0 0 480 512"},child:[{tag:"path",attr:{d:"M106.75 215.06L1.2 370.95c-3.08 5 .1 11.5 5.93 12.14l208.26 22.07-108.64-190.1zM7.41 315.43L82.7 193.08 6.06 147.1c-2.67-1.6-6.06.32-6.06 3.43v162.81c0 4.03 5.29 5.53 7.41 2.09zM18.25 423.6l194.4 87.66c5.3 2.45 11.35-1.43 11.35-7.26v-65.67l-203.55-22.3c-4.45-.5-6.23 5.59-2.2 7.57zm81.22-257.78L179.4 22.88c4.34-7.06-3.59-15.25-10.78-11.14L17.81 110.35c-2.47 1.62-2.39 5.26.13 6.78l81.53 48.69zM240 176h109.21L253.63 7.62C250.5 2.54 245.25 0 240 0s-10.5 2.54-13.63 7.62L130.79 176H240zm233.94-28.9l-76.64 45.99 75.29 122.35c2.11 3.44 7.41 1.94 7.41-2.1V150.53c0-3.11-3.39-5.03-6.06-3.43zm-93.41 18.72l81.53-48.7c2.53-1.52 2.6-5.16.13-6.78l-150.81-98.6c-7.19-4.11-15.12 4.08-10.78 11.14l79.93 142.94zm79.02 250.21L256 438.32v65.67c0 5.84 6.05 9.71 11.35 7.26l194.4-87.66c4.03-1.97 2.25-8.06-2.2-7.56zm-86.3-200.97l-108.63 190.1 208.26-22.07c5.83-.65 9.01-7.14 5.93-12.14L373.25 215.06zM240 208H139.57L240 383.75 340.43 208H240z"},child:[]}]})(o)}function pv(o){return st({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M243.2 189.9V258c26.1 5.9 49.3 15.6 73.6 22.3v-68.2c-26-5.8-49.4-15.5-73.6-22.2zm223.3-123c-34.3 15.9-76.5 31.9-117 31.9C296 98.8 251.7 64 184.3 64c-25 0-47.3 4.4-68 12 2.8-7.3 4.1-15.2 3.6-23.6C118.1 24 94.8 1.2 66.3 0 34.3-1.3 8 24.3 8 56c0 19 9.5 35.8 24 45.9V488c0 13.3 10.7 24 24 24h16c13.3 0 24-10.7 24-24v-94.4c28.3-12.1 63.6-22.1 114.4-22.1 53.6 0 97.8 34.8 165.2 34.8 48.2 0 86.7-16.3 122.5-40.9 8.7-6 13.8-15.8 13.8-26.4V95.9c.1-23.3-24.2-38.8-45.4-29zM169.6 325.5c-25.8 2.7-50 8.2-73.6 16.6v-70.5c26.2-9.3 47.5-15 73.6-17.4zM464 191c-23.6 9.8-46.3 19.5-73.6 23.9V286c24.8-3.4 51.4-11.8 73.6-26v70.5c-25.1 16.1-48.5 24.7-73.6 27.1V286c-27 3.7-47.9 1.5-73.6-5.6v67.4c-23.9-7.4-47.3-16.7-73.6-21.3V258c-19.7-4.4-40.8-6.8-73.6-3.8v-70c-22.4 3.1-44.6 10.2-73.6 20.9v-70.5c33.2-12.2 50.1-19.8 73.6-22v71.6c27-3.7 48.4-1.3 73.6 5.7v-67.4c23.7 7.4 47.2 16.7 73.6 21.3v68.4c23.7 5.3 47.6 6.9 73.6 2.7V143c27-4.8 52.3-13.6 73.6-22.5z"},child:[]}]})(o)}function hv(o){return st({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M496 448H16c-8.84 0-16 7.16-16 16v32c0 8.84 7.16 16 16 16h480c8.84 0 16-7.16 16-16v-32c0-8.84-7.16-16-16-16zm-304-64l-64-32 64-32 32-64 32 64 64 32-64 32-16 32h208l-86.41-201.63a63.955 63.955 0 0 1-1.89-45.45L416 0 228.42 107.19a127.989 127.989 0 0 0-53.46 59.15L64 416h144l-16-32zm64-224l16-32 16 32 32 16-32 16-16 32-16-32-32-16 32-16z"},child:[]}]})(o)}function gv(o){return st({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3 0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z"},child:[]}]})(o)}function vv(o){return st({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 0C114.6 0 0 100.3 0 224c0 70.1 36.9 132.6 94.5 173.7 9.6 6.9 15.2 18.1 13.5 29.9l-9.4 66.2c-1.4 9.6 6 18.2 15.7 18.2H192v-56c0-4.4 3.6-8 8-8h16c4.4 0 8 3.6 8 8v56h64v-56c0-4.4 3.6-8 8-8h16c4.4 0 8 3.6 8 8v56h77.7c9.7 0 17.1-8.6 15.7-18.2l-9.4-66.2c-1.7-11.7 3.8-23 13.5-29.9C475.1 356.6 512 294.1 512 224 512 100.3 397.4 0 256 0zm-96 320c-35.3 0-64-28.7-64-64s28.7-64 64-64 64 28.7 64 64-28.7 64-64 64zm192 0c-35.3 0-64-28.7-64-64s28.7-64 64-64 64 28.7 64 64-28.7 64-64 64z"},child:[]}]})(o)}function yv(o){return st({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M214.02 19.115l-.02.06c38.033 14.387 73.867 34.09 106.393 58.446L368.02 158.4C292.254 72.063 181.72 20.678 64.66 20.604c-14.96-.01-30.027.834-45.14 2.535v18.8c108.174-12.774 213.91 21.292 293.527 88.554l42.314 97.416C290.887 132.486 182.425 73.885 66.395 73.21c-2.45-.013-4.9-.002-7.357.036-13.106.2-26.297 1.157-39.522 2.87v18.85c98.998-13.552 196.12 18.532 267.11 82.264l30.708 87.82C263.412 179.47 168.852 126.394 67.348 125.36c-15.818-.162-31.804.958-47.83 3.398v18.914c93.33-15.18 185.38 18.05 247.677 83.27l20.694 83.917C246.555 230.42 160.67 176.716 67.7 175.423c-1.256-.018-2.514-.025-3.774-.024-14.688.02-29.54 1.36-44.408 4.084v19.036c89.513-17.794 178.655 19.16 230.357 89.468l4.62 73.348c-28.973-83.013-107.888-136.692-193.257-135.87-13.8.132-27.768 1.693-41.72 4.78v19.188c77.22-18.904 155.333 13.983 197.095 77.14l5.873 57.49c23.33-6.283 47.534-13.218 68.727-20.873 19.194-6.93 35.884-14.525 46.596-22.038 5.354-3.756 9.142-7.478 11.174-10.574 2.033-3.096 2.47-5.184 2.098-7.59l-1.252-8.123 137.074-39.556C446.897 159.92 363.67 69.964 260.654 19.114H214.02zm278.86 273.922l-40.196 11.6c1.63 18.66-4.666 36.567-16.397 52.043-14.18 18.707-35.934 34.627-62.363 48.257-45.23 23.33-104.45 39.877-164.397 47.97l4.38 16.35c68.63-7.66 143.34-22.038 198.17-48.538 30.517-14.75 54.633-33.123 68.722-55.33 12.74-20.084 17.775-43.384 12.08-72.353zm-58.513 16.885l-65.027 18.765c-.736 4.345-2.345 8.51-4.733 12.147-3.925 5.98-9.462 10.986-16.068 15.62-13.213 9.266-30.996 17.098-50.978 24.316-31.927 11.53-68.41 20.998-99.558 29.134l6.644 24.79c59.027-7.79 117.64-24.153 160.71-46.366 24.828-12.805 44.388-27.573 56.037-42.94 8.804-11.614 13.283-23.135 12.972-35.466zm-261.754 77.43l-33.033 8.85 8.197 30.59c10.812 3.95 18.623 14.38 18.623 26.485 0 6.87-2.52 13.2-6.673 18.114l4.716 17.6 33.034-8.85-24.864-92.788zM138.22 443.79c-1.49 0-2.88.33-4.12.91l-75.6 20.255c2.926 4.706 4.625 10.24 4.625 16.14 0 .67-.03 1.33-.072 1.987l75.96-20.352c4.96-.386 8.698-4.37 8.698-9.453 0-5.35-4.138-9.488-9.49-9.488zM32.327 468.985c-6.798 0-12.11 5.312-12.11 12.11 0 6.798 5.312 12.11 12.11 12.11 6.798 0 12.111-5.312 12.111-12.11 0-6.798-5.313-12.11-12.11-12.11z"},child:[]}]})(o)}function xv(o){return st({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M30.936 23.332c-.97 100.412 10.37 192.13 100.757 231.064 109.81 47.303 46.883 118.85-58.246 83.002 76.11 65.222 145.665 141.652 200.928 159.985 6.78 2.995 14.26 4.674 22.12 4.674 11.404 0 22.023-3.508 30.835-9.495 31.55 8.544 59.065 11.345 82.4 9.23 19.94-.195 38.412-6.676 53.524-17.556 49.986-33.49 55.46-109.83 11.715-201.34 1.573-8.565 1.077-16.997-1.154-25.322-1.973-9.506-6.227-18.195-12.152-25.476-28.97-42.765-97.358-83.18-159.58-124.506 77.79 99.205 67.214 143.1 10.635 94.234 1.09-7.624-1.225-15.174-6.103-23.178-1.8-3.4-4.032-6.54-6.625-9.343-17.988-22.57-52.22-49.85-87.02-92.078 38.056 186.15-97.83 83.32-182.036-53.895zM267.79 173.836c14.032 0 25.208 11.176 25.208 25.21 0 14.032-11.175 25.208-25.21 25.208-14.032 0-25.208-11.176-25.208-25.21 0-14.032 11.175-25.208 25.21-25.208zm147.575 54.834c22.756 0 41.004 18.248 41.004 41.004 0 22.756-18.248 41.004-41.005 41.004-5.145 0-10.056-.942-14.582-2.65-.746-19.392-10.64-36.512-25.476-47.16 3.997-18.478 20.328-32.198 40.058-32.198zm-75.45 39.473c23.44 0 42.24 18.802 42.24 42.242 0 23.44-18.8 42.242-42.24 42.242s-42.243-18.802-42.243-42.242c0-23.44 18.8-42.242 42.242-42.242zm68.886 65.464c41.396 0 74.755 33.36 74.755 74.754 0 41.397-33.357 74.755-74.754 74.755-23.397 0-44.22-10.662-57.91-27.404.458-2.85.704-5.772.704-8.75 0-15.814-6.752-30.113-17.506-40.183.268-12.963 3.804-25.092 9.828-35.61 23.163-1.518 42.872-16.092 51.803-36.403 4.247-.746 8.613-1.157 13.08-1.157zm-145.53 10.59c12.626 0 22.662 10.038 22.662 22.664 0 12.628-10.035 22.663-22.662 22.663-12.627 0-22.663-10.035-22.663-22.662 0-12.625 10.035-22.663 22.663-22.663zm33.226 66.35c20.22 0 36.414 16.194 36.414 36.414 0 20.222-16.192 36.413-36.414 36.413-20.22 0-36.412-16.192-36.412-36.412s16.19-36.413 36.412-36.413z"},child:[]}]})(o)}function bv(o){return st({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 23c-3.7 0-7.4.1-11.1.27l.8 17.98c3.4-.16 6.8-.25 10.3-.25 118.8 0 215 96.2 215 215s-96.2 215-215 215c-89.6 0-166.35-54.7-198.65-132.6l27.63-8.3-48.43-34.3-19.05 54.5 22.55-6.7C74.68 428.8 158.4 489 256 489c128.6 0 233-104.4 233-233S384.6 23 256 23zm-30.8 2.04c-13.3 1.75-26.1 4.6-38.6 8.48l5.6 17.09c11.4-3.54 23.3-6.15 35.4-7.75l-2.4-17.82zm-57 15.12c-12.4 5.05-24.2 11.12-35.4 18.12l9.5 15.21c10.3-6.44 21.2-12.03 32.6-16.67l-6.7-16.66zM116.4 69.5a234.139 234.139 0 0 0-29.35 26.12l13.05 12.28c8.3-8.77 17.4-16.81 27-24.06l-4.8-6.57-5.9-7.77zm69.5 8.58l-4.4 17.44 217 55.48 4.4-17.4-217-55.52zM74.07 110.5c-8.19 10.2-15.54 21.2-21.94 32.7l15.65 8.8c5.91-10.7 12.69-20.8 20.26-30.3l-13.97-11.2zm127.63 8.8c-3.9 26 2.8 55.2 14.2 79.2 6.4 13.4 14.2 25.2 21.9 33.8 4.2 4.7 8.4 8.3 12.2 10.9l-5.4 21.2c-4.6.4-10 1.6-16 3.7-10.9 3.8-23.4 10.4-35.4 19.1-21.6 15.6-41.4 37.9-50.4 62.6l167.5 42.9c3.9-26-2.8-55.2-14.2-79.2-6.4-13.4-14.2-25.2-21.9-33.8-4.2-4.7-8.4-8.3-12.2-10.9l5.4-21.2c4.5-.5 10-1.6 16-3.7 10.9-3.8 23.4-10.4 35.4-19.1 21.6-15.6 41.4-37.9 50.4-62.6l-167.5-42.9zM43.24 160.9c-5.33 12-9.7 24.4-13 37.3l17.48 4.2c3.03-11.8 7.04-23.2 11.95-34.2l-16.43-7.3zM26.2 217.5C24.11 230 23 242.9 23 256v.9l18-.2v-.7c0-12.1 1.02-24 2.95-35.6l-17.75-2.9zM113.5 361l-4.4 17.4 217 55.5 4.4-17.4-217-55.5z"},child:[]}]})(o)}function _v(o){return st({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M230.125 18.156V247h49.313V18.156h-49.313zM78.812 21.438l-16 136.906c48.707 30.112 97.637 47.843 148.625 53.094V33.125c-44.244-1.822-88.46-5.89-132.625-11.688zm349.438.28c-43.398 6.814-86.784 10.647-130.125 11.97v175c46.732-7.458 95.816-24.375 148.438-50.844L428.25 21.72zm-1.938 166.532c-44.474 19.847-87.06 32.836-128.187 38.97V247h37.031v143.188h-37.031v8.718c0 34.41-20.516 56.084-43.25 56.28-22.734.2-43.438-21.34-43.438-56.28v-8.72l-27.656.002h-9.343V247h37.001v-17.188c-43.774-4.164-86.14-16.857-127.687-38.062 5.04 92.69 3.66 185.37-5.063 278.063 117.402 32.047 234.788 31.002 352.188 0-6.853-93.858-9.223-187.706-4.563-281.563zm-233.187 77.438V371.5H316.47V265.687H193.124zm20.47 18.156H296v67.5H213.594v-67.5zm18.686 18.687v30.126h45.032V302.53h-45.03zm-2.155 87.658v8.718c0 28.23 13.32 37.692 24.594 37.594 11.27-.098 24.718-10.018 24.718-37.594v-8.72l-49.313.002z"},child:[]}]})(o)}function Sv(o){return st({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 16c-22.5 72-45 72-45 120 0 0 22.5 24 45 24s45-24 45-24c0-48-22.5-48-45-120zm0 144c-49.706 0-90 42.98-90 96s40.294 96 90 96c49.705 0 90-42.98 90-96s-40.295-96-90-96zm0 192c-22.5 0-45 24-45 24 0 48 22.5 48 45 120 22.5-72 45-72 45-120 0 0-22.5-24-45-24zm-22.5-168h45v48h45v48h-45v48h-45v-48h-45v-48h45v-48z"},child:[]}]})(o)}function jv(o){return st({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M319.61 20.654c13.145 33.114 13.144 33.115-5.46 63.5 33.114-13.145 33.116-13.146 63.5 5.457-13.145-33.114-13.146-33.113 5.457-63.498-33.114 13.146-33.113 13.145-63.498-5.459zM113.024 38.021c-11.808 21.04-11.808 21.04-35.724 24.217 21.04 11.809 21.04 11.808 24.217 35.725 11.808-21.04 11.808-21.04 35.724-24.217-21.04-11.808-21.04-11.808-24.217-35.725zm76.55 56.184c-.952 50.588-.95 50.588-41.991 80.18 50.587.95 50.588.95 80.18 41.99.95-50.588.95-50.588 41.99-80.18-50.588-.95-50.588-.95-80.18-41.99zm191.177 55.885c-.046 24.127-.048 24.125-19.377 38.564 24.127.047 24.127.046 38.566 19.375.047-24.126.046-24.125 19.375-38.564-24.126-.047-24.125-.046-38.564-19.375zm-184.086 83.88c-1.191.024-2.36.07-3.492.134-18.591 1.064-41.868 8.416-77.445 22.556L76.012 433.582c78.487-20.734 132.97-21.909 170.99-4.615V247.71c-18.076-8.813-31.79-13.399-46.707-13.737a91.166 91.166 0 0 0-3.629-.002zm122.686 11.42c-2.916-.026-5.81.011-8.514.098-12.81.417-27.638 2.215-45.84 4.522V427.145c43.565-7.825 106.85-4.2 171.244 7.566l-39.78-177.197c-35.904-8.37-56.589-11.91-77.11-12.123zm2.289 16.95c18.889.204 36.852 2.768 53.707 5.02l4.437 16.523c-23.78-3.75-65.966-4.906-92.467-.98l-.636-17.805c11.959-2.154 23.625-2.88 34.959-2.758zm-250.483 4.658l-10.617 46.004h24.094l10.326-46.004H71.158zm345.881 0l39.742 177.031 2.239 9.973 22.591-.152-40.855-186.852h-23.717zm-78.857 57.82c16.993.026 33.67.791 49.146 2.223l3.524 17.174c-32.645-3.08-72.58-2.889-102.995 0l-.709-17.174c16.733-1.533 34.04-2.248 51.034-2.223zm-281.793 6.18l-6.924 30.004h24.394l6.735-30.004H56.389zm274.418 27.244c4.656.021 9.487.085 14.716.203l2.555 17.498c-19.97-.471-47.115.56-59.728 1.05l-.7-17.985c16.803-.493 29.189-.828 43.157-.766zm41.476.447c8.268.042 16.697.334 24.121.069l2.58 17.74c-8.653-.312-24.87-.83-32.064-.502l-2.807-17.234a257.25 257.25 0 0 1 8.17-.073zm-326.97 20.309l-17.985 77.928 25.035-.17 17.455-77.758H45.313zm303.164 11.848c19.608-.01 38.66.774 56.449 2.572l2.996 20.787c-34.305-4.244-85.755-7.697-119.1-3.244l-.14-17.922c20.02-1.379 40.186-2.183 59.795-2.193zm-166.606 44.05c-30.112.09-67.916 6.25-115.408 19.76l-7.22 2.053 187.759-1.27v-6.347c-16.236-9.206-37.42-14.278-65.13-14.196zm134.41 6.174c-19.63.067-37.112 1.439-51.283 4.182v10.064l177.594-1.203c-44.322-8.634-89.137-13.17-126.31-13.043zM26 475v18h460v-18H26z"},child:[]}]})(o)}function Tv(o){return st({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 29.816l-231 154v106.368l231-154 231 154V183.816zm0 128.043L105 259.783v90.283l151-101.925 151 101.925v-90.283zm0 112l-87 58.725v67.6l87-58 87 58v-67.6zm0 89.957l-87 58v64.368l87-58 87 58v-64.368z"},child:[]}]})(o)}const At=(o,l="")=>({className:s="",...i})=>c.jsx(o,{className:`icon ${l} ${s}`,...i}),Lf=At(gv,"heal-icon"),Ev=At(yv,"damage-icon"),Av=At(hv,"magic-icon"),Cv=At(fv,"dice-icon"),Nv=At(mv,"miss-icon"),Mv=At(vv,"defeat-icon"),Dv=At(pv,"victory-icon"),qv=At(_v,"bag-icon"),Rv=At(Tv,"upgrade-icon"),zv=At(Sv,"levelup-icon"),Hv=At(cv,"exp-icon"),Ov=At(jv,"spell-icon"),wv=At(xv,"burning-blobs-icon"),Lv=At(bv,"duration-icon"),Tt={PLAYER_DAMAGE:"player-damage",ENEMY_DAMAGE:"enemy-damage",VICTORY:"victory",HEAL:"heal",MISS:"miss",DEFEAT:"defeat",INITIATIVE:"initiative",BAG:"bag",UPGRADE:"upgrade",LEVEL_UP:"levelup",EXPERIENCE:"experience",SPELL:"spell",BURNING_BLOBS:"burning-blobs",DURATION:"duration"},Bv=o=>{const s={[Tt.PLAYER_DAMAGE]:Av,[Tt.ENEMY_DAMAGE]:Ev,[Tt.VICTORY]:Dv,[Tt.HEAL]:Lf,[Tt.MISS]:Nv,[Tt.DEFEAT]:Mv,[Tt.INITIATIVE]:Cv,[Tt.BAG]:qv,[Tt.UPGRADE]:Rv,[Tt.LEVEL_UP]:zv,[Tt.EXPERIENCE]:Hv,[Tt.SPELL]:Ov,[Tt.BURNING_BLOBS]:wv,[Tt.DURATION]:Lv}[o];return s?c.jsx(s,{}):null},kv=ke.memo(({entry:o,showTimestamp:l=!1})=>{const s=o.timestamp?new Date(o.timestamp).toLocaleTimeString():"";return c.jsxs("div",{className:`combat-log__entry combat-log__entry--${o.type}`,children:[c.jsxs("div",{className:"combat-log__entry-content",children:[c.jsx("span",{className:"combat-log__entry-icon",children:Bv(o.type)}),c.jsx("span",{className:"combat-log__entry-message",children:o.message})]}),l&&s&&c.jsx("span",{className:"combat-log__entry-timestamp",children:s})]})}),Ea=({title:o="Journal",maxEntries:l=100,showTimestamps:s=!1,showClearButton:i=!0,collapsible:u=!1,compact:m=!1,className:p=""})=>{const f=se.useRef(null),v=gt(q=>q.combatLog),g=gt(q=>q.clearCombatLog),y=Ze(q=>q.autoScrollLogs),b=Ze(q=>q.compactMode),[E,C]=ke.useState(!1);se.useEffect(()=>{y&&f.current&&!E&&(f.current.scrollTop=f.current.scrollHeight)},[v,y,E]);const _=se.useMemo(()=>v.slice(-l),[v,l]),A=se.useMemo(()=>_.map(q=>c.jsx(kv,{entry:q,showTimestamp:s},q.id||`${q.message}-${q.timestamp}`)),[_,s]),D=["combat-log",m||b?"combat-log--compact":"",E?"combat-log--collapsed":"",p].filter(Boolean).join(" "),j=_.length>0;return c.jsxs("div",{className:D,children:[c.jsxs("div",{className:"combat-log__header",children:[c.jsxs("div",{className:"combat-log__title-section",children:[u&&c.jsx("button",{className:"combat-log__toggle",onClick:()=>C(!E),"aria-expanded":!E,children:E?c.jsx(wf,{}):c.jsx(Of,{})}),c.jsx("h3",{className:"combat-log__title",children:o}),j&&c.jsxs("span",{className:"combat-log__count",children:["(",_.length,")"]})]}),i&&j&&!E&&c.jsx(oe,{size:"small",variant:"ghost",icon:c.jsx(iv,{}),onClick:g,className:"combat-log__clear-button",title:"Vider le journal",children:"Vider"})]}),!E&&c.jsxs("div",{className:"combat-log__content",children:[c.jsx("div",{className:"combat-log__entries",ref:f,children:j?A:c.jsxs("div",{className:"combat-log__empty",children:[c.jsx("span",{className:"combat-log__empty-icon",children:"📝"}),c.jsx("p",{className:"combat-log__empty-message",children:"En attente d'actions..."})]})}),j&&!y&&c.jsx("div",{className:"combat-log__controls",children:c.jsx(oe,{size:"small",variant:"ghost",onClick:()=>{f.current&&(f.current.scrollTop=f.current.scrollHeight)},children:"↓ Aller au bas"})})]})]})};ke.memo(Ea);const vn=({label:o,value:l,modifier:s,tooltip:i,size:u="medium",variant:m="default",showModifier:p=!1,onClick:f,className:v=""})=>{const g=Ze(_=>_.showTooltips),y=Ze(_=>_.compactMode),b=["stat-block",`stat-block--${u}`,`stat-block--${m}`,y&&"stat-block--compact",f&&"stat-block--clickable",v].filter(Boolean).join(" "),E=s!==void 0?s:typeof l=="number"&&p?Math.floor((l-10)/2):null,C=c.jsxs("div",{className:b,onClick:f,children:[c.jsx("div",{className:"stat-block__label",children:o}),c.jsxs("div",{className:"stat-block__value",children:[l,E!==null&&c.jsxs("span",{className:"stat-block__modifier",children:["(",E>=0?"+":"",E,")"]})]})]});return i&&g?c.jsx("div",{className:"stat-block-wrapper",title:i,children:C}):C},Bf=({children:o,layout:l="horizontal",spacing:s="medium",className:i=""})=>{const u=["stat-group",`stat-group--${l}`,`stat-group--spacing-${s}`,i].filter(Boolean).join(" ");return c.jsx("div",{className:u,children:o})},Pv=ke.memo(({statName:o,score:l,hasSaveProficiency:s=!1,proficiencyBonus:i=0,onClick:u,showSaveBonus:m=!1,compact:p=!1})=>{const f=Be(l),v=f+(s?i:0),g={force:"FOR",dexterite:"DEX",constitution:"CON",intelligence:"INT",sagesse:"SAG",charisme:"CHA"},y={force:"Force",dexterite:"Dextérité",constitution:"Constitution",intelligence:"Intelligence",sagesse:"Sagesse",charisme:"Charisme"},b=p?g[o]||o.toUpperCase():y[o]||o,E=`${y[o]}: ${l} (${f>=0?"+":""}${f})${m?`
Jet de sauvegarde: ${v>=0?"+":""}${v}`:""}`;return c.jsxs("div",{className:`ability-score ${p?"ability-score--compact":""}`,children:[c.jsx(vn,{label:b,value:l,modifier:f,tooltip:E,variant:s?"highlighted":"default",onClick:u,size:p?"small":"medium",showModifier:!0}),m&&c.jsxs("div",{className:`ability-score__save ${s?"ability-score__save--proficient":""}`,children:[c.jsx("span",{className:"ability-score__save-label",children:"JdS:"}),c.jsxs("span",{className:"ability-score__save-value",children:[v>=0?"+":"",v]})]})]})}),Uv=({stats:o,saves:l=[],proficiencyBonus:s=2,onStatClick:i,layout:u="grid",compact:m=!1,showSaveBonuses:p=!1})=>{const f=["ability-scores",`ability-scores--${u}`,m&&"ability-scores--compact"].filter(Boolean).join(" "),v=["force","dexterite","constitution","intelligence","sagesse","charisme"];return c.jsx("div",{className:f,children:c.jsx(Bf,{layout:u==="grid"?"grid":u,children:v.map(g=>c.jsx(Pv,{statName:g,score:o[g]||10,hasSaveProficiency:l.includes(g),proficiencyBonus:s,onClick:()=>i?.(g),showSaveBonus:p,compact:m},g))})})},no={acrobaties:"dexterite",arcanes:"intelligence",athletisme:"force",discretion:"dexterite",dressage:"sagesse",escamotage:"dexterite",histoire:"intelligence",intimidation:"charisme",intuition:"sagesse",investigation:"intelligence",medecine:"sagesse",nature:"intelligence",perception:"sagesse",persuasion:"charisme",religion:"intelligence",representation:"charisme",survie:"sagesse",tromperie:"charisme"},kf={acrobaties:"Acrobaties",arcanes:"Arcanes",athletisme:"Athlétisme",discretion:"Discrétion",dressage:"Dressage",escamotage:"Escamotage",histoire:"Histoire",intimidation:"Intimidation",intuition:"Intuition",investigation:"Investigation",medecine:"Médecine",nature:"Nature",perception:"Perception",persuasion:"Persuasion",religion:"Religion",representation:"Représentation",survie:"Survie",tromperie:"Tromperie"},Gv={force:"FOR",dexterite:"DEX",constitution:"CON",intelligence:"INT",sagesse:"SAG",charisme:"CHA"},Ic=ke.memo(({skillName:o,character:l,proficiencyBonus:s,onSkillClick:i,layout:u="default",showProficiencyIndicator:m=!0})=>{const p=no[o],f=l.proficiencies?.skills?.includes(o)||!1,v=Be(l.stats[p]||10),g=v+(f?s:0),y=kf[o]||o,b=Gv[p]||p.toUpperCase(),E=["skill-item",`skill-item--${u}`,f&&"skill-item--proficient"].filter(Boolean).join(" "),C=`${y} (${b}): ${g>=0?"+":""}${g}${f?" (maîtrisé)":""}`;return u==="compact"?c.jsx("div",{className:E,children:c.jsx(vn,{label:y,value:`${g>=0?"+":""}${g}`,variant:f?"highlighted":"default",size:"small",tooltip:C,onClick:()=>i?.(o)})}):c.jsxs("div",{className:E,onClick:()=>i?.(o),children:[c.jsxs("div",{className:"skill-item__header",children:[m&&c.jsx("div",{className:`skill-item__proficiency ${f?"skill-item__proficiency--active":""}`,children:f?"●":"○"}),c.jsxs("div",{className:"skill-item__name",children:[y,c.jsxs("span",{className:"skill-item__stat",children:["(",b,")"]})]}),c.jsxs("div",{className:"skill-item__bonus",children:[g>=0?"+":"",g]})]}),u==="detailed"&&c.jsx("div",{className:"skill-item__details",children:c.jsxs("div",{className:"skill-item__breakdown",children:["Stat: ",v>=0?"+":"",v,f&&c.jsxs("span",{children:[" + Maîtrise: +",s]})]})})]})}),Xv=({character:o,proficiencyBonus:l=2,onSkillClick:s,layout:i="default",groupByAbility:u=!1,showSearch:m=!1,compact:p=!1})=>{const[f,v]=ke.useState(""),g=Object.keys(no).filter(b=>!f||kf[b].toLowerCase().includes(f.toLowerCase())),y=["skills-list",`skills-list--${i}`,p&&"skills-list--compact"].filter(Boolean).join(" ");if(u){const b={};g.forEach(C=>{const _=no[C];b[_]||(b[_]=[]),b[_].push(C)});const E={force:"Force",dexterite:"Dextérité",constitution:"Constitution",intelligence:"Intelligence",sagesse:"Sagesse",charisme:"Charisme"};return c.jsxs("div",{className:y,children:[m&&c.jsx("div",{className:"skills-list__search",children:c.jsx("input",{type:"text",placeholder:"Rechercher une compétence...",value:f,onChange:C=>v(C.target.value),className:"skills-list__search-input"})}),Object.entries(b).map(([C,_])=>c.jsx(nl,{id:`skills-${C}`,title:`${E[C]} (${_.length})`,defaultExpanded:!p,children:c.jsx("div",{className:"skills-list__ability-group",children:_.map(A=>c.jsx(Ic,{skillName:A,character:o,proficiencyBonus:l,onSkillClick:s,layout:p?"compact":i},A))})},C))]})}return c.jsxs("div",{className:y,children:[m&&c.jsx("div",{className:"skills-list__search",children:c.jsx("input",{type:"text",placeholder:"Rechercher une compétence...",value:f,onChange:b=>v(b.target.value),className:"skills-list__search-input"})}),c.jsx("div",{className:"skills-list__items",children:i==="compact"?c.jsx(Bf,{layout:"grid",children:g.map(b=>c.jsx(Ic,{skillName:b,character:o,proficiencyBonus:l,onSkillClick:s,layout:i},b))}):g.map(b=>c.jsx(Ic,{skillName:b,character:o,proficiencyBonus:l,onSkillClick:s,layout:i},b))})]})},Vv=({currentXP:o=0,nextLevelXP:l,progress:s=0,level:i,showNumbers:u=!0,showLevelUpIndicator:m=!0,size:p="medium",animated:f=!0})=>{const v=ht(C=>C.levelUpPending),g=ht(C=>C.experienceGains),y=g.length>0,b=y?g[g.length-1]:null,E=["xp-bar",`xp-bar--${p}`,f&&"xp-bar--animated",v&&"xp-bar--can-level-up",y&&"xp-bar--recent-gain"].filter(Boolean).join(" ");return c.jsxs("div",{className:E,children:[u&&c.jsx("div",{className:"xp-bar__info",children:c.jsx("div",{className:"xp-bar__current",children:c.jsxs("span",{className:"xp-bar__value",children:["✨ XP:  ",Math.max(0,Math.round(o))," / ",Math.max(0,Math.round(l))]})})}),c.jsxs("div",{className:"xp-bar__container",children:[c.jsxs("div",{className:"xp-bar__background",children:[c.jsx("div",{className:"xp-bar__fill",style:{width:`${Math.min(100,s)}%`,transition:f?"width 0.5s ease-out":"none"}}),y&&c.jsxs("div",{className:"xp-bar__recent-gain-indicator",children:["+",b.amount," XP"]})]}),v&&m&&c.jsx("div",{className:"xp-bar__level-up-indicator",children:"🎯 Niveau suivant disponible !"})]}),s>=100&&!v&&c.jsx("div",{className:"xp-bar__max-level",children:"Niveau maximum atteint"})]})},Pf=({characterType:o="player",compact:l=!1,showControls:s=!1})=>{const i=ht(p=>o==="player"?p.playerCharacter:p.playerCompanion),u=se.useMemo(()=>{if(!i)return null;const p=Ie.getXPToNextLevel(i.level),f=Ie.getXPForLevel(i.level),v=i.currentXP||i.experience||0,g=Ie.generateSpellSlotsForLevel(i.level,i.class),y=v-f,b=p-f,E=b>0?y/b*100:100,C=i.spellcasting?Ie.getAttackBonus(i,{actionType:"spell"}):null,_=i.class==="Roublard"?"dexterite":"force",A=Be(i.stats[_])+Ie.getProficiencyBonus(i.level),D=i.spellcasting?Ie.getSpellSaveDC(i):null;return{xpToNext:b,xpProgress:E,spellAttackBonus:C,weaponAttackBonus:A,spellSaveDC:D,spellSlots:g,proficiencyBonus:Ie.getProficiencyBonus(i.level)}},[i]);if(!i)return c.jsx(je,{className:"character-sheet character-sheet--empty",children:c.jsx(Fe,{children:c.jsxs("p",{children:["Aucun ",o==="player"?"personnage":"compagnon"]})})});const m=["character-sheet",l&&"character-sheet--compact",`character-sheet--${o}`].filter(Boolean).join(" ");return c.jsxs(je,{className:m,children:[c.jsx(Qt,{children:c.jsxs("div",{className:"character-sheet__header",children:[c.jsxs("h3",{className:"character-sheet__name",children:[i.name," ",i.familyName]}),!l&&c.jsx(Vv,{currentXP:Math.max(0,(i.currentXP||i.experience||0)-Ie.getXPForLevel(i.level)),nextLevelXP:u.xpToNext,progress:u.xpProgress,level:i.level}),c.jsxs("p",{className:"character-sheet__details",children:["Niv. ",i.level," ",i.race," ",i.class]}),i.historic&&c.jsx("p",{className:"character-sheet__background",children:i.historic})]})}),c.jsxs(Fe,{children:[c.jsxs("div",{className:"character-sheet__main-stats",children:[c.jsx("div",{className:"character-sheet__combat-stats",children:c.jsx(vn,{label:"CA",value:i.ac,tooltip:"Classe d'Armure"})}),!l&&c.jsx(nl,{id:`${o}-resources`,title:"Ressources",defaultExpanded:!0,children:c.jsx(dv,{character:i,characterStats:u,layout:"vertical"})})]}),c.jsx(nl,{id:`${o}-abilities`,title:"Caractéristiques",defaultExpanded:l,children:c.jsx(Uv,{stats:i.stats,saves:i.proficiencies?.saves||[],proficiencyBonus:u.proficiencyBonus,compact:!l,showSaveBonus:!1})}),c.jsx(nl,{id:`${o}-combat`,title:"Combat",defaultExpanded:l,children:c.jsxs("div",{className:"character-sheet__combat-info",children:[c.jsx(vn,{label:"Bonus de Maîtrise",value:`+${u.proficiencyBonus}`}),u.spellAttackBonus!==null&&c.jsx(vn,{label:"Att. Sorts",value:`+${u.spellAttackBonus}`,tooltip:"Bonus d'attaque des sorts"}),c.jsx(vn,{label:"Att. Armes",value:`+${u.weaponAttackBonus}`,tooltip:"Bonus d'attaque des armes"}),u.spellSaveDC&&c.jsx(vn,{label:"DD des sorts",value:u.spellSaveDC,tooltip:"Difficulté des jets de sauvegarde contre vos sorts"})]})}),c.jsx(nl,{id:`${o}-skills`,title:"Compétences",defaultExpanded:l,children:c.jsx(Xv,{character:i,proficiencyBonus:u.proficiencyBonus,compact:l})})]})]})},$v=({characterType:o="player"})=>c.jsx(Pf,{characterType:o,compact:!0}),Yv=({character:o,isSelected:l=!1,onSelect:s,onPreview:i,icon:u,description:m,showStats:p=!0,className:f=""})=>{const v=["character-selection-card",l&&"character-selection-card--selected",f].filter(Boolean).join(" "),g=y=>{y.target.closest("button")||s?.(o)};return o.stats.force,o.stats.dexterite,o.stats.constitution,o.stats.intelligence,o.stats.sagesse,o.stats.charisme,c.jsxs(je,{className:v,onClick:g,variant:l?"primary":"default",children:[c.jsx(Qt,{children:c.jsxs("div",{className:"character-portrait",children:[c.jsx("div",{className:"character-avatar",children:u}),c.jsxs("div",{className:"character-info",children:[c.jsx("h3",{className:"character-selection-card__name",children:o.name}),c.jsxs("p",{className:"character-selection-card__class",children:[o.race," ",o.class]}),c.jsxs("p",{className:"character-selection-card__level",children:["Niveau ",o.level]})]})]})}),c.jsxs(Fe,{children:[c.jsxs("div",{className:"character-stats-preview",children:[c.jsxs("div",{className:"stat-preview",children:[c.jsx("span",{className:"main-stat__label",children:"❤️"}),c.jsxs("span",{className:"main-stat__value",children:[o.maxHP," PV"]})]}),c.jsxs("div",{className:"stat-preview",children:[c.jsx("span",{className:"main-stat__label",children:"🛡️"}),c.jsxs("span",{className:"main-stat__value",children:["CA ",o.ac]})]})]}),c.jsxs("div",{className:"character-specialties",children:[o.class==="Magicien"&&c.jsx("div",{className:"specialty",children:"🔮 Sorts puissants"}),o.class==="Guerrier"&&c.jsx("div",{className:"specialty",children:"⚔️ Combat rapproché"}),o.class==="Roublard"&&c.jsx("div",{className:"specialty",children:"🎯 Attaques précises"}),o.class==="Paladin"&&c.jsx("div",{className:"specialty",children:"🛡️ Défense sacrée"})]})]})]})},Qv=({onCharacterSelect:o})=>{const[l,s]=se.useState(null),[i,u]=se.useState(!1),m=gt(_=>_.setGamePhase),p=ht(_=>_.setPlayerCharacter),{openModal:f}=ov(),v=[Si.wizard,Si.warrior,Si.rogue,Si.paladin].filter(Boolean),g=_=>{s(_)},y=_=>{f("character-preview",_)},b=async()=>{if(l){u(!0);try{await new Promise(_=>setTimeout(_,500)),p(l),o?.(l),m("game")}catch(_){console.error("Erreur lors de la sélection du personnage:",_)}finally{u(!1)}}},E=_=>({Magicien:"Maître des arcanes, ce personnage utilise des sorts puissants pour vaincre ses ennemis. Fragile mais redoutable à distance, il excelle dans le contrôle du champ de bataille.",Guerrier:"Combattant expérimenté, ce héros excelle au corps-à-corps avec ses armes. Robuste et polyvalent au combat, il peut encaisser et infliger de lourds dégâts.",Roublard:"Expert en furtivité, ce personnage frappe avec précision et évite les coups. Agile et mortel par surprise, il excelle dans les situations qui demandent de la finesse.",Paladin:"Chevalier sacré, ce héros allie force et foi. Capable de soigner ses alliés et de frapper avec puissance, il est un pilier de défense et de soutien."})[_.class]||"Un aventurier prêt à affronter tous les défis.",C=_=>({Magicien:"🧙‍♂️",Guerrier:"⚔️",Roublard:"🗡️",Paladin:"🛡️"})[_]||"🗡️";return c.jsxs("div",{className:"character-selection-screen",children:[c.jsxs("div",{className:"selection-header",children:[c.jsx("h1",{className:"character-selection__title",children:"✨ Choisis ton Héros ✨"}),c.jsx("p",{className:"character-selection__subtitle",children:"Sélectionne le personnage avec lequel tu veux vivre cette aventure épique !"})]}),c.jsx("div",{className:"character-grid",children:v.map((_,A)=>c.jsx(Yv,{character:_,isSelected:l?.name===_.name,onSelect:()=>g(_),onPreview:()=>y(_),icon:C(_.class),description:E(_)},`${_.name}-${A}`))}),l&&c.jsxs(je,{className:"character-details",children:[c.jsxs(Qt,{children:[c.jsxs("h3",{children:[C(l.class)," ",l.name]}),c.jsxs("p",{children:[l.level,"e niveau ",l.race," ",l.class]})]}),c.jsxs(Fe,{children:[c.jsx("p",{className:"character-selection__description",children:E(l)}),c.jsxs("div",{className:"character-stats-preview",children:[c.jsxs("div",{className:"stat-preview",children:[c.jsx("span",{className:"quick-stat__label",children:"❤️ PV "}),c.jsx("span",{className:"quick-stat__value",children:l.maxHP})]}),c.jsxs("div",{className:"stat-preview",children:[c.jsx("span",{className:"quick-stat__label",children:"🛡️ CA "}),c.jsx("span",{className:"quick-stat__value",children:l.ac})]}),c.jsxs("div",{className:"stat-preview",children:[c.jsx("span",{className:"quick-stat__label",children:"⚡ Initiative "}),c.jsxs("span",{className:"quick-stat__value",children:["+ ",Math.floor((l.stats.dexterite-10)/2)]})]})]})]}),c.jsx(Di,{children:c.jsx("div",{className:"character-selection__actions",children:c.jsx(oe,{variant:"primary",onClick:b,loading:i,disabled:!l,size:"large",children:i?"Préparation...":"🚀 Commencer l'aventure !"})})})]}),!l&&c.jsx("div",{className:"character-selection__help",children:c.jsx(je,{variant:"ghost",className:"character-selection__help-card",children:c.jsx(Fe,{children:c.jsx("p",{children:'👆 Clique sur un personnage pour le sélectionner, ou sur "Voir les détails" pour examiner ses caractéristiques complètes.'})})})}),c.jsx(ro,{type:"character-preview",size:"large",title:"Aperçu du personnage",children:({data:_,onClose:A})=>c.jsx("div",{className:"character-preview-modal",children:_&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"character-preview-modal__header",children:[c.jsxs("h2",{children:[C(_.class)," ",_.name]}),c.jsxs("p",{children:[_.level,"e niveau ",_.race," ",_.class]})]}),c.jsxs("div",{className:"character-preview-modal__content",children:[c.jsx("div",{className:"character-preview-modal__description",children:c.jsx("p",{children:E(_)})}),c.jsx("div",{className:"character-preview-modal__sheet",children:c.jsx($v,{characterData:_})})]}),c.jsxs("div",{className:"character-preview-modal__actions",children:[c.jsx(oe,{variant:"secondary",onClick:A,children:"Fermer"}),c.jsx(oe,{variant:"primary",onClick:()=>{s(_),A()},children:"Choisir ce personnage"})]})]})})})]})},Zv=({character:o,variant:l="default",className:s="",onAbilityUse:i})=>{if(!o?.specialAbilities||Object.keys(o.specialAbilities).length===0)return null;const u=["special-abilities-panel",`special-abilities-panel--${l}`,s].filter(Boolean).join(" "),m=(p,f)=>{i&&f.uses&&f.uses.current>0&&i(p,f)};return c.jsxs(je,{className:u,children:[c.jsx(Qt,{children:c.jsx("h4",{children:"Capacités Spéciales"})}),c.jsx(Fe,{children:c.jsx("div",{className:"abilities-list",children:Object.entries(o.specialAbilities).map(([p,f])=>c.jsxs("div",{className:"ability-item",children:[c.jsxs("div",{className:"ability-header",children:[c.jsx("h5",{className:"ability-name",children:f.name}),f.level&&c.jsxs("span",{className:"ability-level",children:["Niveau ",f.level]})]}),c.jsx("p",{className:"ability-description",children:f.description}),f.damage&&c.jsx("div",{className:"ability-stats",children:c.jsxs("span",{className:"ability-damage",children:["Dégâts: ",f.damage]})}),f.uses&&c.jsxs("div",{className:"ability-uses",children:[c.jsxs("span",{className:"ability-uses-text",children:["Utilisations: ",f.uses.current||0,"/",f.uses.max]}),l==="interactive"&&f.uses.current>0&&c.jsx("button",{className:"ability-use-button",onClick:()=>m(p,f),title:`Utiliser ${f.name}`,children:"Utiliser"})]}),f.skills&&c.jsx("div",{className:"ability-skills",children:c.jsxs("span",{className:"ability-skills-text",children:["Compétences affectées: ",f.skills.join(", ")]})})]},p))})})]})},Kv=({companion:o,variant:l="default",className:s="",showActions:i=!1,showRole:u=!1,onAction:m})=>{if(!o)return null;const p=["companion-display",`companion-display--${l}`,s].filter(Boolean).join(" "),f=o.maxHP>0?Math.max(0,o.currentHP/o.maxHP*100):0,v=o.currentHP>0,g=f<=25&&f>0,y=E=>{switch(E){case"tank":return"🛡️";case"healer":return"❤️";case"dps":return"⚔️";default:return"🤝"}},b=E=>{switch(E){case"tank":return"Tank";case"healer":return"Soigneur";case"dps":return"DPS";default:return"Compagnon"}};return c.jsxs(je,{className:p,children:[c.jsx(Qt,{children:c.jsxs("h4",{children:[u&&o.role&&c.jsx("span",{className:"companion-role-icon",title:b(o.role),children:y(o.role)}),u?b(o.role):"Compagnon"]})}),c.jsx(Fe,{children:c.jsxs("div",{className:"companion-card",children:[o.image&&c.jsx("div",{className:"companion-image-container",children:c.jsx("img",{src:o.image,alt:o.name,className:"companion-image"})}),c.jsxs("div",{className:"companion-info",children:[c.jsxs("div",{className:"companion-header",children:[c.jsx("span",{className:"companion-name",children:o.name}),l!=="compact"&&c.jsxs("span",{className:"companion-ac",children:["CA: ",o.ac]})]}),c.jsxs("div",{className:"companion-health",children:[c.jsxs("div",{className:"companion-hp-display",children:[c.jsx(Lf,{className:`hp-icon ${v?"":"hp-icon--dead"}`}),c.jsxs("span",{className:`hp-text ${v?"":"hp-text--dead"}`,children:[Math.max(0,o.currentHP)," / ",o.maxHP," PV"]})]}),c.jsx(Ci,{current:o.currentHP,max:o.maxHP,size:l==="compact"?"small":"medium",animated:!0,showPercentage:l==="detailed"})]}),l==="detailed"&&c.jsxs("div",{className:"companion-details",children:[c.jsxs("div",{className:"companion-stats",children:[c.jsxs("span",{children:["Initiative: +",Ie.getInitiativeModifier(o)]}),c.jsxs("span",{children:["Vitesse: ",o.speed||30," ft"]})]}),o.attacks&&o.attacks.length>0&&c.jsxs("div",{className:"companion-attacks",children:[c.jsx("h5",{children:"Attaques:"}),o.attacks.map((E,C)=>c.jsxs("div",{className:"attack-info",children:[c.jsx("span",{className:"attack-name",children:E.name}),c.jsxs("span",{className:"attack-damage",children:["(",E.damage,")"]})]},C))]})]}),i&&v&&c.jsxs("div",{className:"companion-actions",children:[c.jsx("button",{className:"action-button action-button--heal",onClick:()=>m?.("heal",o),disabled:o.currentHP>=o.maxHP,children:"Soigner"}),c.jsx("button",{className:"action-button action-button--rest",onClick:()=>m?.("rest",o),children:"Repos"})]}),!v&&c.jsxs("div",{className:"companion-status companion-status--dead",children:[c.jsx("span",{children:"💀 Inconscient"}),i&&c.jsx("button",{className:"action-button action-button--revive",onClick:()=>m?.("revive",o),children:"Ranimer"})]}),g&&v&&c.jsx("div",{className:"companion-status companion-status--wounded",children:c.jsx("span",{children:"⚠️ Gravement blessé"})})]})]})})]})},Jv=({companions:o=[],variant:l="default",showRoles:s=!0,layout:i="grid",className:u="",onCompanionAction:m})=>{if(!o||o.length===0)return c.jsx("div",{className:"companion-party companion-party--empty",children:c.jsx("p",{children:"Aucun compagnon actif"})});const p=["companion-party",`companion-party--${i}`,`companion-party--${l}`,u].filter(Boolean).join(" ");return c.jsxs("div",{className:p,children:[i!=="compact"&&c.jsx("div",{className:"companion-party__header",children:c.jsxs("h3",{children:["Compagnons (",o.length,"/3)"]})}),c.jsx("div",{className:"companion-party__grid",children:o.map((f,v)=>c.jsx(Kv,{companion:f,variant:l,showRole:s,showActions:l==="interactive",onAction:(g,y)=>m?.(g,y)},f.id||f.name||v))}),o.length<3&&l==="management"&&c.jsx("div",{className:"companion-party__add-slot",children:c.jsx("div",{className:"companion-add-button",children:c.jsx("span",{children:"+ Recruter un compagnon"})})})]})},Iv=({playerCharacter:o,activeCompanions:l=[],enemies:s,positions:i,selectedAction:u,selectedTargets:m,currentTurn:p,phase:f,onTargetSelect:v,onMoveCharacter:g})=>{const[C,_]=se.useState(null),[A,D]=se.useState([]),j=se.useCallback((X,Y)=>{if(i.player?.x===X&&i.player?.y===Y)return{...o,id:"player",type:"player"};if(l&&l.length>0)for(const P of l){const N=P.id||P.name.toLowerCase(),G=i[N];if(G?.x===X&&G?.y===Y)return{...P,id:N,type:"companion"}}for(const P of s){const N=i[P.name];if(N?.x===X&&N?.y===Y&&P.currentHP>0)return P}return null},[i,o,l,s]),q=(X,Y)=>{const P=X/Y;return P>.6?"#4caf50":P>.3?"#ff9800":"#f44336"},B=(X,Y,P,N)=>Math.abs(X-P)+Math.abs(Y-N),F=(X,Y)=>{if(f!=="player-movement")return!1;const P=i.player,N=i.playerStartPos||P;return!P||!N?!1:B(N.x,N.y,X,Y)<=6&&!j(X,Y)},W=(X,Y)=>{if(!u||f!=="player-turn")return!1;const P=j(X,Y);return u.type==="attack"?P?.type==="enemy"&&P.currentHP>0:u.areaOfEffect?!0:u.type==="spell"?P?.type==="enemy"&&P.currentHP>0:!1},le=se.useCallback((X,Y,P)=>{const N=[];switch(P.shape){case"sphere":{const G=Math.floor(P.radius/5);for(let Q=0;Q<8;Q++)for(let I=0;I<6;I++)Math.sqrt(Math.pow(Q-X,2)+Math.pow(I-Y,2))<=G&&N.push({x:Q,y:I});break}case"cube":{const G=Math.floor(P.size/5);for(let Q=X;Q<Math.min(X+G,8);Q++)for(let I=Y;I<Math.min(Y+G,6);I++)Q>=0&&I>=0&&N.push({x:Q,y:I});break}}return N},[]),ae=(X,Y)=>{if(_({x:X,y:Y}),u?.areaOfEffect&&f==="player-turn"){const P=le(X,Y,u.areaOfEffect);D(P)}else D([])},J=()=>{_(null),D([])},ee=(X,Y)=>{if(f==="player-movement"){F(X,Y)&&g?.("player",{x:X,y:Y});return}if(f==="player-turn"&&u)if(u.areaOfEffect)v?.({x:X,y:Y,isPosition:!0});else{const P=j(X,Y);P&&W(X,Y)&&v?.(P)}},ie=(X,Y)=>{const P=["combat-grid__cell"],N=j(X,Y);return N&&(P.push("combat-grid__cell--occupied"),P.push(`combat-grid__cell--${N.type}`),p<i.turnOrder?.length&&i.turnOrder[p]?.id===N.id&&P.push("combat-grid__cell--current-turn"),m.some(G=>G.id===N.id)&&P.push("combat-grid__cell--selected-target")),C?.x===X&&C?.y===Y&&P.push("combat-grid__cell--hovered"),A.some(G=>G.x===X&&G.y===Y)&&P.push("combat-grid__cell--aoe-highlight"),F(X,Y)&&P.push("combat-grid__cell--valid-movement"),W(X,Y)&&P.push("combat-grid__cell--valid-target"),P.join(" ")},Ne=X=>{switch(X.type){case"player":return"🧙‍♂️";case"companion":return"🐺";case"enemy":return"👹";default:return"❓"}},Me=(X,Y)=>{const P=j(X,Y),N=`${X}-${Y}`;return c.jsxs("div",{className:ie(X,Y),onMouseEnter:()=>ae(X,Y),onMouseLeave:J,onClick:()=>ee(X,Y),title:P?`${P.name} (${P.currentHP}/${P.maxHP} PV)`:`Case (${X}, ${Y})`,children:[c.jsxs("span",{className:"combat-grid__coordinates",children:[X,",",Y]}),P&&c.jsxs("div",{className:"combat-grid__combatant",children:[P.image?c.jsx("img",{src:P.image,alt:P.name,className:"combat-grid__combatant-image"}):c.jsx("span",{className:"combat-grid__combatant-icon",children:Ne(P)}),c.jsx("span",{className:"combat-grid__combatant-name",children:P.name}),c.jsxs("span",{className:"combat-grid__combatant-ac",children:["CA",P.ac]}),c.jsxs("span",{className:"combat-gird-health",children:[P.currentHP,"/",P.maxHP,"❤️"]}),c.jsx("div",{className:"combat-grid__health-bar w-95",children:c.jsx("div",{className:"combat-grid__health-fill",style:{width:`${P.currentHP/P.maxHP*100}%`,backgroundColor:q(P.currentHP,P.maxHP)}})})]}),F(X,Y)&&c.jsx("div",{className:"combat-grid__movement-indicator",children:"🏃"}),W(X,Y)&&!P&&c.jsx("div",{className:"combat-grid__target-indicator",children:"🎯"})]},N)};return c.jsxs("div",{className:"combat-grid",children:[c.jsx("div",{className:"combat-grid__container",style:{gridTemplateColumns:"repeat(8, 1fr)",gridTemplateRows:"repeat(6, 1fr)"},children:Array.from({length:6},(X,Y)=>Array.from({length:8},(P,N)=>Me(N,Y)))}),c.jsxs("div",{className:"combat-grid__legend",children:[c.jsxs("div",{className:"combat-grid__legend-item",children:[c.jsx("span",{className:"combat-grid__legend-icon",children:"🧙‍♂️"}),c.jsx("span",{children:"Joueur"})]}),l.length>0&&c.jsxs("div",{className:"combat-grid__legend-item",children:[c.jsx("span",{className:"combat-grid__legend-icon",children:"🐺"}),c.jsx("span",{children:"Compagnons"})]}),c.jsxs("div",{className:"combat-grid__legend-item",children:[c.jsx("span",{className:"combat-grid__legend-icon",children:"👹"}),c.jsx("span",{children:"Ennemis"})]})]})]})},Fv=({currentTurn:o,turnOrder:l,phase:s,onPhaseChange:i,onNextTurn:u})=>{const{combatEnemies:m,combatPositions:p,dealDamageToEnemy:f,updateEnemyPosition:v,setDamageCallbacks:g}=ca(),{addCombatMessage:y}=gt(),{takeDamagePlayer:b,takeDamageCompanionById:E,playerCharacter:C,getActiveCompanions:_}=ht(),A=new il;se.useEffect(()=>{g(b,E)},[g,b,E]);const D=se.useCallback((X,Y)=>{const P=X.type==="companion"?X.id||"companion":X.name,N=Y.combatPositions[P];if(!N)return{moved:!1,newPosition:N};const G=Ce.calculateOptimalMovement(X,N,Y);if(!G)return{moved:!1,newPosition:N};if(A.executeEntityMovement(X,N,G,Y,y)){v(P,G);const I=Math.abs(G.x-N.x)+Math.abs(G.y-N.y);return y(`${X.name} se déplace de ${I} case(s).`),{moved:!0,newPosition:G}}else return{moved:!1,newPosition:N}},[A,v,y]),j=se.useCallback((X,Y)=>{const P=X.type==="companion"?X.id||"companion":X.name,N=Y.combatPositions[P],G=_(),Q=Ce.findBestTarget(X,N,{...Y,playerCharacter:C,activeCompanions:G});return Q||y(`${X.name} ne trouve aucune cible.`),Q},[C,y,_]),q=se.useCallback((X,Y)=>{X.type==="player"?b(Y):X.type==="companion"?E(X.character.id,Y):X.type==="enemy"&&(f(X.name,Y),setTimeout(()=>{const P=m.find(N=>N.name===X.name);P&&P.currentHP<=0&&y(`💀 ${X.name} tombe au combat !`,"enemy-death")},100))},[b,E,f,y,m]),B=se.useCallback((X,Y)=>{const P=X.filter(Q=>Q.attacks.some(I=>{const S=I.range||1;return Y<=S}));if(P.length===0)return null;const N=P.filter(Q=>Q.attacks.some(I=>I.type==="melee"&&Y<=(I.range||1))),G=P.filter(Q=>Q.attacks.some(I=>I.type==="ranged"&&Y<=(I.range||6)));return Y<=1&&N.length>0?N[0]:G.length>0?G[0]:P[0]},[]),F=se.useCallback((X,Y,P,N)=>{const Q=(X.attacks||[{name:"Attaque de base",damageDice:"1d6",damageBonus:0,range:1}]).filter(k=>{const Z=k.range||1;return N<=Z});if(Q.length===0)return y(`${X.name} est trop loin pour attaquer.`),!1;const I=Q[Math.floor(Math.random()*Q.length)],S=A.executeEntityAttack(X,I,Y,y);return S.success&&q(Y,S.damage),S.success},[A,y,q]),W=se.useCallback((X,Y,P,N)=>{const G=B(X.attackSets,N);if(!G)return y(`${X.name} ne peut pas attaquer à cette distance.`),!1;y(`${X.name} lance ${G.name}.`);let Q=!1,I=0;for(const S of G.attacks){if(Y.character.currentHP<=0)break;I++;const k=A.executeEntityAttack(X,S,Y,y);k.success&&(Q=!0,q(Y,k.damage),I<G.attacks.length&&setTimeout(()=>{},200))}return Q},[A,y,B,q]),le=se.useCallback((X,Y,P)=>{if(!Y||!Y.character)return!1;if(Y.character.currentHP<=0)return y(`${X.name} réalise que ${Y.name} est déjà tombé au combat.`),!1;const N=X.type==="companion"?X.id||"companion":X.name,G=P.combatPositions[N],Q=ot(G,Y.position);return X.attackSets&&X.attackSets.length>0?W(X,Y,P,Q):F(X,Y,P,Q)},[W,F,y]),ae=se.useCallback(X=>{const Y=m.find(k=>k.name===X.name);if(!Y||Y.currentHP<=0){setTimeout(()=>{ie(!1),u()},200);return}console.log("enemyturn");const P=_(),N={combatPositions:ca.getState().combatPositions,combatEnemies:m,playerCharacter:C,activeCompanions:P},G=D(Y,N),Q=m.find(k=>k.name===X.name);if(!Q||Q.currentHP<=0){setTimeout(()=>{ie(!1),u()},200);return}const I={...N,combatPositions:ca.getState().combatPositions,activeCompanions:P},S=j(Q,I);if(!S){setTimeout(()=>{ie(!1),u()},200);return}setTimeout(()=>{const k=m.find(Z=>Z.name===X.name);if(!k||k.currentHP<=0){ie(!1),u();return}le(k,S,I),setTimeout(()=>{ie(!1),u()},300)},G.moved?800:400)},[m,C,D,j,le,u,i]),J=se.useCallback(X=>{console.log("🤝 handleCompanionTurn called with:",X);const Y=_();console.log("🤝 Active companions available:",Y);const P=X.character||Y.find(S=>S.id===X.id||S.name===X.name);if(console.log("🤝 Actual companion to use:",P),!P||P.currentHP<=0){console.log("🤝 Companion cannot act - injured or missing"),y(`${X.name} est trop blessé pour agir.`),setTimeout(()=>{ie(!1),u()},500);return}const N={combatPositions:ca.getState().combatPositions,combatEnemies:m.filter(S=>S.currentHP>0),playerCharacter:null,activeCompanions:[]},G={...P,name:X.name,id:X.id||X.name.toLowerCase(),type:"companion",attacks:P.attacks||[{name:"Attaque de base",damageDice:"1d6",damageBonus:0,range:1}]},Q=D(G,N),I={...N,combatPositions:ca.getState().combatPositions,activeCompanions:Y};setTimeout(()=>{const S=j(G,I);if(!S){y(`${X.name} ne trouve aucune cible.`),setTimeout(()=>{ie(!1),u()},500);return}le(G,S,I),setTimeout(()=>{ie(!1),u()},500)},Q.moved?1e3:500)},[_,m,A,v,y,le,u,i]),[ee,ie]=ke.useState(!1),[Ne,Me]=ke.useState(null);return se.useEffect(()=>{if(console.log("🔄 TurnManager useEffect - phase:",s,"currentTurn:",o,"isExecuting:",ee),s!=="executing-turn"||!o||ee)return;const{turnCounter:X,currentTurnIndex:Y}=ca.getState(),P=`${o.name}-${o.type}-${X}-${Y}`;if(console.log("🔑 Turn key:",P,"last executed:",Ne),Ne===P){console.log("⏭️ Skipping already executed turn");return}ie(!0),Me(P);const N=m.every(S=>S.currentHP<=0),G=!C||C.currentHP<=0;if(N){ie(!1),i("victory");return}else if(G){ie(!1),i("defeat");return}if((()=>{if(o.type==="player"){const S=!C||C.currentHP<=0;return console.log("🎮 Player death check:",S,"HP:",C?.currentHP),S}else if(o.type==="companion"){const k=_().find(K=>K.id&&K.id===o.id||K.name&&K.name===o.name),Z=!k||k.currentHP<=0;return console.log("🤝 Companion death check:",o.name,"isDead:",Z,"companion:",k,"HP:",k?.currentHP),Z}else if(o.type==="enemy"){const S=m.find(Z=>Z.name===o.name),k=!S||S.currentHP<=0;return console.log("👹 Enemy death check:",o.name,"isDead:",k,"HP:",S?.currentHP),k}return!1})()){console.log("💀 Entity is dead, skipping turn:",o.name),ie(!1);const S=m.every(Z=>Z.currentHP<=0),k=!C||C.currentHP<=0;if(S){i("victory");return}else if(k){i("defeat");return}u();return}const I=S=>{try{S()}catch(k){console.error(`❌ Erreur pendant l'exécution du tour ${o.name}:`,k),ie(!1),u()}};switch(o.type){case"enemy":I(()=>{ae(o),setTimeout(()=>ie(!1),800)});break;case"companion":console.log("🤝 Starting companion turn execution:",o.name),I(()=>{J(o),setTimeout(()=>ie(!1),800)});break;case"player":C&&C.currentHP>0?(ie(!1),setTimeout(()=>{m.every(k=>k.currentHP<=0)&&i("victory")},100)):(ie(!1),i("defeat"));break;default:console.warn(`❓ Type de tour inconnu: ${o.type}`),ie(!1),u()}},[s,o,ee,Ne,ae,J,u,i,C,m]),null},Wv=({playerCharacter:o,selectedAction:l,selectedTargets:s,onSelectAction:i,onExecuteAction:u,onPassTurn:m,canMove:p=!0,onMoveToggle:f})=>{const g=(()=>{const A=[];if(o.equipment?.mainHand){const j=o.equipment.mainHand,q=Wt[j];q&&A.push({...q,id:j})}const D=(o.weapons||[]).map(j=>Wt[j]).filter(j=>j).map(j=>({...j,id:j.id}));return A.push(...D),A})(),y=g.length>0?g.map(A=>({id:`attack_${A.id||A.name}`,type:"attack",name:A.name,description:`Attaque avec ${A.name}`,damage:typeof A.damage=="object"?`${A.damage.dice}${A.damage.bonus>0?`+${A.damage.bonus}`:""}`:A.damage,damageType:A.damageType,range:A.category==="ranged"?A.range?.ranged:A.range?.melee||1,stat:A.stat,icon:A.category==="ranged"?"🏹":"⚔️"})):[{id:"attack_unarmed",type:"attack",name:"Attaque à mains nues",description:"Attaque de base sans arme",damage:"1d4",damageType:"contondant",range:1,stat:"force",icon:"👊"}],b=[];if(o.spellcasting){const A=(o.spellcasting.cantrips||[]).map(j=>{const q=$t[j]||{};return{id:`cantrip_${j}`,type:"spell",name:j,description:`Cantrip: ${j}`,level:0,range:q.range||60,projectiles:q.projectiles||1,damage:q.damage,requiresAttackRoll:q.requiresAttackRoll,icon:"✨"}}),D=(o.spellcasting.preparedSpells||[]).filter(j=>{const B=($t[j]||{}).level||1,F=o.spellcasting.spellSlots||{};for(let W=B;W<=9;W++){const le=F[W];if(le&&le.available>0)return!0}return!1}).map(j=>{const q=$t[j]||{};return{id:`spell_${j}`,type:"spell",name:j,description:`Sort: ${j}`,level:q.level||1,range:q.range||30,projectiles:q.projectiles||1,damage:q.damage,requiresAttackRoll:q.requiresAttackRoll,icon:"🔮"}});b.push(...A,...D)}const E=A=>c.jsx(bf,{variant:l?.id===A.id?"primary":"secondary",onClick:()=>i(A),disabled:l&&l.id!==A.id,children:c.jsxs("div",{className:"action-button__content",children:[c.jsx("span",{className:"action-button__icon",children:A.icon}),c.jsxs("div",{className:"action-button__details",children:[c.jsx("span",{className:"action-button__name",children:A.name}),A.damage&&c.jsxs("span",{className:"action-button__damage",children:["Dégâts: ",typeof A.damage=="string"?A.damage:`${A.damage.dice}${A.damage.bonus>0?`+${A.damage.bonus}`:""}`]}),A.level>0&&c.jsxs("span",{className:"action-button__level",children:["Niveau ",A.level]})]})]})},A.id);l&&s.length>0;const C=l?.projectiles||1,_=s.length<C;return c.jsxs(je,{className:"combat-action-panel",children:[c.jsxs(Qt,{children:[c.jsxs("h3",{children:["🎯 Actions de ",o.name]}),c.jsx("div",{className:"combat-action-panel__status",children:l&&c.jsxs("span",{className:"selected-action",children:[l.name," sélectionné",_&&c.jsxs("span",{className:"target-count",children:["(",s.length,"/",C," cibles)"]})]})})]}),c.jsxs(Fe,{children:[p&&c.jsxs("div",{className:"combat-action-section",children:[c.jsx("h4",{children:"Mouvement"}),c.jsx(bf,{variant:"ghost",onClick:f,disabled:!!l,children:c.jsxs("div",{className:"action-button__content",children:[c.jsx("span",{className:"action-button__icon",children:"🏃"}),c.jsx("span",{className:"action-button__name",children:"Se déplacer"})]})})]}),y.length>0&&c.jsxs("div",{className:"combat-action-section",children:[c.jsx("h4",{children:"Attaques"}),c.jsx("div",{className:"combat-actions-grid",children:y.map(E)})]}),b.length>0&&c.jsxs("div",{className:"combat-action-section",children:[c.jsx("h4",{children:"Sorts"}),c.jsx("div",{className:"combat-actions-grid",children:b.map(E)})]}),l&&c.jsx("div",{className:"combat-action-instructions",children:c.jsx("p",{children:l.areaOfEffect?"Cliquez sur une case pour cibler la zone d'effet":_?`Sélectionnez ${C-s.length} cible(s) pour exécuter l'action`:"Action prête à être exécutée"})}),s.length>0&&c.jsxs("div",{className:"combat-selected-targets",children:[c.jsx("h5",{children:"Cibles sélectionnées:"}),c.jsx("ul",{className:"combat-selected-targets__list",children:s.map((A,D)=>c.jsxs("li",{className:"selected-target",children:[A.name," (PV: ",A.currentHP,"/",A.maxHP,")"]},D))})]})]}),c.jsx(Di,{children:c.jsxs("div",{className:"combat-action-panel__controls",children:[l&&c.jsx(oe,{variant:"ghost",onClick:()=>i(null),children:"Annuler"}),c.jsx(oe,{variant:"secondary",onClick:m,children:"Passer le tour"})]})})]})},e1=({playerCharacter:o,activeCompanions:l=[],encounterData:s,onCombatEnd:i,onReplayCombat:u,combatKey:m})=>{const{combatPhase:p,currentTurnIndex:f,turnOrder:v,combatEnemies:g,combatPositions:y,playerAction:b,actionTargets:E,defeated:C,victory:_,isInitialized:A,initializeCombat:D,startCombat:j,setTurnPhase:q,nextTurn:B,setPlayerAction:F,setActionTargets:W,resetCombat:le,moveCharacter:ae}=ca(),J=v[f],ee=()=>W([]),{addCombatMessage:ie,combatLog:Ne,clearCombatLog:Me}=gt();se.useEffect(()=>{!s||!s.enemies?.length||(m!==void 0&&le(),A||D(s,o,l))},[s,m,A,o,l,D,j,le,ie,v]),se.useEffect(()=>{p==="initiative-display"&&(ie("Un combat commence !","combat-start"),v.forEach(Q=>{const I=`${Q.name} a obtenu ${Q.initiative} en initiative !`;ie(I,"combat-start")}))},[p]),se.useEffect(()=>{if(p==="turn"&&J){console.log("🎯 Phase transition - Current turn:",J);const Q=g.every(S=>S.currentHP<=0),I=!o||o.currentHP<=0;if(Q){console.log("🏆 All enemies dead - Victory!"),q("victory");return}else if(I){console.log("💀 Player dead - Defeat!"),q("defeat");return}J.type==="player"?(console.log("🎮 Player turn starting"),q("player-turn")):J.type==="enemy"?(console.log("👹 Enemy turn starting:",J.name),q("executing-turn")):J.type==="companion"&&(console.log("🤝 Companion turn starting:",J.name),q("executing-turn"))}},[p,J,q,g,o,l]);const X=se.useCallback(Q=>{F(Q)},[F]),Y=se.useCallback(Q=>{if(!b)return;const I=[...E,Q];W(I);const S=b.projectiles||1;I.length>=S&&setTimeout(()=>{const Z=new il().executePlayerAction(o,b,I,g,y);Z.messages.forEach(K=>ie(K.text,K.type)),Z.damage&&Z.damage.length>0&&Z.damage.forEach(K=>{const re=g.find(he=>he.name===K.targetId||he.id===K.targetId);if(re){const{dealDamageToEnemy:he}=ca.getState();he(re.name,K.damage),setTimeout(()=>{const me=g.find(lt=>lt.name===re.name);me&&me.currentHP<=0&&re.currentHP>0&&ie(`💀 ${re.name} tombe au combat !`,"enemy-death")},100)}}),ee(),F(null),B()},500)},[b,E,W,o,g,y,ie,ee,F,B]),P=se.useCallback(()=>{if(!b||!E.length)return;new il().executePlayerAction(o,b,E,g,y).messages.forEach(S=>ie(S.text,S.type)),ee(),F(null),B()},[b,E,o,g,y,ie,ee,F,B]),N=()=>{ie(`${o.name} passe son tour.`),ee(),F(null),B()},G=()=>{switch(p){case"initializing":return c.jsx(je,{children:c.jsxs("div",{className:"combat-phase-content",children:[c.jsx("h3",{children:"Initialisation du combat..."}),c.jsx("p",{children:"Préparation des combattants et jets d'initiative"})]})});case"initiative-display":return c.jsx(je,{children:c.jsxs("div",{className:"combat-phase-content",children:[c.jsx("h3",{children:"Initiative lancée !"}),c.jsx("p",{children:"Les jets d'initiative ont été effectués. Prêt à commencer le combat ?"}),c.jsx(oe,{onClick:()=>j(),children:"Commencer le combat"})]})});case"player-turn":return c.jsx(Wv,{playerCharacter:o,selectedAction:b,selectedTargets:E,onSelectAction:X,onExecuteAction:P,onPassTurn:N,canMove:!y.playerHasMoved,onMoveToggle:()=>q("player-movement")});case"player-movement":return c.jsx(je,{children:c.jsxs("div",{className:"combat-phase-content",children:[c.jsx("h3",{children:"Phase de mouvement"}),c.jsx("p",{children:"Cliquez sur une case pour vous déplacer (maximum 6 cases)"}),c.jsx(oe,{onClick:()=>q("player-turn"),children:"Terminer le mouvement"})]})});case"victory":return c.jsx(je,{children:c.jsxs("div",{className:"combat-phase-content",children:[c.jsx("h3",{children:"🎉 Victoire !"}),c.jsx("p",{children:"Tous les ennemis ont été vaincus !"}),c.jsx(oe,{onClick:()=>{Me(),i?.(s)},children:"Continuer l'aventure"})]})});case"defeat":return c.jsx(je,{variant:"danger",children:c.jsxs("div",{className:"combat-phase-content",children:[c.jsx("h3",{children:"💀 Défaite"}),c.jsx("p",{children:"Vous avez été vaincu..."}),c.jsx("div",{className:"combat-defeat-actions",children:c.jsx(oe,{variant:"secondary",onClick:u,children:"Rejouer le combat"})})]})});case"enemy-turn":console.log("enemy");case"companion-turn":case"executing-turn":return c.jsx(je,{children:c.jsxs("div",{className:"combat-phase-content",children:[c.jsx("h3",{children:"Tour en cours"}),c.jsxs("p",{children:[J?.type==="enemy"&&`${J.name} réfléchit...`,J?.type==="companion"&&`${J.name} agit...`,(!J||J.type==="player")&&"Attendez la fin du tour en cours..."]})]})});default:return c.jsx(je,{children:c.jsxs("div",{className:"combat-phase-content",children:[c.jsx("h3",{children:"Combat en cours"}),c.jsxs("p",{children:["Phase: ",p," - Attendez..."]})]})})}};return A?c.jsxs("div",{className:"combat-container",children:[c.jsx(Fv,{currentTurn:J,turnOrder:v,phase:p,onPhaseChange:q,onNextTurn:B}),c.jsxs("div",{className:"combat-layout",children:[c.jsx("div",{className:"combat-grid-section",children:c.jsx(Iv,{playerCharacter:o,activeCompanions:l,enemies:g,positions:y,selectedAction:b,selectedTargets:E,currentTurn:J,phase:p,onTargetSelect:Y,onMoveCharacter:(Q,I)=>{ae(Q,I)}})}),c.jsxs("div",{className:"combat-side-container",children:[c.jsx("div",{className:"combat-controls",children:G()}),c.jsx("div",{className:"combat-log-section",children:c.jsx(Ea,{title:"Combat",maxEntries:10,showTimestamps:!1})})]})]})]}):c.jsx("div",{className:"combat-container",children:c.jsx(je,{children:c.jsx("div",{className:"combat-loading",children:c.jsx("h3",{children:"Chargement du combat..."})})})})},t1=({item:o,character:l,viewMode:s="grid",onClick:i,onUse:u,onEquip:m,onUnequip:p,className:f=""})=>{const v=o.nom||o.name||"Objet inconnu",g=o.description||"Aucune description",y=o.quantity||1,b=o.poids||o.weight||.1,E=o.rarity||"commun",C=o.type||"misc",_=o.equipped||!1,A=["inventory-item",`inventory-item--${s}`,`inventory-item--${C}`,`inventory-item--${E.replace(/\s+/g,"-")}`,_&&"inventory-item--equipped",f].filter(Boolean).join(" "),D=()=>{switch(C){case"weapon":case"arme":return"⚔️";case"armor":case"armure":return"🛡️";case"consumable":case"potion":return"🧪";case"accessory":case"accessoire":return"💎";case"outil":return"🔧";case"livre":return"📚";default:return"📦"}},j=()=>{switch(E?.toLowerCase()){case"commun":return"🪙";case"peu commun":return"💰";case"rare":return"💎";case"très rare":return"🏆";case"légendaire":return"🌟";case"artéfact":return"🗝️";default:return"📦"}},q=ae=>{switch(ae?.toLowerCase()){case"commun":return"#9e9e9e";case"peu commun":return"#4caf50";case"rare":return"#2196f3";case"très rare":return"#9c27b0";case"légendaire":return"#ff9800";case"artéfact":return"#f44336";default:return"#9e9e9e"}},B=()=>["weapon","armor","accessory"].includes(C)&&!_,F=()=>o.effet||o.action||C==="potion"||C==="consumable",W=()=>c.jsx(je,{className:A,onClick:i,style:{borderColor:q(E)},children:c.jsxs("div",{className:"inventory-item__content",children:[c.jsxs("div",{className:"inventory-item__header",title:`${v} - ${g} item ${E}`,children:[c.jsx("span",{className:"inventory-item__icon",children:D()}),c.jsx("h5",{className:"inventory-item__name",children:v}),y>1&&c.jsxs("span",{className:"inventory-item__quantity",children:["x ",y]}),c.jsx("span",{className:"inventory-item__icon",children:j()}),_&&c.jsx("span",{className:"inventory-item__equipped-badge",children:"✓"})]}),c.jsx("div",{className:"inventory-item__info",children:s!=="compact"&&c.jsxs(c.Fragment,{children:[c.jsx("p",{className:"inventory-item__description",children:g.length>100?`${g.substring(0,100)}...`:g}),c.jsxs("div",{className:"inventory-item__stats",children:[b>0&&c.jsxs("span",{className:"inventory-item__weight",children:["⚖️ ",b," kg"]}),c.jsx("span",{className:"inventory-item__rarity",children:E})]})]})}),s!=="compact"&&c.jsxs("div",{className:"inventory-item__actions",children:[F()&&c.jsx(oe,{size:"small",variant:"primary",onClick:ae=>{ae.stopPropagation(),u?.()},children:"Utiliser"}),B()&&c.jsx(oe,{size:"small",variant:"secondary",onClick:ae=>{ae.stopPropagation(),m?.()},children:"Équiper"}),_&&c.jsx(oe,{size:"small",variant:"ghost",onClick:ae=>{ae.stopPropagation(),p?.()},children:"Retirer"})]})]})}),le=()=>c.jsx("div",{className:A,onClick:i,children:c.jsxs("div",{className:"inventory-item__list-content",children:[c.jsxs("div",{className:"inventory-item__header",title:`${v} - ${g} item ${E}`,children:[c.jsx("span",{className:"inventory-item__icon",children:D()}),c.jsx("h5",{className:"inventory-item__name",children:v}),y>1&&c.jsxs("span",{className:"inventory-item__quantity",children:["x ",y]}),c.jsx("span",{className:"inventory-item__icon",children:j()}),_&&c.jsx("span",{className:"inventory-item__equipped-badge",children:"✓"})]}),c.jsxs("div",{className:"inventory-item__list-actions",children:[F()&&c.jsx(oe,{size:"small",variant:"primary",onClick:ae=>{ae.stopPropagation(),u?.()},children:"Utiliser"}),B()&&c.jsx(oe,{size:"small",variant:"secondary",onClick:ae=>{ae.stopPropagation(),m?.()},children:"Équiper"}),_&&c.jsx(oe,{size:"small",variant:"ghost",onClick:ae=>{ae.stopPropagation(),p?.()},children:"Retirer"})]})]})});switch(s){case"list":return le();case"compact":case"grid":default:return W()}},a1=({items:o=[],viewMode:l="grid",onItemClick:s,onItemUse:i,onItemEquip:u,onItemUnequip:m,character:p,className:f=""})=>{const v=["inventory-grid",`inventory-grid--${l}`,f].filter(Boolean).join(" ");return o.length===0?c.jsx("div",{className:"inventory-grid-empty"}):c.jsx("div",{className:v,children:o.map((g,y)=>c.jsx(t1,{item:g,character:p,viewMode:l,onClick:()=>s?.(g),onUse:()=>i?.(g),onEquip:()=>u?.(g),onUnequip:()=>m?.(g)},g.id||g.nom||g.name||y))})},n1=({filters:o={},onFilterChange:l,sortBy:s="name",onSortChange:i,availableItems:u=[],className:m=""})=>{const p=D=>{l?.({searchTerm:D.target.value})},f=D=>{l?.({category:D})},v=D=>{l?.({rarity:D})},g=()=>{l?.({category:"all",rarity:"all",searchTerm:""})},y=D=>D.type==="weapon"||D.type==="arme"||D.degats?"weapons":D.type==="armor"||D.type==="armure"||D.ca?"armor":D.type==="consumable"||D.type==="potion"||D.effet?"consumables":D.type==="accessoire"?"accessories":"misc",b=[{value:"all",label:"Tout",icon:"📦"},{value:"weapons",label:"Armes",icon:"⚔️"},{value:"armor",label:"Armures",icon:"🛡️"},{value:"consumables",label:"Consommables",icon:"🧪"},{value:"accessories",label:"Accessoires",icon:"💎"},{value:"misc",label:"Divers",icon:"🎒"}],E=ke.useMemo(()=>{const D=new Set(["all"]);return u.forEach(j=>{D.add(y(j))}),b.filter(j=>D.has(j.value))},[u]),C=[{value:"all",label:"Toutes",color:"#9e9e9e",icon:"📦"},{value:"commun",label:"Commun",color:"#9e9e9e",icon:"🪙"},{value:"peu commun",label:"Peu commun",color:"#4caf50",icon:"💰"},{value:"rare",label:"Rare",color:"#2196f3",icon:"💎"},{value:"très rare",label:"Très rare",color:"#9c27b0",icon:"🏆"},{value:"légendaire",label:"Légendaire",color:"#ff9800",icon:"🌟"}],_=ke.useMemo(()=>{const D=new Set(["all"]);return u.forEach(j=>{const q=j.rarity||"commun";D.add(q)}),C.filter(j=>D.has(j.value))},[u]),A=[{value:"name",label:"Nom",icon:"🔤"},{value:"type",label:"Type",icon:"📁"},{value:"weight",label:"Poids",icon:"⚖️"},{value:"rarity",label:"Rareté",icon:"⭐"}];return c.jsxs("div",{className:`inventory-filters ${m}`,children:[c.jsx("div",{className:"inventory-filters__search",children:c.jsxs("div",{className:"search-input-group",children:[c.jsx("span",{className:"search-icon",children:"🔍"}),c.jsx("input",{type:"text",placeholder:"Rechercher un objet...",value:o.searchTerm||"",onChange:p,className:"search-input"}),o.searchTerm&&c.jsx("button",{type:"button",className:"search-clear",onClick:()=>l?.({searchTerm:""}),children:"✕"})]})}),c.jsxs("div",{className:"inventory-filters__section",children:[c.jsx("h5",{className:"inventory-filters__label",children:"Catégories"}),c.jsx(Ca,{className:"inventory-filters__category-buttons",children:E.map(D=>c.jsxs(oe,{variant:o.category===D.value?"primary":"ghost",size:"small",onClick:()=>f(D.value),children:[c.jsx("span",{className:"button-icon",children:D.icon}),D.label]},D.value))})]}),c.jsxs("div",{className:"inventory-filters__section",children:[c.jsx("h5",{className:"inventory-filters__label",children:"Rareté"}),c.jsx(Ca,{className:"inventory-filters__rarity-buttons",children:_.map(D=>c.jsxs(oe,{variant:o.rarity===D.value?"primary":"ghost",size:"small",onClick:()=>v(D.value),style:o.rarity===D.value?{borderColor:D.color}:{},children:[c.jsx("span",{className:"button-icon",children:D.icon}),D.label]},D.value))})]}),c.jsxs("div",{className:"inventory-filters__section",children:[c.jsx("h5",{className:"inventory-filters__label",children:"Trier par"}),c.jsx(Ca,{className:"inventory-filters__sort-buttons",children:A.map(D=>c.jsxs(oe,{variant:s===D.value?"primary":"ghost",size:"small",onClick:()=>i?.(D.value),children:[c.jsx("span",{className:"button-icon",children:D.icon}),D.label]},D.value))})]}),c.jsx("div",{className:"inventory-filters__actions",children:c.jsx(oe,{variant:"ghost",size:"small",onClick:g,disabled:o.category==="all"&&o.rarity==="all"&&!o.searchTerm,children:"🗑️ Effacer les filtres"})})]})},s1=({item:o,character:l,onClose:s,onUse:i,onEquip:u,onUnequip:m})=>{if(!o)return null;const p=o.nom||o.name||"Objet inconnu",f=o.description||"Aucune description disponible",v=o.quantity||1,g=o.poids||o.weight||0,y=o.rarity||"commun",b=o.type||"misc",E=o.equipped||!1,C=()=>{const B=[];return o.degats&&B.push({label:"Dégâts",value:o.degats,icon:"⚔️"}),o.ca!==void 0&&B.push({label:"Classe d'Armure",value:`+${o.ca}`,icon:"🛡️"}),o.portee&&B.push({label:"Portée",value:`${o.portee} m`,icon:"🏹"}),o.proprietes&&o.proprietes.length>0&&B.push({label:"Propriétés",value:o.proprietes.join(", "),icon:"⭐"}),o.effet&&B.push({label:"Effet",value:o.effet,icon:"✨"}),o.duree&&B.push({label:"Durée",value:o.duree,icon:"⏱️"}),o.prix&&B.push({label:"Prix",value:`${o.prix} po`,icon:"💰"}),B},_=()=>{switch(b){case"arme":return"⚔️";case"armure":return"🛡️";case"potion":return"🧪";case"accessoire":return"💎";case"outil":return"🔧";case"livre":return"📚";case"gemme":return"💎";case"composant":return"🧪";default:return"📦"}},A=B=>{switch(B?.toLowerCase()){case"commun":return"#9e9e9e";case"peu commun":return"#4caf50";case"rare":return"#2196f3";case"très rare":return"#9c27b0";case"légendaire":return"#ff9800";case"artéfact":return"#f44336";default:return"#9e9e9e"}},D=()=>["arme","armure","accessoire"].includes(b)&&!E,j=()=>o.effet||o.action||b==="potion",q=C();return c.jsx(ro,{onClose:s,size:"medium",children:c.jsxs(je,{className:"item-detail-modal",children:[c.jsx(Qt,{children:c.jsxs("div",{className:"item-detail-header",children:[c.jsxs("div",{className:"item-detail-icon-container",children:[c.jsx("span",{className:"item-detail-icon",style:{color:A(y)},children:_()}),v>1&&c.jsxs("span",{className:"item-detail-quantity",children:["x",v]})]}),c.jsxs("div",{className:"item-detail-title",children:[c.jsx("h2",{className:"item-detail-name",children:p}),c.jsxs("div",{className:"item-detail-meta",children:[c.jsx("span",{className:"item-detail-rarity",style:{color:A(y)},children:y}),c.jsx("span",{className:"item-detail-type",children:b}),E&&c.jsx("span",{className:"item-detail-equipped",children:"✓ Équipé"})]})]})]})}),c.jsxs(Fe,{children:[c.jsxs("div",{className:"item-detail-section",children:[c.jsx("h4",{children:"Description"}),c.jsx("p",{className:"item-detail-description",children:f})]}),q.length>0&&c.jsxs("div",{className:"item-detail-section",children:[c.jsx("h4",{children:"Propriétés"}),c.jsx("div",{className:"item-detail-properties",children:q.map((B,F)=>c.jsxs("div",{className:"item-detail-property",children:[c.jsx("span",{className:"property-icon",children:B.icon}),c.jsxs("span",{className:"property-label",children:[B.label,":"]}),c.jsx("span",{className:"property-value",children:B.value})]},F))})]}),c.jsxs("div",{className:"item-detail-section",children:[c.jsx("h4",{children:"Informations"}),c.jsxs("div",{className:"item-detail-stats",children:[c.jsxs("div",{className:"stat-item",children:[c.jsx("span",{className:"stat-icon",children:"⚖️"}),c.jsx("span",{className:"stat-label",children:"Poids:"}),c.jsxs("span",{className:"stat-value",children:[g," kg"]})]}),v>1&&c.jsxs("div",{className:"stat-item",children:[c.jsx("span",{className:"stat-icon",children:"📦"}),c.jsx("span",{className:"stat-label",children:"Quantité:"}),c.jsx("span",{className:"stat-value",children:v})]})]})]}),(o.prerequis||o.restrictions)&&c.jsxs("div",{className:"item-detail-section",children:[c.jsx("h4",{children:"Restrictions"}),c.jsxs("div",{className:"item-detail-restrictions",children:[o.prerequis&&c.jsxs("p",{className:"restriction",children:[c.jsx("span",{className:"restriction-icon",children:"⚠️"}),"Prérequis: ",o.prerequis]}),o.restrictions&&c.jsxs("p",{className:"restriction",children:[c.jsx("span",{className:"restriction-icon",children:"🚫"}),o.restrictions]})]})]})]}),c.jsx(Di,{children:c.jsxs("div",{className:"item-detail-actions",children:[c.jsx(oe,{variant:"ghost",onClick:s,children:"Fermer"}),j()&&c.jsx(oe,{variant:"primary",onClick:()=>{i?.(o),s()},children:"🧪 Utiliser"}),D()&&c.jsx(oe,{variant:"secondary",onClick:()=>{u?.(o),s()},children:"⚔️ Équiper"}),E&&c.jsx(oe,{variant:"ghost",onClick:()=>{m?.(o),s()},children:"🗲 Retirer"})]})})]})})},l1=({className:o="",characterInventory:l,onUseItem:s})=>{const{selectedCharacter:i,useItem:u,equipItem:m,unequipItem:p}=ht(),f=i,{addCombatMessage:v}=gt(),[g,y]=se.useState(null),[b,E]=se.useState({category:"all",rarity:"all",searchTerm:""}),[C,_]=se.useState("name"),[A,D]=se.useState("grid"),j=se.useMemo(()=>{if(!f)return{items:[],totalWeight:0,maxWeight:0,allItems:[]};const J=f.equipment?Object.values(f.equipment).filter(Boolean).map(P=>{const N=Wt[P];return N?{...N,id:P,equipped:!0}:null}).filter(Boolean):[],ee=[...f.inventory||[],...J,...f.equipement?.inventaire||[],...f.equipement?.armes||[],...f.equipement?.armures||[],...f.equipement?.accessoires||[]];let ie=ee.filter(P=>{if(b.category!=="all"&&so(P)!==b.category||b.rarity!=="all"&&(P.rarity||"commun")!==b.rarity)return!1;if(b.searchTerm){const N=b.searchTerm.toLowerCase();return P.nom?.toLowerCase().includes(N)||P.description?.toLowerCase().includes(N)||P.name?.toLowerCase().includes(N)}return!0});ie=i1(ie,C);const Ne=ee.reduce((P,N)=>P+(N.poids||N.weight||.1)*(N.quantity||1),0),Me=r1(f),X=ee.reduce((P,N)=>P+(N.quantity||1),0),Y=ie.reduce((P,N)=>P+(N.quantity||1),0);return{items:ie,totalWeight:Ne,maxWeight:Me,totalItemCount:X,filteredItemCount:Y,allItems:ee}},[f?.inventory,f?.equipement,b,C]),q=J=>{try{const ee=u(J.id||J.nom||J.name);ee.success?(v(ee.message,"item"),s&&s(J.id||J.nom||J.name)):v(ee.message,"error")}catch(ee){console.error("Erreur lors de l'utilisation de l'objet:",ee),v(`Erreur: ${ee.message}`,"error")}},B=J=>{try{const ee=J.id||J.name||J.nom;m(ee,"player"),v(`${J.nom||J.name} équipé !`,"success")}catch(ee){console.error("Erreur lors de l'équipement:",ee),v(`Erreur lors de l'équipement: ${ee.message}`,"error")}},F=J=>{try{const ee=J.id||J.name||J.nom;p(ee,"player"),v(`${J.nom||J.name} retiré !`,"info")}catch(ee){console.error("Erreur lors du déséquipement:",ee),v(`Erreur lors du déséquipement: ${ee.message}`,"error")}},W=J=>{E({...b,...J})},le=J=>{_(J)};if(!f)return c.jsx(je,{className:`inventory-panel ${o}`,children:c.jsx(Fe,{children:c.jsx("p",{children:"Aucun personnage sélectionné"})})});const ae=j.totalWeight>j.maxWeight;return c.jsxs(je,{className:`inventory-panel ${o}`,children:[c.jsx(Qt,{children:c.jsxs("div",{className:"inventory-panel__header",children:[c.jsxs("h3",{className:"inventory--title",children:["🎒 Inventaire de ",f.name]}),c.jsxs("div",{className:"inventory-panel__stats",children:[c.jsxs("div",{className:`inventory-weight ${ae?"inventory-weight--overloaded":""}`,children:[c.jsxs("span",{children:["⚖️ Poids: ",j.totalWeight.toFixed(1),"/",j.maxWeight," kg"]}),ae&&c.jsx("span",{className:"overload-warning",children:"⚠️ Surcharge"})]}),c.jsx("div",{className:"inventory-count",children:c.jsxs("span",{children:["📦 Objets: ",j.filteredItemCount,"/",j.totalItemCount]})})]}),c.jsxs("div",{className:"inventory-panel__controls",children:[c.jsx(oe,{variant:A==="grid"?"primary":"ghost",size:"small",onClick:()=>D("grid"),children:"🔳 Grille"}),c.jsx(oe,{variant:A==="list"?"primary":"ghost",size:"small",onClick:()=>D("list"),children:"📝 Liste"})]})]})}),c.jsxs(Fe,{children:[c.jsx(n1,{filters:b,onFilterChange:W,sortBy:C,onSortChange:le,availableItems:j.allItems}),c.jsx(a1,{items:j.items,viewMode:A,onItemClick:y,onItemUse:q,onItemEquip:B,onItemUnequip:F,character:f}),j.items.length===0&&c.jsx("div",{className:"inventory-empty",children:j.allItemsCount===0?c.jsx("p",{children:"🎒 Votre inventaire est vide"}):c.jsx("p",{children:"🔍 Aucun objet ne correspond aux filtres appliqués"})})]}),g&&c.jsx(s1,{item:g,character:f,onClose:()=>y(null),onUse:q,onEquip:B,onUnequip:F})]})};function so(o){return o.type==="weapon"||o.type==="arme"||o.degats?"weapons":o.type==="armor"||o.type==="armure"||o.ca?"armor":o.type==="consumable"||o.type==="potion"||o.effet?"consumables":o.type==="accessoire"?"accessories":"misc"}function i1(o,l){return[...o].sort((s,i)=>{switch(l){case"name":return(s.nom||s.name||"").localeCompare(i.nom||i.name||"");case"weight":return(s.poids||s.weight||0)-(i.poids||i.weight||0);case"rarity":const u={commun:0,"peu commun":1,rare:2,"très rare":3,légendaire:4};return(u[s.rarity]||0)-(u[i.rarity]||0);case"type":return so(s).localeCompare(so(i));default:return 0}})}function r1(o){return o?.stats?.force?o.stats.force*7.5:50}const c1=({spellSlots:o={},onSlotUse:l,onSlotRestore:s,showDetails:i=!0,className:u=""})=>{const m=Object.keys(o).map(g=>parseInt(g)).sort((g,y)=>g-y);if(m.length===0)return c.jsx(je,{className:`spell-slot-tracker ${u}`,children:c.jsx("div",{className:"spell-slot-tracker__empty",children:c.jsx("p",{children:"Aucun emplacement de sort disponible"})})});const p=m.reduce((g,y)=>{const b=o[y];return g+(b?.max||0)},0),f=m.reduce((g,y)=>{const b=o[y];return g+(b?.used||0)},0),v=p-f;return c.jsx(je,{className:`spell-slot-tracker ${u}`,children:c.jsxs("div",{className:"spell-slot-tracker__content",children:[c.jsxs("div",{className:"spell-slot-tracker__header",children:[c.jsx("h4",{className:"spell-slot-tracker__title",children:"🔮 Emplacements de sorts"}),c.jsx("div",{className:"spell-slot-tracker__summary",children:c.jsxs("span",{className:"slot-summary",children:[v,"/",p," disponibles"]})})]}),c.jsx("div",{className:"spell-slot-tracker__grid",children:m.map(g=>{const y=o[g];if(!y||y.max===0)return null;const b=y.max-(y.used||0),E=y.max>0?(y.used||0)/y.max*100:0;return c.jsxs("div",{className:"spell-slot-level",children:[c.jsxs("div",{className:"spell-slot-level__header",children:[c.jsxs("h5",{className:"spell-slot-level__title",children:["Niveau ",g]}),c.jsxs("span",{className:"spell-slot-level__count",children:[b,"/",y.max]})]}),c.jsx("div",{className:"spell-slot-level__progress",children:c.jsx("div",{className:"spell-slot-progress-bar",children:c.jsx("div",{className:"spell-slot-progress-fill",style:{width:`${100-E}%`,backgroundColor:b>0?"#4caf50":"#f44336"}})})}),i&&c.jsx("div",{className:"spell-slot-level__details",children:c.jsx("div",{className:"spell-slot-dots",children:Array.from({length:y.max},(C,_)=>c.jsx("span",{className:`spell-slot-dot ${_<(y.used||0)?"spell-slot-dot--used":"spell-slot-dot--available"}`,title:_<(y.used||0)?"Emplacement utilisé":"Emplacement disponible",children:_<(y.used||0)?"●":"○"},_))})})]},g)})}),f===p&&c.jsxs("div",{className:"spell-slot-tracker__warning",children:[c.jsx("span",{className:"warning-icon",children:"⚠️"}),c.jsx("span",{children:"Tous les emplacements de sorts ont été utilisés"})]})]})})},jf=({spell:o,character:l,spellSlots:s={},viewMode:i="list",actions:u={},isOutOfCombat:m=!1,onClick:p,onCast:f,onPrepare:v,onUnprepare:g,className:y=""})=>{const[b,E]=se.useState(!1),C=["spell-item",`spell-item--${i}`,`spell-item--level-${o.level}`,`spell-item--${o.school?.toLowerCase().replace(/\s+/g,"-")}`,y].filter(Boolean).join(" "),_=()=>{switch(o.school){case"Évocation":return"🔥";case"Abjuration":return"🛡️";case"Enchantement":return"🧠";case"Illusion":return"🌟";case"Divination":return"👁️";case"Invocation":return"👹";case"Nécromancie":return"💀";case"Transmutation":return"🔄";default:return"✨"}},A=()=>{if(!u.canCast||m&&o.castableOutOfCombat!==!0||m&&o.castableOutOfCombat===!0&&new Ft().isSpellActive(o.id,l))return!1;if(o.level===0)return!0;for(let ae=o.level;ae<=9;ae++){const J=s[ae];if(J&&J.available>0)return!0}return!1},D=()=>{if(o.level===0)return[];const ae=[];for(let J=o.level;J<=9;J++){const ee=s[J];ee&&ee.available>0&&ae.push(J)}return ae},j=(ae=null)=>{f?.(o,ae),E(!1)},q=()=>{const ae=D();o.level===0||ae.length<=1?j(ae[0]||o.level):E(!0)},B=()=>c.jsx("div",{className:C,onClick:p,children:c.jsxs("div",{className:"spell-item__compact-content",children:[c.jsx("span",{className:"spell-item__icon",children:_()}),c.jsxs("div",{className:"spell-item__compact-info",children:[c.jsx("span",{className:"spell-item__name",children:o.name}),c.jsx("span",{className:"spell-item__level",children:o.level===0?"Cantrip":`Niv. ${o.level}`})]}),u.canCast&&A()&&c.jsx(oe,{size:"small",variant:"primary",onClick:ae=>{ae.stopPropagation(),q()},children:"Lancer"})]})}),F=()=>c.jsx(je,{className:C,onClick:p,children:c.jsxs("div",{className:"spell-item__grid-content",children:[c.jsxs("div",{className:"spell-item__header",children:[_(),o.name,c.jsxs("div",{className:"spell-item__title",children:[c.jsx("h4",{className:"spell-item__name",children:o.name}),c.jsxs("div",{className:"spell-item__meta",children:[c.jsx("span",{className:"spell-item__level",children:o.level===0?"Cantrip":`Niveau ${o.level}`}),c.jsx("span",{className:"spell-item__school",children:o.school})]})]})]}),c.jsx("div",{className:"spell-item__description",children:c.jsx("p",{children:o.description?.length>80?`${o.description.substring(0,80)}...`:o.description})}),c.jsxs("div",{className:"spell-item__properties",children:[o.castingTime&&c.jsxs("span",{className:"spell-property",children:["⏱️ ",o.castingTime]}),o.range&&c.jsxs("span",{className:"spell-property",children:["📏 ",o.range]}),o.duration&&c.jsxs("span",{className:"spell-property",children:["⏳ ",o.duration]})]}),c.jsx("div",{className:"spell-item__actions",children:le()})]})}),W=()=>c.jsx("div",{className:C,onClick:p,children:c.jsxs("div",{className:"spell-item__list-content",children:[c.jsxs("div",{className:"spell-item__list-header",children:[_()," ",c.jsx("h4",{className:"spell-item__name",children:o.name}),c.jsx("span",{className:"spell-item__level",children:o.level===0?"Cantrip":`Niveau ${o.level}`}),c.jsx("span",{className:"spell-item__school",children:o.school}),c.jsxs("div",{className:"spell-item__list-properties",children:[o.castingTime&&c.jsxs("span",{children:["⏱️ ",o.castingTime]}),o.range&&c.jsxs("span",{children:["📏 ",o.range]}),o.duration&&c.jsxs("span",{children:["⏳ ",o.duration]}),o.components&&c.jsxs("span",{children:["🧪 ",o.components.join(", ")]})]})]}),c.jsx("div",{className:"spell-item__list-info",children:o.description&&c.jsx("p",{className:"spell-item__list-description",children:o.description})}),c.jsx("div",{className:"spell-item__list-actions",children:le()})]})}),le=()=>c.jsx("div",{className:"spell-item__action-buttons",children:b?c.jsxs("div",{className:"spell-casting-options",children:[c.jsx("span",{className:"casting-options-label",children:"Lancer au niveau:"}),c.jsx(Ca,{children:D().map(ae=>c.jsx(oe,{size:"small",variant:"primary",onClick:J=>{J.stopPropagation(),j(ae)},children:ae},ae))}),c.jsx(oe,{size:"small",variant:"ghost",onClick:ae=>{ae.stopPropagation(),E(!1)},children:"Annuler"})]}):c.jsxs(c.Fragment,{children:[u.canCast&&A()&&c.jsx(oe,{size:"small",variant:"primary",onClick:ae=>{ae.stopPropagation(),q()},children:"🔮 Lancer"}),u.canPrepare&&c.jsx(oe,{size:"small",variant:"secondary",onClick:ae=>{ae.stopPropagation(),v?.(o)},children:"📋 Préparer"}),u.canUnprepare&&c.jsx(oe,{size:"small",variant:"ghost",onClick:ae=>{ae.stopPropagation(),g?.(o)},children:"❌ Retirer"})]})});switch(i){case"compact":return B();case"grid":return F();case"list":default:return W()}},o1=({spells:o=[],character:l,activeTab:s="prepared",spellSlots:i={},isOutOfCombat:u=!1,viewMode:m="list",onSpellClick:p,onCastSpell:f,onPrepareSpell:v,onUnprepareSpell:g,className:y=""})=>{const b=["spell-list",`spell-list--${m}`,`spell-list--${s}`,y].filter(Boolean).join(" "),E=o.reduce((D,j)=>{const q=j.level===0?"Cantrips":`Niveau ${j.level}`;return D[q]||(D[q]=[]),D[q].push(j),D},{}),C=Object.keys(E).sort((D,j)=>{if(D==="Cantrips")return-1;if(j==="Cantrips")return 1;const q=parseInt(D.replace("Niveau ","")),B=parseInt(j.replace("Niveau ",""));return q-B});if(o.length===0)return c.jsx("div",{className:"spell-list-empty",children:c.jsxs("div",{className:"spell-empty-state",children:[c.jsx("span",{className:"spell-empty-icon",children:"🔮"}),c.jsx("p",{children:"Aucun sort à afficher"})]})});const A=(()=>{switch(s){case"prepared":return{canCast:!0,canUnprepare:!0,canPrepare:!1};case"grimoire":case"unprepared":return{canCast:!1,canUnprepare:!1,canPrepare:!0};case"cantrips":return{canCast:!0,canUnprepare:!1,canPrepare:!1};default:return{canCast:!1,canUnprepare:!1,canPrepare:!1}}})();return c.jsx("div",{className:b,children:m==="compact"?c.jsx("div",{className:"spell-list__compact",children:o.map((D,j)=>c.jsx(jf,{spell:D,character:l,spellSlots:i,viewMode:"compact",actions:A,isOutOfCombat:u,onClick:()=>p?.(D),onCast:f,onPrepare:v,onUnprepare:g},D.id||j))}):c.jsx("div",{className:"spell-list__grouped",children:C.map(D=>c.jsxs("div",{className:"spell-level-group",children:[c.jsxs("h4",{className:"spell-level-group__title",children:[D,c.jsxs("span",{className:"spell-level-group__count",children:["(",E[D].length,")"]})]}),c.jsx("div",{className:`spell-level-group__content spell-level-group__content--${m}`,children:E[D].map((j,q)=>c.jsx(jf,{spell:j,character:l,spellSlots:i,viewMode:m,actions:A,isOutOfCombat:u,onClick:()=>p?.(j),onCast:f,onPrepare:v,onUnprepare:g},j.id||q))})]},D))})})},u1=({filters:o={},onFilterChange:l,activeTab:s="prepared",availableSpells:i=[],className:u=""})=>{const m=_=>{l?.({searchTerm:_.target.value})},p=_=>{l?.({school:_})},f=_=>{l?.({level:_})},v=()=>{l?.({castableOnly:!o.castableOnly})},g=()=>{l?.({school:"all",level:"all",searchTerm:"",castableOnly:!1})},y=[{value:"all",label:"Toutes les écoles",icon:"🎓"},{value:"Abjuration",label:"Abjuration",icon:"🛡️"},{value:"Invocation",label:"Invocation",icon:"👹"},{value:"Divination",label:"Divination",icon:"👁️"},{value:"Enchantement",label:"Enchantement",icon:"🧠"},{value:"Évocation",label:"Évocation",icon:"🔥"},{value:"Illusion",label:"Illusion",icon:"🌟"},{value:"Nécromancie",label:"Nécromancie",icon:"💀"},{value:"Transmutation",label:"Transmutation",icon:"🔄"}],b=[{value:"all",label:"Tous niveaux"},{value:"0",label:"Tours de magie"},{value:"1",label:"Niveau 1"},{value:"2",label:"Niveau 2"},{value:"3",label:"Niveau 3"},{value:"4",label:"Niveau 4"},{value:"5",label:"Niveau 5"},{value:"6",label:"Niveau 6"},{value:"7",label:"Niveau 7"},{value:"8",label:"Niveau 8"},{value:"9",label:"Niveau 9"}],E=ke.useMemo(()=>{const _=new Set(["all"]);return i.forEach(A=>{A.school&&_.add(A.school)}),y.filter(A=>_.has(A.value))},[i]),C=ke.useMemo(()=>{const _=new Set(["all"]);return i.forEach(A=>{_.add(A.level.toString())}),b.filter(A=>_.has(A.value))},[i]);return c.jsxs("div",{className:`spell-filters ${u}`,children:[c.jsx("div",{className:"spell-filters__search",children:c.jsxs("div",{className:"search-input-group",children:[c.jsx("span",{className:"search-icon",children:"🔍"}),c.jsx("input",{type:"text",placeholder:"Rechercher un sort...",value:o.searchTerm||"",onChange:m,className:"search-input"}),o.searchTerm&&c.jsx("button",{type:"button",className:"search-clear",onClick:()=>l?.({searchTerm:""}),children:"✕"})]})}),c.jsxs("div",{className:"spell-filters__controls",children:[c.jsxs("div",{className:"spell-filters__section",children:[c.jsx("h5",{className:"spell-filters__label",children:"École de magie"}),c.jsx("div",{className:"spell-filters__school-grid",children:E.map(_=>c.jsxs(oe,{variant:o.school===_.value?"primary":"ghost",size:"small",onClick:()=>p(_.value),className:"school-filter-button",title:_.label,children:[c.jsx("span",{className:"button-icon",children:_.icon}),_.value==="all"?"Toutes":_.value]},_.value))})]}),c.jsxs("div",{className:"spell-filters__section",children:[c.jsx("h5",{className:"spell-filters__label",children:"Niveau de sort"}),c.jsx(Ca,{className:"spell-filters__level-buttons",children:C.slice(0,6).map(_=>c.jsx(oe,{variant:o.level===_.value?"primary":"ghost",size:"small",onClick:()=>f(_.value),children:_.value==="all"?"Tous":_.value==="0"?"CT":_.value},_.value))}),C.length>6&&c.jsx(Ca,{className:"spell-filters__level-buttons spell-filters__level-buttons--high",children:C.slice(6).map(_=>c.jsx(oe,{variant:o.level===_.value?"primary":"ghost",size:"small",onClick:()=>f(_.value),children:_.value},_.value))})]}),c.jsxs("div",{className:"spell-filters__section",children:[c.jsx("h5",{className:"spell-filters__label",children:"Options"}),c.jsx("div",{className:"spell-filters__options",children:s==="prepared"&&c.jsxs(oe,{variant:o.castableOnly?"primary":"ghost",size:"small",onClick:v,children:[o.castableOnly?"✓":"○"," Lançables uniquement"]})})]}),c.jsx("div",{className:"spell-filters__actions",children:c.jsx(oe,{variant:"ghost",size:"small",onClick:g,disabled:o.school==="all"&&o.level==="all"&&!o.searchTerm&&!o.castableOnly,children:"🗑️ Effacer"})})]})]})},d1=({spell:o,character:l,spellSlots:s={},onClose:i,onCast:u,onPrepare:m,onUnprepare:p})=>{const[f,v]=se.useState(null);if(!o)return null;const g=()=>{switch(o.school){case"Évocation":return"🔥";case"Abjuration":return"🛡️";case"Enchantement":return"🧠";case"Illusion":return"🌟";case"Divination":return"👁️";case"Invocation":return"👹";case"Nécromancie":return"💀";case"Transmutation":return"🔄";default:return"✨"}},y=()=>({0:"#9e9e9e",1:"#4caf50",2:"#2196f3",3:"#ff9800",4:"#9c27b0",5:"#f44336",6:"#795548",7:"#607d8b",8:"#e91e63",9:"#ffc107"})[o.level]||"#9e9e9e",b=()=>{if(o.level===0)return!0;for(let j=o.level;j<=9;j++){const q=s[j];if(q&&q.available>0)return!0}return!1},E=()=>{if(o.level===0)return[];const j=[];for(let q=o.level;q<=9;q++){const B=s[q];B&&B.available>0&&j.push(q)}return j},C=j=>{if(!o.upcast||j<=o.level)return null;const q=j-o.level;return o.upcast.replace(/\{level\}/g,q.toString())},_=()=>{const j=f||o.level;u?.(o,j>0?j:null),i()},A=E(),D=o.level===0;return c.jsx(ro,{onClose:i,size:"large",children:c.jsxs(je,{className:"spell-detail-modal",children:[c.jsx(Qt,{children:c.jsxs("div",{className:"spell-detail-header",children:[c.jsx("div",{className:"spell-detail-icon-container",children:c.jsx("span",{className:"spell-detail-icon",style:{color:y()},children:g()})}),c.jsxs("div",{className:"spell-detail-title",children:[c.jsx("h2",{className:"spell-detail-name",children:o.name}),c.jsxs("div",{className:"spell-detail-meta",children:[c.jsx("span",{className:"spell-detail-level",style:{color:y()},children:D?"Tour de magie":`Sort de niveau ${o.level}`}),c.jsx("span",{className:"spell-detail-school",children:o.school})]})]})]})}),c.jsxs(Fe,{children:[c.jsxs("div",{className:"spell-detail-section",children:[c.jsx("h4",{children:"Description"}),c.jsx("p",{className:"spell-detail-description",children:o.description})]}),c.jsxs("div",{className:"spell-detail-section",children:[c.jsx("h4",{children:"Lancement"}),c.jsxs("div",{className:"spell-detail-casting-properties",children:[c.jsxs("div",{className:"spell-casting-property",children:[c.jsx("span",{className:"property-icon",children:"⏱️"}),c.jsx("span",{className:"property-label",children:"Temps d'incantation:"}),c.jsx("span",{className:"property-value",children:o.castingTime||"Action"})]}),c.jsxs("div",{className:"spell-casting-property",children:[c.jsx("span",{className:"property-icon",children:"📏"}),c.jsx("span",{className:"property-label",children:"Portée:"}),c.jsx("span",{className:"property-value",children:o.range||"Personnel"})]}),c.jsxs("div",{className:"spell-casting-property",children:[c.jsx("span",{className:"property-icon",children:"🧪"}),c.jsx("span",{className:"property-label",children:"Composants:"}),c.jsx("span",{className:"property-value",children:o.components?o.components.join(", "):"Aucun"})]}),c.jsxs("div",{className:"spell-casting-property",children:[c.jsx("span",{className:"property-icon",children:"⏳"}),c.jsx("span",{className:"property-label",children:"Durée:"}),c.jsx("span",{className:"property-value",children:o.duration||"Instantané"})]}),o.concentration&&c.jsxs("div",{className:"spell-casting-property",children:[c.jsx("span",{className:"property-icon",children:"🧘"}),c.jsx("span",{className:"property-label",children:"Concentration:"}),c.jsx("span",{className:"property-value",children:"Oui"})]}),o.ritual&&c.jsxs("div",{className:"spell-casting-property",children:[c.jsx("span",{className:"property-icon",children:"🕯️"}),c.jsx("span",{className:"property-label",children:"Rituel:"}),c.jsx("span",{className:"property-value",children:"Oui"})]})]})]}),(o.damage||o.healing||o.effect)&&c.jsxs("div",{className:"spell-detail-section",children:[c.jsx("h4",{children:"Effets"}),c.jsxs("div",{className:"spell-detail-effects",children:[o.damage&&c.jsxs("div",{className:"spell-effect",children:[c.jsx("span",{className:"effect-icon",children:"⚔️"}),c.jsx("span",{className:"effect-label",children:"Dégâts:"}),c.jsx("span",{className:"effect-value",children:o.damage})]}),o.healing&&c.jsxs("div",{className:"spell-effect",children:[c.jsx("span",{className:"effect-icon",children:"💚"}),c.jsx("span",{className:"effect-label",children:"Soins:"}),c.jsx("span",{className:"effect-value",children:o.healing})]}),o.effect&&c.jsxs("div",{className:"spell-effect",children:[c.jsx("span",{className:"effect-icon",children:"✨"}),c.jsx("span",{className:"effect-label",children:"Effet:"}),c.jsx("span",{className:"effect-value",children:o.effect})]}),o.areaOfEffect&&c.jsxs("div",{className:"spell-effect",children:[c.jsx("span",{className:"effect-icon",children:"💥"}),c.jsx("span",{className:"effect-label",children:"Zone d'effet:"}),c.jsxs("span",{className:"effect-value",children:[o.areaOfEffect.shape," de ",o.areaOfEffect.radius||o.areaOfEffect.size,o.areaOfEffect.shape==="sphere"?" pieds de rayon":" pieds"]})]})]})]}),o.upcast&&!D&&c.jsxs("div",{className:"spell-detail-section",children:[c.jsx("h4",{children:"Aux niveaux supérieurs"}),c.jsx("p",{className:"spell-detail-upcast",children:o.upcast})]}),b()&&!D&&A.length>1&&c.jsxs("div",{className:"spell-detail-section",children:[c.jsx("h4",{children:"Niveau de lancement"}),c.jsxs("div",{className:"spell-casting-levels",children:[c.jsx(Ca,{children:A.map(j=>c.jsxs(oe,{variant:f===j?"primary":"secondary",size:"small",onClick:()=>v(j),children:["Niveau ",j,c.jsxs("span",{className:"level-slots",children:["(",s[j]?.available," empl.)"]})]},j))}),f&&f>o.level&&c.jsxs("div",{className:"upcast-preview",children:[c.jsxs("h5",{children:["Effet au niveau ",f,":"]}),c.jsx("p",{children:C(f)})]})]})]}),o.classes&&c.jsxs("div",{className:"spell-detail-section",children:[c.jsx("h4",{children:"Classes"}),c.jsx("div",{className:"spell-detail-classes",children:o.classes.map(j=>c.jsx("span",{className:"spell-class-tag",children:j},j))})]})]}),c.jsx(Di,{children:c.jsxs("div",{className:"spell-detail-actions",children:[c.jsx(oe,{variant:"ghost",onClick:i,children:"Fermer"}),b()&&c.jsxs(oe,{variant:"primary",onClick:_,disabled:!D&&A.length===0,children:["🔮 Lancer",f?` (Niv. ${f})`:""]}),m&&c.jsx(oe,{variant:"secondary",onClick:()=>{m(o),i()},children:"📋 Préparer"}),p&&c.jsx(oe,{variant:"ghost",onClick:()=>{p(o),i()},children:"❌ Retirer"})]})})]})})},m1=({className:o="",character:l,onCastSpell:s,isOutOfCombat:i=!1})=>{const{selectedCharacter:u,castSpell:m,prepareSpell:p,unprepareSpell:f}=ht(),v=l||u,{addCombatMessage:g}=gt(),y=se.useMemo(()=>new Ft,[]),[b,E]=se.useState(null),[C,_]=se.useState("prepared"),[A,D]=se.useState({school:"all",level:"all",searchTerm:"",castableOnly:!1});if(!v?.spellcasting)return c.jsx(je,{className:`spell-panel ${o}`,children:c.jsx(Fe,{children:c.jsxs("div",{className:"spell-panel__no-spells",children:[c.jsx("span",{className:"no-spells-icon",children:"🚫"}),c.jsx("p",{children:"Ce personnage ne peut pas lancer de sorts"})]})})});const j=se.useMemo(()=>{const ie=v.spellcasting.ability||"intelligence",Ne=y.getSpellAttackBonus(v),Me=y.getSpellSaveDC(v);let X=y.getPreparedSpells(v),Y=y.getGrimoireSpells(v),P=y.getUnpreparedSpells(v),N=y.getCantrips(v);(i||s)&&(X=X.filter(I=>I.castableOutOfCombat===!0?!y.isSpellActive(I.id,v):!0),N=N.filter(I=>I.castableOutOfCombat===!0));const G=y.getMaxPreparedSpells(v),Q=y.getSpellSlots(v);return{spellcastingAbility:ie,spellAttackBonus:Ne,spellSaveDC:Me,grimoireSpells:Y,preparedSpells:X,unpreparedSpells:P,cantrips:N,maxPrepared:G,spellSlots:Q}},[v,y]),q=se.useMemo(()=>{let ee=[];switch(C){case"prepared":ee=j.preparedSpells;break;case"grimoire":ee=j.unpreparedSpells;break;case"cantrips":ee=j.cantrips;break;default:ee=[]}return y.filterSpells(ee,A)},[j,C,A,y]),B=async(ee,ie=null)=>{try{if(s){s(ee,ie);return}const Ne=await m(ee.id,ie);Ne.success?g(`${ee.name} lancé avec succès !`,"spell-cast"):g(Ne.message,"error")}catch(Ne){console.error("Erreur lors du lancement du sort:",Ne),g(`Impossible de lancer ${ee.name}: ${Ne.message}`,"error")}},F=async ee=>{try{const ie=await p(ee.id);ie.success?g(`${ee.name} préparé`,"spell-prepare"):g(ie.message,"error")}catch(ie){console.error("Erreur lors de la préparation:",ie),g(`Impossible de préparer ${ee.name}`,"error")}},W=async ee=>{try{const ie=await f(ee.id);ie.success?g(`${ee.name} retiré des sorts préparés`,"spell-unprepare"):g(ie.message,"error")}catch(ie){console.error("Erreur lors de la suppression:",ie)}},le=ee=>{_(ee)},ae=ee=>{D({...A,...ee})},J={prepared:j.preparedSpells.length,grimoire:j.unpreparedSpells.length,cantrips:j.cantrips.length};return c.jsxs(je,{className:`spell-panel ${o}`,children:[c.jsx(Qt,{children:c.jsxs("div",{className:"spell-panel__header",children:[c.jsxs("h3",{children:["🔮 Sorts de ",v.name]}),c.jsxs("div",{className:"spell-panel__stats",children:[c.jsxs("div",{className:"spell-stat",children:[c.jsx("span",{className:"spell-stat__label",children:"Bonus d'attaque:"}),c.jsxs("span",{className:"spell-stat__value",children:["+",j.spellAttackBonus]})]}),c.jsxs("div",{className:"spell-stat",children:[c.jsx("span",{className:"spell-stat__label",children:"DD de sauvegarde:"}),c.jsx("span",{className:"spell-stat__value",children:j.spellSaveDC})]}),c.jsxs("div",{className:"spell-stat",children:[c.jsx("span",{className:"spell-stat__label",children:"Sorts préparés:"}),c.jsxs("span",{className:"spell-stat__value",children:[j.preparedSpells.length,"/",j.maxPrepared]})]})]})]})}),c.jsxs(Fe,{children:[c.jsx(c1,{spellSlots:j.spellSlots,onSlotUse:ee=>{}}),c.jsxs("div",{className:"spell-panel__tabs",children:[c.jsxs(oe,{variant:C==="prepared"?"primary":"ghost",onClick:()=>le("prepared"),children:["📋 Préparés (",J.prepared,")"]}),c.jsxs(oe,{variant:C==="grimoire"?"primary":"ghost",onClick:()=>le("grimoire"),children:["📜 Grimoire (",J.grimoire,")"]})]}),c.jsx(u1,{filters:A,onFilterChange:ae,activeTab:C,availableSpells:(()=>{switch(C){case"prepared":return j.preparedSpells;case"grimoire":return j.unpreparedSpells;case"cantrips":return j.cantrips;default:return[]}})()}),c.jsx(o1,{spells:q,character:v,activeTab:C,spellSlots:j.spellSlots,isOutOfCombat:i||!!s,onSpellClick:E,onCastSpell:B,onPrepareSpell:F,onUnprepareSpell:W}),q.length===0&&c.jsx("div",{className:"spell-panel__empty",children:C==="prepared"&&j.preparedSpells.length===0?c.jsx("p",{children:"🔮 Aucun sort préparé. Préparez des sorts depuis votre grimoire."}):C==="grimoire"&&j.grimoireSpells.length===0?c.jsx("p",{children:"📜 Aucun sort disponible dans le grimoire. Montez de niveau pour débloquer plus de sorts."}):C==="cantrips"&&j.cantrips.length===0?c.jsx("p",{children:"✨ Aucun tour de magie connu."}):c.jsx("p",{children:"🔍 Aucun sort ne correspond aux filtres appliqués."})})]}),b&&c.jsx(d1,{spell:b,character:v,spellSlots:j.spellSlots,onClose:()=>E(null),onCast:B,onPrepare:F,onUnprepare:W})]})};class f1{canTakeShortRest(l){return!0}canTakeLongRest(l){return!0}getShortRestBenefits(l){const s={hitDiceRecovery:!1,spellSlotRecovery:[],classFeatureRecovery:[],description:[]};if(l.hitDice>0&&l.currentHP<l.maxHP&&(s.hitDiceRecovery=!0,s.description.push("Possibilité de dépenser des dés de vie pour récupérer des PV")),l.class==="Magicien"&&l.level>=1){const i=l.level,u=Math.ceil(i/2);s.spellSlotRecovery.push({level:u,amount:1,source:"Récupération arcanique"}),s.description.push(`Récupération d'un emplacement de sort de niveau ${u} ou moins`)}return l.class==="Guerrier"&&l.level>=3&&(s.classFeatureRecovery.push("Action Surge"),s.description.push("Récupération de l'Action Surge")),l.class==="Roublard"&&l.level>=3&&(s.classFeatureRecovery.push("Cunning Action uses"),s.description.push("Récupération des utilisations d'actions spéciales")),s}getLongRestBenefits(l){const s={fullHPRecovery:!0,hitDiceRecovery:Math.max(1,Math.floor(l.level/2)),allSpellSlotsRecovery:!0,allClassFeaturesRecovery:!0,description:[]};return s.description.push("Récupération complète des points de vie"),s.description.push(`Récupération de ${s.hitDiceRecovery} dé${s.hitDiceRecovery>1?"s":""} de vie`),l.spellcasting&&s.description.push("Récupération de tous les emplacements de sorts"),s.description.push("Récupération de toutes les capacités de classe"),s}calculateHitDieHealing(l){const s=l.hitDiceType||8,i=Be(l.stats.constitution),u=Math.floor(Math.random()*s)+1,m=u+i;return{roll:u,modifier:i,total:Math.max(1,m)}}applyShortRest(l){const s={...l},i={success:!0,message:"Repos court terminé",changes:[]};if(l.class==="Magicien"&&l.level>=1){const u=l.level,m=Math.ceil(u/2);if(s.spellcasting?.spellSlots)for(let p=m;p>=1;p--){const f=s.spellcasting.spellSlots[p];if(f&&f.used>0){f.used=Math.max(0,f.used-1),f.available=f.max-f.used,i.changes.push(`Récupération d'un emplacement de sort de niveau ${p}`);break}}}if(l.class==="Ensorceleur"&&l.sorceryPoints){const u=l.level;s.sorceryPoints.current=u,i.changes.push("Récupération des points de sorcellerie")}return l.class==="Guerrier"&&l.level>=2&&s.classFeatures?.actionSurge&&(s.classFeatures.actionSurge.used=0,i.changes.push("Récupération de l'Action Surge")),{character:s,results:i}}applyLongRest(l){const s={...l},i={success:!0,message:"Repos long terminé",changes:[]},u=l.maxHP-l.currentHP;s.currentHP=l.maxHP,u>0&&i.changes.push(`${u} points de vie récupérés`);const m=Math.max(1,Math.floor(l.level/2)),p=l.level,f=l.hitDice||0,v=Math.min(p,f+m);if(v>f&&(s.hitDice=v,i.changes.push(`${v-f} dé${v-f>1?"s":""} de vie récupéré${v-f>1?"s":""}`)),s.spellcasting?.spellSlots){let g=0;Object.values(s.spellcasting.spellSlots).forEach(y=>{y.used>0&&(g+=y.used,y.used=0,y.available=y.max)}),g>0&&i.changes.push("Tous les emplacements de sorts récupérés")}return s.classFeatures&&(Object.values(s.classFeatures).forEach(g=>{g.used!==void 0&&(g.used=0)}),i.changes.push("Toutes les capacités de classe récupérées")),l.class==="Moine"&&s.ki&&(s.ki.current=s.ki.max,i.changes.push("Points de ki récupérés")),l.class==="Ensorceleur"&&s.sorceryPoints&&(s.sorceryPoints.current=s.sorceryPoints.max,i.changes.push("Points de sorcellerie récupérés")),s.activeSpells&&(Object.keys(s.activeSpells).forEach(g=>{delete s.activeSpells[g]}),i.changes.push("Sorts temporaires dissipés")),{character:s,results:i}}hasUsedSpellSlots(l){return l.spellcasting?.spellSlots?Object.values(l.spellcasting.spellSlots).some(s=>s.used>0):!1}getRestDuration(l){switch(l){case"short":return{duration:1,unit:"heure",description:"Au moins 1 heure de repos léger"};case"long":return{duration:8,unit:"heures",description:"Au moins 8 heures de sommeil ou de repos"};default:return null}}canInterruptRest(l,s){return l==="short"||l==="long"?s<60:!1}calculateInterruptionPenalties(l,s){const i={lostProgress:!1,reducedBenefits:!1,description:[]};return l==="short"&&(i.lostProgress=!0,i.description.push("Le repos court doit être recommencé")),l==="long"&&s<480&&(i.reducedBenefits=!0,i.description.push("Bénéfices du repos long perdus")),i}}const p1=({character:o,restData:l,onSpendHitDie:s,onCompleteRest:i,onCancelRest:u,className:m=""})=>{const p=()=>l.hitDiceAvailable>0&&l.currentHP<l.maxHP,f=async()=>{if(p())try{await s()}catch(g){console.error("Erreur lors de la dépense du dé de vie:",g)}},v=l.currentHP>=l.maxHP;return c.jsx(je,{className:`short-rest-manager ${m}`,children:c.jsx(Fe,{children:c.jsxs("div",{className:"short-rest-manager__content",children:[c.jsxs("div",{className:"short-rest-manager__header",children:[c.jsx("h4",{children:"🌅 Repos court en cours"}),c.jsx("p",{className:"rest-description",children:"Prenez une heure pour vous reposer et récupérer des forces. Vous pouvez dépenser des dés de vie pour récupérer des points de vie."})]}),c.jsx("div",{className:"short-rest-manager__status",children:c.jsxs("div",{className:"rest-status-grid",children:[c.jsxs("div",{className:"rest-status-item",children:[c.jsx("span",{className:"rest-status-label",children:"Points de vie"}),c.jsxs("span",{className:"rest-status-value",children:[l.currentHP,"/",l.maxHP]})]}),c.jsxs("div",{className:"rest-status-item",children:[c.jsx("span",{className:"rest-status-label",children:"Dés de vie restants"}),c.jsxs("span",{className:"rest-status-value",children:[l.hitDiceAvailable," (d",l.hitDiceType,")"]})]})]})}),c.jsxs("div",{className:"short-rest-manager__health-bar",children:[c.jsx("div",{className:"health-bar-container",children:c.jsx("div",{className:"health-bar-fill",style:{width:`${l.currentHP/l.maxHP*100}%`}})}),c.jsxs("span",{className:"health-bar-label",children:["PV : ",l.currentHP,"/",l.maxHP]})]}),c.jsxs("div",{className:"short-rest-manager__hit-dice",children:[c.jsx("h5",{children:"Dés de vie"}),c.jsxs("p",{className:"hit-dice-description",children:["Lancez un dé de vie (d",l.hitDiceType,") et ajoutez votre modificateur de Constitution (+",Math.floor((o.stats.constitution-10)/2),") pour récupérer des points de vie."]}),c.jsxs("div",{className:"hit-dice-controls",children:[c.jsxs(oe,{variant:"secondary",disabled:!p(),onClick:f,children:["🎲 Dépenser un dé de vie",!p()&&c.jsx("span",{className:"button-disabled-reason",children:l.hitDiceAvailable===0?" (aucun restant)":" (PV au maximum)"})]}),c.jsx("div",{className:"hit-dice-info",children:c.jsxs("span",{children:["Dés restants : ",l.hitDiceAvailable]})})]})]}),c.jsxs("div",{className:"short-rest-manager__benefits",children:[c.jsx("h5",{children:"Autres bénéfices du repos court"}),c.jsxs("ul",{className:"rest-benefits-list",children:[o.class==="Magicien"&&o.level>=1&&c.jsx("li",{children:"✨ Récupération arcanique disponible"}),o.class==="Guerrier"&&o.level>=2&&c.jsx("li",{children:"⚔️ Action Surge récupérée"}),o.class==="Ensorceleur"&&c.jsx("li",{children:"🔮 Points de sorcellerie récupérés"}),c.jsx("li",{children:"🧘 Récupération mentale et physique"})]})]}),v&&c.jsxs("div",{className:"rest-message rest-message--success",children:[c.jsx("span",{className:"rest-message-icon",children:"✅"}),c.jsx("span",{children:"Vous êtes à pleine santé ! Vous pouvez terminer le repos."})]}),!v&&l.hitDiceAvailable>0&&c.jsxs("div",{className:"rest-message rest-message--info",children:[c.jsx("span",{className:"rest-message-icon",children:"💡"}),c.jsx("span",{children:"Vous pouvez dépenser d'autres dés de vie ou terminer le repos maintenant."})]}),c.jsx("div",{className:"short-rest-manager__actions",children:c.jsxs(Ca,{children:[c.jsx(oe,{variant:"primary",onClick:i,children:"✅ Terminer le repos"}),c.jsx(oe,{variant:"ghost",onClick:u,children:"❌ Annuler le repos"})]})})]})})})},h1=({character:o,restData:l,onCompleteRest:s,onCancelRest:i,className:u=""})=>{const[m,p]=se.useState(0),[f,v]=se.useState(!1);se.useEffect(()=>{const _=setInterval(()=>{p(A=>{const D=A+30;return D>=480?(v(!0),clearInterval(_),480):D})},1e3);return()=>clearInterval(_)},[]);const y=(()=>{const _=[],A=l.maxHP-l.currentHP;A>0&&_.push({icon:"❤️",text:`+${A} points de vie (récupération complète)`});const D=Math.max(1,Math.floor(o.level/2)),j=o.level,q=l.hitDiceAvailable,B=Math.min(D,j-q);return B>0&&_.push({icon:"🎲",text:`+${B} dé${B>1?"s":""} de vie`}),o.spellcasting?.spellSlots&&Object.values(o.spellcasting.spellSlots).reduce((W,le)=>W+(le.used||0),0)>0&&_.push({icon:"🔮",text:"Tous les emplacements de sorts récupérés"}),_.push({icon:"⚡",text:"Toutes les capacités de classe récupérées"}),o.class==="Magicien"&&_.push({icon:"📚",text:"Possibilité de changer les sorts préparés"}),o.class==="Ensorceleur"&&_.push({icon:"✨",text:"Points de sorcellerie récupérés"}),o.class==="Moine"&&_.push({icon:"🧘",text:"Points de ki récupérés"}),_})(),b=m/480*100,E=Math.floor(m/60),C=m%60;return c.jsx(je,{className:`long-rest-manager ${u}`,children:c.jsx(Fe,{children:c.jsxs("div",{className:"long-rest-manager__content",children:[c.jsxs("div",{className:"long-rest-manager__header",children:[c.jsx("h4",{children:"🌙 Repos long en cours"}),c.jsx("p",{className:"rest-description",children:"Prenez 8 heures pour dormir ou vous reposer paisiblement. Toutes vos capacités seront restaurées."})]}),c.jsxs("div",{className:"long-rest-manager__progress",children:[c.jsxs("div",{className:"rest-progress-header",children:[c.jsx("h5",{children:"Progression du repos"}),c.jsxs("span",{className:"rest-time",children:[E,"h ",C,"min / 8h 00min"]})]}),c.jsx("div",{className:"rest-progress-bar",children:c.jsx("div",{className:"rest-progress-fill",style:{width:`${b}%`}})}),c.jsx("div",{className:"rest-progress-status",children:f?c.jsx("span",{className:"rest-status-complete",children:"✅ Repos terminé ! Vous vous sentez complètement reposé."}):c.jsxs("span",{className:"rest-status-resting",children:["😴 Repos en cours... (",Math.floor(100-b),"% restant)"]})})]}),c.jsxs("div",{className:"long-rest-manager__benefits",children:[c.jsx("h5",{children:"Bénéfices du repos long"}),c.jsx("div",{className:"rest-benefits-grid",children:y.map((_,A)=>c.jsxs("div",{className:`rest-benefit-item ${f?"rest-benefit-item--available":""}`,children:[c.jsx("span",{className:"rest-benefit-icon",children:_.icon}),c.jsx("span",{className:"rest-benefit-text",children:_.text}),f&&c.jsx("span",{className:"rest-benefit-check",children:"✓"})]},A))})]}),c.jsx("div",{className:"long-rest-manager__health-comparison",children:c.jsxs("div",{className:"health-comparison-grid",children:[c.jsxs("div",{className:"health-comparison-item",children:[c.jsx("h6",{children:"État actuel"}),c.jsxs("div",{className:"health-stats",children:[c.jsxs("span",{className:"health-stat",children:["❤️ PV: ",l.currentHP,"/",l.maxHP]}),c.jsxs("span",{className:"health-stat",children:["🎲 Dés: ",l.hitDiceAvailable]})]})]}),c.jsx("div",{className:"health-comparison-arrow",children:"→"}),c.jsxs("div",{className:"health-comparison-item",children:[c.jsx("h6",{children:"Après le repos"}),c.jsxs("div",{className:"health-stats",children:[c.jsxs("span",{className:"health-stat health-stat--improved",children:["❤️ PV: ",l.maxHP,"/",l.maxHP]}),c.jsxs("span",{className:"health-stat health-stat--improved",children:["🎲 Dés: ",Math.min(o.level,l.hitDiceAvailable+Math.max(1,Math.floor(o.level/2)))]})]})]})]})}),!f&&c.jsx("div",{className:"long-rest-manager__info",children:c.jsxs("div",{className:"rest-info-box",children:[c.jsx("h6",{children:"💡 Pendant votre repos"}),c.jsxs("ul",{className:"rest-info-list",children:[c.jsx("li",{children:"Votre corps et votre esprit récupèrent naturellement"}),c.jsx("li",{children:"Les blessures guérissent complètement"}),c.jsx("li",{children:"Votre énergie magique se régénère"}),c.jsx("li",{children:"Vos capacités spéciales retrouvent leur pleine puissance"})]})]})}),c.jsxs("div",{className:"long-rest-manager__warnings",children:[c.jsxs("div",{className:"rest-warning",children:[c.jsx("span",{className:"rest-warning-icon",children:"⚠️"}),c.jsx("span",{className:"rest-warning-text",children:"Vous ne pouvez bénéficier que d'un repos long par période de 24 heures."})]}),!f&&c.jsxs("div",{className:"rest-warning",children:[c.jsx("span",{className:"rest-warning-icon",children:"⏰"}),c.jsx("span",{className:"rest-warning-text",children:"Annuler maintenant vous fera perdre les bénéfices du repos long."})]})]}),c.jsx("div",{className:"long-rest-manager__actions",children:c.jsxs(Ca,{children:[c.jsx(oe,{variant:"primary",disabled:!f,onClick:s,children:f?"✅ Terminer le repos":`⏳ Repos en cours... ${Math.floor(100-b)}%`}),c.jsx(oe,{variant:"ghost",onClick:i,children:"❌ Annuler le repos"})]})})]})})})},g1=({character:o,restData:l,onSelect:s,showBackButton:i=!1,onBack:u,className:m=""})=>{const p=(g,y,b,E,C,_=!0)=>c.jsxs(je,{className:`rest-option ${_?"":"rest-option--disabled"}`,children:[c.jsxs("div",{className:"rest-option__header",children:[c.jsx("span",{className:"rest-option__icon",children:b}),c.jsx("h4",{className:"rest-option__title",children:y}),c.jsx("span",{className:"rest-option__duration",children:E})]}),c.jsxs("div",{className:"rest-option__benefits",children:[c.jsx("h5",{children:"Bénéfices :"}),c.jsx("ul",{className:"rest-benefits-list",children:C.map((A,D)=>c.jsx("li",{className:"rest-benefit",children:A},D))})]}),c.jsx("div",{className:"rest-option__actions",children:c.jsx(oe,{variant:"primary",disabled:!_,onClick:()=>s(g),children:_?`Commencer le ${y.toLowerCase()}`:"Indisponible"})})]},g),f=[];if(l.hitDiceAvailable>0&&l.currentHP<l.maxHP&&f.push(`Dépenser jusqu'à ${l.hitDiceAvailable} dé${l.hitDiceAvailable>1?"s":""} de vie pour récupérer des PV`),o.class==="Magicien"&&o.level>=1){const g=Math.ceil(o.level/2);f.push(`Récupération arcanique (1 emplacement ≤ niv. ${g})`)}o.class==="Guerrier"&&o.level>=2&&f.push("Récupération de l'Action Surge"),o.class==="Ensorceleur"&&f.push("Récupération des points de sorcellerie"),f.length===0&&f.push("Moment de récupération et de planification");const v=["Récupération complète des points de vie",`Récupération de ${Math.max(1,Math.floor(o.level/2))} dé${Math.floor(o.level/2)>1?"s":""} de vie`];return o.spellcasting&&v.push("Récupération de tous les emplacements de sorts"),v.push("Récupération de toutes les capacités de classe"),o.class==="Magicien"&&v.push("Préparation de nouveaux sorts"),c.jsxs("div",{className:`rest-type-selector ${m}`,children:[c.jsx("div",{className:"rest-type-selector__intro",children:c.jsx("p",{children:"Choisissez le type de repos que vous souhaitez prendre. Un repos permet de récupérer des forces et des capacités."})}),c.jsxs("div",{className:"rest-options",children:[p("short","Repos court","🌅","1 heure",f,l.canTakeShortRest),p("long","Repos long","🌙","8 heures",v,l.canTakeLongRest)]}),c.jsxs("div",{className:"rest-type-selector__info",children:[c.jsxs("div",{className:"rest-info-section",children:[c.jsx("h5",{children:"État actuel :"}),c.jsxs("ul",{children:[c.jsxs("li",{children:["Points de vie : ",l.currentHP,"/",l.maxHP,l.currentHP<l.maxHP&&c.jsx("span",{className:"rest-info-highlight",children:" (récupération nécessaire)"})]}),c.jsxs("li",{children:["Dés de vie : ",l.hitDiceAvailable," disponible",l.hitDiceAvailable>1?"s":"","(d",l.hitDiceType,")"]}),o.spellcasting&&c.jsxs("li",{children:["Emplacements de sorts :",Object.entries(o.spellcasting.spellSlots||{}).some(([,g])=>g.used>0)?" certains utilisés":" tous disponibles"]})]})]}),c.jsxs("div",{className:"rest-info-section",children:[c.jsx("h5",{children:"Conseils :"}),c.jsxs("ul",{children:[c.jsx("li",{children:"Les repos courts sont idéaux pour une récupération rapide entre les combats"}),c.jsx("li",{children:"Les repos longs restaurent toutes vos capacités mais prennent plus de temps"}),c.jsx("li",{children:"Vous ne pouvez bénéficier que d'un repos long par période de 24 heures"})]})]})]}),i&&c.jsx("div",{className:"rest-type-selector__back",children:c.jsx(oe,{variant:"secondary",onClick:u,className:"rest-back-button",children:"← Retour"})})]})},Fc=({type:o,character:l,onRestComplete:s,onCancel:i,className:u=""})=>{const{playerCharacter:m,shortRestPlayer:p,longRestPlayer:f,spendHitDie:v}=ht(),g=l||m,{addCombatMessage:y,gamePhase:b,setGamePhase:E}=gt(),C=se.useMemo(()=>new f1,[]),[_,A]=se.useState(o||null),[D,j]=se.useState(!1);if(!g)return c.jsx(je,{className:`rest-panel ${u}`,children:c.jsx(Fe,{children:c.jsxs("div",{className:"rest-panel__no-character",children:[c.jsx("span",{className:"no-character-icon",children:"😴"}),c.jsx("p",{children:"Aucun personnage sélectionné pour se reposer"})]})})});const q=se.useMemo(()=>({canTakeShortRest:C.canTakeShortRest(g),canTakeLongRest:C.canTakeLongRest(g),shortRestBenefits:C.getShortRestBenefits(g),longRestBenefits:C.getLongRestBenefits(g),hitDiceAvailable:g.hitDice||0,hitDiceType:g.hitDiceType||8,currentHP:g.currentHP||0,maxHP:g.maxHP||0,needsRest:g.currentHP<g.maxHP||g.spellcasting&&C.hasUsedSpellSlots(g)}),[g,C]),B=J=>{A(J)},F=()=>{try{p(),y("Repos court terminé !","rest-complete"),j(!1),A(null),s?.("short")}catch(J){console.error("Erreur lors du repos court:",J),y("Erreur lors du repos court","error")}},W=()=>{try{f(),y("Repos long terminé ! Tous vos points de vie et emplacements de sorts ont été restaurés.","rest-complete"),j(!1),A(null),s?.("long")}catch(J){console.error("Erreur lors du repos long:",J),y("Erreur lors du repos long","error")}},le=()=>{try{v("player"),y("Dé de vie dépensé !","healing")}catch(J){console.error("Erreur lors de la dépense du dé de vie:",J),y("Impossible de dépenser le dé de vie","error")}},ae=()=>{j(!1),A(null),E("normal"),y("Repos annulé","rest-cancel"),i?.()};return!_&&!D?c.jsxs(je,{className:`rest-panel ${u}`,children:[c.jsxs(Qt,{children:[c.jsxs("h3",{children:["😴 Choix de repos pour ",g.name]}),c.jsxs("div",{className:"rest-panel__status",children:[c.jsxs("div",{className:"rest-status-item",children:[c.jsx("span",{className:"rest-status-label",children:"Points de vie:"}),c.jsxs("span",{className:`rest-status-value ${q.currentHP<q.maxHP?"rest-status-value--low":""}`,children:[q.currentHP,"/",q.maxHP]})]}),c.jsxs("div",{className:"rest-status-item",children:[c.jsx("span",{className:"rest-status-label",children:"Dés de vie:"}),c.jsxs("span",{className:"rest-status-value",children:[q.hitDiceAvailable," disponible",q.hitDiceAvailable>1?"s":""]})]}),q.needsRest&&c.jsxs("div",{className:"rest-need-indicator",children:[c.jsx("span",{className:"rest-need-icon",children:"⚠️"}),c.jsx("span",{children:"Repos recommandé"})]})]})]}),c.jsx(Fe,{children:c.jsx(g1,{character:g,restData:q,onSelect:B,showBackButton:!!i,onBack:i})})]}):c.jsxs(je,{className:`rest-panel ${u}`,children:[c.jsx(Qt,{children:c.jsxs("h3",{children:["😴 ",_==="short"?"Repos court":"Repos long"," en cours"]})}),c.jsx(Fe,{children:_==="short"?c.jsx(p1,{character:g,restData:q,onSpendHitDie:le,onCompleteRest:F,onCancelRest:i?ae:void 0}):c.jsx(h1,{character:g,restData:q,onCompleteRest:W,onCancelRest:i?ae:void 0})})]})};class Yt{static evaluateCondition(l,s){if(!l)return!0;if(typeof l!="string")return!!l;try{const i={gameFlags:s.flags||{},character:s.character||{},inventory:s.character?.inventory||[],companions:s.flags?.companions||[]};let u=l;const m={hasItem:f=>i.inventory.some(v=>v.id===f),hasCompanion:f=>i.companions.includes(f),hasFlag:f=>!!i.gameFlags[f],getRelation:f=>i.gameFlags.npcRelations?.[f]||0};return new Function("gameFlags","character","inventory","companions","hasItem","hasCompanion","hasFlag","getRelation",`return ${u}`)(i.gameFlags,i.character,i.inventory,i.companions,m.hasItem,m.hasCompanion,m.hasFlag,m.getRelation)}catch(i){return console.warn(`Erreur d'évaluation de condition: ${l}`,i),!1}}static getSceneText(l,s){let i=l.content?.text||"";if(l.content?.variations){const u=[];for(const[m,p]of Object.entries(l.content.variations)){if(m==="default")continue;const f=l.conditions?.show_variation?.[m];f&&this.evaluateCondition(f,s)&&u.push(p)}u.length>0&&(i+=`
`+u.join(`
`))}return this.interpolateText(i,s)}static interpolateText(l,s){return!l||typeof l!="string"?l:l.replace(/\{([^}]+)\}/g,(i,u)=>{if(u.includes(".")){const m=u.split(".");let p=s;for(const f of m)if(p=p?.[f],p===void 0)break;return p!==void 0?p:i}switch(u){case"playerName":return s.character?.name||"Aventurier";case"playerClass":return s.character?.class||"Aventurier";case"gold":return s.character?.gold||0;default:return s.flags?.[u]||i}})}static getAvailableChoices(l,s){return l.choices?l.choices.filter(i=>i.condition?this.evaluateCondition(i.condition,s):!0):[]}static getAvailableHotspots(l,s){return l.hotspots?l.hotspots.filter(i=>i.condition?this.evaluateCondition(i.condition,s):!0):[]}static renderInteractiveScene(l,s){const i=this.getAvailableHotspots(l,s);return{...l,hotspots:i,content:{...l.content,text:this.getSceneText(l,s)}}}static processShopAction(l,s,i){const{character:u,flags:m}=s,p=i.shop;switch(l.type){case"purchase":return this.handlePurchase(l.itemId,u,p,m);case"sell":return this.handleSell(l.itemId,u,p);default:return{success:!1,message:"Action non supportée"}}}static handlePurchase(l,s,i,u){const m=i.inventory.find(f=>f.id===l);if(!m)return{success:!1,message:"Objet non trouvé"};if(m.stock!==-1&&m.stock<=0)return{success:!1,message:"Objet en rupture de stock"};let p=m.price;return i.reputation_discount&&u.reputation>=i.reputation_discount.threshold&&(p=Math.floor(p*i.reputation_discount.discount)),s.gold<p?{success:!1,message:"Pas assez d'or"}:{success:!0,message:`Vous achetez ${m.name||l} pour ${p} or`,effects:{gold:-p,items:[l],shopStock:m.stock!==-1?{[l]:m.stock-1}:null}}}static handleSell(l,s,i){const u=s.inventory?.find(p=>p.id===l);if(!u)return{success:!1,message:"Vous ne possédez pas cet objet"};const m=Math.floor((u.value||0)*.5);return{success:!0,message:`Vous vendez ${u.name||l} pour ${m} or`,effects:{gold:m,removeItems:[l]}}}static applyConsequences(l,s){if(!l)return{};const i={};return l.flags&&(i.flags={...l.flags}),typeof l.reputation=="number"&&(i.reputation=l.reputation),l.items&&Array.isArray(l.items)&&(i.items=l.items),l.companions&&Array.isArray(l.companions)&&(i.companions=l.companions),i}static getDialogueData(l,s){const i=l.content?.speaker||"Inconnu",u=l.content?.portrait||null,m=l.content?.mood||"neutral";return{speaker:i,portrait:u,mood:m,text:this.getSceneText(l,s)}}static shouldShowScene(l,s){return l.conditions?.show_if?this.evaluateCondition(l.conditions.show_if,s):!0}static executeSceneEffects(l,s,i="on_enter"){const u=l.effects?.[i];if(!u||typeof u!="function")return null;try{return u(s)}catch(m){return console.warn(`Erreur lors de l'exécution de l'effet ${i}:`,m),null}}static validateScene(l){return Sg.validateScene(l)}static getSceneDebugInfo(l,s){const i=this.validateScene(l),u=this.getAvailableChoices(l,s),m=this.shouldShowScene(l,s);return{isValid:i.isValid,errors:i.errors,type:l.metadata?.type||"unknown",shouldShow:m,choicesCount:l.choices?.length||0,availableChoicesCount:u.length,hasVariations:!!l.content?.variations,hasConditions:!!l.conditions}}static getNextScene(l,s){if(l.action){const i=this.processAction(l.action,s);if(i?.nextScene)return i.nextScene}return typeof l.next=="string"?l.next:typeof l.next=="object"&&l.next.nextScene?l.next.nextScene:null}static processAction(l,s){switch(l.type){case ji.SCENE_TRANSITION:return{nextScene:l.nextScene};case ji.SKILL_CHECK:return this.processSkillCheck(l,s);case ji.SHOP_OPEN:return{openShop:!0};default:return null}}static processSkillCheck(l,s){return{onSuccess:l.onSuccess,onPartialSuccess:l.onPartialSuccess,onFailure:l.onFailure}}}const Uf=({scene:o,gameState:l,onChoice:s,onBack:i})=>{const u=Yt.getDialogueData(o,l),m=Yt.getAvailableChoices(o,l),p=f=>{s&&s(f)};return c.jsxs("div",{className:"dialogue-scene",children:[c.jsxs("div",{className:"dialogue-header",children:[u.portrait&&c.jsx("div",{className:"character-portrait",children:c.jsx("img",{src:u.portrait,alt:u.speaker,className:`portrait mood-${u.mood}`})}),c.jsxs("div",{className:"character-info",children:[c.jsx("h3",{className:"character-name",children:u.speaker}),o.metadata?.location&&c.jsxs("p",{className:"location-text",children:["à ",o.metadata.location]})]})]}),c.jsx("div",{className:"dialogue-content",children:c.jsx("div",{className:"dialogue-text",children:u.text.split(`
`).map((f,v)=>f.trim()===""?c.jsx("br",{},v):c.jsx("p",{children:f},v))})}),c.jsx("div",{className:"dialogue-choices",children:m.map((f,v)=>c.jsxs("button",{className:`dialogue-choice ${f.action?.type==="openShop"?"shop-choice":""}`,onClick:()=>p(f),children:[c.jsx("span",{className:"choice-text",children:f.text}),f.condition&&c.jsx("span",{className:"choice-requirement"})]},v))}),i&&c.jsx("div",{className:"dialogue-controls",children:c.jsx("button",{className:"back-button",onClick:i,children:"← Retour"})})]})},v1=({scene:o,gameState:l,onHotspotClick:s,onChoice:i})=>{const[u,m]=se.useState(null),[p,f]=se.useState(!1),v=se.useRef(null),g=Yt.getAvailableHotspots(o,l),y=Yt.getAvailableChoices(o,l),b=Yt.getSceneText(o,l),E=D=>{s&&s(D)},C=D=>{i&&i(D)},_=()=>{},A=D=>({left:`${D.coordinates.x}px`,top:`${D.coordinates.y}px`,width:`${D.coordinates.width}px`,height:`${D.coordinates.height}px`});return c.jsxs("div",{className:"interactive-scene",children:[c.jsx("h3",{className:"title-scene",children:o.metadata.title}),c.jsxs("div",{className:"scene-image-container",children:[c.jsx("img",{ref:v,src:o.metadata.background,alt:o.metadata.title||"Scène interactive",className:"scene-background",onLoad:_}),c.jsx("div",{className:"hotspots-overlay",children:g.map(D=>c.jsxs("div",{className:`hotspot ${u===D.id?"hovered":""} ${p?"visible":""}`,style:A(D),onClick:()=>E(D),onMouseEnter:()=>m(D.id),onMouseLeave:()=>m(null),title:D.text,children:[c.jsx("div",{className:"hotspot-highlight"}),u===D.id&&c.jsx("div",{className:"hotspot-tooltip",children:D.text})]},D.id))}),c.jsx("button",{className:"toggle-hotspots",onClick:()=>f(!p),title:"Révéler les zones interactives",children:p?"👁️":"🔍"})]}),g.length>0&&c.jsx("p",{className:"hint-text",children:"💡 Cliquez sur les éléments de l'image pour interagir"}),c.jsxs("div",{className:"scene-description",children:[c.jsx("div",{className:"scene-text",children:b.split(`
`).map((D,j)=>D.trim()===""?c.jsx("br",{},j):c.jsx("p",{children:D},j))}),o.content.description&&c.jsx("div",{className:"additional-description",children:o.content.description.split(`
`).map((D,j)=>D.trim()===""?c.jsx("br",{},j):c.jsx("p",{children:D},j))})]}),y.length>0&&c.jsxs("div",{className:"",children:[c.jsx("h4",{children:"Actions disponibles :"}),c.jsx("div",{className:"scene-choices",children:y.map((D,j)=>c.jsx("button",{className:"scene-choice",onClick:()=>C(D),children:D.text},j))})]})]})},y1=({mode:o,availableItems:l,playerInventory:s,playerGold:i,onPurchase:u,onSell:m,getItemPrice:p,shopCurrency:f="or"})=>{const[v,g]=se.useState(null),[y,b]=se.useState(1),E=j=>Aa[j]||Wt[j]||null,C=j=>{if(!u)return;u(j.id,y).success&&(g(null),b(1))},_=j=>{if(!m)return;m(j.id,y).success&&(g(null),b(1))},D=o==="buy"?l:s.filter(j=>{const q=E(j.id);return q&&q.value>0});return c.jsxs("div",{className:"shop-interface",children:[c.jsx("div",{className:"items-grid",children:D.length===0?c.jsx("div",{className:"empty-shop",children:o==="buy"?"Aucun objet en vente":"Aucun objet vendable"}):D.map((j,q)=>{const B=E(j.id);if(!B)return null;const F=o==="buy"?p(j):Math.floor((B.value||0)*.5),W=o==="buy"?i>=F:!0,le=o==="buy"?j.stock===-1||j.stock>0:!0;return c.jsxs("div",{className:`shop-item ${!W||!le?"unavailable":""} ${v?.id===j.id?"selected":""}`,onClick:()=>g(j),children:[c.jsxs("div",{className:"item-info",children:[c.jsx("h4",{className:"item-name",children:B.name}),c.jsx("p",{className:"item-description",children:B.description}),B.type==="weapon"&&c.jsx("div",{className:"item-stats",children:c.jsxs("span",{children:["Dégâts: ",B.damage.dice]})}),B.effect&&c.jsxs("div",{className:"item-effect",children:["Effet: ",B.effect.description||B.effect]})]}),c.jsxs("div",{className:"item-pricing",children:[c.jsxs("div",{className:"price",children:[F," ",f]}),o==="buy"&&j.stock!==-1&&c.jsxs("div",{className:"stock",children:["Stock: ",j.stock]}),o==="sell"&&j.quantity&&j.quantity>1&&c.jsxs("div",{className:"quantity-owned",children:["Possédé: ",j.quantity]}),!W&&o==="buy"&&c.jsx("div",{className:"insufficient-funds",children:"Pas assez d'or"}),!le&&o==="buy"&&c.jsx("div",{className:"out-of-stock",children:"Rupture de stock"})]})]},q)})}),v&&c.jsx("div",{className:"item-details",children:c.jsxs("div",{className:"details-content",children:[c.jsx("h3",{children:E(v.id)?.name}),c.jsx("p",{children:E(v.id)?.description}),c.jsxs("div",{className:"quantity-selector",children:[c.jsx("label",{children:"Quantité:"}),c.jsxs("div",{className:"quantity-controls",children:[c.jsx("button",{onClick:()=>b(Math.max(1,y-1)),disabled:y<=1,children:"-"}),c.jsx("span",{className:"quantity-value",children:y}),c.jsx("button",{onClick:()=>{const j=o==="buy"?v.stock===-1?10:v.stock:v.quantity||1;b(Math.min(j,y+1))},disabled:o==="buy"?v.stock!==-1&&y>=v.stock:v.quantity&&y>=v.quantity,children:"+"})]})]}),c.jsx("div",{className:"total-price",children:c.jsxs("strong",{children:["Total: ",o==="buy"?p(v)*y:Math.floor((E(v.id)?.value||0)*.5)*y," ",f]})}),c.jsxs("div",{className:"action-buttons",children:[o==="buy"?c.jsx("button",{className:"buy-button",onClick:()=>C(v),disabled:i<p(v)*y||v.stock!==-1&&v.stock<y,children:"🛒 Acheter"}):c.jsx("button",{className:"sell-button",onClick:()=>_(v),disabled:v.quantity&&v.quantity<y,children:"💰 Vendre"}),c.jsx("button",{className:"cancel-button",onClick:()=>g(null),children:"Annuler"})]})]})})]})},x1=({scene:o,gameState:l,onChoice:s,onPurchase:i,onSell:u,onBack:m})=>{const[p,f]=se.useState("dialogue"),[v,g]=se.useState("buy"),y=j=>{if(j.action?.type==="openShop"){f("shop"),g("buy");return}if(j.action?.type==="openSellInterface"){f("shop"),g("sell");return}s&&s(j)},b=()=>{f("dialogue")},E=(j,q=1)=>{const B=Yt.processShopAction({type:"purchase",itemId:j,quantity:q},l,o);return i&&i(B),B},C=(j,q=1)=>{const B=Yt.processShopAction({type:"sell",itemId:j,quantity:q},l,o);return u&&u(B),B},_=j=>{let q=j.price;const B=o.shop;return B.reputation_discount&&l.flags.reputation>=B.reputation_discount.threshold&&(q=Math.floor(q*B.reputation_discount.discount)),q},A=()=>o.shop?.inventory?o.shop.inventory.filter(j=>!(j.condition&&!Yt.evaluateCondition(j.condition,l)||j.stock!==-1&&j.stock<=0)):[],D=()=>o.shop?.special_offers?o.shop.special_offers.filter(j=>Yt.evaluateCondition(j.condition,l)):[];return p==="dialogue"?c.jsxs("div",{className:"merchant-scene",children:[c.jsx(Uf,{scene:o,gameState:l,onChoice:y,onBack:m}),D().length>0&&c.jsxs("div",{className:"special-offers",children:[c.jsx("h4",{children:"🎁 Offres spéciales"}),D().map((j,q)=>c.jsxs("div",{className:"special-offer",children:[c.jsx("p",{children:j.message}),j.reward&&c.jsxs("div",{className:"offer-reward",children:[j.reward.type==="item"&&`Récompense: ${j.reward.item}`,j.reward.type==="gold"&&`Récompense: ${j.reward.amount} or`,j.reward.type==="discount"&&`Réduction: ${j.reward.amount}%`]})]},q))]})]}):c.jsxs("div",{className:"merchant-scene shop-mode",children:[c.jsxs("div",{className:"shop-header",children:[c.jsxs("div",{className:"merchant-info",children:[o.content.portrait&&c.jsx("img",{src:o.content.portrait,alt:o.content.speaker,className:"merchant-portrait"}),c.jsxs("div",{children:[c.jsx("h3",{children:o.content.speaker}),c.jsx("p",{className:"shop-type",children:o.metadata.shop_type})]})]}),c.jsxs("div",{className:"player-gold",children:["💰 ",l.character?.gold||0," or"]})]}),c.jsxs("div",{className:"shop-tabs",children:[c.jsx("button",{className:`tab ${v==="buy"?"active":""}`,onClick:()=>g("buy"),children:"🛒 Acheter"}),c.jsx("button",{className:`tab ${v==="sell"?"active":""}`,onClick:()=>g("sell"),children:"💰 Vendre"})]}),c.jsx("div",{className:"shop-content",children:c.jsx(y1,{mode:v,availableItems:A(),playerInventory:l.character?.inventory||[],playerGold:l.character?.gold||0,onPurchase:E,onSell:C,getItemPrice:_,shopCurrency:o.shop?.currency||"or"})}),c.jsxs("div",{className:"shop-controls",children:[c.jsx("button",{className:"back-to-dialogue",onClick:b,children:"💬 Parler"}),m&&c.jsx("button",{className:"leave-shop",onClick:m,children:"🚪 Quitter"})]})]})},Gf=(o,l)=>{if(typeof o=="string")return o;if(typeof o=="object"){if(o.nextScene)return b1(o,l),o.nextScene;switch(o.type){case"combat":return{...o,enemies:o.enemies,enemyPositions:o.enemyPositions,next:o.next};case"longRest":return l.startLongRest(o.nextScene),null;case"shortRest":return l.startShortRest(o.nextScene),null;case"items":return l.handleItemGain(o.item),o.nextScene;case"ally":return Xf(o,l);case"skillCheck":return _1(o,l);case"setFlag":return S1(o);case"changeReputation":return j1(o,l);case"openShop":return o;case"openSellInterface":return o;case"scene_transition":return o.next;default:return console.warn("Type d'action inconnu :",o.type),null}}return null},b1=(o,l)=>{const s=gt.getState();switch(o.consequences&&s.applyConsequences(o.consequences),o.type){case"item":o.item&&l.handleItemGain(o.item);break;case"ally":o.ally&&Xf(o,l);break}},Xf=(o,l)=>{const s=Df[o.ally];if(s){const i={...s,id:o.ally.toLowerCase()};if(l.addCompanion){l.addCompanion(i);const p=[...ht.getState().activeCompanions,i.id];l.setActiveCompanions(p)}return gt.getState().addToList("companions",o.ally),l.addCombatMessage(`${s.name} te rejoint dans ton aventure !`,"upgrade"),o.nextScene}else return console.error(`Compagnon '${o.ally}' introuvable.`),null},_1=(o,l)=>{const s=ht.getState().playerCharacter;return s?(o.onSuccess&&typeof o.onSuccess=="object"&&o.onSuccess.consequences?l.handleSkillCheckWithConsequences?.(o.skill,o.dc,o.onSuccess,o.onPartialSuccess,o.onFailure,s)||l.handleSkillCheck(o.skill,o.dc,o.onSuccess.next||o.onSuccess,o.onPartialSuccess,o.onFailure,s):l.handleSkillCheck(o.skill,o.dc,o.onSuccess,o.onPartialSuccess,o.onFailure,s),null):(console.error("Aucun personnage joueur trouvé pour le test de compétence"),null)},S1=(o,l)=>{const s=gt.getState();return o.flags?s.setFlags(o.flags):o.flag&&o.value!==void 0&&s.setFlag(o.flag,o.value),o.nextScene},j1=(o,l)=>{const s=gt.getState();return typeof o.change=="number"&&(s.updateReputation(o.change),l.addCombatMessage(`Réputation ${o.change>0?"augmentée":"diminuée"} de ${Math.abs(o.change)}`,"info")),o.nextScene},T1=async(o,l,s)=>{if(o.consequences&&await gt.getState().applyConsequences(o.consequences),o.action){const i=Gf(o.action,s);if(i)return i;if(i===null)return null}return o.next},E1=()=>{const o=gt.getState(),l=ht.getState();return{flags:o.gameFlags,character:l.playerCharacter,currentScene:o.currentScene}},Tf=(o,l)=>({metadata:{type:o==="long"?w.REST_LONG:w.REST_SHORT,title:o==="long"?"Repos long":"Repos court"},choices:{next:l}}),A1=o=>({container:"game-container",mainContent:"main-content",sidebar:"sidebar"});function Ef({error:o,resetErrorBoundary:l}){return c.jsxs("div",{className:"error-boundary",children:[c.jsx("h2",{children:"Quelque chose s'est mal passé :"}),c.jsx("pre",{children:o.message}),c.jsx("button",{onClick:l,children:"Réessayer"})]})}function C1(){const{gamePhase:o,currentScene:l,isShortResting:s,isLongResting:i,nextSceneAfterRest:u,combatKey:m,setGamePhase:p,setCurrentScene:f,addCombatMessage:v,handleSkillCheck:g,startShortRest:y,startLongRest:b,endShortRest:E,endLongRest:C}=gt(),{playerCharacter:_,setPlayerCharacter:A,addCompanion:D,setActiveCompanions:j,getActiveCompanions:q,addItemToInventory:B,castSpellPlayer:F,shortRestPlayer:W,longRestAll:le,addExperience:ae}=ht(),{initializeCombat:J,resetCombat:ee,incrementCombatKey:ie}=ca(),{showError:Ne}=Ze(),Me=te=>{const De={...te,gold:te.gold||100};A(De),p("game"),v("La fortune sourit aux audacieux")},X=()=>{const{totalXpGained:te,combatEnemies:De}=ca.getState(),_e=te||De.reduce((oa,ta)=>oa+(ta.xp||0),0);_e>0&&(ae(_e,"player"),v(`Vous gagnez ${_e} points d'expérience !`,"victory"),q().forEach(ta=>{v(`${ta.name} gagne aussi ${_e} points d'expérience !`,"victory")}));const Xe=pf[l],Zt=Xe?.metadata?.next||Xe?.next;ee(),v("Combat terminé ! Victoire !","victory"),Zt?f(Zt):(console.warn("Aucune scène suivante n'est définie après le combat."),f("fin_du_jeu"))},Y=te=>{(Array.isArray(te)?te:[te]).forEach(_e=>{let Xe=Aa[_e];if(Xe||(Xe=Wt[_e]),Xe){const Zt={...Xe,id:_e};B(Zt),console.log(`Objet obtenu : ${Xe.name}`,"item"),v(`Objet obtenu : ${Xe.name}`,"item")}else console.error(`❌ Item non trouvé dans items.js ou weapons.js : ${_e}`)})},P=()=>{W(),E()},N=()=>{le(),C(),v("Repos long terminé - PV et sorts restaurés","rest")},G=(te,De=null)=>{try{F(te,De?{spellLevel:De}:{}),v(`Sort lancé : ${te.name}`,"spell")}catch(_e){console.error("Erreur lors du lancement du sort:",_e),Ne(`Impossible de lancer le sort : ${_e.message}`)}};if(o==="character-selection")return c.jsx(mf,{FallbackComponent:Ef,children:c.jsx(Qv,{onCharacterSelect:Me})});if(!_)return c.jsx("div",{className:"game-container",children:c.jsx("div",{className:"main-content",children:c.jsx("p",{children:"Chargement de ton personnage..."})})});const{container:Q,mainContent:I,sidebar:S}=A1(),k=()=>{const te=E1();return te.character=_,te},Z=async te=>{const De=k(),_e=await T1(te,De,{startLongRest:b,startShortRest:y,handleItemGain:Y,addCompanion:D,setActiveCompanions:j,addCombatMessage:v,handleSkillCheck:g});_e&&f(_e)},K=te=>{if(te.action){const De=Gf(te.action,{startLongRest:b,startShortRest:y,handleItemGain:Y,addCompanion:D,setActiveCompanions:j,addCombatMessage:v,handleSkillCheck:g});De&&f(De)}},re=te=>{if(te.success){const De={..._,gold:(_.gold||0)+te.effects.gold};A(De),te.effects.items&&Y(te.effects.items),v(te.message,"success")}else v(te.message,"error")},he=te=>{if(te.success){const De={..._,gold:(_.gold||0)+te.effects.gold};A(De),te.effects.removeItems&&console.log("Items to remove:",te.effects.removeItems),v(te.message,"success")}else v(te.message,"error")},me=te=>{const De=k();if(!Yt.shouldShowScene(te,De))return c.jsx("p",{children:"Cette scène n'est pas disponible actuellement."});switch(te.metadata.type){case w.DIALOGUE:return c.jsxs("div",{className:"scene-dialogue",children:[c.jsx(Uf,{scene:te,gameState:De,onChoice:Z}),c.jsx(Ea,{title:"Journal",compact:!0})]});case w.INTERACTIVE:return c.jsxs("div",{className:"scene-interactive",children:[c.jsx(v1,{scene:te,gameState:De,onHotspotClick:K,onChoice:Z}),c.jsx(Ea,{title:"Journal",compact:!0})]});case w.MERCHANT:return c.jsxs("div",{className:"scene-merchant",children:[c.jsx(x1,{scene:te,gameState:De,onChoice:Z,onPurchase:re,onSell:he}),c.jsx(Ea,{title:"Journal",compact:!0})]});case w.REST_LONG:return c.jsxs("div",{className:"scene-rest-long",children:[c.jsx(Fc,{type:"long",character:_,onRestComplete:()=>{N(),te.next?f(te.next):console.warn("Pas de scène suivante définie après le repos long")}}),c.jsx(Ea,{title:"Journal",compact:!0})]});case w.REST_SHORT:return c.jsxs("div",{className:"scene-rest-short",children:[c.jsx(Fc,{type:"short",character:_,onRestComplete:()=>{P(),te.next?f(te.next):console.warn("Pas de scène suivante définie après le repos court")}}),c.jsx(Ea,{title:"Journal",compact:!0})]});case w.REST_CHOICE:return c.jsxs("div",{className:"scene-rest-choice",children:[c.jsx(Fc,{character:_,onRestComplete:_e=>{_e==="long"?N():P(),te.next?f(te.next):console.warn("Pas de scène suivante définie après le repos")},onCancel:()=>{te.back?f(te.back):console.warn("Pas de scène de retour définie")}}),c.jsx(Ea,{title:"Journal",compact:!0})]});case w.COMBAT:{const _e={};te.enemyPositions&&Array.isArray(te.enemyPositions)&&te.enemyPositions.forEach((Zt,oa)=>{if(te.enemies&&te.enemies[0]){const ta=te.enemies[0].type,qi=`${{name:ta.charAt(0).toUpperCase()+ta.slice(1)}.name} ${oa+1}`;_e[qi]=Zt}});const Xe={type:"combat",enemies:te.enemies||[],enemyPositions:_e,playerPosition:te.playerPosition||null,companionPositions:te.companionPositions||null,next:te.metadata.nextScene||te.next};return console.log("🎯 Combat scene data:",te),console.log("🎯 Combat data for CombatPanel:",Xe),console.log("🎯 Enemy positions converted:",_e),c.jsx(e1,{playerCharacter:_,activeCompanions:q(),encounterData:Xe,onCombatEnd:()=>{X(),te.metadata.nextScene&&f(te.metadata.nextScene)},onReplayCombat:()=>{_&&A({..._,currentHP:_.maxHP}),q().forEach(oa=>{}),ee(),ie(),v("🔄 Combat réinitialisé !","info"),setTimeout(()=>{const oa={..._,currentHP:_.maxHP},ta=q().map(vt=>({...vt,currentHP:vt.maxHP}));J(te,oa,ta)},100)}},m)}case"error":return c.jsxs("div",{className:"scene-error",children:[c.jsx("h3",{children:"⚠️ Scène introuvable"}),c.jsx("p",{children:te.content.text}),c.jsx("button",{onClick:()=>f("introduction"),children:"Retour au début"})]});case w.TEXT:default:return c.jsxs("div",{className:"scene-textuel-new",children:[c.jsxs("div",{className:"scene-content",children:[c.jsx("h3",{children:te.metadata.title}),c.jsx("div",{className:"scene-text",children:Yt.getSceneText(te,De).split(`
`).map((_e,Xe)=>_e.trim()===""?c.jsx("br",{},Xe):c.jsx("p",{children:_e},Xe))})]}),c.jsx("div",{className:"scene-choices",children:Yt.getAvailableChoices(te,De).map((_e,Xe)=>c.jsx("button",{className:"choice-button",onClick:()=>Z(_e),children:_e.text},Xe))}),c.jsx(Ea,{title:"Journal",compact:!0})]})}},lt=()=>{if(i)return Tf("long",u);if(s)return Tf("short",u);const te=pf[l];return te||{metadata:{type:"error",title:"Erreur"},content:{text:`La scène "${l}" n'existe pas dans newScenes.`,error:!0}}},Oe=_?.spellcasting,ea=_?.specialAbilities;return c.jsx(mf,{FallbackComponent:Ef,children:c.jsxs("div",{className:Q,children:[c.jsx("div",{className:I,children:me(lt())}),c.jsxs("div",{className:`${S} right-sidebar`,children:[c.jsx(Pf,{character:_,variant:"interactive"}),c.jsx(Jv,{companions:q(),variant:"default",showRoles:!0}),c.jsx(l1,{}),Oe&&c.jsx(m1,{character:_,onCastSpell:G,isOutOfCombat:!0}),ea&&c.jsx(Zv,{character:_})]})]})})}yg.createRoot(document.getElementById("root")).render(c.jsx(C1,{}));
